{"version":3,"sources":["tonva/index.ts","tonva/components/index.ts","tonva/components/nav.tsx","tonva/net/netToken.ts","tonva/components/fetchErrorView.tsx","tonva/components/reloadPage.tsx","tonva/entry/login.tsx","tonva/net/guestApi.ts","tonva/net/caller.ts","tonva/tool/cacheIds.ts","tonva/tool/local.ts","tonva/tool/getObjPropIgnoreCase.ts","tonva/components/page/page.tsx","tonva/net/appBridge.ts","tonva/components/edit/itemEdit.tsx","tonva/uq/caller.ts","tonva/uq/entity.ts","tonva/net/httpChannel.ts","tonva/net/httpChannelUI.ts","tonva/net/uqApi.ts","tonva/res/res.ts","tonva/vm/controller.tsx","tonva/vm/view.tsx","tonva/vm/vpage.tsx","tonva/vm/components/CStringEdit.tsx","tonva/tool/uid.ts","tonva/uq/query.ts","tonva/net/wsChannel.ts","tonva/components/image.tsx","tonva/uq/index.ts","tonva/tool/user.ts","tonva/net/host.ts","tonva/components/page/scrollView.tsx","tonva/uq/action.ts","tonva/components/simple/LMR.tsx","tonva/components/simple/Badge.tsx","tonva/components/simple/FA.tsx","tonva/components/simple/IconText.tsx","tonva/components/simple/Muted.tsx","tonva/tool/localDb.ts","tonva/uq/tuid/reactBoxId.tsx","tonva/components/loading.tsx","tonva/res/formRes.ts","tonva/res/listRes.ts","tonva/res/entry/login.ts","tonva/res/entry/register.ts","tonva/tool/env.ts","tonva/uq/tuid/index.ts","tonva/net/apiBase.ts","tonva/components/edit/imageItemEdit.tsx","tonva/tool/pageItems.ts","tonva/net/messageHub.ts","tonva/components/navigo.ts","tonva/components/page/pageHeader.tsx","tonva/components/page/tabs.tsx","tonva/components/resUploader.tsx","tonva/uq/uqMan.ts","tonva/uq/sheet.ts","tonva/uq/book.ts","tonva/uq/history.ts","tonva/uq/map.ts","tonva/uq/pending.ts","tonva/uq/tag/tagView.tsx","tonva/uq/tag/tag.ts","tonva/img/logo.svg","tonva/entry/tools.tsx","tonva/components/page/index.ts","tonva/components/schema/index.ts","tonva/components/rules/index.ts","tonva/components/dropDownActions/index.tsx","tonva/components/easyDate/index.tsx","tonva/components/media.tsx","tonva/components/searchBox.tsx","tonva/components/userIcon.tsx","tonva/components/ax/index.tsx","tonva/components/autoHideTips.tsx","tonva/uq/tuid/tuidsCache.ts","tonva/uq/uqsMan.ts","tonva/components/form/rules/index.ts","tonva/components/form/widgets/widget.tsx","tonva/components/form/widgets/textWidget.tsx","tonva/components/form/widgets/textareaWidget.tsx","tonva/components/form/widgets/passwordWidget.tsx","tonva/components/form/widgets/numberWidget.tsx","tonva/components/form/widgets/updownWidget.tsx","tonva/components/form/widgets/dateWidget.tsx","tonva/components/form/widgets/checkBoxWidget.tsx","tonva/components/form/widgets/selectWidget.tsx","tonva/components/form/widgets/radioWidget.tsx","tonva/components/form/widgets/rangeWidget.tsx","tonva/components/form/widgets/idWidget.tsx","tonva/components/form/widgets/unknown.tsx","tonva/components/form/widgets/buttonWidget.tsx","tonva/components/form/context.tsx","tonva/components/form/widgets/arrComponent.tsx","tonva/components/form/widgets/imageWidget.tsx","tonva/components/form/widgets/tagWidget.tsx","tonva/components/form/widgets/factory.tsx","tonva/components/form/form.tsx","tonva/components/form/field.tsx","tonva/components/edit/stringItemEdit.tsx","tonva/components/edit/radioItemEdit.tsx","tonva/components/edit/selectItemEdit.tsx","tonva/components/edit/idItemEdit.tsx","tonva/components/edit/tagItemEdit.tsx","tonva/components/edit/textAreaItemEdit.tsx","tonva/components/edit/checkBoxItemEdit.tsx","tonva/components/edit/rangeItemEdit.tsx","tonva/components/edit/numberItemEdit.tsx","tonva/components/edit/edit.tsx","tonva/app/centerApi.ts","tonva/app/vMain.tsx","tonva/app/CAppBase.ts","tonva/app/start.ts","tonva/app/CBase.ts","tonva/components/list/base.tsx","tonva/components/list/clickable.tsx","tonva/components/list/static.tsx","tonva/components/list/selectable.tsx","tonva/components/list/index.tsx","tonva/components/propGrid/row.tsx","tonva/components/propGrid/propView.tsx","tonva/components/propGrid/PropGrid.tsx","tonva/entry/meInfo.tsx","tonva/uq/tuid/idCache.ts","tonva/uq/tuid/tuid.ts","serviceWorker.ts","tapp/appConfig.ts","tapp/appName.ts","tapp/CBase.ts","tapp/main.tsx","notes/model.ts","notes/views/VBasePage.tsx","notes/views/VSelectContact.tsx","notes/views/VNotesDropDown.tsx","notes/noteBase/CNoteBase.tsx","notes/noteBase/VNoteBase.tsx","notes/noteBase/VNoteBaseDir.tsx","notes/noteBase/VNoteBaseEdit.tsx","notes/noteBase/VNoteBaseForm.tsx","notes/noteBase/VNoteBaseView.tsx","tool/none.tsx","tool/VAddContact.tsx","notes/noteBase/VRelativesBase.tsx","notes/components/content/CContent.ts","notes/components/content/checkable/VBase.tsx","notes/components/content/checkable/VView.tsx","notes/components/content/checkable/VItem.tsx","notes/components/content/ListInputBase.tsx","notes/components/content/checkable/CheckableListInput.tsx","notes/components/content/checkable/CCheckable.ts","notes/components/content/list/VView.tsx","notes/components/content/list/ListInput.tsx","notes/components/content/list/CList.ts","notes/components/content/textBase/CTextBase.ts","notes/components/content/textBase/VTextBaseView.tsx","notes/components/content/textBase/VTextBaseInput.tsx","notes/components/content/text/VInput.tsx","notes/components/content/text/VView.tsx","notes/components/content/text/CText.ts","notes/components/content/folder/VInput.tsx","notes/components/content/folder/VView.tsx","notes/components/content/folder/CFolder.ts","notes/components/to/VSent.tsx","notes/components/to/VTo.tsx","notes/components/to/CTo.ts","notes/components/selectContact/VSelectContact.tsx","notes/components/selectContact/CSelectContact.ts","notes/components/inputHours/VInputHours.tsx","notes/components/inputHours/CInputHours.ts","notes/components/renderParagraphs.tsx","notes/container/views/VFolder.tsx","notes/container/unitNote/model.ts","notes/container/views/VFolderDir.tsx","notes/container/views/VFolderRelatives.tsx","notes/container/views/VFolderView.tsx","notes/container/CContainer.ts","notes/container/space/VSpaceDir.tsx","notes/container/space/VSpaceMembers.tsx","notes/container/space/VSpaceView.tsx","notes/container/views/VContainerForm.tsx","notes/container/space/VSpaceEdit.tsx","notes/container/space/VContentView.tsx","notes/container/space/VContacts.tsx","notes/container/space/VSpaceAdd.tsx","notes/container/space/CSpace.ts","notes/container/CFolder.ts","notes/container/folderMy/VFolderMyEdit.tsx","notes/container/folderMy/VFolderMyAdd.tsx","notes/container/folderMy/VFolderMyView.tsx","notes/container/folderMy/VFolderMy.tsx","notes/container/folderMy/CFolderMy.ts","notes/container/folderShare/VFolderShare.tsx","notes/container/folderShare/CFolderShare.ts","notes/container/folderRoot/CFolderRoot.ts","notes/container/unitNote/admin/VRootProjects.tsx","notes/container/unitNote/admin/VUnitProjects.tsx","notes/container/unitNote/admin/VReportsAdmin.tsx","notes/container/unitNote/admin/VUnitAdmin.tsx","notes/container/unitNote/admin/CUnitAdmin.ts","notes/container/unitNote/VUnitNoteDir.tsx","notes/container/unitNote/VUnitNoteView.tsx","notes/container/unitNote/CUnitNote.ts","notes/note/components/comments/VCommentsList.tsx","notes/note/task/TaskState.ts","notes/note/components/comments/VAddComment.tsx","notes/note/components/comments/VWriteComment.tsx","notes/note/components/comments/CComments.ts","notes/note/CNote.ts","notes/note/views/VRelativesNoteBase.tsx","notes/note/assign/VAssignRelatives.tsx","notes/note/assign/VAssignView.tsx","notes/note/assign/VAssignAdd.tsx","notes/note/assign/VAssignEdit.tsx","notes/note/assign/VAssignDir.tsx","notes/note/assign/VAssignParams.tsx","notes/note/assign/CAssignTo.ts","notes/note/task/content/VBase.tsx","notes/note/task/content/VView.tsx","notes/note/task/content/VItem.tsx","notes/note/task/content/CTaskContent.ts","notes/note/task/CNoteTask.ts","notes/note/task/VTaskRelatives.tsx","notes/note/task/VTaskView.tsx","notes/note/task/VTaskObserver.tsx","notes/note/task/CTaskObserver.ts","notes/note/assign/CNoteAssign.ts","notes/note/text/VTextRelatives.tsx","notes/note/text/VTextHeader.tsx","notes/note/text/VTextView.tsx","notes/note/text/VTextEdit.tsx","notes/note/text/VTextAdd.tsx","notes/note/text/VTextDir.tsx","notes/note/text/CNoteText.ts","notes/note/task/start/VTaskStart.tsx","notes/note/task/start/CTaskStart.ts","notes/note/task/done/VTaskDone.tsx","notes/note/task/done/CTaskDone.ts","notes/note/task/canceled/VTaskCanceled.tsx","notes/note/task/canceled/CTaskCanceled.ts","notes/note/task/pass/VTaskPass.tsx","notes/note/task/pass/CTaskPass.ts","notes/note/task/fail/VTaskFail.tsx","notes/note/task/fail/CTaskFail.ts","notes/note/task/rated/VTaskRated.tsx","notes/note/task/rated/CTaskRated.ts","notes/note/task/VEditTextItem.tsx","notes/note/task/check/VTaskCheck.tsx","notes/note/task/check/CTaskCheck.ts","notes/note/task/rate/VRateTask.tsx","notes/note/task/rate/CTaskRate.ts","notes/views/VActions.tsx","notes/CShareTo.ts","notes/CNotes.ts","notes/container/index.ts","notes/note/task/index.ts","notes/container/unitNote/index.ts","home/VHome.tsx","home/CHome.ts","relation/VAdd.tsx","relation/VRelation.tsx","relation/contact/VContact.tsx","relation/contact/VEditAssigned.tsx","relation/contact/CContact.ts","relation/CRelation.ts","me/VAdmin.tsx","me/VEditMe.tsx","me/VMe.tsx","me/CMe.ts","tapp/uqs.ts","discover/VDiscover.tsx","book/VBook.tsx","book/VFlow.tsx","book/CBook.ts","discover/CDiscover.ts","tapp/VTestMe.tsx","tapp/VTestAB.tsx","tapp/res/index.ts","tapp/res/zh.ts","tapp/res/en.ts","tapp/CApp.ts","index.tsx"],"names":["logMark","netToken","userId","token","setCenterToken","WSChannel","FetchErrorView","reApi","a","props","clearError","channel","url","options","resolve","reject","refetchApi","close","errContent","this","error","err","i","push","key","style","wordWrap","className","type","onClick","React","SystemNotifyPage","message","header","ReloadPage","reload","clearInterval","timerHandler","nav","seconds","undefined","state","setInterval","setState","title","msg","ConfirmReloadPage","back","confirm","schema","name","required","maxLength","Login","res","resLang","loginRes","uiSchema","items","username","placeholder","label","password","widget","login","onSubmit","context","values","form","data","un","pwd","userApi","user","guest","sender","getSender","caption","console","log","userLogined","callback","onEnter","footer","href","margin","privacyEntry","withBack","tonvaTop","onButtonClick","requiredFlag","isMobile","RegExp","test","navigator","userAgent","logs","stackKey","NavView","waitCount","upgradeUq","start","isHistoryBack","navBack","tick","Date","now","stack","length","len","window","self","top","postMessage","confirmClose","pop","fetchError","wait","set","addEventListener","init","waitTimeHandler","env","setTimeout","clearTimeout","unauthorized","showLogin","uq","version","show","view","disposer","clear","removeCeased","history","pushState","ceased","refresh","item","dispose","level","p","backLevel","popAndDispose","find","v","elWait","elError","testing","left","zIndex","map","index","visibility","position","local","LocalData","arrs","windowOnError","event","source","lineno","colno","windowOnUnhandledRejection","ev","reason","windowOnClick","windowOnMouseMove","x","y","windowOnScroll","navLogin","params","navLogout","showLogout","navRegister","showRegister","navForget","showForget","sysRoutes","isWebNav","backIcon","closeIcon","showPrivacyPage","privacy","getPrivacyContent","privacyPage","getPrivacy","html","content","__html","marked","dangerouslySetInnerHTML","waiting","Promise","race","serviceWorker","ready","registration","unregister","location","plus","webview","webView","resetAll","ok","showReloadPage","localStorage","lang","resOptions","district","language","culture","navView","messageHub","dispatch","unitJsonPath","fetch","unitRes","json","unit","remove","process","isMiniprogram","el","document","getElementById","innerText","loadUnitJson","innerHTML","JSON","parse","envUnit","REACT_APP_UNIT","Number","get","isDevelopment","id","getPredefinedUnitName","unitName","guestApi","unitFromName","unitId","settings","navSettings","origin","pathname","toLowerCase","_","endsWith","substr","host","hash","pos","getExHashPos","hashParam","substring","ws","resHost","centerHost","resUrl","resUrlFromHost","wsHost","setCenterUrl","Error","setGuest","exHash","getExHash","appInFrame","setAppInFrame","parent","noUnit","predefinedUnit","loadPredefinedUnit","onerror","onunhandledrejection","onselectstart","oncontextmenu","startWait","notLogined","logined","endWait","navigo","Navigo","historyAPIUpdateMethod","on","onNavRoutes","navPage","queryStr","routeFromNavPage","navPageRoutes","merge","navOns","route","absolute","navigate","alert","showPage","isUserLogin","onLogined","me","icon","nick","logoutApis","stringify","saveLocalUser","showAppView","internalLogined","defaultTop","loginTop","headers","indexOf","http","method","text","loginView","lv","logout","c","RegisterController","ForgetController","logoutClear","cp","ChangePasswordPage","onError","showUpgradeUq","replace","topKey","popTo","ceaseTop","regConfirmClose","confirmBox","apiId","sheetType","sheetId","sheet","includes","uh","appUrl","src","String","open","date","getTime","toTimeString","step","ret","r","parser","DOMParser","htmlDoc","parseFromString","elHtml","getElementsByTagName","newVersion","getAttribute","g","oem","observable","decodeGuestToken","CenterApiBase","Caller","_params","maxCount","arr","ids","dict","loadId","shift","delete","_loadIds","_loadId","setItem","e","Map","localDb","child","_user","_guest","_unit","forEach","d","getObjPropIgnoreCase","obj","prop","keys","Object","Page","observer","tabsProps","tabsView","TabsView","webNav","right","headerClassName","afterBack","inWebNav","pageHeaderProps","center","rph","renderPageHeader","elFooter","pageWebNav","onScroll","onScrollTop","onScrollBottom","children","renderHeader","renderFooter","uqTokens","logoutUqTokens","appsInFrame","val","isBridged","subFrameStarted","evt","subWin","setSubAppWindow","hidden","hideFrameBack","clone","initSubWin","onReceiveAppApiMessage","apiName","db","parts","split","param","uqOwner","uqName","appOwner","appName","uqTokenApi","onAppApiReturn","urlTest","action","uqTokenActions","realUrl","getUrlOrTest","appHash","page","slice","lastIndexOf","u","uid","getUnit","realUnit","onReceive","callCenterApiFromMessage","bridgeCenterApiReturn","startsWith","buildAppUq","uqToken","centerToken","at","opener","appUq","brideCenterApis","bridgeCenterApi","body","callId","o","from","callCenterapi","directCall","result","bca","ItemEdit","edit","itemSchema","uiItem","value","_itemSchema","_uiItem","internalStart","internalEnd","divValue","labelHide","templet","Templet","list","rules","nv","newValue","Array","isArray","verifyRule","rule","EntityCaller","entity","tries","_entity","loadSchema","innerRequest","uqApi","xcall","innerCall","jsonResult","$uq","$modify","pullModify","xresult","retry","rebuildSchema","buildEntities","setSchema","ver","uqVersion","en","ActionCaller","QueryQueryCaller","unpackReturns","buildParams","QueryPageCaller","pageStart","pageSize","ln","chars","codeBackSlash","charCodeAt","codeN","codeT","codeB","codeF","codeV","codeR","codes","codeBN","codeBT","codeBB","codeBF","codeBV","codeBR","Entity","typeId","fieldMaps","sys","cache","localMap","jName","fields","arrFields","returns","f","loadEntitySchema","buildFieldsTuid","loadValues","setJName","buildFieldTuid","buildArrFieldsTuid","fieldName","arrName","entities","fn","getTuid","an","fieldArr","tuid","buildFieldsParams","arrResult","pa","rowResult","field","buildDateTimeParam","getFullYear","getMonth","getDate","_tuid","getIdFromObj","dt","Math","floor","toISOString","packRow","arrData","packArr","join","row","ch","escape","boxId","unpackRow","unpackArr","ch0","fLen","to","reverseNT","n","isNaN","p0","vals","methodsWithBody","HttpChannel","hostUrl","apiToken","ui","showError","timeout","post","urlPrefix","caller","buildOptions","path","h","encodeURI","innerFetch","k","innerFetchResult","buildError","ex","retErr","that","timeOutHandler","wxfetch","statusText","jres","ct","then","retJson","retError","catch","buildHeaders","CenterHttpChannel","UqHttpChannel","HttpChannelNavUI","channelUIs","channelNoUIs","channels","UqApi","basePath","access","showWaiting","channelUI","acc","ApiBase","UnitxApi","buildChannel","centerAppApi","CenterAppApi","unitxUq","centerChannel","centerChannelUI","loginedUserId","t","uqTokensName","localCache","nowTick","appUqParams","call","loadAppUqs","uqs","decodeUserToken","account","verify","$lang","$district","l","languages","toUpperCase","setResOptions","resGlobal","setRes","target","str","setGlobalRes","Controller","_t","isDev","unregisterReceiveHandler","receiveHandlerId","onDispose","onMessageReceive","onMessage","internalT","beforeInit","getPageWebNav","afterInit","vp","replaceOpen","render","onEvent","openPage","registerReceiveHandler","beforeStart","afterStart","_resolve_$","onClosePage","go","topPageKey","yes","no","classNames","closePage","buttons","View","controller","isMe","vm","vCall","returnCall","imageClassName","textClassName","renderUser","replacePage","backPage","ceasePage","popToTopPage","VPage","_onClosePage","retOnClosePage","openPageElement","renderPage","replacePageElement","onPageScroll","scroller","onPageScrollTop","onPageScrollBottom","CStringEdit","onChange","preValue","isChanged","onBlur","verifyValue","onFocus","onEdit","onValueChange","onSave","createElement","disabled","onKeyDown","keyCode","defaultValue","renderValue","renderPencil","ALPHABET","rtn","charAt","random","QueryPager","query","firstSize","itemObservable","appendPosition","$page","sortOrder","order","idFieldName","_items","startIndex","getPageId","load","splice","newItem","newId","oldItem","oldId","PageItems","Query","isPaged","size","more","startField","array","deep","pageCaller","request","queryCaller","table","subAppWindow","postWsToSubApp","win","WsBase","wsBaseSeed","wsBaseId","WebSocket","onopen","onmessage","wsMessage","onclose","receive","netThis","connect","send","Image","altImage","alt","currentTarget","jwtDecode","uqDebugHost","hosts","centerhost","reshost","uqhost","unitxhost","httpArr","urlFromHost","isAbsoluteUrl","centerUrlFromHost","centerWsFromHost","https","fetchOptions","mode","getCenterHost","getResHost","promises","hostArr","findIndex","fetchUrl","debugHostUrl","localCheck","all","results","j","hostValue","debugHost","getUrlOrDebug","urlDebug","fetchLocalCheck","Scroller","scrollTo","scrollTop","offsetHeight","scrollTimeGap","ScrollViewBase","bottomTime","topTime","refDiv","div","onResize","removeEventListener","sh","scrollHeight","direct","Children","_$scroll","toString","eachChild","Component","ScrollView","ref","WebNavScrollView","vHeader","vFooter","navHeader","navRawHeader","navFooter","navRawFooter","Action","ActionSubmitCaller","SubmitReturnsCaller","SubmitConvertCaller","pack","LMR","b","badge","color","badgeAlign","badgeVertical","cn","cursor","FA","spin","fixWidth","border","pull","pulse","rotate","flip","inverse","IconText","iconClass","textClass","Muted","__ls","getItem","removeItem","LocalCache","removeLocal","Local","caches","locals","keyForGet","keyForSet","sk","LocalArr","LocalMap","keyForRemove","removeAll","ks","unshift","saveIndex","max","ls","TuidContent","tuidName","s","uqStringify","ReactBoxId","isUndefined","boxName","assureBox","valueFromId","tuidValue","nullUI","ttv","divObj","bi","logContent","boxIdContent","Loading","formRes","number","integer","min","zh","listRes","none","registerRes","tag","ms","args","global","handle","getHttpChannel","callFetch","put","ImageItemEdit","resId","onSaved","isFirst","scrollToTop","scrollIntoView","topDiv","scrollToBottom","bottomDiv","changing","pageItemAction","itemConverter","divId","loadResults","pageList","beforeLoad","loaded","allLoaded","reset","isAsc","endItem","scrollToEnd","pushItem","endIndex","startId","pid","sum","setLoaded","loading","onLoad","setPageStart","onLoaded","reverse","computed","handlerSeed","anyHandlers","msgHandlers","handler","seed","args0","handlerId","$type","useHash","_routes","_onLocationChange","root","_useHash","_hash","_paused","_destroyed","_lastRouteResolved","_notFoundHandler","_defaultHandler","_usePushState","isPushStateAvailable","_genericHooks","_historyUpdateMethod","_cLoc","_listen","updatePageLinks","cleanUrl","match","names","reduce","decodeURIComponent","paramNames","regexp","PARAMETER_REGEXP","full","dots","REPLACE_VARIABLE_REGEXP","WILDCARD_REGEXP","REPLACE_WILDCARD","FOLLOWED_BY_SLASH_REGEXP","MATCH_REGEXP_FLAGS","urlA","urlB","getUrlDepth","routes","replaceDynamicURLParts","clean","regExpResultToParams","filter","m","findMatchedRoutes","colonExp","matched","routeExp","fallbackURL","matched0","cleanGETParam","hooks","exHooks","before","shouldRoute","after","_getRoot","_historyUpdate","arg0","arg1","orderedRoutes","sort","compareUrlDepth","uses","_add","current","GETParameters","extractGETParameters","onlyURL","getOnlyURL","already","manageHooks","_callLeave","isHashedRoot","timout","_findLinks","link","hasListenerAttached","ctrlKey","metaKey","tagName","getLinkPath","preventDefault","status","pause","destroy","as","replaceState","cLocRoot","isHashChangeAPIAvailable","cached","check","querySelectorAll","lastRouteResolved","leave","onBack","vBack","debugLogout","role","rightView","Tab","onShown","selected","_content","contentBuilder","TabCaptionComponent","tabClick","tab","selectedTab","tabArr","shown","tabs","bsCur","bsTab","tabPosition","borderColor","borderStyle","borderTopWidth","borderLeftWidth","borderRightWidth","borderBottomWidth","borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius","tabBg","sep","notifyCircle","notify","num","displayNone","pageHeader","pageFooter","tabBack","isSelected","display","ResUploader","upload","formData","buildFormData","onFilesChange","files","fileName","maxSize","fileInput","FormData","file","append","multiple","formatSize","pointLength","units","toFixed","xlargeSize","mediumSize","ImageUploader","onFileChange","fileError","uploaded","enableUploadButton","suffix","imageTypes","reader","FileReader","readAsDataURL","onload","srcImage","setSize","imgBaseSize","desImgSize","desImage","compress","img","width","height","srcImgWidth","srcImgHeight","w","scale","desImgWidth","round","desImgHeight","canvas","ctx","getContext","anw","createAttribute","nodeValue","anh","setAttributeNode","drawImage","base64","toDataURL","blob","convertBase64UrlToBlob","resUploader","showOrgImage","maxWidth","urlData","mime","bstr","atob","u8arr","Uint8Array","Blob","defaultChecked","levelDiv","padding","AudioUploader","audioTypes","fileSize","uploading","UqMan","uqData","createBoxId","tvs","actions","sheets","queries","books","maps","histories","pendings","tags","tuids","createBoxIdFromTVs","tuidArr","actionArr","sheetArr","queryArr","bookArr","mapArr","historyArr","pendingArr","tagArr","localModifyMax","localAccess","trim","tuidsCache","TuidsCache","accesses","loadAccess","buildTuids","buildAccess","newTuid","entityName","fromType","fromObj","defer","cacheTuids","TuidImport","TuidInner","book","Book","Tag","History","pending","Pending","Sheet","newAction","newQuery","newBook","newMap","newHistory","newSheet","newPending","newTag","buildSheet","build","mainFields","buildTuidBox","owner","ownerField","buildTuidDivBox","modifyMax","states","ops","op","discription","app","SaveCaller","flow","brief","unpackSheet","flows","GetSheetCaller","getArchive","unpack","SheetArchiveCaller","SheetArchivesCaller","StateSheetsCaller","PageStateItems","StateSheetCountCaller","UserSheetsCaller","MySheetsCaller","SheetCaller","count","getStateSheets","queryApiName","BookQueryCaller","schemaFrom","actionSchema","querySchema","AddCaller","DelCaller","AllCaller","PageCaller","qc","QueryCaller","MapCaller","getCaller","MapAddCaller","add","MapDelCaller","MapAllCaller","MapPageCaller","MapQueryCaller","radioStyle","TagView","nameFromId","namesFromIds","renderRadio","renderView","checked","renderCheck","wrapClassName","inputs","inputName","onInputChange","input","coll","lines","line","ext","_view","logo","senders","regex","mobileRegex","emailRegex","DropdownActions","handleDocumentClick","dropdownOpen","button","contains","menu","toggle","isRight","itemIconClass","itemCaptionClass","hasIcon","some","data-toggle","aria-expanded","captionClass","aria-hidden","onTouchStart","timeRes","md","month","ymd","year","yesterday","today","tomorrow","$zh","$en","tt","renderDate","vDate","withTime","always","nDate","_date","nowYear","hour","getHours","minute","getMinutes","appendTime","dPart","hm","EasyTime","SearchBox","allowEmptySearch","initKey","onSearch","inputSize","inputClassName","buttonText","userCache","loader","UserView","noneImage","getValue","idProp","useUser","use","Ax","axProps","aClassName","naClassName","loadIds","clearCacheTimer","cacheIds","cacheTimer","tuidCached","innerPullModify","tuidLists","queueModify","group","queue","modify","modifyIds","UQsMan","tonvaAppName","buildTVs","collection","localData","uqsMan","uqAppData","retErrors","setTuidImportsLocal","_uqs","buildUQs","errors","uqTVs","lj","uqsData","promiseInits","uqFullName","lower","loadEntities","uqMan","Proxy","receiver","showReload","isImport","setInner","tuidImport","fromName","iName","setFrom","Rule","RuleCustom","func","defy","RulePredefined","RuleRequired","RuleNum","minMsg","template","maxMsg","checkMore","RuleInt","isInteger","Widget","fieldProps","changeValue","container","visible","inNode","FieldContainer","renderBody","_ui","getUiItem","readOnly","contextErrors","buildRules","removeErrorWidget","addErrorWidget","isChanging","initData","fromElement","onChanging","onChanged","prev","allowChange","setDataValue","setElementValue","elDiscription","hasError","discriptionClassName","errorList","fieldClass","FieldClass","uiLabel","TextWidget","inputType","internalOnKeyDown","blur","setError","checkRules","checkContextRules","hasFocus","clearErrors","renderTemplet","renderErrors","TextAreaWidget","setValue","rows","PasswordWidget","UrlWidget","EmailWidget","NumberWidget","UpdownWidget","returnValue","isValidKey","DateWidget","DateTimeWidget","TimeWidget","MonthWidget","CheckBoxWidget","trueValue","falseValue","SelectWidget","select","option","RadioWidget","rowKey","isRow","RangeWidget","IdWidget","pickId","clearContextError","Unknown","dataType","uiType","dataTypes","ButtonWidget","submit","observerRender","widgetType","ButtonClass","Context","widgets","subContexts","arrRowContexts","itemName","getDisabled","setDisabled","getReadOnly","setReadOnly","getVisible","setVisible","buttonName","errorWidgets","ew","checkFieldRules","rowContext","setContextError","clearWidgetsErrors","clearContextErrors","checkHasError","rowKeySeed","RowContext","parentContext","arrSchema","uiArr","itemSchemas","FormContext","ContextContainer","ArrComponent","selectable","deletable","restorable","getArrRowContexts","arrLabel","ArrContainer","RowContainer","RowSeperator","formSelectable","formDeletable","formRestorable","arrSelectable","arrDeletable","arrRestorable","ac","rc","rs","first","rowContent","typeofTemplet","factory","selectCheck","deleteIcon","$isSelected","$source","isDeleted","$isDeleted","editContainer","Provider","ImageWidget","imageSrc","end","TagWidget","widgetsFactory","textarea","datetime","time","email","updown","checkbox","image","checkboxes","radio","tagSingle","valuesView","renderRadios","tagMulti","def","defaultArr","renderChecks","range","typeWidget","getItemSchema","getTypeWidget","WidgetClass","Form","watch","calcSelectOrDelete","DefaultContainer","DefaultFieldContainer","fieldLabelSize","labelView","fieldCol","DefaultFieldClass","DefaultButtonClass","DefaultRes","Container","autorun","formContext","dv","initDataItem","arrItem","arrItems","arrDict","arrItemOperated","formArrVal","beforeShow","renderContent","contextType","StringItemEdit","inputOptions","element","RadioItemEdit","SelectItemEdit","IdItemEdit","TagItemEdit","renderInputs","TagSingleItemEdit","TagMultiItemEdit","TextAreaItemEdit","CheckBoxItemEdit","onItemChanged","RangeItemEdit","NumberItemEdit","Edit","defaultSepClassName","defaultRowContainerClassName","rowClick","itemEdit","editInRow","onItemClick","stopEdit","topBorderClassName","bottomBorderClassName","sepClassName","rowContainerClassName","topBorder","bottomBorder","ie","createItemEdit","divLabel","requireFlag","centerApi","userName","VUnsupportedUnit","VUnitSelect","renderRow","onRowClick","appUnit","setAppUnit","appUnits","VErrorsPage","VStartError","CAppBase","config","appConfig","nRole","roleDefines","roles","roleDefs","onSysNavRoutes","userAppUnits","showUnsupport","appUnitId","openVPage","resolveRoute","userFromId","CApp","htmlTitle","html0","setSettings","cApp","CBase","_cApp","hasRole","wn","getWebNav","CSub","_owner","ownerWNs","own","ListBase","pageItems","Clickable","Static","Selectable","inputItems","buildItems","itemsArray","isItemSelected","selectedItems","compare","retItems","labelId","comp","selectItem","si","obItem","onSelect","flex","marginBottom","htmlFor","listenArraySplice","isObservableArray","observe","change","removedCount","added","_added","checkAll","anySelected","List","buildBase","listBase","prevProps","prevState","isEqual","forceUpdate","selectAll","unselectAll","waitingMore","tabIndex","isLoading","staticRow","PropRow","PropBorder","borderTop","PropGap","valueAlignStart","valueAlignCenter","valueAlignEnd","LabeledPropRow","gridProps","_prop","col","labelFixLeft","bk","renderLabel","renderProp","align","vAlign","alignValue","renderPropBody","renderPropContent","StringPropRow","NumberPropRow","ListPropRow","borderBottom","ComponentPropRow","component","PropView","buildRows","isGap","setValues","PropGrid","propView","userSetProp","IdCache","tuidLocal","waitingIds","divName","tuidInner","initLocalArr","localArr","isNumber","has","moveToHead","_id","useId","tuidValues","cacheIdValues","unpackTuidIds","cacheValue","cacheTuidFieldValues","loadTuidIdsOrLocal","localedValues","netIds","loadTuidIds","netRet","IdDivCache","Tuid","typeName","idName","TuidBox","noCache","id1","id2","idValue","idCache","divs","tuidDiv","TuidDiv","resetCache","assureObj","IdsCaller","GetCaller","cacheFieldsInValue","arrValues","$create","$update","stampOnMain","cacheFields","unpackTuidIdsOfFields","SavePropCaller","searchArr","SearchCaller","LoadArrCaller","SaveArrCaller","ArrPosCaller","TuidNoCaller","TuidCaller","$id","transParams","arrParams","arrValue","buildDateParam","bid","$order","loadMain","save","saveProp","search","loadArr","saveArr","posArr","hasDiv","TuidBoxDiv","Boolean","hostname","CUqBase","CUqSub","CUqApp","EnumNoteType","VMain","cHome","cRelation","cDiscover","cMe","loadBookProjects","numberFromId","compareID","checkHourMinutes","taskTimeToString","initNoteItemObj","flowContent","textList","textCheckable","VBasePage","renderContact","assigned","renderContactItem","contact","contacts","VSelectContact","buildRight","single","onToggleSelect","onNext","onContactSelect","onContactClick","VNotesDropDown","showAddNoteTextPage","showAddNoteListPage","checkable","showAddNoteCheckablePage","task","showAddAssignPage","folder","showAddMyFolderPage","space","showAddGroupPage","dropdownActions","VHomeDropdown","VFolderDropdown","VSpaceDropdown","CNoteBase","disableFrom","noteItem","folderId","currentFold","notes","GetNote","note","noteModel","spawn","contain","comments","showShareTo","endContentInput","noteContent","editNote","updateChange","itemChanged","addNote","groupFolder","isContentChanged","isCaptionChanged","renderIcon","VNoteBase","renderFrom","disableOwnerFrom","vImage","cnName","renderCommentFlag","commentCount","commentUnread","vCU","cu","onSendNote","loadRelation","renderTop","renderCaption","renderEditTime","create","update","toCount","spawnCount","isEnd","showEditPage","VNoteBaseDir","renderTopCaptionContent","renderDirBottom","divToCount","renderToCount","divSpawnCount","renderSpawnCount","divComment","dot","unread","VNoteBaseEdit","onButtonSave","isNoteChanged","renderExButtons","SetNote","onCaptionChange","renderEditBottom","renderCaptionInput","hideNote","onDelete","VNoteBaseView","renderViewBottom","renderRelatives","vEditButton","renderEditButton","VAddContact","fromKey","onAddContact","addContact","renderFields","VRelativesBase","tabShare","isAction","vCount","activeRelativeTab","isActive","renderTab","marginTop","renderTabs","tabName","tabContent","CContent","changed","buildObj","renderViewContent","fromString","startInput","VBase","doneItems","uncheckedItems","checkedItems","renderCheckItem","renderCheckedItems","VView","data-key","onCheckChange","checkedCount","VItem","ListInputBase","renderItem","focusable","focused","renderInputItem","renderTextItem","onAddNewEnter","addNewItem","currentFocusable","inputingText","setItemText","inputRef","getComputedStyle","onBlurAddNew","focusables","toJS","renderNewInput","getItemKey","getItemText","renderItemHeader","onMouseDown","focuseTimeout","focus","renderInput","uniqueKey","trimRight","CheckableListInput","CCheckable","itemKey","listInput","getList","ci","ListInput","CList","CTextBase","changedNoteContent","VTextBaseView","renderParagraphs","VTextBaseInput","onContentChange","renderContentTextArea","VInput","CText","CFolder","VSent","VTo","anyChanged","onContactsSelected","groupContacts","CTo","currentGroupFolder","currentNoteItem","onSendOut","toList","sendOut","GetContacts","startAction","afterContactsSelected","CSelectContact","loadContacts","VInputHours","onHoursChange","hourminutes","onHoursBlur","autoFocus","CInputHours","EnumUnitRole","EnumPeriod","VFolder","noteKey","renderItemInFolder","cNoteBase","renderDirItem","popFolder","renderFolderDropDown","paragraphs","contentString","trimEnd","stopPropagation","showFolderView","notesPager","showNoteItem","VFolderDir","vIcon","VFolderRelatives","VFolderView","renderVm","cContent","CContainer","lodeModel","showViewPage","EnumSpecFolder","GetNotes","setItemConverter","getItemConverter","noteItemConverter","withX","newnotes","newitems","cNoteItem","fItem","renderListView","openFolder","showFolderViewPage","sub","AddNote","fromAssigned","createCNoteBase","theItems","theItem","HideNote","members","AddGroup","VSpaceDir","VSpaceMembers","showAddMember","VSpaceView","groupOwner","renderSpaceDropDown","showSpaceContent","whiteSpace","overflow","textOverflow","cNotes","cSpace","addMember","VContainerForm","VSpaceEdit","SetGroup","VContentView","memberCount","VContacts","selectMember","VSapceAdd","addGroup","CSpace","showMembers","loadMembers","loadSpace","GetGroupFolderMemberCount","resulte","groupId","GetGroupMembers","GetGroupContacts","AddGroupMember","member","RemoveGroupMember","mi","endInput","rootFold","editGroup","CFolderDisableItemFrom","queryResults","VFolderMyEdit","VFolderMyAdd","VFolderMyView","renderShareButton","VFolderMy","CFolderMy","VFolderShare","CFolderShare","CFolderRoot","VRootProjects","projectFileds","projectUISchema","memo","ratioX","ratioY","readUnit","onClickAdd","project","onSubmitNewProject","saveBookProject","renderProject","onClickProject","bookProjects","VUnitProjects","onAddSub","unitedProjects","renderUnitedProject","unitableProjects","renderUnitableProject","downVisible","upVisible","setProjectDisplay","setProjectDown","setProjectUp","VReportsAdmin","report","onSubmitNewReport","saveBookReport","onClickReport","cNameEdit","changeReportName","bookReports","VAdminBase","onNewUnit","VNewUnit","renderUnitRow","unitItem","onUnitRow","showUnitAdmin","onNewMember","VNewMember","renderMemberRow","admin","onClickMember","VEditMember","renderParent","renderEditUnitName","renderUnitID","renderProjects","renderUnitProjects","renderMembersAndUnits","showUnitProjects","renderMembers","renderUnits","VRootAdmin","showDesignReports","showRootProjects","VUnitAdmin","onEditUnitName","onUnitNameSubmit","onUnitNameChange","onUnitNameKeyDown","setUnitName","onCreate","createUnit","vError","adminSchema","isAdminUI","isAdmin","setUnitMemberAdmin","setUnitMemberProp","unitAdmin","CAdminBase","loadUnitProjects","orderNo","setUnitProjects","unitNote","GetUnit","moveOwnerMemberToTop","getVUnitAdmin","pOwner","pAdmin","cUnitAdmin","CUnitAdmin","CreateUnit","SetUnitName","AddUnitMember","roleMask","SetUnitMemberRole","SetUnitMemberProp","GetUnitProjects","rootUnit","projects","rootProjects","SetUnitProjects","CRootAdmin","loadBookReports","GetRootUnitProjects","BookProject","GetRootUnitReports","BookReport","VUnitNoteDir","VUnitNoteView","onAdmin","showRootAdmin","unitProjectsSum","projectSums","renderProjectSums","memberProjectsSum","memberItem","onMemberRow","myProjectsSum","debit","unitProjectsSums","memberProjectsSums","CUnitNote","cUnitAdmins","period","GetMySum","buildMyProjectsSum","GetUnitSum","subSum","memberSum","buildUnitProjectsSums","buildMemberProjectsSums","unitSums","subRow","credit","projectSum","memberSums","equ","mySums","loadUnits","loadMySum","day","loadProjectsSum","curUnitAdmin","EnumTaskState","VCommentsList","renderComments","cNote","renderComment","showMoreComments","comment","divUserName","renderCommentContent","vUser","VAddComment","onCommentChange","onCommentSubmit","onAddComment","VWriteComment","onComment","CComments","addComment","renderButton","CNote","AddComment","commentId","cComments","stateContents","Start","Done","Pass","Fail","Rated","Canceled","getTaskItemState","checker","rater","GetTaskStateContent","VRelativesNoteBase","tabComment","renderCommentsList","tabFlow","VAssignRelatives","VAssignView","renderSpawn","showSpawn","renderStateSpan","duplicateAssign","renderWriteComment","renderDirContent","showAssignTo","VAssignAdd","saveAndAssingTo","onButtonSend","isNoteEmpty","onClickHours","chours","inputHours","assignhours","renderTaskAdditions","additionRows","renderAssignHours","renderParam","renderDeleteButton","VAssignDir","VAssignParams","cNoteAssign","onItemChange","point","onItemKeyDown","onClickChecker","cSelectContact","CNotesSelectContact","SetContacts","GetAssignToContacts","callSelectContact","onClickRater","renderHours","renderChecker","renderRater","CAssignTo","replaceTop","replaceVPage","assignTask","getItems","allowCheck","CTaskContent","CNoteTask","initobj","checkInfo","checkInfoInput","rateInfo","rateInfoInput","rateValue","rateValueInput","hours","saveX","noteId","SetNoteX","VTaskRelatives","VTaskView","renderTaskDirTop","divCaption","renderState","VTaskObserver","taskStateResult","VTaskObserverDir","renderDirView","CTaskObserver","CNoteAssign","cAssignTo","SetTopKey","TopKey","cObj","tos","AssignTask","initModelData","assign","isEmpty","VTextRelatives","VTextHeader","VTextView","VTextEdit","changeToText","changeToList","changeToCheckable","cType","renderButtonLeft","dropdowns","VTextAdd","onSaveAndSendNote","cnewNote","VTextDir","CNoteText","createTextContent","createListContent","createCheckableContent","VTaskStart","onDone","DoneTask","contentChecker","contentRater","showActionEndPage","VTaskStartDir","CTaskStart","taskUpdateState","VTaskDone","VTaskDoneDir","CTaskDone","VTaskCanceled","VTaskCanceledDir","CTaskCanceled","VTaskPass","VTaskPassDir","CTaskPass","VTaskFail","VTaskFailDir","CTaskFail","VTaskRated","VTaskRatedDir","CTaskRated","VEditTextItemInput","onUpdate","onClickSave","inputText","VTaskCheck","onDiscribeChange","updateCheckInfo","onDiscribeKeyDown","checkSaveInfo","onCheck","pass","checkTask","resultPage","eprops","setCheckInfo","vEdit","renderOrtherContent","VTaskCheckDir","CTaskCheck","CheckTask","VTaskRate","updateRateInfo","onRate","rateTask","renderValueRadio","VTaskRateDir","CTaskRate","RateTask","VActions","renderSelectedContact","CShareTo","sendNoteTo","GetShareContacts","CNotes","createCNoteText","showAddPage","createCNoteList","createCNoteCheckable","cFolder","cGroup","newSub","foldStack","folderNoteItem","foldItem","showFolder","createCFolder","createCNoteTask","createCUnitNote","SendNoteTo","cShareTo","VHome","cNodes","renderHomeDropDown","renderNotesView","CHome","newC","VAdd","AddContact","VRelation","onShowContact","VContact","onEditAlias","onEditAssigned","VEditAssigned","btnSaveDisabled","SaveContactAssign","CContact","CRelation","GetMyContacts","showContact","SetContactAssinged","VAdmin","renderRootUnit","tonvaUnit","vId","vName","onClickRootUnit","changeRootUnitName","changeRootUnitTonva","changeRootUnitX","VUser","rootUnits","unitOwner","VUnit","createRootUnit","VEditMe","vAdmin","showAdmin","VMe","onExit","changePassword","meInfo","showEditMe","userSpan","aboutRows","logOutRows","CMe","GetSystemRole","GetRootUnits","CreateRootUnit","ChangeRootUnitProp","VDiscover","onTaskReport","onOtherReport","testBus","cBook","renderBook","VBook","onProject","showProjectFlow","debitMonth","debitWeek","debitDay","renderNumber","VFlow","renderFlowItem","flowItem","stamp","showFlowItem","projectDetailPager","CBook","GetProjectFlow","projectFlowItem","GetNoteItemFromId","CDiscover","TestBusBootProject","VTestMe","VTestAB","home","relation","discover","aboutTheApp","pleaseLogin","noteSpace","noteText","noteList","noteCheckable","noteTask","noteFolder","noteCreateSpace","gaps","gapIndex","callTick","$Poked","poke","initMySetting","startHome","showMain","timer","timezone","getTimezoneOffset","InitMySetting","startAB","startMe","initTabName","App","ReactDOM","StrictMode","createApp","appendChild","wx","getSystemInfoSync","startApp"],"mappings":"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","file":"static/js/main.a8b2729a.chunk.js","sourcesContent":["export * from './tool';\nexport * from './net';\nexport * from './components';\nexport * from './entry';\nexport * from './uq';\nexport * from './app';\nexport * from './vm';\n","export * from './navigo';\r\nexport * from './nav';\r\nexport * from './page';\r\nexport * from './schema';\r\nexport * from './form';\r\nexport * from './edit';\r\nexport * from '../res/res';\r\nexport * from './loading';\r\nexport * from './image';\r\nexport * from './resUploader';\r\nexport * from './rules';\r\nexport * from './list';\r\nexport * from './dropDownActions';\r\nexport * from './easyDate';\r\nexport * from './propGrid';\r\nexport * from './simple';\r\nexport * from './media';\r\nexport * from './searchBox';\r\nexport * from './userIcon';\r\nexport * from './ax';\r\nexport * from './autoHideTips';\r\n","import * as React from 'react';\r\nimport {observable} from 'mobx';\r\nimport marked from 'marked';\r\nimport _ from 'lodash';\r\nimport {User, Guest/*, UserInNav*/} from '../tool/user';\r\nimport {Page} from './page/page';\r\nimport {netToken} from '../net/netToken';\r\nimport FetchErrorView, { SystemNotifyPage } from './fetchErrorView';\r\nimport {FetchError} from '../net/fetchError';\r\nimport {appUrl, setAppInFrame, getExHash, getExHashPos} from '../net/appBridge';\r\nimport {LocalData, env} from '../tool';\r\nimport {guestApi, logoutApis, setCenterUrl, setCenterToken, appInFrame, host, resUrlFromHost, messageHub} from '../net';\r\n//import { WsBase, wsBridge } from '../net/wsChannel';\r\nimport { resOptions } from '../res/res';\r\nimport { Loading } from './loading';\r\nimport { Navigo, RouteFunc, Hooks, NamedRoute } from './navigo';\r\nimport 'font-awesome/css/font-awesome.min.css';\r\nimport '../css/va-form.css';\r\nimport '../css/va.css';\r\nimport '../css/animation.css';\r\nimport { FA } from './simple';\r\nimport { userApi } from '../net';\r\nimport { ReloadPage, ConfirmReloadPage } from './reloadPage';\r\nimport lv from '../entry/login'\r\nimport { PageWebNav } from './page';\r\n\r\nconst regEx = new RegExp('Android|webOS|iPhone|iPad|' +\r\n    'BlackBerry|Windows Phone|'  +\r\n    'Opera Mini|IEMobile|Mobile' , \r\n    'i');\r\nconst isMobile = regEx.test(navigator.userAgent);\r\n\r\n/*\r\nexport const mobileHeaderStyle = isMobile? {\r\n    minHeight:  '3em'\r\n} : undefined;\r\n*/\r\n//const logo = require('../img/logo.svg');\r\nlet logMark: number;\r\nconst logs:string[] = [];\r\n\r\nexport type NavPage = (params:any) => Promise<void>;\r\n\r\nexport interface Props //extends React.Props<Nav>\r\n{\r\n    onLogined: (isUserLogin?:boolean)=>Promise<void>;\r\n    notLogined?: ()=>Promise<void>;\r\n};\r\nlet stackKey = 1;\r\nexport interface StackItem {\r\n    key: number;\r\n    view: JSX.Element;\r\n    ceased: boolean;\r\n    confirmClose?: ()=>Promise<boolean>;\r\n    disposer?: ()=>void;\r\n}\r\nexport interface NavViewState {\r\n    stack: StackItem[];\r\n    wait: 0|1|2;\r\n    fetchError: FetchError\r\n}\r\n\r\nexport class NavView extends React.Component<Props, NavViewState> {\r\n    private stack: StackItem[];\r\n    private htmlTitle: string;\r\n    private waitCount: number = 0;\r\n    private waitTimeHandler?: NodeJS.Timer;\r\n\r\n    constructor(props:Props) {\r\n        super(props);\r\n        this.stack = [];\r\n        this.state = {\r\n            stack: this.stack,\r\n            wait: 0,\r\n            fetchError: undefined\r\n        };\r\n        nav.set(this);\r\n    }\r\n    async componentDidMount()\r\n    {\r\n\t\twindow.addEventListener('popstate', this.navBack);\r\n\t\t//if (nav.isRouting === false) {\r\n\t\tawait nav.init();\r\n\t\t//}\r\n        await nav.start();\r\n    }\r\n\r\n    get level(): number {\r\n        return this.stack.length;\r\n    }\r\n\r\n    startWait() {\r\n        if (this.waitCount === 0) {\r\n            this.setState({wait: 1});\r\n            this.waitTimeHandler = env.setTimeout(\r\n                'NavView.startWait',\r\n                () => {\r\n                    this.waitTimeHandler = undefined;\r\n                    this.setState({wait: 2});\r\n                },\r\n                1000) as NodeJS.Timer;\r\n        }\r\n        ++this.waitCount;\r\n        this.setState({\r\n            fetchError: undefined,\r\n        });\r\n    }\r\n\r\n    endWait() {\r\n        env.setTimeout(\r\n            undefined, //'NavView.endWait',\r\n            () => {\r\n            /*\r\n            this.setState({\r\n                fetchError: undefined,\r\n            });*/\r\n            --this.waitCount;\r\n            if (this.waitCount === 0) {\r\n                if (this.waitTimeHandler !== undefined) {\r\n                    env.clearTimeout(this.waitTimeHandler);\r\n                    this.waitTimeHandler = undefined;\r\n                }\r\n                this.setState({wait: 0});\r\n            }\r\n        },100);\r\n    }\r\n\r\n    async onError(fetchError: FetchError)\r\n    {\r\n        let err = fetchError.error;\r\n        if (err !== undefined) {\r\n            if (err.unauthorized === true) {\r\n                await nav.showLogin(undefined);\r\n                return;\r\n            }\r\n            switch (err.type) {\r\n                case 'unauthorized':\r\n                    await nav.showLogin(undefined);\r\n                    return;\r\n                case 'sheet-processing':\r\n                    nav.push(<SystemNotifyPage message=\"单据正在处理中。请重新操作！\" />);\r\n                    return;\r\n            }\r\n        }\r\n        this.setState({\r\n            fetchError: fetchError,\r\n        });\r\n    }\r\n\r\n    private upgradeUq = () => {\r\n        nav.start();\r\n    }\r\n\r\n    async showUpgradeUq(uq:string, version:number):Promise<void> {\r\n        this.show(<Page header={false}>\r\n            <div>\r\n                UQ升级了，请点击按钮升级 <br />\r\n                <small className=\"text-muted\">{uq} ver-{version}</small>\r\n                <button className=\"btn btn-primary\" onClick={this.upgradeUq}>升级</button>\r\n            </div>\r\n        </Page>)\r\n    }\r\n\r\n    show(view: JSX.Element, disposer?: ()=>void): number {\r\n        this.clear();\r\n        return this.push(view, disposer);\r\n    }\r\n\r\n    push(view: JSX.Element, disposer?: ()=>void): number {\r\n        this.removeCeased();\r\n        if (this.stack.length > 0) {\r\n            window.history.pushState('forward', null, null);\r\n        }\r\n        let key = stackKey++;\r\n        this.stack.push({\r\n            key: key,\r\n            view: view, \r\n            ceased: false,\r\n            disposer: disposer\r\n        });\r\n        this.refresh();\r\n        //console.log('push: %s pages', this.stack.length);\r\n        return key;\r\n    }\r\n\r\n    replace(view: JSX.Element, disposer?: ()=>void): number {\r\n        let item:StackItem = undefined;\r\n        let stack = this.stack;\r\n        if (stack.length > 0) {\r\n            item = stack.pop();\r\n            //this.popAndDispose();\r\n        }\r\n        let key = stackKey++;\r\n        this.stack.push({\r\n            key: key, \r\n            view: view, \r\n            ceased: false,\r\n            disposer: disposer\r\n        });\r\n        if (item !== undefined) this.dispose(item.disposer);\r\n        this.refresh();\r\n        //console.log('replace: %s pages', this.stack.length);\r\n        return key;\r\n    }\r\n\r\n    ceaseTop(level:number = 1) {\r\n        let p = this.stack.length - 1;\r\n        for (let i=0; i<level; i++, p--) {\r\n            if (p < 0) break;\r\n            let item = this.stack[p];\r\n            item.ceased = true;\r\n        }\r\n    }\r\n\r\n    pop(level:number = 1) {\r\n        let stack = this.stack;\r\n        let len = stack.length;\r\n        //console.log('pop start: %s pages level=%s', len, level);\r\n        if (level <= 0 || len <= 1) return;\r\n        if (len < level) level = len;\r\n        let backLevel = 0;\r\n        for (let i = 0; i < level; i++) {\r\n            if (stack.length === 0) break;\r\n            //stack.pop();\r\n            this.popAndDispose();\r\n            ++backLevel;\r\n        }\r\n        if (backLevel >= len) backLevel--;\r\n        this.refresh();\r\n        if (this.isHistoryBack !== true) {\r\n            //window.removeEventListener('popstate', this.navBack);\r\n            //window.history.back(backLevel);\r\n            //window.addEventListener('popstate', this.navBack);\r\n        }\r\n        //console.log('pop: %s pages', stack.length);\r\n    }\r\n\r\n    popTo(key: number) {\r\n        if (key === undefined) return;\r\n        if (this.stack.find(v => v.key === key) === undefined) return;\r\n        while (this.stack.length >0) {\r\n            let len = this.stack.length;\r\n            let top = this.stack[len-1];\r\n            if (top.key === key) break;\r\n            this.pop();\r\n        }\r\n    }\r\n\r\n    topKey():number {\r\n        let len = this.stack.length;\r\n        if (len === 0) return undefined;\r\n        return this.stack[len-1].key;\r\n    }\r\n\r\n    removeCeased() {\r\n        for (;;) {\r\n            let p=this.stack.length-1;\r\n            if (p < 0) break;\r\n            let top = this.stack[p];\r\n            if (top.ceased === false) break;\r\n            let item = this.stack.pop();\r\n            let {disposer} = item;\r\n            this.dispose(disposer);\r\n        }\r\n        this.refresh();\r\n    }\r\n\r\n    private popAndDispose() {\r\n        this.removeCeased();\r\n        let item = this.stack.pop();\r\n\t\tif (item === undefined) return;\r\n\t\t//if (nav.isRouting) {\r\n\t\t//\twindow.history.back();\r\n\t\t//}\r\n        let {disposer} = item;\r\n        this.dispose(disposer);\r\n        this.removeCeased();\r\n        return item;\r\n    }\r\n\r\n    private dispose(disposer:()=>void) {\r\n        if (disposer === undefined) return;\r\n        let item = this.stack.find(v => v.disposer === disposer);\r\n        if (item === undefined) disposer();\r\n    }\r\n\r\n    clear() {\r\n        let len = this.stack.length;\r\n        while (this.stack.length > 0) this.popAndDispose();\r\n        //this.refresh();\r\n        if (len > 1) {\r\n            //window.removeEventListener('popstate', this.navBack);\r\n            //window.history.back(len-1);\r\n            //window.addEventListener('popstate', this.navBack);\r\n        }\r\n    }\r\n\r\n    regConfirmClose(confirmClose:()=>Promise<boolean>) {\r\n        let stack = this.stack;\r\n        let len = stack.length;\r\n        if (len === 0) return;\r\n        let top = stack[len-1];\r\n        top.confirmClose = confirmClose;\r\n    }\r\n\r\n    private isHistoryBack:boolean = false;\r\n    navBack = () => {\r\n        //nav.log('backbutton pressed - nav level: ' + this.stack.length);\r\n        let tick = Date.now();\r\n        this.isHistoryBack = true;\r\n        this.back(true);\r\n        this.isHistoryBack = false;\r\n        console.log(`///\\\\\\\\ ${Date.now()-tick}ms backbutton pressed - nav level: ${this.stack.length}`);\r\n    }\r\n\r\n    back = async (confirm:boolean = true) => {\r\n        let stack = this.stack;\r\n        let len = stack.length;\r\n        if (len === 0) return;\r\n        if (len === 1) {\r\n            if (window.self !== window.top) {\r\n                window.top.postMessage({type:'pop-app'}, '*');\r\n            }\r\n            return;\r\n        }\r\n        let top = stack[len-1];\r\n        if (confirm===true && top.confirmClose) {\r\n            if (await top.confirmClose()===true) this.pop();\r\n        }\r\n        else {\r\n            this.pop();\r\n        }\r\n    }\r\n\r\n    confirmBox(message?:string): boolean {\r\n        return window.confirm(message);\r\n    }\r\n    clearError = () => {\r\n        this.setState({fetchError: undefined});\r\n    }\r\n    render() {\r\n        const {wait, fetchError} = this.state;\r\n        let {stack} = this.state;\r\n        let top = stack.length - 1;\r\n        let elWait = null, elError = null;\r\n        switch (wait) {\r\n            case 1:\r\n                elWait = <div className=\"va-wait va-wait1\">\r\n                </div>;\r\n                break;\r\n            case 2:\r\n                elWait = <div className=\"va-wait va-wait2\">\r\n                    <Loading />\r\n                </div>;\r\n                break;\r\n        }\r\n        if (fetchError)\r\n            elError = <FetchErrorView clearError={this.clearError} {...fetchError} />;\r\n        let test = nav.testing===true && \r\n\t\t\t<span className=\"cursor-pointer position-fixed\" style={{top:0,left:'0.2rem',zIndex:90001}}>\r\n                <FA className=\"text-warning\" name=\"info-circle\" />\r\n            </span>;\r\n        return <>\r\n\t\t\t{stack.map((item, index) => {\r\n\t\t\t\tlet {key, view} = item;\r\n\t\t\t\treturn <div key={key} style={index<top? {visibility: 'hidden', position: 'absolute'}:undefined}>\r\n\t\t\t\t\t{view}\r\n\t\t\t\t</div>\r\n\t\t\t})}\r\n\t\t\t{elWait}\r\n\t\t\t{elError}\r\n\t\t\t{test}\r\n        </>;\r\n    }\r\n\r\n    private refresh() {\r\n        this.setState({stack: this.stack });\r\n    }\r\n}\r\n\r\nexport interface NavSettings {\r\n    oem?: string;\r\n    loginTop?: JSX.Element;\r\n\tprivacy?: string;\r\n\tnoUnit?: boolean;\r\n}\r\n\r\nexport class Nav {\r\n    private navView:NavView;\r\n    //private ws: WsBase;\r\n    private wsHost: string;\r\n    private local: LocalData = new LocalData();\r\n\tprivate navigo: Navigo;\r\n\t//isRouting: boolean = false;\r\n\tnavSettings: NavSettings;\r\n    @observable user: User/*InNav*/ = undefined;\r\n    testing: boolean;\r\n    language: string;\r\n    culture: string;\r\n    resUrl: string;\r\n\r\n    constructor() {\r\n        let {lang, district} = resOptions;\r\n        this.language = lang;\r\n        this.culture = district;\r\n\t\tthis.testing = false;\r\n    }\r\n\r\n    get guest(): number {\r\n        let guest = this.local.guest;\r\n        if (guest === undefined) return 0;\r\n        let g = guest.get();\r\n        if (g === undefined) return 0;\r\n        return g.guest;\r\n    }\r\n\r\n    set(navView:NavView) {\r\n        //this.logo = logo;\r\n        this.navView = navView;\r\n\t}\r\n\t/*\r\n    registerReceiveHandler(handler: (message:any)=>Promise<void>):number {\r\n        //if (this.ws === undefined) return;\r\n        return messageHub.onReceiveAny(handler);\r\n    }\r\n\r\n    unregisterReceiveHandler(handlerId:number) {\r\n        //if (this.ws === undefined) return;\r\n        if (handlerId === undefined) return;\r\n        messageHub.endReceive(handlerId);\r\n    }\r\n\t*/\r\n    async onReceive(msg:any) {\r\n        //if (this.ws === undefined) return;\r\n        await messageHub.dispatch(msg);\r\n    }\r\n\r\n\tprivate async loadUnitJson() {\r\n\t\ttry {\r\n\t\t\tlet unitJsonPath = this.unitJsonPath();\r\n\t\t\tlet unitRes = await fetch(unitJsonPath, {});\r\n\t\t\tlet res = await unitRes.json();\r\n\t\t\treturn res.unit;\r\n\t\t}\r\n\t\tcatch (err1) {\r\n\t\t\tthis.local.unit.remove();\r\n\t\t\treturn;\r\n\t\t}\r\n\t}\r\n\r\n    private async getPredefinedUnitName() {\t\r\n        if (process.env.isMiniprogram) {\r\n            return '百灵威';\r\n        }\r\n\t\tlet el = document.getElementById('unit');\r\n\t\tif (el) {\r\n\t\t\treturn el.innerText;\r\n\t\t}\r\n\t\tel = document.getElementById('unit.json');\r\n\t\tif (!el) {\r\n\t\t\treturn await this.loadUnitJson();\r\n\t\t}\r\n\t\ttry {\r\n            let json = el.innerHTML;\r\n            let res = JSON.parse(json);\r\n            return res.unit;\r\n        }\r\n        catch (err) {\r\n\t\t\treturn await this.loadUnitJson();\r\n        }\r\n    }\r\n\r\n    private async loadPredefinedUnit() {\r\n        let envUnit = process.env.REACT_APP_UNIT;\r\n        if (envUnit !== undefined) {\r\n            return Number(envUnit);\r\n        }\r\n        let unitName:string;\r\n        let unit = this.local.unit.get();\r\n        if (unit !== undefined) {\r\n            if (env.isDevelopment !== true) return unit.id;\r\n            unitName = await this.getPredefinedUnitName();\r\n            if (unitName === undefined) return;\r\n            if (unit.name === unitName) return unit.id;\r\n        }\r\n        else {\r\n            unitName = await this.getPredefinedUnitName();\r\n            if (unitName === undefined) return;\r\n        }\r\n        let unitId = await guestApi.unitFromName(unitName);\r\n        if (unitId !== undefined) {\r\n            this.local.unit.set({id: unitId, name: unitName});\r\n        }\r\n        return unitId;\r\n    }\r\n\r\n    setSettings(settings?: NavSettings) {\r\n        this.navSettings = settings;\r\n    }\r\n\r\n    get oem():string {\r\n        return this.navSettings && this.navSettings.oem;\r\n    }\r\n\r\n    hashParam: string;\r\n    private centerHost: string;\r\n    private arrs = ['/test', '/test/'];\r\n    private unitJsonPath():string {\r\n        let {origin, pathname} = window.location; //document.location;\r\n\t\tpathname = pathname.toLowerCase();\r\n        for (let item of this.arrs) {\r\n            if (_.endsWith(pathname, item) === true) {\r\n                pathname = pathname.substr(0, pathname.length - item.length);\r\n                break;\r\n            }\r\n        }\r\n        if (_.endsWith(pathname, '/') === true || _.endsWith(pathname, '\\\\') === true) {\r\n            pathname = pathname.substr(0, pathname.length-1);\r\n        }\r\n        return origin + pathname + '/unit.json';\r\n    }\r\n    private windowOnError = (event: Event | string, source?: string, lineno?: number, colno?: number, error?: Error) => {\r\n\t\tdebugger;\r\n        console.error('windowOnError');\r\n        console.error(error);\r\n    }\r\n    private windowOnUnhandledRejection = (ev: PromiseRejectionEvent) => {\r\n\t\tdebugger;\r\n        console.error('windowOnUnhandledRejection');\r\n        console.error(ev.reason);\r\n    }\r\n    private windowOnClick = (ev: MouseEvent) => {\r\n        console.error('windowOnClick');\r\n    }\r\n    private windowOnMouseMove = (ev: MouseEvent) => {\r\n        console.log('navigator.userAgent: ' + navigator.userAgent);\r\n        console.log('mouse move (%s, %s)', ev.x, ev.y);\r\n    }\r\n    private windowOnScroll = (ev: Event) => {\r\n        console.log('scroll event');\r\n\t}\r\n\t\r\n\tasync init() {\r\n\t\tthis.testing = env.testing;\r\n        await host.start(this.testing);\r\n        //if (document.location) {\r\n            let hash = window.location.hash;\r\n            if (hash !== undefined && hash.length > 0) {\r\n                let pos = getExHashPos();\r\n                if (pos < 0) pos = undefined;\r\n                this.hashParam = hash.substring(1, pos);\r\n            }\r\n        //}\r\n        \r\n\t\tlet {url, ws, resHost} = host;\r\n\t\tthis.centerHost = url;\r\n\t\tthis.resUrl = resUrlFromHost( resHost);\r\n\t\tthis.wsHost = ws;\r\n\t\tsetCenterUrl(url);\r\n\r\n\t\tlet guest:Guest = this.local.guest.get();\r\n\t\tif (guest === undefined) {\r\n\t\t\tguest = await guestApi.guest();\r\n\t\t}\r\n\t\tif (!guest) {\r\n\t\t\tdebugger;\r\n\t\t\tthrow Error('guest can not be undefined');\r\n\t\t}\r\n\t\tnav.setGuest(guest);\r\n\r\n\t\tlet exHash = getExHash();\r\n\t\tlet appInFrame = setAppInFrame(exHash);\r\n\t\tif (exHash !== undefined && window !== window.parent) {\r\n\t\t\t// is in frame\r\n\t\t\tif (appInFrame !== undefined) {\r\n\t\t\t\t//this.ws = wsBridge;\r\n\t\t\t\tconsole.log('this.ws = wsBridge in sub frame');\r\n\t\t\t\t//nav.user = {id:0} as User;\r\n\t\t\t\tif (window.self !== window.parent) {\r\n\t\t\t\t\twindow.parent.postMessage({type:'sub-frame-started', hash: appInFrame.hash}, '*');\r\n\t\t\t\t}\r\n\t\t\t\t// 下面这一句，已经移到 appBridge.ts 里面的 initSubWin，也就是响应从main frame获得user之后开始。\r\n\t\t\t\t//await this.showAppView();\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tlet predefinedUnit:number;\r\n\t\tif (this.navSettings?.noUnit === true) {\r\n\t\t\tpredefinedUnit = 0;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tpredefinedUnit = await this.loadPredefinedUnit();\r\n\t\t}\r\n\t\tappInFrame.predefinedUnit = predefinedUnit;\r\n\t}\r\n\r\n    async start() {\r\n        try {\r\n\t\t\twindow.onerror = this.windowOnError;\r\n            window.onunhandledrejection = this.windowOnUnhandledRejection;\r\n            //window.addEventListener('click', this.windowOnClick);\r\n            //window.addEventListener('mousemove', this.windowOnMouseMove);\r\n            //window.addEventListener('touchmove', this.windowOnMouseMove);\r\n            //window.addEventListener('scroll', this.windowOnScroll);\r\n            if (isMobile === true) {\r\n                document.onselectstart = function() {return false;}\r\n                document.oncontextmenu = function() {return false;}\r\n            }\r\n            //window.setInterval(()=>console.error('tick every 5 seconds'), 5000);\r\n\t\t\tnav.clear();\r\n\t\t\tthis.startWait();\r\n            \r\n            let user: User = this.local.user.get();\r\n            if (user === undefined) {\r\n                let {notLogined} = this.navView.props;\r\n                if (notLogined !== undefined) {\r\n                    await notLogined();\r\n                }\r\n                else {\r\n                    await nav.showLogin(undefined);\r\n                }\r\n                return;\r\n            }\r\n\r\n            await nav.logined(user);\r\n        }\r\n        catch (err) {\r\n\t\t\tconsole.error(err);\r\n\t\t\tdebugger;\r\n        }\r\n        finally {\r\n            this.endWait();\r\n        }\r\n\t}\r\n\r\n\tresolveRoute() {\r\n\t\t//if (this.isRouting === false) return;\r\n\t\tif (this.navigo === undefined) return;\r\n\t\tthis.navigo.resolve();\r\n\t}\r\n\r\n\ton(routeFunc:RouteFunc, hooks?:Hooks):Navigo;\r\n\ton(url:string, routeFunc:RouteFunc, hooks?:Hooks):Navigo;\r\n\ton(regex:RegExp, routeFunc:RouteFunc, hooks?:Hooks):Navigo;\r\n\ton(options: {[url:string]: RouteFunc|NamedRoute}):Navigo;\r\n\ton(...args:any[]):Navigo {\r\n\t\tif (this.navigo === undefined) {\r\n\t\t\tthis.navigo = new Navigo();\r\n\t\t\tif (this.isWebNav !== true) this.navigo.historyAPIUpdateMethod('replaceState');\r\n\t\t}\r\n\t\treturn this.navigo.on(args[0], args[1], args[2]);\r\n\t}\r\n\r\n\tprivate navLogin:NavPage = async (params:any) => {\r\n\t\tnav.showLogin(async (user: User) => window.history.back(), false);\r\n\t}\r\n\r\n\tprivate navLogout:NavPage = async (params:any) => {\r\n\t\tnav.showLogout(async () => window.history.back());\r\n\t}\r\n\r\n\tprivate navRegister:NavPage = async (params:any) => {\r\n\t\tnav.showRegister();\r\n\t}\r\n\r\n\tprivate navForget:NavPage = async (params:any) => {\r\n\t\tnav.showForget();\r\n\t}\r\n\r\n\tprivate sysRoutes: { [route: string]: NavPage } = {\r\n\t\t'/login': this.navLogin,\r\n\t\t'/logout': this.navLogout,\r\n\t\t'/register': this.navRegister,\r\n\t\t'/forget': this.navForget,\r\n\t}\r\n\r\n\tonSysNavRoutes() {\r\n\t\tthis.onNavRoutes(this.sysRoutes);\r\n\t}\r\n\r\n\tprivate navPageRoutes: {[url:string]: NavPage};\r\n\tprivate routeFromNavPage(navPage: NavPage) {\r\n\t\treturn (params: any, queryStr: any) => {\r\n\t\t\tif (navPage) {\r\n\t\t\t\tif (this.isWebNav) nav.clear();\r\n\t\t\t\tnavPage(params);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\tonNavRoute(navPage: NavPage) {\r\n\t\tthis.on(this.routeFromNavPage(navPage));\r\n\t}\r\n\tonNavRoutes(navPageRoutes: {[url:string]: NavPage}) {\r\n\t\tif (!navPageRoutes) return;\r\n\t\tthis.navPageRoutes = _.merge(this.navPageRoutes, navPageRoutes);\r\n\t\tlet navOns: { [route: string]: (params: any, queryStr: any) => void } = {};\r\n\t\tfor (let route in navPageRoutes) {\r\n\t\t\tlet navPage = navPageRoutes[route];\r\n\t\t\tnavOns[route] = this.routeFromNavPage(navPage);\r\n\t\t}\r\n\t\tthis.on(navOns);\r\n\t}\r\n\r\n\t/*\r\n\tget isWebNav():boolean { \r\n\t\tif (!this.navigo) return false;\r\n\t\treturn !isMobile;\r\n\t}\r\n\t*/\r\n\tisWebNav:boolean = false;\r\n\tbackIcon = <i className=\"fa fa-angle-left\" />;\r\n\tcloseIcon = <i className=\"fa fa-close\" />;\r\n\tsetIsWebNav() {\r\n\t\tthis.isWebNav = true;\r\n\t\tthis.backIcon = <i className=\"fa fa-arrow-left\" />;\r\n\t\tthis.closeIcon = <i className=\"fa fa-close\" />;\r\n\t}\r\n\r\n\tpageWebNav: PageWebNav;\r\n\r\n\tget isMobile():boolean {return isMobile;}\r\n\r\n\tnavigate(url:string, absolute?:boolean) {\r\n\t\tif (!this.navigo) {\r\n\t\t\talert('Is not in webnav state, cannot navigate to url \"' + url + '\"');\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (this.testing === true) url += '#test';\r\n\t\treturn this.navigo.navigate(url, absolute);\r\n\t}\r\n\r\n\tgo(showPage:()=>void, url:string, absolute?:boolean) {\r\n\t\tif (this.navigo !== undefined) {\r\n\t\t\tthis.navigate(url, absolute);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tshowPage();\r\n\t\t}\r\n\t}\r\n\r\n    async showAppView(isUserLogin?: boolean) {\r\n        let {onLogined} = this.navView.props;\r\n        if (onLogined === undefined) {\r\n            nav.push(<div>NavView has no prop onLogined</div>);\r\n            return;\r\n        }\r\n        nav.clear();\r\n        await onLogined(isUserLogin);\r\n    }\r\n\r\n    setGuest(guest: Guest) {\r\n        this.local.guest.set(guest);\r\n        netToken.set(0, guest.token);\r\n    }\r\n\r\n    saveLocalUser() {\r\n        this.local.user.set(this.user);\r\n    }\r\n\r\n    async loadMe() {\r\n        let me = await userApi.me();\r\n        this.user.icon = me.icon;\r\n        this.user.nick = me.nick;\r\n    }\r\n\r\n\tprivate async internalLogined(user: User, callback: (user:User)=>Promise<void>, isUserLogin:boolean) {\r\n        logoutApis();\r\n        console.log(\"logined: %s\", JSON.stringify(user));\r\n        this.user = user;\r\n        this.saveLocalUser();\r\n\t\tnetToken.set(user.id, user.token);\r\n\t\tnav.clear();\r\n\r\n        if (callback !== undefined) //this.loginCallbacks.has)\r\n            callback(user);\r\n            //this.loginCallbacks.call(user);\r\n        else {\r\n            await this.showAppView(isUserLogin);\r\n        }\r\n\t}\r\n\r\n\t// 缓冲登录\r\n    async logined(user: User, callback?: (user:User)=>Promise<void>) {\r\n\t\tawait this.internalLogined(user, callback, false);\r\n    }\r\n\r\n\t// 用户操作之后登录\r\n    async userLogined(user: User, callback?: (user:User)=>Promise<void>) {\r\n\t\tawait this.internalLogined(user, callback, true);\r\n    }\r\n\r\n    //wsConnect() {\r\n        //let ws:WSChannel = this.ws = new WSChannel(this.wsHost, this.user.token);\r\n        //ws.connect();\r\n    //}\r\n\r\n    loginTop(defaultTop:JSX.Element) {\r\n        return (this.navSettings && this.navSettings.loginTop) || defaultTop;\r\n    }\r\n\r\n    privacyEntry() {\r\n        if (!this.getPrivacyContent()) return;\r\n        return <div className=\"text-center\">\r\n            <button className=\"btn btn-sm btn-link\"\r\n                onClick={this.showPrivacyPage}>\r\n                <small className=\"text-muted\">隐私政策</small>\r\n            </button>\r\n        </div>;\r\n    }\r\n\r\n    private getPrivacyContent():string {\r\n        if (!this.navSettings) return;\r\n        let {privacy} = this.navSettings;\r\n        return privacy;\r\n    }\r\n\r\n    showPrivacyPage = () => {\r\n        let privacy = this.getPrivacyContent();\r\n        if (privacy) {\r\n            this.privacyPage(privacy);\r\n        }\r\n        else {\r\n            nav.push(<Page header=\"隐私政策\">\r\n                <div className=\"p-3\">AppConfig 中没有定义 privacy。可以定义为字符串，或者url。markdown格式</div>\r\n            </Page>);\r\n        }\r\n    }\r\n\r\n    private privacyPage = async (privacy:string) => {\r\n        let html = await this.getPrivacy(privacy);\r\n        let content = {__html: marked(html)};\r\n        nav.push(<Page header=\"隐私政策\">\r\n            <div className=\"p-3\" dangerouslySetInnerHTML={content} />\r\n        </Page>);\r\n    }\r\n\r\n    private async getPrivacy(privacy:string):Promise<string> {\r\n        //const headers = new Headers({\r\n        //    \"Content-Type\":'text/plain'\r\n        //})\r\n        let headers:{[name:string]: string} = {}; //new Headers();\r\n        headers['Content-Type'] = 'text/plain';\r\n        let pos = privacy.indexOf('://');\r\n        if (pos > 0) {\r\n            let http = privacy.substring(0, pos).toLowerCase();\r\n            if (http === 'http' || http === 'https') {\r\n                try {\r\n                    let res = await fetch(privacy, {\r\n                        method:'GET',\r\n                        headers: headers,\r\n                    });\r\n                    let text = await res.text();\r\n                    return text;\r\n                }\r\n                catch (err) {\r\n                    return err.message;\r\n                }\r\n            }\r\n        }\r\n        return privacy;\r\n    }\r\n\r\n    async showLogin(callback?: (user:User)=>Promise<void>, withBack?:boolean) {\r\n        //let lv = await import('../entry/login');\r\n        \r\n        let loginView = React.createElement(\r\n\t\t\tlv, \r\n\t\t\t{withBack, callback}\r\n\t\t);\r\n        if (withBack !== true) {\r\n            this.navView.clear();\r\n            this.pop();\r\n        }\r\n        this.navView.push(loginView);\r\n    }\r\n\r\n    async showLogout(callback?: ()=>Promise<void>) {\r\n        let footer = <div className=\"text-center justify-content-center\">\r\n            <button className=\"btn btn-outline-danger\" onClick={this.resetAll}>升级软件</button>\r\n        </div>;\r\n        nav.push(<Page header=\"安全退出\" back=\"close\" footer={footer}>\r\n            <div className=\"my-5 mx-1 border border-info bg-white rounded p-3 text-center\">\r\n                <div>退出当前账号不会删除任何历史数据，下次登录依然可以使用本账号</div>\r\n                <div className=\"mt-3 text-center\">\r\n                        <button className=\"btn btn-danger\" onClick={()=>this.logout(callback)}>安全退出</button>\r\n                </div>\r\n            </div>\r\n        </Page>);\r\n\t}\r\n\t\r\n\tasync showRegister() {\r\n\t\tlet lv = await import('../entry/register');\r\n\t\tlet c = new lv.RegisterController(undefined);\r\n\t\tawait c.start();\r\n\t}\r\n\r\n\tasync showForget() {\r\n\t\tlet lv = await import('../entry/register');\r\n\t\tlet c = new lv.ForgetController(undefined);\r\n\t\tawait c.start();\r\n\t}\r\n\r\n    async logout(callback?:()=>Promise<void>) { //notShowLogin?:boolean) {\r\n        appInFrame.unit = undefined;\r\n        this.local.logoutClear();\r\n        this.user = undefined; //{} as User;\r\n        logoutApis();\r\n        let guest = this.local.guest.get();\r\n        setCenterToken(0, guest && guest.token);\r\n\t\t//this.ws = undefined;\r\n\t\tthis.clear();\r\n        if (callback === undefined)\r\n            await nav.start();\r\n        else\r\n            await callback();\r\n    }\r\n\r\n    async changePassword() {\r\n        let cp = await import('../entry/changePassword');\r\n        nav.push(<cp.ChangePasswordPage />);\r\n    }\r\n\r\n    get level(): number {\r\n        return this.navView.level;\r\n    }\r\n    startWait() {\r\n        this.navView?.startWait();\r\n    }\r\n    endWait() {\r\n        this.navView?.endWait();\r\n    }\r\n    async onError(error: FetchError) {\r\n        await this.navView.onError(error);\r\n    }\r\n    async showUpgradeUq(uq:string, version:number):Promise<void> {\r\n        await this.navView.showUpgradeUq(uq, version);\r\n    }\r\n\r\n    show (view: JSX.Element, disposer?: ()=>void): void {\r\n        this.navView.show(view, disposer);\r\n    }\r\n    push(view: JSX.Element, disposer?: ()=>void): void {\r\n        this.navView.push(view, disposer);\r\n    }\r\n    replace(view: JSX.Element, disposer?: ()=>void): void {\r\n        this.navView.replace(view, disposer);\r\n    }\r\n    pop(level:number = 1) {\r\n        this.navView.pop(level);\r\n    }\r\n    topKey():number {\r\n        return this.navView.topKey();\r\n    }\r\n    popTo(key:number) {\r\n        this.navView.popTo(key);\r\n    }\r\n    clear() {\r\n        this.navView?.clear();\r\n    }\r\n    navBack() {\r\n        this.navView.navBack();\r\n    }\r\n    ceaseTop(level?:number) {\r\n        this.navView.ceaseTop(level);\r\n    }\r\n    removeCeased() {\r\n        this.navView.removeCeased();\r\n    }\r\n    async back(confirm:boolean = true) {\r\n        await this.navView.back(confirm);\r\n    }\r\n    regConfirmClose(confirmClose: ()=>Promise<boolean>) {\r\n        this.navView.regConfirmClose(confirmClose);\r\n    }\r\n    confirmBox(message?:string): boolean {\r\n        return this.navView.confirmBox(message);\r\n    }\r\n    async navToApp(url: string, unitId: number, apiId?:number, sheetType?:number, sheetId?:number):Promise<void> {\r\n        return new Promise<void>((resolve, reject) => {\r\n            let sheet = this.centerHost.includes('http://localhost:') === true? 'sheet_debug':'sheet'\r\n            let uh = sheetId === undefined?\r\n                    appUrl(url, unitId) :\r\n                    appUrl(url, unitId, sheet, [apiId, sheetType, sheetId]);\r\n            console.log('navToApp: %s', JSON.stringify(uh));\r\n            nav.push(<article className='app-container'>\r\n                <span id={uh.hash} onClick={()=>this.back()} /*style={mobileHeaderStyle}*/>\r\n                    <i className=\"fa fa-arrow-left\" />\r\n                </span>\r\n                {\r\n                    // eslint-disable-next-line \r\n                    <iframe src={uh.url} title={String(sheetId)} />\r\n                }\r\n            </article>, \r\n            ()=> {\r\n                resolve();\r\n            });\r\n        });\r\n    }\r\n\r\n    navToSite(url: string) {\r\n        // show in new window\r\n        window.open(url);\r\n    }\r\n\r\n    get logs() {return logs};\r\n    log(msg:string) {\r\n        logs.push(msg);\r\n    }\r\n    logMark() {\r\n        let date = new Date();\r\n        logMark = date.getTime();\r\n        logs.push('log-mark: ' + date.toTimeString());\r\n    }\r\n    logStep(step:string) {\r\n        logs.push(step + ': ' + (new Date().getTime() - logMark));\r\n    }\r\n\r\n    showReloadPage(msg: string) {\r\n        let seconds = -1;\r\n\t\tthis.push(<ReloadPage message={msg} seconds={seconds} />);\r\n\t\t/*\r\n\t\tif (seconds > 0) {\r\n\t\t\tenv.setTimeout(undefined, this.reload, seconds*1000);\r\n\t\t}\r\n\t\t*/\r\n    }\r\n\r\n    reload = async () => {\r\n        let waiting:Promise<void> = new Promise<void>((resolve, reject) => {\r\n            setTimeout(resolve, 100);\r\n        });\r\n\r\n        if ('serviceWorker' in navigator) {\r\n            let registration =await Promise.race([waiting, navigator.serviceWorker.ready]);\r\n            if (registration) registration.unregister();\r\n        }\r\n        //window.document.location.reload();\r\n        window.location.reload();\r\n\t\t// dcloud hbuilder里面的app自动升级，需要清webview的缓存\r\n\t\tlet plus = (window as any).plus;\r\n\t\tif (plus) {\r\n\t\t\tlet webview = plus.webview;\r\n\t\t\tif (webview) {\r\n\t\t\t\tif (webview.reload) webview.reload(true);\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tlet webView = plus.webView;\r\n\t\t\t\tif (webView) {\r\n\t\t\t\t\tif (webView.reload) webView.reload(true);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t//plus.webview.reload(true)\r\n\t\t}\r\n    }\r\n\r\n    resetAll = () => {\r\n        this.push(<ConfirmReloadPage confirm={(ok:boolean):Promise<void> => {\r\n            if (ok === true) {\r\n                this.showReloadPage('彻底升级');\r\n\t\t\t\tlocalStorage.clear();\r\n\t\t\t\t/*\r\n                this.local.readToMemory();\r\n                env.localDb.removeAll();\r\n\t\t\t\tthis.local.saveToLocalStorage();\r\n\t\t\t\t*/\r\n            }\r\n            else {\r\n                this.pop();\r\n            }\r\n            return;\r\n        }} />);\r\n    }\r\n\r\n    async checkVersion():Promise<string> {\r\n        let {href} = window.location;\r\n        href += (href.indexOf('?')>=0? '&':'?') + '_t_t_=' + new Date().getTime();\r\n        let ret = await fetch(href);\r\n        let r = await ret.text();\r\n        let parser = new DOMParser();\r\n        let htmlDoc = parser.parseFromString(r, 'text/html');\r\n        let elHtml = htmlDoc.getElementsByTagName('html');\r\n        let newVersion = elHtml[0].getAttribute('data-version');\r\n        return newVersion;\r\n    }\r\n}\r\nexport const nav: Nav = new Nav();\r\n\r\nexport class TonvaView extends NavView {\r\n\r\n}\r\n","\nimport {setCenterToken} from './uqApi';\nimport {WSChannel} from './wsChannel';\n\nexport const netToken = {\n    set(userId:number, token:string) {\n        setCenterToken(userId, token);\n        WSChannel.setCenterToken(token);\n    },\n    clear() {\n        setCenterToken(0, undefined);\n        WSChannel.setCenterToken(undefined);\n    }\n};\n","import * as React from 'react';\nimport {FetchError} from '../net/fetchError';\nimport { refetchApi } from '../net';\nimport { Page } from './page/page';\n\nexport interface FetchErrorProps extends FetchError {\n    clearError: ()=>void\n}\n\nexport default class FetchErrorView extends React.Component<FetchErrorProps, null> {\n    private reApi = async () => {\n        this.props.clearError();\n        const {channel, url, options, resolve, reject} = this.props;\n        await refetchApi(channel, url, options, resolve, reject);\n    }\n    private close = async () => {\n        this.props.clearError();\n    }\n    render() {\n        let {error, url} = this.props;\n        let errContent:any;\n        if (typeof error === 'object') {\n            let err = [];\n            for (let i in error) {\n                err.push(<li key={i}><label>{i}</label><div style={{wordWrap:\"break-word\"}}>{error[i]}</div></li>);\n            }\n            errContent = <ul>{err}</ul>;\n        }\n        else {\n            errContent = <div>{error}</div>;\n        }\n        return <div>\n            <article>\n\t\t\t\t<main className=\"va-error\">\n\t\t\t\t\t<div>网络出现问题</div>\n\t\t\t\t\t<div>点击重新访问</div>\n\t\t\t\t\t<div style={{wordWrap:\"break-word\"}}>url: {url}</div>\n\t\t\t\t\t{errContent}\n\t\t\t\t\t<div className=\"p-3\">\n\t\t\t\t\t\t<button type='button' onClick={this.reApi}>重新API</button>\n\t\t\t\t\t\t<button type='button' onClick={this.close}>关闭</button>\n\t\t\t\t\t</div>\n\t\t\t\t</main>\n            </article>\n        </div>;\n    }\n}\n\nexport const SystemNotifyPage = ({message}:{message:string}):JSX.Element => {\n    return <Page header=\"系统提醒\">\n        <div className=\"px-3\">{message}</div>\n    </Page>;\n}","import * as React from 'react';\nimport { nav } from './nav';\nimport { Page } from './page/page';\n\ninterface Props {\n    message: string,\n    seconds: number\n}\n\ninterface State {\n    seconds: number\n}\n\nexport class ReloadPage extends React.Component<Props, State> {\n    private timerHandler:any;\n    constructor(props:Props) {\n\t\tsuper(props);\n\t\tlet {seconds} = props;\n\t\tif (seconds===undefined) return;\n        this.state = {seconds};\n\t\tif (seconds <= 0) return;\n        this.timerHandler = setInterval(() => {\n\t\t\tlet {seconds} = this.state;\n            seconds--;\n            if (seconds <= 0) {\n                this.reload();\n            }\n            else {\n                this.setState({seconds: seconds});\n            }\n        }, 1000);\n    }\n    private reload = () => {\n        clearInterval(this.timerHandler);\n        nav.reload();\n    }\n    render() {\n\t\tlet {seconds} = this.state;\n\t\tlet title:string, msg:string;\t\t\n\t\tif (seconds > 0) {\n\t\t\ttitle = '程序升级中...';\n\t\t\tmsg = this.state.seconds + '秒钟之后自动重启动';\n\t\t}\n\t\telse {\n\t\t\ttitle = '程序需要升级';\n\t\t\tmsg = '请点击下面按钮重启';\n\t\t}\n        return <Page header={false}>\n            <div className=\"text-center p-5\">\n                <div className=\"text-info py-5\">\n\t\t\t\t\t<span className=\"text-danger\">{title}</span>\n\t\t\t\t\t<br/>\n\t\t\t\t\t{msg}\n                    <br/>\n                    <span className=\"small text-muted\">{this.props.message}</span>\n                </div>\n                <button className=\"btn btn-danger\" onClick={this.reload}>立刻重启</button>\n            </div>\n        </Page>;\n    }\n}\n\ninterface ConfirmReloadPageProps {\n    confirm: (ok: boolean)=>Promise<void>;\n}\nexport const ConfirmReloadPage = (props: ConfirmReloadPageProps):JSX.Element => {\n    return <Page header=\"升级软件\" back=\"close\">\n        <div className=\"py-5 px-3 my-5 mx-2 border bg-white rounded\">\n            <div className=\"text-center text-info\">\n                升级将清除所有本机缓冲区内容，并从服务器重新安装程序！\n            </div>\n            <div className=\"text-center mt-5\">\n                <button className=\"btn btn-danger mr-3\" onClick={()=>props.confirm(true)}>确认升级</button>\n            </div>\n        </div>\n    </Page>;\n    // <button className=\"btn btn-outline-danger\" onClick={()=>props.confirm(false)}>暂不</button>\n}\n","import * as React from 'react';\r\nimport {nav, Page, Form, Schema, UiSchema, UiTextItem, UiPasswordItem, Context, UiButton, resLang, StringSchema, Ax} from '../components';\r\nimport { userApi } from '../net';\r\nimport { LoginRes, loginRes } from '../res';\r\nimport { tonvaTop, getSender } from './tools';\r\nimport { User } from '../tool/user';\r\n\r\nconst schema: Schema = [\r\n    {name: 'username', type: 'string', required: true, maxLength: 100} as StringSchema,\r\n    {name: 'password', type: 'string', required: true, maxLength: 100} as StringSchema,\r\n    {name: 'login', type: 'submit'},\r\n];\r\n\r\nexport interface LoginProps {\r\n    withBack?: boolean;\r\n    callback?: (user:User) => Promise<void>;\r\n    //top?: any;\r\n}\r\n\r\nexport default class Login extends React.Component<LoginProps> {\r\n    private res: LoginRes = resLang(loginRes);\r\n    private uiSchema: UiSchema = {\r\n        items: {\r\n            username: {placeholder: '手机/邮箱/用户名', label: '登录账号'} as UiTextItem,\r\n            password: {widget: 'password', placeholder: '密码', label: '密码'} as UiPasswordItem,\r\n            login: {widget: 'button', className: 'btn btn-primary btn-block mt-3', label: '登录'} as UiButton,\r\n        }\r\n    }\r\n\r\n    private onSubmit = async (name:string, context:Context):Promise<string> => {\r\n        let values = context.form.data;\r\n        let un = values['username'];\r\n        let pwd = values['password'];\r\n        if (pwd === undefined) {\r\n            return 'something wrong, pwd is undefined';\r\n        }\r\n        let user = await userApi.login({\r\n            user: un,\r\n            pwd: pwd,\r\n            guest: nav.guest,\r\n        });\r\n\r\n        if (user === undefined) {\r\n            let sender = getSender(un);\r\n            let type:string = sender !== undefined? sender.caption : '用户名';\r\n            return type + '或密码错！';\r\n        }\r\n\t\tconsole.log(\"onLoginSubmit: user=%s pwd:%s\", user.name, user.token);\r\n        await nav.userLogined(user, this.props.callback);\r\n    }\r\n    private onEnter = async (name:string, context:Context):Promise<string> => {\r\n        if (name === 'password') {\r\n            return await this.onSubmit('login', context);\r\n        }\r\n\t}\r\n\t/*\r\n    private clickReg = () => {\r\n        //nav.replace(<RegisterView />);\r\n        let register = new RegisterController(undefined);\r\n        register.start();\r\n    }\r\n    private clickForget = () => {\r\n        let forget = new ForgetController(undefined);\r\n        forget.start();\r\n\t}\r\n\t*/\r\n    render() {\r\n        let footer = <div><div className=\"d-block\">\r\n            <div className='text-center'>\r\n                <Ax href=\"/register\" className=\"btn btn-link\" style={{margin:'0px auto'}}>\r\n                    注册账号\r\n                </Ax>\r\n            </div>\r\n            {nav.privacyEntry()}\r\n        </div>\r\n        </div>;\r\n        let header:string|boolean|JSX.Element = false;\r\n        if (this.props.withBack === true) {\r\n            header = '登录';\r\n        }\r\n        return <Page header={header} footer={footer}>\r\n            <div className=\"d-flex p-5 flex-column justify-content-center align-items-center\">\r\n                <div className=\"flex-fill\" />\r\n                <div className=\"w-20c\">\r\n                    {tonvaTop()}\r\n                    <div className=\"h-2c\" />\r\n                    <Form schema={schema} uiSchema={this.uiSchema} \r\n                        onButtonClick={this.onSubmit} \r\n                        onEnter={this.onEnter}\r\n                        requiredFlag={false} />\r\n\t\t\t\t\t{/*onClick={() => this.clickForget()}*/}\r\n                    <Ax className=\"btn btn-link btn-block\" href=\"/forget\">\r\n                        忘记密码\r\n                    </Ax>\r\n                </div>\r\n                <div className=\"flex-fill\" />\r\n                <div className=\"flex-fill\" />\r\n            </div>\r\n        </Page>;\r\n    }\r\n}\r\n","import { decodeGuestToken } from '../tool/user';\nimport { CenterApiBase } from './uqApi';\n\nexport class GuestApi extends CenterApiBase {\n    async guest(): Promise<any> {\n        //let guest = nav.local.guest.get();\n        let ret = await this.get('', {});\n        switch (typeof ret) {\n            default: return;\n            case 'string': return decodeGuestToken(ret);\n            case 'object':\n                let guest = decodeGuestToken(ret.token);\n                return guest;\n        }\n    }\n\n    async unitFromName(unitName:string): Promise<number> {\n        let ret = await this.get(unitName);\n        return ret && ret.unit;\n    }\n}\n\nexport const guestApi = new GuestApi('tv/guest/', undefined);\n","export abstract class Caller<T> {\n    protected readonly _params: T;\n    constructor(params: T, waiting: boolean) {\n        this._params = params;\n        this.waiting = waiting;\n    }\n    protected get params():any {return this._params;}\n    buildParams():any {return this.params;}\n    method: string  = 'POST';\n    abstract get path(): string;\n    get headers(): {[header:string]: string} {return undefined}\n    waiting: boolean;\n}\n","import {observable} from 'mobx';\r\n\r\nexport interface Id {\r\n    id: number;\r\n}\r\n\r\nexport abstract class CacheIds<T extends Id> {\r\n    constructor(maxCount:number = 100) {\r\n        this.maxCount = maxCount;\r\n    }\r\n    private maxCount:number;\r\n    private arr:T[] = [];\r\n    @observable dict = new Map<number, T>();\r\n\r\n    loadIds(ids:number[]) {\r\n        let arr:number[] = [];\r\n        for (let id of ids) {\r\n            if (id === null) continue;\r\n            let item = this.dict.get(id);\r\n            if (item === undefined) {\r\n                arr.push(id);\r\n                item = {id:id} as T;\r\n                this.dict.set(id, item);\r\n            }\r\n        }                \r\n        this.loadId(arr);\r\n    }\r\n\r\n    get(id:number):T {\r\n        if (id === undefined || id === null) return null;\r\n        let item = this.dict.get(id);\r\n        if (item === undefined) {\r\n            this.dict.set(id, {id:id} as T);\r\n            this.loadId([id]);\r\n            item = this.dict.get(id);\r\n        }\r\n        return item;\r\n    }\r\n    private setItem(id:number, item:T) {\r\n        if (item === undefined) {\r\n            this.dict.set(id, null);\r\n            this.arr.push({id: id} as T);\r\n        }\r\n        else {\r\n            this.dict.set(id, item);\r\n            this.arr.push(item);\r\n        }\r\n        if (this.arr.length > this.maxCount) {\r\n            item = this.arr.shift();\r\n            this.dict.delete(item.id);\r\n        }\r\n    }\r\n    private async loadId(ids:number[]) {\r\n        let items = await this._loadIds(ids);\r\n        if (items === undefined) {\r\n            for (let id of ids) {\r\n                if (id === null) continue;\r\n                let item = await this._loadId(id);\r\n                this.setItem(id, item);\r\n            }\r\n        }\r\n        else {\r\n            for (let id of ids) {\r\n                let item = items.find(v => v.id === id);\r\n                this.setItem(id, item);\r\n            }\r\n        }\r\n    }\r\n\r\n    protected abstract _loadIds(ids:number[]):Promise<T[]>;\r\n    protected abstract _loadId(id:number):Promise<T>;\r\n}\r\n","import { env } from './env';\n\nexport class LocalData {\n    user = env.localDb.child('user');\n    guest = env.localDb.child('guest');\n    unit = env.localDb.child('unit');\n\n    private _user:string;\n    private _guest:string;\n    private _unit:string;\n    readToMemory() {\n        this._user = this.user.get();\n        this._guest = this.guest.get();\n        this._unit = this.unit.get();\n    }\n    saveToLocalStorage() {\n        this.user.set(this._user);\n        this.guest.set(this._guest);\n        this.unit.set(this._unit);\n    }\n\n    logoutClear() {\n        [\n            this.user,\n            this.unit,\n        ].forEach(d => d.remove());\n    }\n}\n","export function getObjPropIgnoreCase(obj:any, prop:string):any {\n\tif (!obj) return;\n\tif (!prop) return;\n\tlet keys = Object.keys(obj);\n\tprop = prop.toLowerCase();\n\tfor (let key of keys) {\n\t\tif (key.toLowerCase() === prop) return obj[key];\n\t}\n\treturn;\n}\n","import * as React from 'react';\r\nimport {observer} from 'mobx-react';\r\nimport {PageHeaderProps, renderPageHeader} from './pageHeader';\r\nimport { TabsProps, TabsView } from './tabs';\r\nimport { ScrollProps, ScrollView, PageWebNav, WebNavScrollView } from './scrollView';\r\nimport { nav } from '../nav';\r\n\r\nexport interface IVPage {\r\n\tcontent():JSX.Element;\r\n\theader():JSX.Element|string;\r\n\tfooter():JSX.Element;\r\n}\r\n\r\nexport interface PageProps extends ScrollProps {\r\n    back?: 'close' | 'back' | 'none';\r\n    header?: boolean | string | JSX.Element;\r\n    right?: JSX.Element;\r\n    footer?: JSX.Element;\r\n    logout?: boolean | (()=>Promise<void>);\r\n\theaderClassName?: string;\r\n\tclassName?: string;\r\n\tafterBack?: () => void;\r\n\ttabsProps?: TabsProps;\r\n\twebNav?: PageWebNav;\r\n}\r\n\r\n@observer\r\nexport class Page extends React.Component<PageProps> {\r\n\tprivate tabsView: TabsView;\r\n    constructor(props: PageProps) {\r\n\t\tsuper(props);\r\n\t\tlet {tabsProps} = props;\r\n\t\tif (tabsProps) {\r\n\t\t\tthis.tabsView = new TabsView(tabsProps);\r\n\t\t}\r\n\t}\r\n\r\n\tprivate renderHeader(webNav?: PageWebNav) {\r\n\t\tconst {back, header, right, headerClassName, afterBack, logout} = this.props;\r\n\t\tif (header === false) return;\r\n\t\t//const {webNav} = this.props;\r\n\t\tlet inWebNav = false;\r\n\t\tlet pageHeaderProps:PageHeaderProps = {\r\n\t\t\tback,\r\n\t\t\tcenter: header as any,\r\n\t\t\tright,\r\n\t\t\tlogout,\r\n\t\t\tclassName: headerClassName,\r\n\t\t\tafterBack,\r\n\t\t};\r\n\t\tif (webNav !== undefined) {\r\n\t\t\tinWebNav = true;\r\n\t\t\tlet {renderPageHeader: rph} = webNav;\r\n\t\t\tif (rph) return rph(pageHeaderProps);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tinWebNav = false;\r\n\t\t}\r\n\t\treturn renderPageHeader(pageHeaderProps, inWebNav);\r\n\t\t/*\r\n\t\tlet pageHeader = header !== false && <PageHeader \r\n\t\t\tback={back} \r\n\t\t\tcenter={header as any}\r\n\t\t\tright={right}\r\n\t\t\tlogout={this.props.logout}\r\n\t\t\tclassName={headerClassName}\r\n\t\t\tafterBack={afterBack}\r\n\t\t\t/>;\r\n\t\treturn pageHeader;\r\n\t\t*/\r\n\t}\r\n\r\n\tprivate renderFooter(webNav?: PageWebNav) {\r\n\t\tconst {footer} = this.props;\r\n\t\tif (!footer) return;\r\n\t\tlet elFooter = <footer>{footer}</footer>;\r\n\t\tif (webNav) return elFooter;\r\n\t\treturn <>\r\n\t\t\t<section className=\"tv-page-footer\">{elFooter}</section>\r\n\t\t\t{elFooter}\r\n\t\t</>;\r\n\t}\r\n\r\n    render() {\r\n\t\tif (this.tabsView) {\r\n\t\t\treturn React.createElement(this.tabsView.content);\r\n\t\t}\r\n\t\tconst {onScroll, onScrollTop, onScrollBottom, children, className, webNav} = this.props;\r\n\t\tlet pageWebNav:PageWebNav;\r\n\t\tif (!webNav) {\r\n\t\t\tpageWebNav = nav.pageWebNav;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tpageWebNav = webNav;\r\n\t\t}\r\n\t\tlet content = <>\r\n\t\t\t{this.renderHeader(pageWebNav)}\r\n\t\t\t<main>{children}</main>\r\n\t\t\t{this.renderFooter(pageWebNav)}\r\n\t\t</>;\r\n\t\tif (pageWebNav) {\r\n\t\t\treturn <WebNavScrollView\r\n\t\t\t\tonScroll={onScroll}\r\n\t\t\t\tonScrollTop={onScrollTop}\r\n\t\t\t\tonScrollBottom={onScrollBottom}\r\n\t\t\t\tclassName={className}\r\n\t\t\t\twebNav={pageWebNav}\r\n\t\t\t>\r\n\t\t\t\t{content}\r\n\t\t\t</WebNavScrollView>;\r\n\t\t}\r\n\t\telse {\r\n\t\t\treturn <ScrollView\r\n\t\t\t\tonScroll={onScroll}\r\n\t\t\t\tonScrollTop={onScrollTop}\r\n\t\t\t\tonScrollBottom={onScrollBottom}\r\n\t\t\t\tclassName={className}\r\n\t\t\t>\r\n\t\t\t\t{content}\r\n\t\t\t</ScrollView>;\r\n\t\t}\r\n\t}\r\n}\r\n","import _ from 'lodash';\r\nimport {nav} from '../components';\r\nimport {uid} from '../tool/uid';\r\nimport {uqTokenApi, callCenterapi, centerToken, setCenterToken} from './uqApi';\r\nimport {setSubAppWindow} from './wsChannel';\r\nimport { host } from './host';\r\n\r\nexport interface UqToken {\r\n    name: string;\r\n    db: string;\r\n    url: string;\r\n    token: string;\r\n}\r\nconst uqTokens:{[uqName:string]: UqToken}  = {};\r\nexport function logoutUqTokens() {\r\n    for (let i in uqTokens) {\r\n        uqTokens[i] = undefined;\r\n    }\r\n}\r\n\r\nexport interface AppInFrame {\r\n    hash: string;\r\n    unit: number;       // unit id\r\n    page?: string;\r\n    param?: string[];\r\n    predefinedUnit?: number;  // 比如像Cart这样的应用，直接让用户访问的，就需要在unit.json里面定义unitName\r\n}\r\nconst appsInFrame:{[key:string]:AppInFrame} = {};\r\n\r\nclass AppInFrameClass implements AppInFrame {\r\n    hash: string;\r\n    private _unit: number;\r\n    get unit(): number {return this._unit;}       // unit id\r\n    set unit(val:number) { this._unit=val;}\r\n    page?: string;\r\n    param?: string[];\r\n}\r\n\r\nexport let appInFrame:AppInFrame = new AppInFrameClass();\r\n/* {\r\n    hash: undefined,\r\n    get unit():number {return } undefined, //debugUnitId,\r\n    page: undefined;\r\n    param: undefined,\r\n}*/\r\n\r\nexport function isBridged():boolean {\r\n    if (process.env.isMiniprogram)\r\n        return false;\r\n    return window.self !== window.parent;\r\n}\r\n\r\nwindow.addEventListener('message', async function(evt) {\r\n    var message = evt.data;\r\n    switch (message.type) {\r\n        case 'sub-frame-started':\r\n            subFrameStarted(evt);\r\n            break;\r\n        case 'ws':\r\n            //wsBridge.receive(message.msg);\r\n            await nav.onReceive(message.msg);\r\n            break;\r\n        case 'init-sub-win':\r\n            await initSubWin(message);\r\n            break;\r\n        case 'pop-app':\r\n            window.console.log('///\\\\\\\\\\\\ pop-app');\r\n            nav.navBack();\r\n            break;\r\n        case 'center-api':\r\n            await callCenterApiFromMessage(evt.source as Window, message);\r\n            break;\r\n        case 'center-api-return':\r\n            bridgeCenterApiReturn(message);\r\n            break;\r\n        case 'app-api':\r\n            let ret = await onReceiveAppApiMessage(message.hash, message.apiName);\r\n            (evt.source as Window).postMessage({\r\n                type: 'app-api-return', \r\n                apiName: message.apiName,\r\n                db: ret.db,\r\n                url: ret.url,\r\n                token: ret.token} as any, \"*\");\r\n            break;\r\n        case 'app-api-return':\r\n            console.log(\"app-api-return: %s\", JSON.stringify(message));\r\n            console.log('await onAppApiReturn(message);');\r\n            await onAppApiReturn(message);\r\n            break;\r\n        default:\r\n\t\t\tif ((message.source as string) && _.startsWith(message.source, 'react-devtools') === true) break;\r\n            window.console.log('message: %s', JSON.stringify(message));\r\n            break;\r\n    }\r\n});\r\n\r\nfunction subFrameStarted(evt:any) {\r\n    var message = evt.data;\r\n    let subWin = evt.source as Window;\r\n    setSubAppWindow(subWin);\r\n    hideFrameBack(message.hash);\r\n    let msg:any = _.clone(nav.user);\r\n    msg.type = 'init-sub-win';\r\n    subWin.postMessage(msg, '*');\r\n}\r\nfunction hideFrameBack(hash:string) {\r\n    let el = document.getElementById(hash);\r\n    if (el !== undefined) el.hidden = true;\r\n}\r\nasync function initSubWin(message:any) {\r\n    console.log('initSubWin: set nav.user', message);\r\n    let user = nav.user = message; // message.user;\r\n    setCenterToken(user.id, user.token);\r\n    await nav.showAppView();\r\n}\r\nasync function onReceiveAppApiMessage(hash: string, apiName: string): Promise<UqToken> {\r\n    let appInFrame = appsInFrame[hash];\r\n    if (appInFrame === undefined) return {name:apiName, db:undefined, url:undefined, token:undefined};\r\n    //let unit = getUnit();\r\n    let {unit, predefinedUnit} = appInFrame;\r\n    unit = unit || predefinedUnit;\r\n    if (!unit) {\r\n        console.error('no unit defined in unit.json or in index.html, or not logined in', unit);\r\n    }\r\n    let parts = apiName.split('/');\r\n    let param = {unit, uqOwner: parts[0], uqName: parts[1], appOwner: parts[2], appName:parts[3]};\r\n    console.log('uqTokenApi.uq onReceiveAppApiMessage', param);\r\n    let ret = await uqTokenApi.uq(param);\r\n    let {db, url, token} = ret;\r\n    return {name: apiName, db:db, url: url, token: token};\r\n}\r\n\r\nasync function onAppApiReturn(message:any) {\r\n    let {apiName, db, url, urlTest, token} = message;\r\n    let action = uqTokenActions[apiName];\r\n    if (action === undefined) {\r\n        throw new Error('error app api return');\r\n        //return;\r\n    }\r\n    let realUrl = host.getUrlOrTest(db, url, urlTest);\r\n    console.log('onAppApiReturn(message:any): url=' + url + ', real=' + realUrl);\r\n    //action.url = realUrl;\r\n    //action.token = token;\r\n    action.resolve({\r\n        name: apiName,\r\n        db: db,\r\n        url: realUrl,\r\n        token: token,\r\n    } as UqToken);\r\n}\r\n\r\nexport function setAppInFrame(appHash: string):AppInFrame {\r\n    if (appHash) {\r\n        let parts = appHash.split('-');\r\n        let len = parts.length;\r\n        if (len > 0) {\r\n            let p = 1;\r\n            appInFrame.hash = parts[p++];\r\n            if (len>0) appInFrame.unit = Number(parts[p++]);\r\n            if (len>1) appInFrame.page = parts[p++];\r\n            if (len>2) appInFrame.param = parts.slice(p++);\r\n        }\r\n    }\r\n    return appInFrame;\r\n}\r\n\r\nexport function getExHashPos():number {\r\n    let hash = window.location.hash;\r\n    if (hash !== undefined && hash.length > 0) {\r\n        let pos = hash.lastIndexOf('#tv-');\r\n        if (pos < 0) pos = hash.lastIndexOf('#tvdebug-');\r\n        return pos;\r\n    }\r\n    return -1;\r\n}\r\n\r\nexport function getExHash():string {\r\n    let pos = getExHashPos();\r\n    if (pos < 0) return undefined;\r\n    return window.location.hash.substring(pos);\r\n}\r\n\r\nexport function appUrl(url: string, unitId: number, page?:string, param?:any[]):{url:string; hash:string} {\r\n    let u:string;\r\n    for (;;) {\r\n        u = uid();\r\n        let a = appsInFrame[u];\r\n        if (a === undefined) {\r\n            appsInFrame[u] = {hash:u, unit:unitId};\r\n            break;\r\n        }\r\n    }\r\n    url += '#tv-' + u + '-' + unitId;\r\n    if (page !== undefined) {\r\n        url += '-' + page;\r\n        if (param !== undefined) {\r\n            for (let i=0; i<param.length; i++) {\r\n                url += '-' + param[i];\r\n            }\r\n        }\r\n    }\r\n    return {url: url, hash: u};\r\n}\r\n\r\nfunction getUnit():number {\r\n\tlet {unit, predefinedUnit} = appInFrame;\r\n\tlet realUnit:number;\r\n\tif (unit !== undefined) {\r\n\t\trealUnit = unit;\r\n\t} \r\n\telse if (predefinedUnit !== undefined) {\r\n\t\trealUnit = predefinedUnit;\r\n\t}\r\n    if (realUnit === undefined) {\r\n        throw new Error('no unit defined in unit.json or not logined in');\r\n\t}\r\n    return realUnit;\r\n}\r\n\r\ninterface UqTokenAction {\r\n    resolve: (value?: UqToken | PromiseLike<UqToken>) => void;\r\n    reject: (reason?: any) => void;\r\n}\r\nconst uqTokenActions:{[uq:string]: UqTokenAction} = {};\r\nexport async function buildAppUq(uq:string, uqOwner:string, uqName:string, appOwner:string, appName:string):Promise<void> {\r\n    if (!isBridged()) {\r\n        let unit = getUnit();\r\n        let uqToken = await uqTokenApi.uq({unit,  uqOwner, uqName, appOwner, appName});\r\n        if (uqToken.token === undefined) uqToken.token = centerToken;\r\n        let {db, url, urlTest} = uqToken;\r\n        let realUrl = host.getUrlOrTest(db, url, urlTest);\r\n        console.log('realUrl: %s', realUrl);\r\n        uqToken.url = realUrl;\r\n        uqTokens[uq] = uqToken;\r\n        return uqToken;\r\n    }\r\n    console.log(\"**** before buildAppUq ****\", appInFrame);\r\n    let bp = uqTokenActions[uq];\r\n    if (bp !== undefined) return;\r\n    return new Promise<void>((resolve, reject) => {\r\n        uqTokenActions[uq] = {\r\n            resolve: async (at:any) => {\r\n                let {db, url, token} = await at;\r\n                uqTokens[uq] = {\r\n                    name: uq,\r\n                    db: db,\r\n                    url: url,\r\n                    token: token,\r\n                };\r\n                uqTokenActions[uq] = undefined;\r\n                console.log(\"**** after buildAppUq ****\", appInFrame);\r\n                resolve();\r\n            },\r\n            reject: reject,\r\n        };\r\n        (window.opener || window.parent).postMessage({\r\n            type: 'app-api',\r\n            apiName: uq,\r\n            hash: appInFrame.hash,\r\n        }, \"*\");\r\n    });\r\n}\r\n\r\nexport function appUq(uq:string):UqToken {\r\n    let uts = uqTokens;\r\n    return uts[uq];\r\n}\r\n\r\ninterface BridgeCenterApi {\r\n    id: string;\r\n    resolve: (value?:any)=>any;\r\n    reject: (reason?:any)=>void;\r\n}\r\nconst brideCenterApis:{[id:string]: BridgeCenterApi} = {};\r\nexport async function bridgeCenterApi(url:string, method:string, body:any):Promise<any> {\r\n    console.log('bridgeCenterApi: url=%s, method=%s', url, method);\r\n    return await new Promise<any>(async (resolve, reject) => {\r\n        let callId:string;\r\n        for (;;) {\r\n            callId = uid();\r\n            let bca = brideCenterApis[callId];\r\n            if (bca === undefined) {\r\n                brideCenterApis[callId] = {\r\n                    id: callId,\r\n                    resolve: resolve,\r\n                    reject: reject,\r\n                }\r\n                break;\r\n            }\r\n        }\r\n        console.log('bridgeCenterApi: url=%s, callId=%s, body=%s', url, callId, body);\r\n        let o = window.opener || window.parent || window;\r\n        console.log('bridgeCenterApi: window=%s', o);\r\n        o?.postMessage({\r\n            type: 'center-api',\r\n            callId: callId,\r\n            url: url,\r\n            method: method,\r\n            body: body\r\n        }, '*');\r\n    });\r\n}\r\n\r\nasync function callCenterApiFromMessage(from:Window, message:any):Promise<void> {\r\n    let {callId, url, method, body} = message;\r\n    let result = await callCenterapi.directCall(url, method, body);\r\n    from.postMessage({\r\n        type: 'center-api-return',\r\n        callId: callId,\r\n        result: result,\r\n    }, '*');\r\n}\r\n\r\nfunction bridgeCenterApiReturn(message:any) {\r\n    let {callId, result} = message;\r\n    let bca = brideCenterApis[callId];\r\n    if (bca === undefined) return;\r\n    brideCenterApis[callId] = undefined;\r\n    bca.resolve(result);\r\n}\r\n","import * as React from 'react';\nimport { ItemSchema, UiItem, UiSelectBase } from '../schema';\nimport { nav } from '../nav';\nimport { observable } from 'mobx';\nimport { FieldRule } from '../form/rules';\nimport { Image } from '../image';\nimport { Edit } from './edit';\n\nexport abstract class ItemEdit {\n\tprotected edit: Edit;\n\tprotected name: string;\n\tprotected _itemSchema: ItemSchema;\n    get itemSchema(): ItemSchema {return this._itemSchema}\n    protected _uiItem:UiItem;\n    get uiItem():UiItem {return this._uiItem}\n    value: any;\n\tlabel: string;\n\tget editInRow(): boolean {return false;}\n\n    @observable protected error: string;\n    @observable protected isChanged: boolean = false;\n    protected newValue: any;\n\n    constructor(edit:Edit, itemSchema: ItemSchema, uiItem:UiItem, label:string, value: any) {\n\t\tthis.edit = edit;\n        this._itemSchema = itemSchema;\n        this._uiItem = uiItem\n        this.value = value;\n        let {name} = itemSchema;\n        this.name = name;\n        this.label = label;\n\t}\n\t\n\tinit() {\t\t\n\t}\n\n    async start():Promise<any> {\n        return await this.internalStart();\n    }\n\n    protected abstract internalStart():Promise<any>;\n\n    async end():Promise<any> {\n        await this.internalEnd()\n    }\n\n\trenderContent() {\n        let {name, type} = this._itemSchema;\n        let divValue:any;\n        let uiItem = this._uiItem;\n        let label:string, labelHide:boolean;\n        if (uiItem === undefined) {\n            label = name;\n        }\n        else {\n\t\t\tlabel = uiItem.label;\n\t\t\tlabelHide = uiItem.labelHide;\n            let templet = uiItem.Templet;\n            if (templet !== undefined) {\n                if (typeof templet === 'function') {\n\t\t\t\t\tif (this.value !== undefined) divValue = templet(this.value);\n\t\t\t\t}\n                else {\n\t\t\t\t\tdivValue = {templet};\n\t\t\t\t}\n            }\n            else if (this.value !== undefined) {\n                switch (uiItem.widget) {\n                    case 'radio':\n                    case 'select':\n                        let {list} = uiItem as UiSelectBase;\n                        divValue = <b>{list.find(v => v.value === this.value).title}</b>;\n                        break;\n                    case 'id':\n                        divValue = <b>no templet for {name}={this.value}</b>\n                        break;\n                }\n            }\n        }\n        if (divValue === undefined) {\n            switch (type) {\n                default:\n                    divValue = this.value? \n\t\t\t\t\t\t<b>{this.value}</b> \n\t\t\t\t\t\t:\n\t\t\t\t\t\t<small className=\"text-muted\">[{labelHide===true? label:'无'}]</small>;\n                    break;\n                case 'image':\n                    divValue = <Image className=\"w-4c h-4c\" src={this.value} />;\n                    break;\n            }\n\t\t}\n\t\treturn divValue;\n\t}\n\n    protected async internalEnd():Promise<void> {nav.pop()}\n\n    protected verifyValue() {\n        if (this.uiItem === undefined) return;\n        let {rules} = this.uiItem;\n        if (rules === undefined) return;\n        let nv = this.newValue;\n        function verifyRule(rule:FieldRule, value: any):string {\n            let error = rule(nv);\n            if (error !== undefined) {\n                if (typeof error !== 'object')\n                    return error;\n                else\n                    return JSON.stringify(error);\n            }\n        }\n        if (Array.isArray(rules)) {\n            for (let rule of rules) {\n                let error = verifyRule(rule as FieldRule, nv);\n                if (error !== undefined) {\n                    this.error = error;\n                    break;\n                }\n            }\n        }\n        else {\n            this.error = verifyRule(rules as FieldRule, nv);\n        }\n    }\n}\n","//import _ from 'lodash';\nimport { Caller } from '../net';\nimport { Entity } from './entity';\nimport { Action } from './action';\nimport { Query } from './query';\n\ninterface UqResponseSchema {\n    uq: any;\n    entity: any;\n}\n\nexport abstract class EntityCaller<T> extends Caller<T> {\n    private tries: number;\n    protected _entity: Entity;\n\n    constructor(entity: Entity, params:T, waiting: boolean = true) {\n        super(params, waiting);\n        this.tries = 0;\n        this._entity = entity;\n    }\n\n    protected get entity(): Entity {return this._entity;}\n\n    //大多的entityCaller都不需要这个\n    //buildParams() {return this.entity.buildParams(this.params);}\n    \n    async request(): Promise<any> {\n        await this.entity.loadSchema();\n        let ret = await this.innerRequest();\n        return ret;\n    }\n\n    protected async innerCall(): Promise<any> {\n        return await this.entity.uqApi.xcall(this);\n    }\n\n    async innerRequest(): Promise<any> {\n        let jsonResult = await this.innerCall();\n        let {$uq, $modify, res} = jsonResult;\n        this.entity.uq.pullModify($modify);\n        if ($uq === undefined) {\n            //if (res === undefined) debugger;\n            let ret = this.xresult(res);\n            //if (ret === undefined) debugger;\n            return ret;\n        }\n        return await this.retry($uq);\n    }\n\n    xresult(res:any):any {return res}\n\n    get headers(): {[header:string]: string} {\n        let {ver, uq} = this.entity;\n        let {uqVersion} = uq;\n        return {\n            uq: `${uqVersion}`,\n            en: `${ver}`,\n        }\n    }\n\n    private async retry(schema: UqResponseSchema) {\n        ++this.tries;\n        if (this.tries > 5) throw new Error('can not get right uq response schema, 5 tries');\n        this.rebuildSchema(schema);\n        return await this.innerRequest();\n    }\n\n    private rebuildSchema(schema: UqResponseSchema) {\n        let {uq, entity} = schema;\n        if (uq !== undefined) {\n\t\t\tthis.entity.uq.buildEntities(uq);\n\t\t}\n        if (entity !== undefined) {\n\t\t\tthis.entity.setSchema(entity);\n\t\t}\n    }\n}\n\nexport abstract class ActionCaller extends EntityCaller<any> {\n    protected get entity(): Action {return this._entity as Action;}\n}\n\nexport class QueryQueryCaller extends EntityCaller<any> {\n    protected get entity(): Query {return this._entity as Query};\n    get path():string {return `query/${this.entity.name}`;}\n    xresult(res:any) {\n        let data = this.entity.unpackReturns(res);\n        return data;\n    }\n    buildParams() {return this.entity.buildParams(this.params);}\n}\n\nexport class QueryPageCaller extends EntityCaller<any> {\n    protected get params(): {pageStart:any; pageSize:number, params:any} {return this._params};\n\tprotected get entity(): Query {return this._entity as Query};\n\t//results: {[name:string]:any[]};\n\tget path():string {return `query-page/${this.entity.name}`;}\t\n    buildParams() {\n        let {pageStart, pageSize, params} = this.params;\n        let p:any;\n        if (params === undefined) {\n            p = {key: ''};\n        }\n        else {\n            p = this.entity.buildParams(params);\n        }\n        /*\n        switch (typeof params) {\n            case 'undefined': p = {key: ''}; break;\n            default: p = _.clone(params); break;\n        }\n        */\n        p['$pageStart'] = pageStart;\n        p['$pageSize'] = pageSize;\n        return p;\n    };\n    xresult(res:any): {[name:string]:any[]} {\n        let ret = this.entity.unpackReturns(res);\n\t\t//return this.results.$page;// as any[];\n\t\treturn ret;\n    }\n}\n","import { UqApi } from '../net';\nimport { LocalCache } from '../tool';\nimport { UqMan, Field, ArrFields, FieldMap } from './uqMan';\nimport { Tuid } from './tuid';\nimport { getObjPropIgnoreCase } from '../tool';\n\nconst tab = '\\t';\nconst ln = '\\n';\nconst chars = '\\\\ntbfvr';\nconst codeBackSlash = chars.charCodeAt(0);\nconst codeN = chars.charCodeAt(1);\nconst codeT = chars.charCodeAt(2);\nconst codeB = chars.charCodeAt(3);\nconst codeF = chars.charCodeAt(4);\nconst codeV = chars.charCodeAt(5);\nconst codeR = chars.charCodeAt(6);\n\nconst codes = '\\n\\t\\b\\f\\v\\r';\nconst codeBN = codes.charCodeAt(0);\nconst codeBT = codes.charCodeAt(1);\nconst codeBB = codes.charCodeAt(2);\nconst codeBF = codes.charCodeAt(3);\nconst codeBV = codes.charCodeAt(4);\nconst codeBR = codes.charCodeAt(5);\n\nexport abstract class Entity {\n    private jName: string;\n    schema: any;\n    ver: number = 0;\n    sys?: boolean;\n    readonly uq: UqMan;\n    readonly name: string;\n    readonly typeId: number;\n    readonly cache: LocalCache;\n    readonly uqApi: UqApi;\n    abstract get typeName(): string;\n    get sName():string {return this.jName || this.name}\n    fields: Field[];\n    arrFields: ArrFields[];\n    returns: ArrFields[];\n\n    constructor(uq:UqMan, name:string, typeId:number) {\n        this.uq = uq;\n        this.name = name;\n        this.typeId = typeId;\n        this.sys = this.name.indexOf('$') >= 0;\n        this.cache = this.uq.localMap.item(this.name); // new EntityCache(this);\n        this.uqApi = this.uq.uqApi;\n    }\n\n    public face: any;           // 对应字段的label, placeHolder等等的中文，或者语言的翻译\n\n    //getApiFrom() {return this.entities.uqApi;}\n\n    private fieldMaps: {[arr:string]: FieldMap} = {};\n    fieldMap(arr?:string): FieldMap {\n        if (arr === undefined) arr = '$';\n        let ret = this.fieldMaps[arr];\n        if (ret === undefined) {\n            let fields:Field[];\n            if (arr === '$') fields = this.fields;\n            else if (this.arrFields !== undefined) {\n                let arrFields = this.arrFields.find(v => v.name === arr);\n                if (arrFields !== undefined) fields = arrFields.fields;\n            }\n            else if (this.returns !== undefined) {\n                let arrFields = this.returns.find(v => v.name === arr);\n                if (arrFields !== undefined) fields = arrFields.fields;\n            }\n            if (fields === undefined) return {};\n            ret = {};\n            for (let f of fields) ret[f.name] = f;\n            this.fieldMaps[arr] = ret;\n        }\n        return ret;\n    }\n\n    public async loadSchema():Promise<void> {\n        if (this.schema !== undefined) return;\n        let schema = this.cache.get();\n        if (!schema) {\n            schema = await this.uq.loadEntitySchema(this.name);\n        }\n        this.setSchema(schema);\n\t\tthis.buildFieldsTuid();\n\t\tawait this.loadValues();\n\t}\n\t\n\tprotected async loadValues():Promise<any> {}\n\n    // 如果要在setSchema里面保存cache，必须先调用clearSchema\n    public clearSchema() {\n        this.schema = undefined;\n    }\n\n    public setSchema(schema:any) {\n        if (schema === undefined) return;\n        let {name, version} = schema;\n        this.ver = version || 0;\n\t\tthis.setJName(name);\n        this.cache.set(schema);\n\t\tthis.schema = schema;\n\t\tthis.buildFieldsTuid();\n\t}\n\t\n\tprotected setJName(name:string) {\n        if (name !== this.name) this.jName = name;\n\t}\n\n    public buildFieldsTuid() {\n        let {fields, arrs, returns} = this.schema;\n        this.uq.buildFieldTuid(this.fields = fields);\n        this.uq.buildArrFieldsTuid(this.arrFields = arrs, fields);\n        this.uq.buildArrFieldsTuid(this.returns = returns, fields);\n    }\n\n    schemaStringify():string {\n        return JSON.stringify(this.schema, (key:string, value:any) => {\n            if (key === '_tuid') return undefined;\n            return value;\n        }, 4);\n    }\n\n    tuidFromName(fieldName:string, arrName?:string):Tuid {\n        if (this.schema === undefined) return;\n        let {fields, arrs} = this.schema;\n        let entities = this.uq;\n        function getTuid(fn:string, fieldArr:Field[]) {\n            if (fieldArr === undefined) return;\n            let f = fieldArr.find(v => v.name === fn);\n            if (f === undefined) return;\n            return entities.getTuid(f.tuid);\n        }\n        let fn = fieldName.toLowerCase();\n        if (arrName === undefined) return getTuid(fn, fields);\n        if (arrs === undefined) return;\n        let an = arrName.toLowerCase();\n        let arr = (arrs as ArrFields[]).find(v => v.name === an);\n        if (arr === undefined) return;\n        return getTuid(fn, arr.fields);\n    }\n\n    buildParams(params:any):any {\n        let result:any = {};\n        let fields = this.fields;\n        if (fields !== undefined) this.buildFieldsParams(result, fields, params);\n        let arrs = this.arrFields;\n        if (arrs !== undefined) {\n            for (let arr of arrs) {\n                let {name, fields} = arr;\n                let paramsArr:any[] = params[name];\n                if (paramsArr === undefined) continue;\n                let arrResult:any[] = [];\n                result[name] = arrResult;\n                for (let pa of params) {\n                    let rowResult = {};\n                    this.buildFieldsParams(rowResult, fields, pa);\n                    arrResult.push(rowResult);\n                }\n            }\n        }\n        return result;\n    }\n\n    private buildFieldsParams(result:any, fields:Field[], params:any) {\n        for (let field of fields) {\n            let {name, type} = field;            \n            let d = params[name];\n            let val:any;\n            switch (type) {\n\t\t\t\tcase 'datetime':\n                \tval = this.buildDateTimeParam(d);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'date':\n\t\t\t\t\tif (d instanceof Date) {\n\t\t\t\t\t\tval = `${d.getFullYear()}-${d.getMonth()+1}-${d.getDate()}`;\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\tval = d;\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\t\t\t\t\tswitch (typeof d) {\n\t\t\t\t\t\tdefault: val = d; break;\n\t\t\t\t\t\tcase 'object':\n\t\t\t\t\t\t\tif (d instanceof Date) {\n\t\t\t\t\t\t\t\tval = d;\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tlet tuid = field._tuid;\n\t\t\t\t\t\t\tif (tuid === undefined) val = d.id;\n\t\t\t\t\t\t\telse val = tuid.getIdFromObj(d);\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n            }\n            result[name] = val;\n        }\n    }\n\n    buildDateTimeParam(val:any) {\n        let dt: Date;\n        switch (typeof val) {\n            default: debugger; throw new Error('escape datetime field in pack data error: value=' + val);\n            case 'undefined': return '';\n            case 'object': dt = (val as Date); break;\n            case 'string':\n            case 'number': dt = new Date(val); break;\n        }\n        return Math.floor(dt.getTime()/1000);\n    }\n\n    buildDateParam(val:any) {\n        let dt: Date;\n        switch (typeof val) {\n            default: debugger; throw new Error('escape datetime field in pack data error: value=' + val);\n            case 'undefined': return '';\n            case 'string': return val;\n            case 'object': dt = (val as Date); break;\n            case 'number': dt = new Date(val); break;\n        }\n        let ret = dt.toISOString();\n        let p = ret.indexOf('T');\n        return p>0? ret.substr(0, p) : ret;\n    }\n\n    pack(data:any):string {\n        let ret:string[] = [];\n        let fields = this.fields;\n        if (fields !== undefined) this.packRow(ret, fields, data);\n        let arrs = this.arrFields; \n        if (arrs !== undefined) {\n            for (let arr of arrs) {\n\t\t\t\tlet {name, fields} = arr;\n\t\t\t\tlet arrData = getObjPropIgnoreCase(data, name);\n\t\t\t\t//if (!arrData) arrData = data[name.toLowerCase()];\n                this.packArr(ret, fields, arrData);\n            }\n        }\n        return ret.join('');\n    }\n\n    private escape(row:any, field:Field):any {\n        let d = row[field.name];\n        switch (field.type) {\n            case 'datetime':\n                return this.buildDateTimeParam(d);\n            default:\n                switch (typeof d) {\n                    default: return d;\n                    case 'object':\n                        let tuid = field._tuid;\n                        if (tuid === undefined) return d.id;\n                        return tuid.getIdFromObj(d);\n                    case 'string':\n                        let len = d.length;\n                        let r = '', p = 0;\n                        for (let i=0;i<len;i++) {\n                            let c:number = d.charCodeAt(i), ch:string;\n                            switch(c) {\n\t\t\t\t\t\t\t\tdefault: continue;\n\t\t\t\t\t\t\t\tcase codeBackSlash: ch = '\\\\\\\\'; break;\n                                case codeBT: ch = '\\\\t'; break;\n\t\t\t\t\t\t\t\tcase codeBN: ch = '\\\\n'; break;\n\t\t\t\t\t\t\t\tcase codeBF: ch = '\\\\f'; break;\n\t\t\t\t\t\t\t\tcase codeBV: ch = '\\\\v'; break;\n\t\t\t\t\t\t\t\tcase codeBB: ch = '\\\\b'; break;\n\t\t\t\t\t\t\t\tcase codeBR: ch = '\\\\r'; break;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tr += d.substring(p, i) + ch;\n\t\t\t\t\t\t\tp = i+1;\n                        }\n                        return r + d.substring(p);\n                    case 'undefined': return '';\n                }\n        }\n    }\n\n    private packRow(result:string[], fields:Field[], data:any) {\n        let len = fields.length;\n        if (len === 0) return;\n        let ret = '';\n        ret += this.escape(data, fields[0]);\n        for (let i=1;i<len;i++) {\n            let f = fields[i];\n            ret += tab + this.escape(data, f);\n        }\n        result.push(ret + ln);\n    }\n\n    private packArr(result:string[], fields:Field[], data:any[]) {\n        if (data !== undefined) {\n\t\t\tif (data.length === 0) {\n\t\t\t\tresult.push(ln);\n\t\t\t}\n\t\t\telse {\n\t\t\t\tfor (let row of data) {\n\t\t\t\t\tthis.packRow(result, fields, row);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\telse {\n\t\t\tresult.push(ln);\n\t\t}\n        result.push(ln);\n    }\n    protected cacheFieldsInValue(values:any, fields:Field[]) {\n        for (let f of fields as Field[]) {\n            let {name, _tuid} = f;\n            if (_tuid === undefined) continue;\n            let id = values[name];\n            //_tuid.useId(id);\n            values[name] = _tuid.boxId(id);\n        }\n    }\n\n    protected unpackTuidIdsOfFields(values:string[], fields: Field[]):any[] {\n        if (fields === undefined) return values as any[];\n        //if (this.fields === undefined) return values as any[];\n        let ret:any[] = []\n        for (let ln of values) {\n            if (!ln) continue;\n            let len = ln.length;\n            let p = 0;\n            while (p<len) {\n                let ch = ln.charCodeAt(p);\n                if (ch === 10) {\n                    ++p;\n                    break;\n                }\n                let row = {};\n                p = this.unpackRow(row, fields, ln, p);\n                ret.push(row);\n            }\n        }\n        return ret;\n    }\n\n    unpackSheet(data:string):any {\n        let ret = {} as any; //new this.newMain();\n        //if (schema === undefined || data === undefined) return;\n        let fields = this.fields;\n        let p = 0;\n        if (fields !== undefined) p = this.unpackRow(ret, fields, data, p);\n        let arrs = this.arrFields; //schema['arrs'];\n        if (arrs !== undefined) {\n            for (let arr of arrs) {\n                p = this.unpackArr(ret, arr, data, p);\n            }\n        }\n        return ret;\n    }\n\n    unpackReturns(data:string):{[name:string]:any[]} {\n        if (data === undefined) debugger;\n        let ret = {} as any;\n        //if (schema === undefined || data === undefined) return;\n        //let fields = schema.fields;\n        let p = 0;\n        //if (fields !== undefined) p = unpackRow(ret, schema.fields, data, p);\n        let arrs = this.returns; //schema['returns'];\n        if (arrs !== undefined) {\n            for (let arr of arrs) {\n                //let creater = this.newRet[arr.name];\n                p = this.unpackArr(ret, arr, data, p);\n            }\n        }\n        return ret;\n    }\n\n    protected unpackRow(ret:any, fields:Field[], data:string, p:number):number {\n        let ch0 = 0, ch = 0, c = p, i = 0, len = data.length, fLen = fields.length;\n        for (;p<len;p++) {\n            ch0 = ch;\n            ch = data.charCodeAt(p);\n            if (ch === 9) {\n                let f = fields[i];\n                let {name} = f;\n                if (ch0 !== 8) {\n                    if (p>c) {\n                        let v = data.substring(c, p);\n                        ret[name] = this.to(ret, v, f);\n                    }\n                }\n                else {\n                    ret[name] = null;\n                }\n                c = p+1;\n                ++i;\n                if (i>=fLen) {\n                    p = data.indexOf('\\n', c);\n                    if (p >= 0) ++p;\n                    else p = len;\n                    return p;\n                }\n            }\n            else if (ch === 10) {\n                let f = fields[i];\n                let {name} = f;\n                if (ch0 !== 8) {\n                    if (p>c) {\n                        let v = data.substring(c, p);\n                        ret[name] = this.to(ret, v, f);\n                    }\n                }\n                else {\n                    ret[name] = null;\n                }\n                ++p;\n                ++i;\n                return p;\n            }\n        }\n        let f = fields[i];\n        let {name} = f;\n        if (ch0 !== 8) {\n            let v = data.substring(c);\n            ret[name] = this.to(ret, v, f);\n        }\n        return len;\n    }\n\n    private to(ret:any, v:string, f:Field):any {\n        switch (f.type) {\n\t\t\tdefault: return v;\n\t\t\tcase 'text':\n\t\t\tcase 'char':\n\t\t\t\treturn this.reverseNT(v);\n            case 'datetime':\n            case 'time':\n\t\t\tcase 'timestamp':\n                let n = Number(v);\n                let date = isNaN(n) === true? new Date(v) : new Date(n*1000);\n                return date;\n            case 'date':\n                let parts = v.split('-');\n                return new Date(Number(parts[0]), Number(parts[1])-1, Number(parts[2]));\n            case 'tinyint':\n            case 'smallint':\n            case 'int':\n            case 'bigint':\n            case 'dec':\n                return Number(v);\n            case 'id':\n                let id = Number(v);\n                let {_tuid} = f;\n                if (_tuid === undefined) return id;\n                return _tuid.boxId(id);\n        }\n\t}\n\t\n\tprivate reverseNT(text:string):string {\n\t\tif (text === undefined) return;\n\t\tif (text === null) return;\n\t\tlet len = text.length;\n\t\tlet r = '';\n\t\tlet p = 0;\n\t\tfor (let i=0; i<len; i++) {\n\t\t\tlet c = text.charCodeAt(i);\n\t\t\tif (c === codeBackSlash) {\n\t\t\t\tif (i===len-1) break;\n\t\t\t\tlet c1 = text.charCodeAt(i+1);\n\t\t\t\tlet ch:string;\n\t\t\t\tswitch (c1) {\n\t\t\t\t\tdefault: continue;\n\t\t\t\t\tcase codeBackSlash: ch = '\\\\'; break;\n\t\t\t\t\tcase codeN: ch = '\\n'; break;\n\t\t\t\t\tcase codeT: ch = '\\t'; break;\n\t\t\t\t\tcase codeB: ch = '\\b'; break;\n\t\t\t\t\tcase codeF: ch = '\\f'; break;\n\t\t\t\t\tcase codeV: ch = '\\v'; break;\n\t\t\t\t\tcase codeR: ch = '\\r'; break;\n\t\t\t\t}\n\t\t\t\tr += text.substring(p, i) + ch;\n\t\t\t\tp = i+2;\n\t\t\t\t++i;\n\t\t\t}\n\t\t}\n\t\tr += text.substring(p, len);\n\t\treturn r;\n\t}\n\n    private unpackArr(ret:any, arr:ArrFields, data:string, p:number):number {\n\t\tlet p0 = p;\n        let vals:any[] = [], len = data.length;\n        let {name, fields} = arr;\n        while (p<len) {\n            let ch = data.charCodeAt(p);\n            if (ch === 10) {\n\t\t\t\tif (p === p0) {\n\t\t\t\t\tch = data.charCodeAt(p);\n\t\t\t\t\tif (ch !== 10) {\n\t\t\t\t\t\tthrow new Error('upackArr: arr第一个字符是10，则必须紧跟一个10，表示整个arr的结束')\n\t\t\t\t\t}\n\t\t\t\t\t++p;\n\t\t\t\t}\n                ++p;\n                break;\n            }\n            let val = {} as any; //new creater();\n            vals.push(val);\n            p = this.unpackRow(val, fields, data, p);\n        }\n        ret[name] = vals;\n        return p;\n    }\n}\n","import { bridgeCenterApi, isBridged } from './appBridge';\r\nimport { FetchError } from './fetchError';\r\nimport { HttpChannelUI } from './httpChannelUI';\r\nimport { nav } from '../components/nav';\r\nimport { Caller } from './caller';\r\nimport { env } from '../tool';\r\nimport wxfetch from 'wxapp-fetch';\r\n\r\n/*\r\nexport async function httpGet(url:string, params?:any):Promise<any> {\r\n    let channel = new HttpChannel(false, url, undefined, undefined);\r\n    let ret = await channel.get('', params);\r\n    return ret;\r\n}\r\n\r\nexport async function httpPost(url:string, params?:any):Promise<any> {\r\n    let channel = new HttpChannel(false, url, undefined, undefined);\r\n    let ret = await channel.post('', params);\r\n    return ret;\r\n}\r\n*/\r\n\r\nconst methodsWithBody = ['POST', 'PUT'];\r\n\r\nexport abstract class HttpChannel {\r\n    private timeout: number;\r\n    protected ui?: HttpChannelUI;\r\n    protected hostUrl: string;\r\n    protected apiToken: string;\r\n\r\n    constructor(hostUrl: string, apiToken: string, ui?: HttpChannelUI) {\r\n        this.hostUrl = hostUrl;\r\n        this.apiToken = apiToken;\r\n        this.ui = ui;\r\n        this.timeout = env.isDevelopment === true ? 500000 : 50000;\r\n    }\r\n\r\n    private startWait = (waiting: boolean) => {\r\n        if (waiting === true) {\r\n            if (this.ui !== undefined) this.ui.startWait();\r\n        }\r\n    }\r\n\r\n    private endWait = (url?: string, reject?: (reason?: any) => void) => {\r\n        if (this.ui !== undefined) this.ui.endWait();\r\n        if (reject !== undefined) reject('访问webapi超时 ' + url);\r\n    }\r\n\r\n    private showError = async (error: FetchError) => {\r\n        if (this.ui !== undefined) await this.ui.showError(error);\r\n    }\r\n\r\n    used() {\r\n        this.post('', {});\r\n    }\r\n\r\n    async xcall(urlPrefix: string, caller: Caller<any>): Promise<void> {\r\n        let options = this.buildOptions();\r\n        let { headers, path, method } = caller;\r\n        if (headers !== undefined) {\r\n            let h = options.headers;\r\n            for (let i in headers) {\r\n\t\t\t\t//h.append(i, encodeURI(headers[i]));\r\n\t\t\t\th[i] = encodeURI(headers[i]);\r\n            }\r\n        }\r\n        options.method = method;\r\n        let p = caller.buildParams();\r\n        if (methodsWithBody.indexOf(method) >= 0 && p !== undefined) {\r\n            options.body = JSON.stringify(p)\r\n        }\r\n        return await this.innerFetch(urlPrefix + path, options, caller.waiting);\r\n    }\r\n\r\n    private async innerFetchResult(url: string, options: any, waiting: boolean): Promise<any> {\r\n        let ret = await this.innerFetch(url, options, waiting);\r\n        return ret.res;\r\n    }\r\n\r\n    async get(url: string, params: any = undefined, waiting?: boolean): Promise<any> {\r\n        if (params) {\r\n            let keys = Object.keys(params);\r\n            if (keys.length > 0) {\r\n                let c = '?';\r\n                for (let k of keys) {\r\n                    let v = params[k];\r\n                    if (v === undefined) continue;\r\n                    url += c + k + '=' + params[k];\r\n                    c = '&';\r\n                }\r\n            }\r\n        }\r\n        let options = this.buildOptions();\r\n        options.method = 'GET';\r\n        return await this.innerFetchResult(url, options, waiting);\r\n    }\r\n\r\n    async post(url: string, params: any, waiting?: boolean): Promise<any> {\r\n        let options = this.buildOptions();\r\n        options.method = 'POST';\r\n        options.body = JSON.stringify(params);\r\n        return await this.innerFetchResult(url, options, waiting);\r\n    }\r\n\r\n    async put(url: string, params: any, waiting?: boolean): Promise<any> {\r\n        let options = this.buildOptions();\r\n        options.method = 'PUT';\r\n        options.body = JSON.stringify(params);\r\n        return await this.innerFetchResult(url, options, waiting);\r\n    }\r\n\r\n    async delete(url: string, params: any, waiting?: boolean): Promise<any> {\r\n        let options = this.buildOptions();\r\n        options.method = 'DELETE';\r\n        options.body = JSON.stringify(params);\r\n        return await this.innerFetchResult(url, options, waiting);\r\n    }\r\n    async fetch(url: string, options: any, waiting: boolean, resolve: (value?: any) => any, reject: (reason?: any) => void): Promise<void> {\r\n        let that = this;\r\n        this.startWait(waiting);\r\n        let path = url;\r\n        function buildError(err: any, ex?: string) {\r\n            switch (typeof err) {\r\n                case 'string':\r\n                    if (ex !== undefined) err += ' ' + ex;\r\n                    break;\r\n                case 'object':\r\n                    let keys = Object.keys(err);\r\n                    let retErr: any = {\r\n                        ex: ex,\r\n                    };\r\n                    for (let key of keys) {\r\n                        retErr[key] = err[key];\r\n                    }\r\n                    err = retErr;\r\n                    break;\r\n            }\r\n            return {\r\n                channel: that,\r\n                url: path,\r\n                options: options,\r\n                resolve: resolve,\r\n                reject: reject,\r\n                error: err,\r\n            }\r\n        }\r\n        try {\r\n            console.log('%s-%s %s : %s', options.method, path, options.body || '', options.params);\r\n            let now = Date.now();\r\n            let timeOutHandler = env.setTimeout(\r\n                undefined, //'httpChannel.fetch',\r\n                () => {\r\n                    that.endWait(url + ' timeout endWait: ' + (Date.now() - now) + 'ms', reject);\r\n                },\r\n                this.timeout);\r\n            let res;\r\n            let url = encodeURI(path);\r\n            if (process.env.isMiniprogram) {\r\n                res = await wxfetch(url, options) as Response;\r\n                console.log(res);\r\n            }\r\n            else {\r\n                res = await fetch(url, options);\r\n            }\r\n            if (res.ok === false) {\r\n                env.clearTimeout(timeOutHandler);\r\n                console.log('ok false endWait');\r\n                that.endWait();\r\n                console.log('call error %s', res.statusText);\r\n                throw res.statusText;\r\n            }\r\n            let jres:boolean = false;\r\n            if (process.env.isMiniprogram) {\r\n                jres = true;\r\n            }\r\n            else {\r\n                let ct = res.headers.get('content-type');\r\n                if (ct && ct.indexOf('json') >= 0) {\r\n                    jres = true;\r\n                }\r\n            }\r\n            if (jres) {\r\n                return res.json().then(async retJson => {\r\n                    env.clearTimeout(timeOutHandler);\r\n                    that.endWait();\r\n                    if (retJson.ok === true) {\r\n                        if (typeof retJson !== 'object') {\r\n                            debugger;\r\n                        }\r\n                        else if (Array.isArray(retJson) === true) {\r\n                            debugger;\r\n                        }\r\n                        return resolve(retJson);\r\n                    }\r\n                    let retError = retJson.error;\r\n                    if (retError === undefined) {\r\n                        await that.showError(buildError('not valid tonva json'));\r\n                    }\r\n                    else {\r\n                        await that.showError(buildError(retError, 'retJson.error'));\r\n                        reject(retError);\r\n                    }\r\n                }).catch(async error => {\r\n                    await that.showError(buildError(error, 'catch res.json()'));\r\n                });\r\n            }\r\n            else {\r\n                let text = await res.text();\r\n                env.clearTimeout(timeOutHandler);\r\n                console.log('text endWait');\r\n                that.endWait();\r\n                resolve(text);\r\n            }\r\n        }\r\n        catch (error) {\r\n            this.endWait(url, reject);\r\n            if (typeof error === 'string') {\r\n                let err = error.toLowerCase();\r\n                if (err.startsWith('unauthorized') === true) {\r\n                    nav.logout();\r\n                    return;\r\n                }\r\n            }\r\n            console.error('fecth error (no nav.showError): ' + url);\r\n            console.error(error);\r\n            // await this.showError(buildError(error, 'catch outmost'));\r\n        };\r\n    }\r\n\r\n    protected abstract innerFetch(url: string, options: any, waiting: boolean): Promise<any>;\r\n\r\n    async callFetch(url: string, method: string, body: any): Promise<any> {\r\n        let options = this.buildOptions();\r\n        options.method = method;\r\n        options.body = body;\r\n        return await new Promise<any>(async (resolve, reject) => {\r\n            await this.fetch(url, options, true, resolve, reject);\r\n        });\r\n    }\r\n\r\n    //private buildOptions(): {method:string; headers:Headers; body:any} {\r\n\t\tprivate buildOptions(): {method:string; headers:{[name:string]: string}; body:any} {\r\n        let headers = this.buildHeaders();\r\n        let options = {\r\n            headers: headers,\r\n            method: undefined as any,\r\n            body: undefined as any,\r\n            // cache: 'no-cache',\r\n        };\r\n        return options;\r\n    }\r\n\r\n\t/*\r\n    protected buildHeaders():Headers {\r\n        let {language, culture} = nav;\r\n        let headers = new Headers();\r\n        //headers.append('Access-Control-Allow-Origin', '*');\r\n        headers.append('Content-Type', 'application/json;charset=UTF-8');\r\n        let lang = language;\r\n        if (culture) lang += '-' + culture;\r\n        headers.append('Accept-Language', lang);\r\n        if (this.apiToken) { \r\n            headers.append('Authorization', this.apiToken); \r\n        }\r\n        return headers;\r\n\t}\r\n\t*/\r\n\tprotected buildHeaders():{[name:string]: string} { \r\n        let {language, culture} = nav;\r\n        let headers:{[name:string]: string} = {}; //new Headers();\r\n        //headers.append('Access-Control-Allow-Origin', '*');\r\n\t\t//headers.append('Content-Type', 'application/json;charset=UTF-8');\r\n\t\theaders['Content-Type'] = 'application/json;charset=UTF-8';\r\n        let lang = language;\r\n        if (culture) lang += '-' + culture;\r\n\t\t//headers.append('Accept-Language', lang);\r\n\t\theaders['Accept-Language'] = lang;\r\n        if (this.apiToken) { \r\n\t\t\t//headers.append('Authorization', this.apiToken); \r\n\t\t\theaders['Authorization'] = this.apiToken;\r\n        }\r\n        return headers;\r\n\t}\r\n}\r\n\r\nexport class CenterHttpChannel extends HttpChannel {\r\n    protected async innerFetch(url: string, options: any, waiting: boolean): Promise<any> {\r\n        let u = this.hostUrl + url;\r\n        if (this.apiToken === undefined && isBridged())\r\n            return await bridgeCenterApi(u, options.method, options.body);\r\n        return await new Promise<any>(async (resolve, reject) => {\r\n            await this.fetch(u, options, waiting, resolve, reject);\r\n        });\r\n    }\r\n}\r\n\r\nexport class UqHttpChannel extends HttpChannel {\r\n    protected async innerFetch(url: string, options: any, waiting: boolean): Promise<any> {\r\n        let u = this.hostUrl + url;\r\n        return await new Promise<any>(async (resolve, reject) => {\r\n            await this.fetch(u, options, waiting, resolve, reject);\r\n        });\r\n    }\r\n}\r\n","import {nav} from '../components/nav';\nimport {FetchError} from './fetchError';\n\nexport interface HttpChannelUI {\n    startWait():void;\n    endWait():void;\n    showError(error:FetchError):Promise<void>;\n    showUpgradeUq(uq:string, version:number):Promise<void>;\n}\n\nexport class HttpChannelNavUI implements HttpChannelUI {\n    startWait() {\n        nav.startWait();\n    }\n    endWait() {\n        nav.endWait();\n    }\n    async showError(error:FetchError):Promise<void> {\n        nav.endWait();\n        /*\n        if (error.name === 'SyntaxError') {\n            error = {\n                name: error.name,\n                message: error.message,\n            }\n        }*/\n        await nav.onError(error);\n    }\n    async showUpgradeUq(uq:string, version:number):Promise<void> {\n        await nav.showUpgradeUq(uq, version);\n    }\n}\n\n","import _ from 'lodash';\r\nimport {HttpChannel, CenterHttpChannel, UqHttpChannel} from './httpChannel';\r\nimport {HttpChannelNavUI} from './httpChannelUI';\r\nimport {appUq, logoutUqTokens, buildAppUq} from './appBridge';\r\nimport {ApiBase} from './apiBase';\r\nimport { host } from './host';\r\nimport { LocalMap, env } from '../tool';\r\nimport {decodeUserToken} from '../tool/user';\r\n\r\ninterface PromiseValue<T> {\r\n\tresolve: (value?: T | PromiseLike<T>) => void;\r\n\treject: (reason?: any) => void;\r\n}\r\nlet channelUIs:{[name:string]: HttpChannel|(PromiseValue<any>[])} = {};\r\nlet channelNoUIs:{[name:string]: HttpChannel|(PromiseValue<any>[])} = {};\r\n\r\nexport function logoutApis() {\r\n    channelUIs = {};\r\n    channelNoUIs = {};\r\n    logoutUnitxApis();\r\n    logoutUqTokens();\r\n}\r\n\r\ninterface UqLocal {\r\n    user: number;\r\n    unit: number;\r\n    value: any;\r\n    tick?: number;\r\n    isNet?: boolean;\r\n}\r\ninterface UqLocals {\r\n    user: number;\r\n    unit: number;\r\n    uqs: {[uq:string]: UqLocal};\r\n}\r\n/*\r\nconst uqLocalEntities = 'uqLocalEntities';\r\nclass CacheUqLocals {\r\n    private local:UqLocals;\r\n\r\n    async loadAccess(uqApi: UqApi):Promise<any> {\r\n        try {\r\n            let {uqOwner, uqName} = uqApi;\r\n            if (this.local === undefined) {\r\n                let ls = null; // localStorage.getItem(uqLocalEntities);\r\n                if (ls !== null) {\r\n                    this.local = JSON.parse(ls);\r\n                }\r\n            }\r\n            if (this.local !== undefined) {\r\n                let {user, uqs} = this.local;\r\n                if (user !== loginedUserId || uqs === undefined) {\r\n                    this.local = undefined;\r\n                }\r\n                else {\r\n                    for (let i in uqs) {\r\n                        let ul = uqs[i];\r\n                        ul.isNet = undefined;\r\n                    }\r\n                }\r\n            }\r\n            if (this.local === undefined) {\r\n                this.local = {\r\n                    user: loginedUserId,\r\n                    unit: undefined,\r\n                    uqs: {}\r\n                };\r\n            }\r\n\r\n            let ret: any;\r\n            let un = uqOwner+'/'+uqName;\r\n            let uq = this.local.uqs[un];\r\n            if (uq !== undefined) {\r\n                let {value} = uq;\r\n                ret = value;\r\n            }\r\n            if (ret === undefined) {\r\n                ret = await uqApi.__loadAccess();\r\n                //this.saveLocal(un, ret);\r\n            }\r\n            return _.cloneDeep(ret);\r\n        }\r\n        catch (err) {\r\n            this.local = undefined;\r\n            localStorage.removeItem(uqLocalEntities);\r\n            throw err;\r\n        }\r\n    }\r\n\r\n    private saveLocal(uqName:string, accessValue: any) {\r\n        this.local.uqs[uqName] = {\r\n            value: accessValue,\r\n            isNet: true,\r\n        }\r\n        let str = JSON.stringify(this.local);\r\n        localStorage.setItem(uqLocalEntities, str);\r\n    }\r\n\r\n    async checkAccess(uqApi: UqApi):Promise<boolean> {\r\n        if (this.local === undefined) return false;\r\n        let {uqOwner, uqName} = uqApi;\r\n        let un = uqOwner+'/'+uqName;\r\n        let uq = this.local.uqs[un];\r\n        if (uq === undefined) return false;\r\n        let {isNet, value} = uq;\r\n        if (isNet === true) return true;\r\n        let ret = await uqApi.__loadAccess();\r\n        let isMatch = _.isMatch(value, ret);\r\n        if (isMatch === false) {\r\n            this.saveLocal(un, ret);\r\n            return false;\r\n        }\r\n        uq.isNet = true;\r\n        return true;\r\n    }\r\n}\r\n\r\nconst localUqs = new CacheUqLocals;\r\n*/\r\nexport class UqApi extends ApiBase {\r\n    private access:string[];\r\n    appOwner:string;\r\n    appName:string;\r\n    uqOwner: string;\r\n    uqName: string;\r\n    uq: string;\r\n\r\n    constructor(basePath:string, appOwner:string, appName:string, uqOwner:string, uqName:string, access:string[], showWaiting?: boolean) {\r\n        super(basePath, showWaiting);\r\n        this.appOwner = appOwner;\r\n        this.appName = appName;\r\n        if (uqName) {\r\n            this.uqOwner = uqOwner;\r\n            this.uqName = uqName;\r\n            this.uq = uqOwner + '/' + uqName;\r\n        }\r\n        this.access = access;\r\n        this.showWaiting = showWaiting;\r\n    }\r\n\r\n    //setUqVersion(uqVersion:number) {this.uqVersion = undefined}\r\n\r\n    async init() {\r\n        await buildAppUq(this.uq, this.uqOwner, this.uqName, this.appOwner, this.appName);\r\n    }\r\n\r\n    protected async getHttpChannel(): Promise<HttpChannel> {\r\n        let channels: {[name:string]: HttpChannel|(PromiseValue<any>[])};\r\n        let channelUI: HttpChannelNavUI;\r\n        if (this.showWaiting === true || this.showWaiting === undefined) {\r\n            channels = channelUIs;\r\n            channelUI = new HttpChannelNavUI();\r\n        }\r\n        else {\r\n            channels = channelNoUIs;\r\n        }\r\n        let channel = channels[this.uq];\r\n\t\tif (channel !== undefined) {\r\n\t\t\tif (Array.isArray(channel) === false) return channel as HttpChannel;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tchannel = channels[this.uq] = [];\r\n\t\t}\r\n\t\tlet arr = channel as PromiseValue<any>[];\r\n\t\treturn new Promise(async (resolve, reject) => {\r\n\t\t\tarr.push({resolve, reject});\r\n\t\t\tif (arr.length !== 1) return;\r\n\t\t\tlet uqToken = appUq(this.uq); //, this.uqOwner, this.uqName);\r\n\t\t\tif (!uqToken) {\r\n\t\t\t\t//debugger;\r\n\t\t\t\tawait this.init();\r\n\t\t\t\tuqToken = appUq(this.uq);\r\n\t\t\t}\r\n\t\t\tlet {url, token} = uqToken;\r\n\t\t\tthis.token = token;\r\n\t\t\tchannel = new UqHttpChannel(url, token, channelUI);\r\n\t\t\tchannels[this.uq] = channel;\r\n\t\t\tfor (let pv of arr) {\r\n\t\t\t\tpv.resolve(channel);\r\n\t\t\t}\r\n\r\n\t\t});\r\n    }\r\n\r\n    /*async update():Promise<string> {\r\n        return await this.get('update');\r\n    }*/\r\n\r\n    /*\r\n    async __loadAccess():Promise<any> {\r\n        let acc = this.access === undefined?\r\n            '' :\r\n            this.access.join('|');\r\n        let ret = await this.get('access', {acc:acc});\r\n        return ret;\r\n    }\r\n    */\r\n    async loadAccess():Promise<any> {\r\n        //return await localUqs.loadAccess(this);\r\n        let acc = this.access === undefined?\r\n            '' :\r\n            this.access.join('|');\r\n        let ret = await this.get('access', {acc:acc});\r\n        return ret;\r\n    }\r\n\r\n    /*async loadEntities():Promise<any> {\r\n        return await this.get('entities');\r\n    }*/\r\n\r\n    /*\r\n    async checkAccess():Promise<boolean> {\r\n        return await localUqs.checkAccess(this);\r\n    }\r\n    */\r\n\r\n    async schema(name:string):Promise<any> {\r\n        return await this.get('schema/' + name);\r\n    }\r\n\r\n    async queueModify(start:number, page:number, entities:string) {\r\n        return await this.post('queue-modify', {start:start, page:page, entities:entities});\r\n    }\r\n\r\n    /*async schemas(names:string[]):Promise<any[]> {\r\n        return await this.post('schema', names);\r\n    }*/\r\n\r\n    /*\r\n    async tuidGet(name:string, id:number):Promise<any> {\r\n        return await this.get('tuid/' + name + '/' + id);\r\n    }\r\n\r\n    async tuidGetAll(name:string):Promise<any[]> {\r\n        return await this.get('tuid-all/' + name + '/');\r\n    }\r\n\r\n    async tuidSave(name:string, params:any):Promise<any> {\r\n        return await this.post('tuid/' + name, params);\r\n    }\r\n\r\n    async tuidSearch(name:string, arr:string, owner:number, key:string, pageStart:string|number, pageSize:number):Promise<any> {\r\n        let ret = await this.post('tuids/' + name, {\r\n            arr: arr,\r\n            owner: owner,\r\n            key: key,\r\n            pageStart: pageStart,\r\n            pageSize: pageSize\r\n        });\r\n        return ret;\r\n    }\r\n    async tuidArrGet(name:string, arr:string, owner:number, id:number):Promise<any> {\r\n        return await this.get('tuid-arr/' + name + '/' + owner + '/' + arr + '/' + id);\r\n    }\r\n    async tuidArrGetAll(name:string, arr:string, owner:number):Promise<any[]> {\r\n        return await this.get('tuid-arr-all/' + name + '/' + owner + '/' + arr + '/');\r\n    }\r\n    async tuidArrSave(name:string, arr:string, owner:number, params:any):Promise<any> {\r\n        return await this.post('tuid-arr/' + name + '/' + owner + '/' + arr + '/', params);\r\n    }\r\n    async tuidArrPos(name:string, arr:string, owner:number, id:number, order:number):Promise<any> {\r\n        return await this.post('tuid-arr-pos/' + name + '/' + owner + '/' + arr + '/', {\r\n            id: id,\r\n            $order: order\r\n        });\r\n    }\r\n\r\n    async tuidIds(name:string, arr:string, ids:number[]):Promise<any[]> {\r\n        try {\r\n            let url = 'tuidids/' + name + '/';\r\n            if (arr !== undefined) url += arr;\r\n            else url += '$';\r\n            let ret = await this.post(url, ids);\r\n            return ret;\r\n        }\r\n        catch (e) {\r\n            console.error(e);\r\n        }\r\n    }\r\n    */\r\n    /*async sheetSave(name:string, data:object):Promise<any> {\r\n        return await this.post('sheet/' + name, data);\r\n    }*/\r\n\r\n    /*async sheetAction(name:string, data:object) {\r\n        return await this.put('sheet/' + name, data);\r\n    }*/\r\n\r\n    /*async stateSheets(name:string, data:object) {\r\n        return await this.post('sheet/' + name + '/states', data);\r\n    }*/\r\n\r\n    /*async stateSheetCount(name:string):Promise<any> {\r\n        return await this.get('sheet/' + name + '/statecount');\r\n    }*/\r\n\r\n    /*async mySheets(name:string, data:object) {\r\n        return await this.post('sheet/' + name + '/my-sheets', data);\r\n    }*/\r\n\r\n    /*async getSheet(name:string, id:number):Promise<any> {\r\n        return await this.get('sheet/' + name + '/get/' + id);\r\n    }*/\r\n\r\n    /*async sheetArchives(name:string, data:object):Promise<any> {\r\n        return await this.post('sheet/' + name + '/archives', data);\r\n    }\r\n\r\n    async sheetArchive(name:string, id:number):Promise<any> {\r\n        return await this.get('sheet/' + name + '/archive/' + id);\r\n    }*/\r\n\r\n    /*async action(name:string, data:object):Promise<any> {\r\n        return await this.post('action/' + name, data);\r\n    }\r\n\r\n    async actionReturns(name:string, data:object):Promise<any[][]> {\r\n        return await this.post('action/' + name + '/returns', data);\r\n    }\r\n\r\n    async page(name:string, pageStart:any, pageSize:number, params:any):Promise<string> {\r\n        let p:any;\r\n        switch (typeof params) {\r\n            case 'undefined': p = {key: ''}; break;\r\n            default: p = _.clone(params); break;\r\n        }\r\n        p['$pageStart'] = pageStart;\r\n        p['$pageSize'] = pageSize;\r\n        return await this.post('query-page/' + name, p);\r\n    }\r\n\r\n    async query(name:string, params:any):Promise<any> {\r\n        let ret = await this.post('query/' + name, params);\r\n        return ret;\r\n    }\r\n    */\r\n/*\r\n    async history(name:string, pageStart:any, pageSize:number, params:any):Promise<string> {\r\n        let p = _.clone(params);\r\n        p['$pageStart'] = pageStart;\r\n        p['$pageSize'] = pageSize;\r\n        let ret = await this.post('history/' + name, p);\r\n        return ret;\r\n    }\r\n\r\n    async book(name:string, pageStart:any, pageSize:number, params:any):Promise<string> {\r\n        let p = _.clone(params);\r\n        p['$pageStart'] = pageStart;\r\n        p['$pageSize'] = pageSize;\r\n        let ret = await this.post('history/' + name, p);\r\n        return ret;\r\n    }\r\n*/\r\n    /*async user():Promise<any> {\r\n        return await this.get('user');\r\n    }*/\r\n}\r\n\r\nlet channels:{[unitId:number]: HttpChannel} = {};\r\n\r\nexport function logoutUnitxApis() {\r\n    channels = {};\r\n}\r\n\r\nexport class UnitxApi extends UqApi {\r\n    private unitId:number;\r\n    constructor(unitId:number) {\r\n        super('tv/', undefined, undefined, undefined, undefined, undefined, true);\r\n        this.unitId = unitId;\r\n    }\r\n\r\n    protected async getHttpChannel(): Promise<HttpChannel> {\r\n        let channel = channels[this.unitId];\r\n        if (channel !== undefined) return channel;\r\n        return channels[this.unitId] = await this.buildChannel();\r\n    }\r\n\r\n    private async buildChannel():Promise<HttpChannel> {\r\n        let channelUI = new HttpChannelNavUI();\r\n        let centerAppApi = new CenterAppApi('tv/', undefined);\r\n        let ret = await centerAppApi.unitxUq(this.unitId);\r\n        let {token, db, url, urlTest} = ret;\r\n        let realUrl = host.getUrlOrTest(db, url, urlTest);\r\n        this.token = token;\r\n        return new UqHttpChannel(realUrl, token, channelUI);\r\n    }\r\n}\r\n\r\nlet centerHost:string;\r\n\r\nexport function setCenterUrl(url:string) {\r\n    console.log('setCenterUrl %s', url);\r\n    centerHost = url;\r\n    //centerToken = undefined;\r\n    centerChannel = undefined;\r\n    centerChannelUI = undefined;\r\n}\r\n\r\nexport let centerToken:string|undefined = undefined;\r\n\r\nlet loginedUserId:number = 0;\r\nexport function setCenterToken(userId:number, t?:string) {\r\n    loginedUserId = userId;\r\n    centerToken = t;\r\n    console.log('setCenterToken %s', t);\r\n    centerChannel = undefined;\r\n    centerChannelUI = undefined;\r\n}\r\n\r\nlet centerChannelUI:HttpChannel;\r\nlet centerChannel:HttpChannel;\r\nfunction getCenterChannelUI():HttpChannel {\r\n    if (centerChannelUI !== undefined) return centerChannelUI;\r\n    return centerChannelUI = new CenterHttpChannel(centerHost, centerToken, new HttpChannelNavUI());\r\n}\r\nfunction getCenterChannel():HttpChannel {\r\n    if (centerChannel !== undefined) return centerChannel;\r\n    return centerChannel = new CenterHttpChannel(centerHost, centerToken);\r\n}\r\n\r\nexport abstract class CenterApiBase extends ApiBase {\r\n    /*\r\n    constructor(path: string, showWaiting?: boolean) {\r\n        super(path, showWaiting);\r\n    }*/\r\n\r\n    protected async getHttpChannel(): Promise<HttpChannel> {\r\n        return (this.showWaiting === true || this.showWaiting === undefined)?\r\n            getCenterChannelUI():\r\n            getCenterChannel();\r\n    }\r\n}\r\n\r\nconst uqTokensName = 'uqTokens';\r\nexport class UqTokenApi extends CenterApiBase {\r\n    private localMap: LocalMap = env.localDb.map(uqTokensName);\r\n\r\n    async uq(params: {unit:number, uqOwner:string, uqName:string, appOwner:string, appName:string}):Promise<any> {\r\n        let {uqOwner, uqName} = params;\r\n        let un = uqOwner+'/'+uqName;\r\n        let localCache = this.localMap.child(un);\r\n        try {\r\n            let uqToken:UqLocal = localCache.get();\r\n            if (uqToken !== undefined) {\r\n                let {unit, user} = uqToken;\r\n                if (unit !== params.unit || user !== loginedUserId) {\r\n                    localCache.remove();\r\n                    uqToken = undefined;\r\n                }\r\n            }\r\n            let nowTick = Math.floor(Date.now() / 1000);\r\n            if (uqToken !== undefined) {\r\n                let {tick, value} = uqToken;\r\n                if (value !== undefined && (nowTick - tick) < 24*3600) {\r\n                    return _.clone(value);\r\n                }\r\n            }\r\n            let appUqParams:any = _.clone(params);\r\n            appUqParams.testing = host.testing;\r\n            let ret = await this.get('app-uq', appUqParams);\r\n            if (ret === undefined) {\r\n                let {unit, uqOwner, uqName} = params;\r\n                let err = `center get app-uq(unit=${unit}, '${uqOwner}/${uqName}') - not exists or no unit-service`;\r\n                throw err;\r\n            }\r\n\r\n            uqToken = {\r\n                unit: params.unit,\r\n                user: loginedUserId,\r\n                tick: nowTick,\r\n                value: ret,\r\n            }\r\n            localCache.set(uqToken);\r\n            return _.clone(ret);\r\n        }\r\n        catch (err) {\r\n            localCache.remove();\r\n            throw err;\r\n        }\r\n    }\r\n}\r\n\r\nexport const uqTokenApi = new UqTokenApi('tv/tie/', undefined);\r\n\r\nexport class CallCenterApi extends CenterApiBase {\r\n    directCall(url:string, method:string, body:any):Promise<any> {\r\n        return this.call(url, method, body);\r\n    }\r\n}\r\nexport const callCenterapi = new CallCenterApi('', undefined);\r\n\r\nexport interface UqAppData {\r\n    appName: string;\r\n    appOwner: string;\r\n    id: number;\r\n    version: string;        // AppUI version\r\n    uqs: UqData[];\r\n}\r\n\r\nexport interface UqData {\r\n    id: number;\r\n    uqOwner: string;\r\n    uqName: string;\r\n    access: string;\r\n    newVersion: boolean;\r\n}\r\n\r\nexport interface UqServiceData {\r\n    id: number;\r\n    db: string;\r\n    url: string;\r\n    urlTest: string;\r\n    token: string;\r\n}\r\n\r\n//const appUqsName = 'appUqs';\r\n\r\nexport class CenterAppApi extends CenterApiBase {\r\n    //private local: LocalCache = env.localDb.item(appUqsName);\r\n    //private cachedUqs: UqAppData;\r\n    async uqs(appOwner:string, appName:string):Promise<UqAppData> {\r\n        let ret:UqAppData = await this.get('tie/app-uqs', {appOwner:appOwner, appName:appName});\r\n        return ret;\r\n        /*\r\n        let ret:UqAppData;\r\n        let appUqs = this.local.get();\r\n        if (appUqs) {\r\n            let {appOwner:rAppOwner, appName:rAppName} = appUqs;\r\n            if (appOwner === rAppOwner && appName === rAppName) ret = appUqs;\r\n        }\r\n        if (ret === undefined) {\r\n            ret = await this.uqsPure(appOwner, appName);\r\n            ret.appName = appName;\r\n            ret.appOwner = appOwner;\r\n            //localStorage.setItem(JSON.stringify(obj));\r\n            this.local.set(ret);\r\n        }\r\n        //return this.cachedUqs = _.cloneDeep(ret);\r\n        return ret;\r\n        */\r\n    }\r\n    private async uqsPure(appOwner:string, appName:string):Promise<UqAppData> {\r\n        return await this.get('tie/app-uqs', {appOwner:appOwner, appName:appName});\r\n    }\r\n    /*\r\n    private async isOkCheckUqs(appOwner:string, appName:string):Promise<boolean> {\r\n        let ret = await this.uqsPure(appOwner, appName);\r\n        let {id:cachedId, uqs:cachedUqs} = this.local.get(); //.cachedUqs;\r\n        let {id:retId, uqs:retUqs} = ret;\r\n        if (cachedId !== retId) return false;\r\n        if (cachedUqs.length !== retUqs.length) return false;\r\n        let len = cachedUqs.length;\r\n        for (let i=0; i<len; i++) {\r\n            if (_.isMatch(cachedUqs[i], retUqs[i]) === false) return false;\r\n        }\r\n        return true;\r\n    }\r\n    async checkUqs(appOwner:string, appName:string):Promise<boolean> {\r\n        let ret = await this.isOkCheckUqs(appOwner, appName);\r\n        if (ret === false) {\r\n            this.local.remove();\r\n            nav.start();\r\n        }\r\n        return ret;\r\n    }\r\n    */\r\n    async unitxUq(unit:number):Promise<UqServiceData> {\r\n        return await this.get('tie/unitx-uq', {unit:unit});\r\n    }\r\n    async changePassword(param: {orgPassword:string, newPassword:string}) {\r\n        return await this.post('tie/change-password', param);\r\n    }\r\n}\r\n\r\nexport async function loadAppUqs(appOwner:string, appName:string): Promise<UqAppData> {\r\n    let centerAppApi = new CenterAppApi('tv/', undefined);\r\n    //let unit = meInFrame.unit;\r\n    let ret = await centerAppApi.uqs(appOwner, appName);\r\n    //await centerAppApi.checkUqs(appOwner, appName);\r\n    /*\r\n    .then(v => {\r\n        if (v === false) {\r\n            localStorage.removeItem(appUqs);\r\n            nav.start();\r\n        }\r\n    });\r\n    */\r\n    return ret;\r\n}\r\n\r\n//import { nav } from '../ui';\r\n\r\nexport interface RegisterParameter {\r\n    nick:string, \r\n    user:string, \r\n    pwd:string,\r\n    country:number, \r\n    mobile:number, \r\n    mobileCountry:number,\r\n    email:string,\r\n    verify:string,\r\n};\r\n\r\nexport class UserApi extends CenterApiBase {\r\n    async login(params: {user: string, pwd: string, guest: number}): Promise<any> {\r\n        //(params as any).device = nav.local.device.get();\r\n        let ret = await this.get('user/login', params);\r\n        switch (typeof ret) {\r\n            default: return;\r\n            case 'string': return decodeUserToken(ret);\r\n            case 'object':\r\n                let token = ret.token;\r\n                let user = decodeUserToken(token);\r\n                let {nick, icon} = ret;\r\n                if (nick) user.nick = nick;\r\n                if (icon) user.icon = icon;\r\n                return user;\r\n        }\r\n        // !== undefined) return decodeToken(token);\r\n    }\r\n    async register(params: RegisterParameter): Promise<any>\r\n    {\r\n        return await this.post('user/register', params);\r\n    }\r\n\r\n    async sendVerify(account:string, type:'mobile'|'email', oem:string) {\r\n        return await this.post('user/set-verify', {account:account, type:type, oem:oem});\r\n    }\r\n\r\n    async checkVerify(account:string, verify:string) {\r\n        return await this.post('user/check-verify', {account:account, verify:verify});\r\n    }\r\n\r\n    async isExists(account:string) {\r\n        return await this.get('user/is-exists', {account:account});\r\n    }\r\n\r\n    async resetPassword(account:string, password:string, verify:string, type:'mobile'|'email'):Promise<any[]> {\r\n        return await this.post('user/reset-password', {account:account, password, verify, type});\r\n    }\r\n    \r\n    async userSetProp(prop:string, value:any) {\r\n        await this.post('tie/user-set-prop', {prop:prop, value:value});\r\n    }\r\n\r\n    async me():Promise<any> {\r\n        return await this.get('tie/me');\r\n    }\r\n\r\n    async user(id:number): Promise<any> {\r\n        return await this.get('tie/user', {id:id});\r\n\t}\r\n\t\r\n\tasync fromKey(key:string): Promise<{id:number, name:string, nick:string, icon:string}> {\r\n\t\treturn await this.get('tie/user-from-key', {key});\r\n\t}\r\n}\r\n\r\nexport const userApi = new UserApi('tv/', undefined);\r\n","import _ from 'lodash';\n\nexport interface KeyValueRes {\n    [key:string]: any;\n}\n\nexport interface Res<T extends KeyValueRes> {\n    [lang:string]: T | {[district:string]: T};\n}\n\nexport const resOptions:{\n\tlang: string;\n\t$lang: string;\n\tdistrict: string;\n\t$district: string;\n} = {\n\tlang: undefined,\n\t$lang: undefined,\n\tdistrict: undefined,\n\t$district: undefined,\n}\n\nexport function setResOptions(lang:string, district:string) {\n\tresOptions.lang = lang;\n\tresOptions.$lang = '$' + lang;\n    resOptions.district = district;\n    resOptions.$district = '$' + district;\n}\n\n(function() {\n    let lang: string, district: string;\n    let language = (navigator.languages && navigator.languages[0])  // Chrome / Firefox\n        || navigator.language; // ||   // All browsers\n    //navigator.userLanguage; // IE <= 10\n    if (!language) {\n        lang = 'zh';\n        district = 'CN';\n    }\n    else {\n        let parts = language.split('-');\n        lang = parts[0];\n        if (parts.length > 1) district = parts[1].toUpperCase();\n    }\n    setResOptions(lang, district);\n}());\n\nexport function resLang<T extends KeyValueRes>(res:Res<T>):T {\n    let {lang, district} = resOptions;\n    let ret:T = {} as T;\n    if (res === undefined) return ret;\n    _.merge(ret, res._);\n    let l = res[lang];\n    if (l === undefined) return ret;\n    _.merge(ret, l._);\n    let d = l[district];\n    if (d === undefined) return ret;\n    _.merge(ret, d);\n    let {entity} = ret;\n    if (entity !== undefined) {\n        for (let i in entity) {\n            entity[i.toLowerCase()] = entity[i];\n        }\n    }\n    return ret;\n}\n\nconst resGlobal:any = {};\nexport function setRes(target: any, res: any):(str:string)=>any {\n\tif (res === undefined) return;\n\tlet {$lang, $district} = resOptions;\n\t_.merge(target, res);\n\tif ($lang !== undefined) {\n\t\tlet l = res[$lang];\n\t\tif (l !== undefined) {\n\t\t\t_.merge(target, l);\n\t\t\tlet d = l[$district];\n\t\t\tif (d !== undefined) {\n\t\t\t\t_.merge(target, d);\n\t\t\t}\n\t\t}\n\t}\n\treturn function(str:string) {\n\t\treturn target[str] || str;\n\t}\n}\nexport function setGlobalRes(res: any) {\n\tsetRes(resGlobal, res);\n}\nexport function t(str:string):any {\n\treturn resGlobal[str] || str;\n}\n","import * as React from 'react';\r\nimport _ from 'lodash';\r\nimport {nav, Page, resOptions, PageHeaderProps, PageWebNav} from '../components';\r\nimport { User, env } from '../tool';\r\nimport { VPage } from './vpage';\r\nimport { View } from './view';\r\nimport { messageHub } from '../net';\r\n\r\nexport interface ConfirmOptions {\r\n    caption?: string;\r\n    message: string | JSX.Element;\r\n    classNames?: string;\r\n    ok?: string;\r\n    yes?: string;\r\n    no?: string;\r\n}\r\n\r\nexport interface WebNav<C extends Controller> {\r\n\tVNavHeader?: new (controller: C) => View<C>;\r\n\tVNavRawHeader?: new (controller: C) => View<C>;\r\n\tVNavFooter?: new (controller: C) => View<C>;\r\n\tVNavRawFooter?: new (controller: C) => View<C>;\r\n\trenderPageHeader?: (props: PageHeaderProps) => JSX.Element;\r\n}\r\n\r\nexport abstract class Controller {\r\n    readonly res: any;\r\n\treadonly x: any;\r\n\tprivate _t: any = {};\r\n\treadonly t: (str:string)=>any;\r\n    icon: string|JSX.Element;\r\n    label:string;\r\n\treadonly isDev:boolean = env.isDevelopment;\r\n\tpageWebNav: PageWebNav;\r\n    get user():User {return nav.user}\r\n    get isLogined():boolean {\r\n        let {user} = nav;\r\n        if (user === undefined) return false;\r\n        return user.id > 0;\r\n    }\r\n    constructor(res:any) {\r\n        this.res = res || {};\r\n\t\tthis.x = this.res.x || {};\r\n\t\tthis.t = (str:string):any => this.internalT(str) || str;\r\n\t}\r\n\r\n\tprotected beforeInit() {}\r\n\tprotected afterInit() {}\r\n\r\n\tinit(...param: any[]) {\r\n\t\tthis.beforeInit();\r\n\t\tthis.pageWebNav = this.getPageWebNav();\r\n\t\tthis.afterInit();\r\n\t}\r\n\r\n\tinternalT(str:string):any {\r\n\t\treturn this._t[str];\r\n\t}\r\n\r\n\tget webNav(): WebNav<any> {return undefined;}\r\n\r\n\tgetWebNav(): WebNav<any> {return this.webNav;}\r\n\r\n\tgetPageWebNav(): PageWebNav {return undefined;}\r\n\r\n\tget isWebNav(): boolean {return nav.isWebNav}\r\n\tnavigate(url:string) {\r\n\t\tnav.navigate(url);\r\n\t}\r\n\t\r\n\tprotected setRes(res:any) {\r\n\t\tif (res === undefined) return;\r\n\t\tlet {$lang, $district} = resOptions;\r\n\t\t_.merge(this._t, res);\r\n\t\tif ($lang !== undefined) {\r\n\t\t\tlet l = res[$lang];\r\n\t\t\tif (l !== undefined) {\r\n\t\t\t\t_.merge(this._t, l);\r\n\t\t\t\tlet d = l[$district];\r\n\t\t\t\tif (d !== undefined) {\r\n\t\t\t\t\t_.merge(this._t, d);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\t\t\r\n\t}\r\n\r\n    private receiveHandlerId:number;\r\n    //private disposer:()=>void;\r\n\r\n    protected dispose = () => {\r\n        // message listener的清理\r\n\t\t//nav.unregisterReceiveHandler(this.receiveHandlerId);\r\n\t\tmessageHub.unregisterReceiveHandler(this.receiveHandlerId);\r\n        this.onDispose();\r\n    }\r\n\r\n    protected onDispose() {\r\n\t}\r\n\t\r\n\t//get isRouting() {return nav.isRouting;}\r\n\r\n\tisMe(id:any):boolean {\r\n\t\tif (id === null) return false;\r\n\t\tlet {user} = this;\r\n\t\tlet userId = user.id;\r\n\t\tswitch (typeof id) {\r\n\t\t\tdefault: return false;\r\n\t\t\tcase 'string': return Number(id) === userId;\r\n\t\t\tcase 'number': return id === userId;\r\n\t\t\tcase 'object': return id.id === userId;\r\n\t\t}\r\n\t}\r\n\r\n    protected async openVPage<C extends Controller>(vp: new (controller: C)=>VPage<C>, param?:any, afterBack?:(ret:any)=>void):Promise<void> {\r\n        await (new vp((this as any) as C)).open(param, afterBack);\r\n    }\r\n\r\n    protected async replaceVPage<C extends Controller>(vp: new (controller: C)=>VPage<C>, param?:any, afterBack?:(ret:any)=>void):Promise<void> {\r\n        await (new vp((this as any) as C)).replaceOpen(param, afterBack);\r\n    }\r\n\r\n    protected renderView<C extends Controller>(view: new (controller: C)=>View<C>, param?:any) {\r\n        return (new view((this as any) as C)).render(param);\r\n    }\r\n\r\n    async event(type:string, value:any) {\r\n        await this.onEvent(type, value);\r\n    }\r\n\r\n    protected async onEvent(type:string, value:any) {\r\n    }\r\n\r\n    protected msg(text:string) {\r\n        alert(text);\r\n    }\r\n    protected errorPage(header:string, err:any) {\r\n        this.openPage(<Page header=\"App error!\">\r\n            <pre>\r\n                {typeof err === 'string'? err : err.message}\r\n            </pre>\r\n        </Page>);\r\n    }\r\n\r\n    protected onMessage(message:any):Promise<void> {\r\n        return;\r\n    }\r\n\r\n    private onMessageReceive = async (message:any):Promise<void> => {\r\n        await this.onMessage(message);\r\n    }\r\n\r\n    protected async beforeStart():Promise<boolean> {\r\n        /*\r\n        console.log('this.receiveHandlerId = nav.registerReceiveHandler(this.onMessageReceive);');\r\n        this.receiveHandlerId = nav.registerReceiveHandler(this.onMessageReceive);\r\n        console.log('return true');\r\n        */\r\n        return true;\r\n\t}\r\n\tprotected async afterStart():Promise<void> {\r\n\t}\r\n    protected registerReceiveHandler() {\r\n        this.receiveHandlerId = messageHub.registerReceiveHandler(this.onMessageReceive);\r\n    }\r\n\r\n    protected abstract internalStart(param?:any, ...params:any[]):Promise<void>;\r\n    async start(param?:any, ...params:any[]):Promise<void> {\r\n        //this.disposer = this.dispose;\r\n\t\tthis.registerReceiveHandler();\r\n        let ret = await this.beforeStart();\r\n        if (ret === false) return;\r\n\t\tawait this.internalStart(param, ...params);\r\n\t\tawait this.afterStart();\r\n    }\r\n\r\n    get isCalling():boolean {return this._resolve_$ !== undefined}\r\n\r\n    private _resolve_$:((value:any) => void)[];\r\n    async call<T>(param?:any, ...params:any[]):Promise<T> {\r\n        if (this._resolve_$ === undefined) this._resolve_$ = [];\r\n        return new Promise<T> (async (resolve, reject) => {\r\n            this._resolve_$.push(resolve);\r\n            await this.start(param, ...params);\r\n        });\r\n    }\r\n\r\n    async vCall<C extends Controller>(vp: new (controller: C)=>VPage<C>, param?:any):Promise<any> {\r\n        if (this._resolve_$ === undefined) this._resolve_$ = [];\r\n        return new Promise<any> (async (resolve, reject) => {\r\n            this._resolve_$.push(resolve);\r\n            await (new vp(this as any)).open(param);\r\n        });\r\n    }\r\n\r\n    returnCall(value:any) {\r\n        if (this._resolve_$ === undefined) return;\r\n        let resolve = this._resolve_$.pop();\r\n        if (resolve === undefined) {\r\n            alert('the Controller call already returned, or not called');\r\n            return;\r\n        }\r\n        resolve(value);\r\n    }\r\n\r\n    openPage(page:JSX.Element, onClosePage?: (ret:any)=>void) {\r\n\t\tlet disposer: ()=>void;\r\n\t\tif (onClosePage !== undefined) {\r\n\t\t\tdisposer = () => {\r\n\t\t\t\t//if (this.disposer) this.disposer();\r\n\t\t\t\tonClosePage(undefined);\r\n\t\t\t}\r\n\t\t}\r\n\r\n        nav.push(page, disposer);\r\n        //this.disposer = undefined;\r\n    }\r\n\r\n    replacePage(page:JSX.Element, onClosePage?: ()=>void) {\r\n        nav.replace(page, onClosePage);\r\n        //this.disposer = undefined;\r\n    }\r\n\r\n    backPage() {\r\n        nav.back();\r\n    }\r\n\r\n    closePage(level?:number) {\r\n        nav.pop(level);\r\n    }\r\n\r\n    ceasePage(level?:number) {\r\n        nav.ceaseTop(level);\r\n\t}\r\n\t\r\n\tgo(showPage:()=>void, url:string, absolute?:boolean) {\r\n\t\tnav.go(showPage, url, absolute);\r\n\t}\r\n\r\n    removeCeased() {\r\n        nav.removeCeased();\r\n    }\r\n\r\n    regConfirmClose(confirmClose: ()=>Promise<boolean>) {\r\n        nav.regConfirmClose(confirmClose);\r\n\t}\r\n\r\n\tprivate topPageKey:any;\r\n\tprotected startAction() {\r\n\t\tthis.topPageKey = nav.topKey();\r\n    }\r\n    get TopKey() {\r\n        return this.topPageKey;\r\n    }\r\n    SetTopKey(key:any) {\r\n        this.topPageKey = key;\r\n    }\r\n\tpublic popToTopPage() {\r\n\t\tnav.popTo(this.topPageKey);\r\n\t}\r\n\r\n    async confirm(options: ConfirmOptions): Promise<'ok'|'yes'|'no'|undefined> {\r\n        return new Promise<'ok'|'yes'|'no'|undefined> (async (resolve, reject) => {\r\n            let {caption, message, ok, yes, no, classNames} = options;\r\n            let close = (res:'ok'|'yes'|'no'|undefined) => {\r\n                this.closePage();\r\n                resolve(res);\r\n            }\r\n            let buttons:any[] = [];\r\n            if (ok !== undefined) {\r\n                buttons.push(<button key=\"ok\" className=\"btn btn-primary mr-3\" onClick={()=>close('ok')}>{ok}</button>);\r\n            }\r\n            if (yes !== undefined) {\r\n                buttons.push(<button key=\"yes\" className=\"btn btn-success mr-3\" onClick={()=>close('yes')}>{yes}</button>);\r\n            }\r\n            if (no !== undefined) {\r\n                buttons.push(<button key=\"no\" className=\"btn btn-outline-danger mr-3\" onClick={()=>close('no')}>{no}</button>);\r\n            }\r\n            this.openPage(<Page header={caption || '请确认'} back=\"close\">\r\n                <div className={classNames || \"rounded bg-white m-5 p-3 border\"}>\r\n                    <div className=\"d-flex align-items-center justify-content-center\">\r\n                        {message}\r\n                    </div>\r\n                    <div className=\"mt-3 d-flex align-items-center justify-content-center\">\r\n                        {buttons}\r\n                    </div>\r\n                </div>\r\n            </Page>);\r\n            nav.regConfirmClose(async ():Promise<boolean> => {\r\n                resolve(undefined);\r\n                return true;\r\n            });\r\n        });\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport { Page, Image, UserView } from '../components';\r\nimport { env, User } from '../tool';\r\nimport { Controller } from './controller';\r\nimport { VPage } from './vpage';\r\n\r\nexport abstract class View<C extends Controller> {\r\n    protected controller: C;\r\n    protected readonly res: any;\r\n\tprotected readonly x: any;\r\n\tprotected readonly t: (str:string)=>any;\r\n\r\n    constructor(controller: C) {\r\n        this.controller = controller;\r\n        this.res = controller.res;\r\n\t\tthis.x = controller.x;\r\n\t\tthis.t = controller.t;\r\n    }\r\n\r\n\tprotected get isDev() {return  env.isDevelopment}\r\n\tget isWebNav(): boolean {return this.controller.isWebNav}\r\n\tnavigate(url:string) {this.controller.navigate(url)}\r\n\tprotected isMe(id:any) {return this.controller.isMe(id)}\r\n    abstract render(param?:any): JSX.Element;\r\n\r\n    protected renderVm(vm: new (controller: C)=>View<C>, param?:any) {\r\n        return (new vm(this.controller)).render(param);\r\n    }\r\n\r\n    protected async openVPage(vp: new (controller: C)=>VPage<C>, param?:any, afterBack?:()=>Promise<void>):Promise<void> {\r\n        await (new vp(this.controller)).open(param, afterBack);\r\n    }\r\n\r\n    protected async event(type:string, value?:any) {\r\n        await this.controller.event(type, value);\r\n\t}\r\n\t\r\n\tprotected go(showPage:()=>void, url:string, absolute?:boolean) {\r\n\t\tthis.controller.go(showPage, url, absolute);\r\n\t}\r\n\r\n    async vCall<C extends Controller>(vp: new (controller: C)=>VPage<C>, param?:any):Promise<any> {\r\n        return await this.controller.vCall(vp, param);\r\n    }\r\n\r\n    protected returnCall(value:any) {\r\n        this.controller.returnCall(value);\r\n    }\r\n\r\n\tprotected renderUser(user:any, imageClassName?:string, textClassName?:string) {\r\n\t\tlet renderUser = (user:User) => {\r\n\t\t\tlet {name, nick, icon} = user;\r\n\t\t\treturn <>\r\n\t\t\t\t<Image src={icon} className={imageClassName || 'w-1c h-1c mr-2'} />\r\n\t\t\t\t<span className={textClassName}>{nick || name}</span>\r\n\t\t\t</>;\r\n\t\t}\r\n\t\treturn <UserView user={user} render={renderUser} />\r\n\t}\r\n\r\n\tprotected renderUserText(user:any) {\r\n\t\tlet renderUser = (user:User) => {\r\n\t\t\tlet {name, nick} = user;\r\n\t\t\treturn <>{nick || name}</>;\r\n\t\t}\r\n\t\treturn <UserView user={user} render={renderUser} />\r\n\t}\r\n\r\n\tprotected renderMe(imageClassName?:string, textClassName?:string) {\r\n\t\tlet {user} = this.controller;\r\n\t\tif (!user) return;\r\n\t\treturn this.renderUser(user.id, imageClassName, textClassName);\r\n\t}\r\n\r\n    protected openPage(view: React.StatelessComponent<any>, param?:any, onClosePage?:(ret:any)=>void) {\r\n        let type = typeof param;\r\n        if (type === 'object' || type === 'undefined') {\r\n            this.controller.openPage(React.createElement(view, param), onClosePage);\r\n        }\r\n        else {\r\n            this.controller.openPage(<Page header=\"param type error\">\r\n                View.openPage param must be object, but here is {type}\r\n            </Page>, onClosePage);\r\n        }\r\n    }\r\n\r\n    protected replacePage(view: React.StatelessComponent<any>, param?:any) {\r\n        this.controller.replacePage(React.createElement(view, param));\r\n    }\r\n\r\n    protected openPageElement(page: JSX.Element, onClosePage?: ()=>void) {\r\n        this.controller.openPage(page, onClosePage);\r\n    }\r\n\r\n    protected replacePageElement(page: JSX.Element, onClosePage?: ()=>void) {\r\n        this.controller.replacePage(page, onClosePage);\r\n    }\r\n\r\n    protected backPage() {\r\n        this.controller.backPage();\r\n    }\r\n\r\n    protected closePage(level?:number) {\r\n        this.controller.closePage(level);\r\n    }\r\n\r\n    protected ceasePage(level?:number) {\r\n        this.controller.ceasePage(level);\r\n    }\r\n\r\n    protected removeCeased() {\r\n        this.controller.removeCeased();\r\n    }\r\n\r\n    protected regConfirmClose(confirmClose: ()=>Promise<boolean>) {\r\n        this.controller.regConfirmClose(confirmClose);\r\n\t}\r\n\r\n\tprotected popToTopPage() {\r\n\t\tthis.controller.popToTopPage();\r\n\t}\r\n}\r\n","import * as React from 'react';\nimport { Page, Scroller, TabsProps } from \"../components\";\nimport { View } from \"./view\";\nimport { Controller } from \"./controller\";\n\nexport abstract class VPage<C extends Controller> extends View<C> {\n\tprotected retOnClosePage: any;\n\n    open(param?:any, onClosePage?:(ret:any)=>void):Promise<void> {\n\t\tthis.init(param);\n\t\tlet _onClosePage: ()=>void;\n\t\tif (onClosePage !== undefined) _onClosePage = () => onClosePage(this.retOnClosePage);\n\t\tthis.openPageElement(this.renderPage(), _onClosePage);\n\t\treturn;\n\t}\n\n    replaceOpen(param?:any, onClosePage?:(ret:any)=>void):Promise<void> {\n\t\tthis.init(param);\n\t\tlet _onClosePage: ()=>void;\n\t\tif (onClosePage !== undefined) _onClosePage = () => onClosePage(this.retOnClosePage);\n\t\tthis.replacePageElement(this.renderPage(), _onClosePage);\n\t\treturn;\n\t}\n\n\trender(param?:any):JSX.Element {\n\t\tthis.init(param);\n\t\treturn this.renderPage();\n\t}\n\n\tinit(param?:any):void {return;}\n\n\theader():string|boolean|JSX.Element {return null;}\n\tright():JSX.Element {return null;}\n\tcontent():JSX.Element {return null;}\n\tfooter():JSX.Element {return null;}\n\tlogout(): boolean | (()=>Promise<void>) {return false;}\n\tprotected renderPage():JSX.Element {\n\t\tlet header = this.header();\n\t\tif (!header) header = false;\n\t\treturn <Page\n\t\t\theader={header} right={this.right()} footer={this.footer()}\n\t\t\tonScroll={(e:any)=>this.onPageScroll(e)}\n\t\t\tonScrollTop={(scroller: Scroller) => this.onPageScrollTop(scroller)}\n\t\t\tonScrollBottom={(scroller: Scroller) => this.onPageScrollBottom(scroller)}\n\t\t\tback={this.back}\n\t\t\theaderClassName={this.headerClassName}\n\t\t\tclassName={this.className}\n\t\t\tafterBack={()=>this.afterBack()}\n\t\t\ttabsProps={this.tabsProps}\n\t\t\tlogout={this.logout()}\n\t\t\twebNav={this.controller.pageWebNav}\n\t\t>\n\t\t\t{this.content()}\n\t\t</Page>;\n\t}\n\n\tprotected onPageScroll(e:any) {}\n\tprotected async onPageScrollTop(scroller: Scroller): Promise<boolean> {return false;}\n\tprotected async onPageScrollBottom(scroller: Scroller): Promise<void> {return;}\n\tprotected afterBack():void {}\n\tprotected get back(): 'close' | 'back' | 'none' {return 'back'}\n\tprotected get headerClassName(): string {return null;}\n\tprotected get className(): string {return null;}\n\tprotected get tabsProps(): TabsProps {return null;}\n}\n","import React from 'react';\nimport _ from 'lodash';\nimport { FA, Page } from '../../components';\nimport { Controller } from \"../controller\";\nimport { observable } from 'mobx';\nimport { observer } from 'mobx-react';\n\nexport interface CStringEditProps {\n\tlabel?: string;\n\tplaceholder?: string;\n\tmaxLength?: number;\n\tonValueChange?: (value: string) => Promise<void>;\n}\n\nexport class CStringEdit extends Controller {\n\tprivate props: CStringEditProps = {\n\t\tlabel: '编辑'\n\t}\n\t@observable value: string;\n\t@observable private newValue: string;\n\t@observable private isChanged: boolean;\n\t@observable private error: string;\n\n\tprotected async internalStart() {}\n\trender(value:string, props?:CStringEditProps) {\n\t\tthis.value = value;\n\t\tif (props) _.merge(this.props, props);\n\t\treturn React.createElement(observer(()=><>{this.renderValue()}{this.renderPencil()}</>))\n\t}\n\n\tprotected renderValue() {return <>{this.value}</>}\n\tprotected renderPencil() {\n\t\treturn <span onClick={this.onEdit} className=\"cursor-pointer\">\n\t\t\t&nbsp; <FA className=\"text-info\" name=\"pencil-square-o\" /> &nbsp;\n\t\t</span>;\n\t}\n\n    private onChange = (evt: React.ChangeEvent<HTMLInputElement>) => {\n        this.newValue = evt.target.value;\n        let preValue = this.value;\n        this.isChanged = (this.newValue !== preValue);\n    }\n\n    private onBlur = (evt: React.ChangeEvent<HTMLInputElement>) => {\n        this.verifyValue();\n\t}\n\t\n\tprotected verifyValue() {}\n\n    private onFocus = () => {\n        this.error = undefined;\n\t}\n\t\n\tprivate onEdit = () => {\n\t\tlet {label, maxLength, placeholder, onValueChange} = this.props;\n\t\tlet onSave = () => {\n\t\t\tthis.verifyValue();\n\t\t\tif (this.error === undefined) {\n\t\t\t\tthis.value = this.newValue;\n\t\t\t\tthis.closePage();\n\t\t\t\tif (onValueChange) onValueChange(this.value);\n\t\t\t}\n\t\t}\n        let right = React.createElement(observer(() => <button\n            className=\"btn btn-sm btn-success align-self-center mr-2\"\n            disabled={!this.isChanged}\n            onClick={onSave}>保存</button>));\n\t\tlet onKeyDown = (evt: React.KeyboardEvent<HTMLInputElement>) => {\n\t\t\tif (evt.keyCode === 13) onSave();\n\t\t}\n\t\tthis.openPage(<Page header={label} right={right}>\n            <div className=\"m-3\">\n\t\t\t\t<input type=\"text\"\n\t\t\t\t\tonChange={this.onChange}\n\t\t\t\t\tonKeyDown={onKeyDown}\n                    onBlur={this.onBlur}\n                    onFocus={this.onFocus}\n\t\t\t\t\tclassName=\"form-control\"\n\t\t\t\t\tdefaultValue={this.value}\n\t\t\t\t\tmaxLength={maxLength} />\n                {\n\t\t\t\t\tReact.createElement(observer(()=> placeholder && <div className=\"small muted m-2\">{placeholder}</div>))                    \n                }\n                {this.error && <div className=\"text-danger\">{this.error}</div>}\n            </div>\n\t\t</Page>);\n\t}\n}\n","const ALPHABET = '0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ';\nconst ID_LENGTH = 8;\n\nexport function uid():string {\n    let len = ALPHABET.length;\n    let rtn = '';\n    for (let i = 0; i < ID_LENGTH; i++) {\n        rtn += ALPHABET.charAt(Math.floor(Math.random() * len));\n    }\n    return rtn;\n}\n","import _ from 'lodash';\nimport {observable, IObservableArray} from 'mobx';\nimport { PageItems } from '../tool';\nimport {Field, ArrFields} from './uqMan';\nimport {Entity} from './entity';\nimport { QueryQueryCaller, QueryPageCaller } from './caller';\n\nexport type QueryPageApi = (name:string, pageStart:any, pageSize:number, params:any) => Promise<string>;\n\nexport class QueryPager<T extends any> extends PageItems<T> {\n\tprivate query: Query;\n\tprivate $page: any;\n\tprotected idFieldName: any;\n    constructor(query: Query, pageSize?: number, firstSize?: number, itemObservable?:boolean) {\n        super(itemObservable);\n        this.query = query;\n        if (pageSize !== undefined) this.pageSize = pageSize;\n\t\tif (firstSize !== undefined) this.firstSize = firstSize;\n\t}\n\n\tsetReverse() {\n\t\tthis.appendPosition = 'head';\n\t}\n\n    protected async onLoad() {\n\t\tif (this.$page) return;\n        let {schema} = this.query;\n        if (schema === undefined) {\n\t\t\tawait this.query.loadSchema();\n\t\t\tschema = this.query.schema;\n\t\t}\n\t\tif (schema === undefined) return;\n\t\tlet $page = this.$page = (schema.returns as any[]).find(v => v.name === '$page');\n\t\tif ($page === undefined) return;\n\t\tthis.sortOrder = $page.order;\n\t\tlet fields = $page.fields;\n\t\tif (fields !== undefined) {\n\t\t\tlet field = fields[0];\n\t\t\tif (field) this.idFieldName = field.name;\n\t\t}\n    }\n\n    protected async loadResults(param:any, pageStart:number, pageSize:number):Promise<{[name:string]:any[]}> {\n\t\tlet ret = await this.query.page(param, pageStart, pageSize);\n\t\treturn ret;\n\t}\n\tprotected getPageId(item:T) {\n\t\tif (item === undefined) return;\n\t\tif (typeof item === 'number') return item;\n\t\tlet start = (item as any)[this.idFieldName];\n\t\tif (start === null) return;\n\t\tif (start === undefined) return;\n\t\tif (typeof start === 'object') {\n\t\t\tlet id = start.id;\n\t\t\tif (id !== undefined) return id;\n\t\t}\n\t\treturn start;\n\t}\n\tasync refreshItems(item:T) {\n\t\tlet index = this._items.indexOf(item);\n\t\tif (index < 0) return;\n\t\tlet startIndex:number;\n\t\tif (this.appendPosition === 'tail') {\n\t\t\tstartIndex = index - 1;\n\t\t}\n\t\telse {\n\t\t\tstartIndex = index + 1;\n\t\t}\n\t\tlet pageStart = this.getPageId(this._items[startIndex]);\n\t\tlet pageSize = 1;\n        let ret = await this.load(\n\t\t\tthis.param, \n\t\t\tpageStart,\n\t\t\tpageSize);\n\t\tlet len = ret.length;\n\t\tif (len === 0) {\n\t\t\tthis._items.splice(index, 1);\n\t\t\treturn;\n\t\t}\n\t\tfor (let i=0; i<len; i++) {\n\t\t\tlet newItem = ret[i];\n\t\t\tif (!newItem) continue;\n\t\t\tlet newId = newItem[this.idFieldName];\n\t\t\tif (newId === undefined || newId === null) continue;\n\t\t\tif (typeof newId === 'object') newId = newId.id;\n\t\t\tlet oldItem = this._items.find(v => {\n\t\t\t\tlet oldId = (v as any)[this.idFieldName];\n\t\t\t\tif (oldId === undefined || oldId === null) return false;\n\t\t\t\tif (typeof oldId === 'object') oldId = oldId.id;\n\t\t\t\treturn oldId = newId;\n\t\t\t});\n\t\t\tif (oldItem) {\n\t\t\t\t_.merge(oldItem, newItem);\n\t\t\t}\n\t\t}\n\t}\n}\n\nexport class Query extends Entity {\n    get typeName(): string { return 'query';}\n    private pageStart: any;\n    private pageSize:number;\n    private params:any;\n    private more: boolean;\n    private startField: Field;\n    @observable list:IObservableArray; // = observable.array([], {deep: false});\n    returns: ArrFields[];\n    isPaged: boolean;\n\n    setSchema(schema:any) {\n        super.setSchema(schema);\n        let {returns} = schema;\n        //this.returns = returns;\n        this.isPaged = returns && (returns as any[]).find(v => v.name === '$page') !== undefined;\n    }\n\n    resetPage(size:number, params:any) {\n        this.pageStart = undefined;\n        this.pageSize = size;\n        this.params = params;\n        this.more = false;\n        this.list = undefined;\n    }\n    get hasMore() {return this.more;}\n    async loadPage():Promise<void> {\n        if (this.pageSize === undefined) {\n            throw new Error('call resetPage(size:number, params:any) first');\n        }\n        let pageStart:any;\n        if (this.pageStart !== undefined) {\n            switch (this.startField.type) {\n                default: pageStart = this.pageStart; break;\n                case 'date':\n                case 'time':\n                case 'datetime': pageStart = (this.pageStart as Date).getTime(); break;\n            }\n        }\n\t\tlet ret = await this.page(this.params, pageStart, this.pageSize+1);\n\t\tlet page = ret.$page;\n        /*\n        await this.loadSchema();\n        let res = await this.tvApi.page(this.name, pageStart, this.pageSize+1, this.params);\n        let data = await this.unpackReturns(res);\n        let page = data['$page'] as any[];\n        */\n        this.list = observable.array([], {deep: false});\n        if (page !== undefined) {\n            if (page.length > this.pageSize) {\n                this.more = true;\n                page.pop();\n                let ret = this.returns.find(r => r.name === '$page');\n                this.startField = ret.fields[0];\n                this.pageStart = page[page.length-1][this.startField.name];\n            }\n            else {\n                this.more = false;\n            }\n            this.list.push(...page);\n        }\n        //this.loaded = true;\n    }\n\n    protected pageCaller(params: any, showWaiting: boolean = true): QueryPageCaller {\n        return new QueryPageCaller(this, params, showWaiting);\n    }\n\n    async page(params:any, pageStart:any, pageSize:number, showWaiting: boolean = true):Promise<{[name:string]:any[]}> {\n        let p = {pageStart, pageSize, params};\n        let res = await this.pageCaller(p, showWaiting).request();\n        return res;\n    }\n    protected queryCaller(params: any, showWaiting: boolean = true): QueryQueryCaller {\n        return new QueryQueryCaller(this, params, showWaiting);\n    }\n    async query(params:any, showWaiting:boolean = true):Promise<any> {\n        let res = await this.queryCaller(params, showWaiting).request();\n        return res;\n    }\n    async table(params:any, showWaiting:boolean = true): Promise<any[]> {\n        let ret = await this.query(params, showWaiting);\n        for (let i in ret) {\n            return ret[i];\n        }\n    }\n    async obj(params:any, showWaiting:boolean = true):Promise<any> {\n        let ret = await this.table(params, showWaiting);\n        if (ret.length > 0) return ret[0];\n    }\n    async scalar(params:any, showWaiting:boolean = true):Promise<any> {\n        let ret = await this.obj(params, showWaiting);\n        for (let i in ret) return ret[i];\n    }\n}\n","import { messageHub } from \"./messageHub\";\n\nlet subAppWindow:Window;\nfunction postWsToSubApp(msg:any) {\n    if (subAppWindow === undefined) return;\n    subAppWindow.postMessage({\n        type: 'ws',\n        msg: msg\n    }, '*');\n}\n\nexport function setSubAppWindow(win:Window) {\n    subAppWindow = win;\n}\n\nexport function postWsToTop(msg:any) {\n    window.top.postMessage({\n        type: 'ws',\n        msg: msg\n    }, '*');\n}\n\nexport abstract class WsBase {\n\tprivate messageHub = messageHub;\n\t/*\n    wsBaseId:string;\n    private handlerSeed = 1;\n    private anyHandlers:{[id:number]:(msg:any)=>Promise<void>} = {};\n\tprivate msgHandlers:{[id:number]:{type:string, handler:(msg:any)=>Promise<void>}} = {};\n\t*/\n\t/*\n    onWsReceiveAny(handler:(msg:any)=>Promise<void>):number {\n        let seed = this.handlerSeed++;\n        this.anyHandlers[seed] = handler;\n        return seed;\n    }\n    onWsReceive(type:string, handler:(msg:any)=>Promise<void>):number {\n        let seed = this.handlerSeed++;\n        this.msgHandlers[seed] = {type:type, handler: handler};\n        return seed;\n    }\n    endWsReceive(handlerId:number) {\n        delete this.anyHandlers[handlerId];\n        delete this.msgHandlers[handlerId];\n\t}\n\t*/\n    async receive(msg:any) {\n\t\tthis.messageHub.dispatch(msg);\n\t\t/*\n        let {$type} = msg;\n        for (let i in this.anyHandlers) {\n            await this.anyHandlers[i](msg);\n        }\n        for (let i in this.msgHandlers) {\n            let {type, handler} = this.msgHandlers[i];\n            if (type !== $type) continue;\n            await handler(msg);\n\t\t}\n\t\t*/\n    }\n}\n\nlet wsBaseSeed = 1;\nexport class WsBridge extends WsBase {\n    wsBaseId:string = 'WsBridge seed ' + wsBaseSeed++;\n}\n\nexport const wsBridge = new WsBridge();\n\nexport class WSChannel extends WsBase {\n    wsBaseId:string = 'WSChannel seed ' + wsBaseSeed++;\n    static centerToken:string;\n    private wsHost: string;\n    private token: string;\n    private ws: WebSocket;\n\n    constructor(wsHost: string, token: string) {\n        super();\n        this.wsHost = wsHost;\n        this.token = token;\n    }\n\n    static setCenterToken(token?: string) {\n        WSChannel.centerToken = token;\n    }\n    \n    connect():Promise<void> {\n        //this.wsHost = wsHost;\n        //this.token = token || WSChannel.centerToken;\n        if (this.ws !== undefined) return;\n        let that = this;\n        return new Promise((resolve, reject) => {\n            let ws = new WebSocket(this.wsHost, this.token || WSChannel.centerToken);\n            console.log('connect webSocket %s', this.wsHost);\n            ws.onopen = (ev) => {\n                console.log('webSocket connected %s', this.wsHost);\n                that.ws = ws;\n                resolve();\n            };\n            ws.onerror = (ev) => {\n                reject('webSocket can\\'t open!');\n            };\n            ws.onmessage = async (msg) => await that.wsMessage(msg);\n            ws.onclose = (ev) => {\n                that.ws = undefined;\n                console.log('webSocket closed!');\n            }\n        });\n    }\n    close() {\n        if (this.ws !== undefined) {\n            this.ws.close();\n            this.ws = undefined;\n        }\n    }\n    private async wsMessage(event:any):Promise<void> {\n        try {\n            console.log('websocket message: %s', event.data);\n            let msg = JSON.parse(event.data);\n            postWsToSubApp(msg);\n            await this.receive(msg);\n        }\n        catch (err) {\n            console.log('ws msg error: ', err);\n        }\n    }\n    sendWs(msg:any) {\n        let netThis = this;\n        this.connect().then(() => {\n            netThis.ws.send(msg);\n        });\n    }\n}\n","import * as React from 'react';\nimport classNames from 'classnames';\nimport { nav } from './nav';\nimport _ from 'lodash';\n\nexport interface ImageProps {\n    src: string;\n    className?: string;\n    style?: React.CSSProperties;\n    altImage?: string;\n}\n\n// src = .src, 表示fontawesome Icon\nexport function Image(props: ImageProps) {\n\tlet {className, style, src, altImage} = props;\n\tlet icon:string;\n    if (src) {\n\t\tif (src.indexOf('.') !== 0) {\n\t\t\tif (_.startsWith(src, ':') === true) {\n\t\t\t\tsrc = nav.resUrl + src.substr(1);\n\t\t\t}\n\t\t\treturn <img src={src} className={className} alt=\"img\"\n\t\t\t\tstyle={style}\n\t\t\t\tonError={evt=>{\n\t\t\t\t\tif (altImage) evt.currentTarget.src=altImage;\n\t\t\t\t\telse evt.currentTarget.src = 'https://tv.jkchemical.com/imgs/0001.png';\n\t\t\t\t}} />;\n\t\t}\n\t\ticon = src.substr(1);\n\t}\n\telse {\n\t\ticon = 'file-o'\n\t}\n\treturn <span className={classNames(className, 'image-none')} style={style}>\n\t\t<i className={'fa fa-' + icon} />\n\t</span>;\n}\n","export * from './uqMan';\nexport * from './entity';\nexport * from './action';\nexport * from './query';\nexport * from './sheet';\nexport * from './tuid';\nexport * from './book';\nexport * from './map';\nexport * from './history';\nexport * from './pending';\nexport * from './uqsMan';\nexport * from './tag/tag';\n","import jwtDecode from 'jwt-decode';\n\nexport interface Unit {\n    id: number;\n    name: string;\n}\n\nexport interface Guest {\n    id: number;             // id = 0\n    guest: number;\n    token: string;\n}\n\nexport interface User extends Guest {\n    id: number;\n    name: string;\n    nick?: string;\n    icon?: string;\n}\n\nexport function decodeUserToken(token: string): User {\n    let ret:any = jwtDecode(token);\n    let user: User = {\n        id: ret.id,\n        name: ret.name,\n        guest: ret.guest,\n        token: token,\n    };\n    return user;\n}\n\nexport function decodeGuestToken(token: string): Guest {\n    let ret:any = jwtDecode(token);\n    let guest: Guest = {\n        id: 0,\n        guest: ret.guest,\n        token: token,\n    };\n    return guest;\n}\n","import { env } from '../tool';\r\nimport _ from 'lodash';\r\n\r\n\r\n\r\nconst centerHost = process.env['REACT_APP_CENTER_HOST'];\r\nconst resHost = process.env['REACT_APP_RES_HOST'] || centerHost;\r\n\r\nconst centerDebugHost = 'localhost:3000'; //'192.168.86.64';\r\nconst resDebugHost = 'localhost:3015'; //'192.168.86.63';\r\nconst uqDebugHost = 'localhost:3015'; //'192.168.86.63';\r\nconst uqDebugBuilderHost = 'localhost:3009';\r\ninterface HostValue {\r\n    value: string;\r\n\tlocal: boolean;\r\n}\r\nconst hosts:{[name:string]:HostValue} = {\r\n    centerhost: {\r\n        value: process.env['REACT_APP_CENTER_DEBUG_HOST'] || centerDebugHost, \r\n\t\tlocal: false,\r\n    },\r\n    reshost: {\r\n        value: process.env['REACT_APP_RES_DEBUG_HOST'] || resDebugHost,\r\n\t\tlocal: false,\r\n    },\r\n    uqhost: {\r\n        value: process.env['REACT_APP_UQ_DEBUG_HOST'] || uqDebugHost, \r\n\t\tlocal: false,\r\n    },\r\n    unitxhost: {\r\n        value: process.env['REACT_APP_UQ_DEBUG_HOST'] || uqDebugHost, \r\n\t\tlocal: false,\r\n    },\r\n    \"uq-build\": {\r\n        value: process.env['REACT_APP_UQ_DEBUG_BUILDER_HOST'] || uqDebugBuilderHost, \r\n\t\tlocal: false,\r\n    }\r\n}\r\n\r\nconst httpArr = ['https://', 'http://'];\r\nfunction isAbsoluteUrl(url:string):boolean {\r\n    for (let str of httpArr) {\r\n        if (_.startsWith(url, str) === true) return true;\r\n    }\r\n    return false;\r\n}\r\n\r\nfunction urlFromHost(host:string):string {\r\n    if (isAbsoluteUrl(host) === true) {\r\n        if (_.endsWith(host, '/')) return host;\r\n        return host + '/';\r\n    }\r\n    return `http://${host}/`;\r\n}\r\n\r\nfunction centerUrlFromHost(host:string):string {\r\n    return urlFromHost(host);\r\n}\r\nfunction centerWsFromHost(host:string) {\r\n    let https = 'https://';\r\n    if (_.startsWith(host, https) === true) {\r\n        host = host.substr(https.length);\r\n        if (_.endsWith(host, '/') === true) host = host.substr(0, host.length-1);\r\n        return 'wss://' + host + '/tv/';\r\n    }\r\n    return `ws://${host}/tv/`\r\n}\r\nexport function resUrlFromHost(host:string) {\r\n\tif (!host) return;\r\n    let url = urlFromHost(host);\r\n    return url + 'res/';\r\n}\r\n\r\nconst fetchOptions = {\r\n    method: \"GET\",\r\n    mode: \"no-cors\", // no-cors, cors, *same-origin\r\n    headers: {\r\n        \"Content-Type\": \"text/plain\"\r\n    },\r\n};\r\n\r\nclass Host {\r\n    testing: boolean;\r\n    url: string;\r\n    ws: string;\r\n    resHost: string;\r\n\r\n    async start(testing:boolean) {\r\n        this.testing = testing;\r\n        // if (env.isDevelopment === true) {\r\n        //     await this.tryLocal();\r\n        // }\r\n        let host = this.getCenterHost();\r\n        this.url = centerUrlFromHost(host);\r\n        this.ws = centerWsFromHost(host);\r\n        this.resHost = this.getResHost();\r\n    }\r\n\r\n    private debugHostUrl(host:string) {return `http://${host}/hello`}\r\n    private async tryLocal() {\r\n        let promises:PromiseLike<any>[] = [];\r\n        let hostArr:string[] = [];\r\n        for (let i in hosts) {\r\n            let hostValue = hosts[i];\r\n            let {value} = hostValue;\r\n            if (hostArr.findIndex(v => v === value) < 0) hostArr.push(value);\r\n        }\r\n\r\n        for (let host of hostArr) {\r\n            let fetchUrl = this.debugHostUrl(host);\r\n            promises.push(localCheck(fetchUrl));\r\n        }\r\n        let results = await Promise.all(promises);\r\n        let len = hostArr.length;\r\n        for (let i=0; i<len; i++) {\r\n            let local = results[i];\r\n            let host = hostArr[i];\r\n            for (let j in hosts) {\r\n                let hostValue = hosts[j];\r\n                if (hostValue.value === host) {\r\n                    hostValue.local = local;\r\n                }\r\n            }\r\n        }\r\n        /*\r\n        let p = 0;\r\n        for (let i in hosts) {\r\n            let hostValue = hosts[i];\r\n            hostValue.local = results[p];\r\n            ++p;\r\n        }\r\n        */\r\n    }\r\n\r\n    private getCenterHost():string {\r\n        let {value, local} = hosts.centerhost;\r\n        //if (document.location) {\r\n            let hash = window.location.hash;\r\n            if (hash && hash.includes('sheet_debug') === true) {\r\n                return value;\r\n            }\r\n        //}\r\n        if (env.isDevelopment === true) {\r\n            if (local === true) return value;\r\n        }\r\n        return centerHost;\r\n    }\r\n\r\n    private getResHost():string {\r\n        let {value, local} = hosts.reshost;\r\n        //if (document.location) {\r\n            let hash = window.location.hash;\r\n            if (hash.includes('sheet_debug') === true) {\r\n                return value;\r\n            }\r\n        //}\r\n        if (env.isDevelopment === true) {\r\n            if (local === true) return value;\r\n        }\r\n        return resHost;\r\n    }\r\n\r\n    getUrlOrDebug(url:string, debugHost:string = 'uqhost'):string {\r\n        if (env.isDevelopment === false) return url;\r\n        let host = hosts[debugHost];\r\n        if (host === undefined) return url;\r\n        let {value, local} = host;\r\n        if (local === false) return url;\r\n        return `http://${value}/`;\r\n    }\r\n    getUrlOrTest(db:string, url:string, urlTest:string):string {\r\n\t\tlet path:string;\r\n\t\tif (!urlTest) {\r\n\t\t\turlTest = url;\r\n\t\t\tif (!urlTest) {\r\n\t\t\t\tconsole.error('no server set for ' + db);\r\n\t\t\t\tdebugger;\t\t\t\t\r\n\t\t\t}\r\n\t\t}\r\n        if (this.testing === true) {\r\n            if (urlTest !== '-') url = urlTest;\r\n            path = 'uq/test/' + db + '/';\r\n        }\r\n        else {\r\n            path = 'uq/prod/' + db + '/';\r\n        }\r\n\t\turl = this.getUrlOrDebug(url);\r\n\t\tif (_.endsWith(url, '/') === false) {\r\n\t\t\turl += '/';\r\n\t\t}\r\n        return url + path;\r\n    }\r\n\r\n    async localCheck(urlDebug: string):Promise<boolean> {\r\n        return await localCheck(urlDebug);\r\n    }\r\n}\r\n\r\nexport const host:Host = new Host();\r\n\r\n// 因为测试的都是局域网服务器，甚至本机服务器，所以一秒足够了\r\n// 网上找了上面的fetch timeout代码。\r\n// 尽管timeout了，fetch仍然继续，没有cancel\r\n\r\n// 实际上，一秒钟不够。web服务器会自动停。重启的时候，可能会比较长时间。也许两秒甚至更多。\r\n//const timeout = 2000;\r\nconst timeout = 200;\r\n\r\nfunction fetchLocalCheck(url:string):Promise<any> {\r\n    return new Promise((resolve, reject) => {\r\n      fetch(url, fetchOptions as any)\r\n      .then(v => {\r\n          v.text().then(resolve).catch(reject);\r\n      })\r\n      .catch(reject);\r\n      const e = new Error(\"Connection timed out\");\r\n      env.setTimeout('fetchLocalCheck', reject, timeout, e);\r\n    });\r\n}\r\n\r\nasync function localCheck(url:string):Promise<boolean> {\r\n    try {\r\n        await fetchLocalCheck(url);\r\n        return true;\r\n    }\r\n    catch (err) {\r\n        return false;\r\n    }\r\n}\r\n\r\n/*\r\nexport interface IUqForChannel {\r\n    uq: string;\r\n    uqVersion: number;\r\n}\r\n*/","import React, { CSSProperties } from 'react';\nimport { PageHeaderProps } from './pageHeader';\n\nconst scrollAfter = 20; // 20ms之后，scroll执行\nexport class Scroller {\n    private el: HTMLBaseElement;\n    constructor(el: HTMLBaseElement) {\n        this.el = el;\n    }\n\n    scrollToTop():void {\n        setTimeout(() => this.el.scrollTo(0, 0), scrollAfter);\n    }\n    scrollToBottom():void {\n        setTimeout(() => this.el.scrollTo(0, this.el.scrollTop + this.el.offsetHeight), scrollAfter);\n    }\n}\n\nexport interface ScrollProps {\n    onScroll?: (e:any) => void;\n    onScrollTop?: (scroller: Scroller) => Promise<boolean>;\n\tonScrollBottom?: (scroller: Scroller) => Promise<void>;\n\tclassName?: string;\n}\ninterface ScrollViewProps extends ScrollProps {\n\tclassName?: string;\n\tstyle?: React.CSSProperties;\n}\nconst scrollTimeGap = 100;\nabstract class ScrollViewBase<T extends ScrollViewProps> extends React.Component<T, null> {\n    private bottomTime:number = 0;\n\tprivate topTime:number = 0;\n\tprivate div: HTMLDivElement;\n\n\tprotected refDiv = (div:HTMLDivElement) => {\n\t\tif (!div) {\n\t\t\tif (this.div) {\n\t\t\t\tthis.div.removeEventListener('resize', this.onResize)\n\t\t\t}\n\t\t\treturn;\n\t\t}\n\t\tthis.div = div;\n\t\tthis.div.addEventListener('resize', this.onResize);\n\t}\n\n\tprivate onResize = (ev:UIEvent) => {\n\t\tconsole.error('div resize');\n\t};\n\n    protected onScroll = async (e:any) => {\n        let {onScroll, onScrollTop, onScrollBottom} = this.props;\n        if (onScroll) this.props.onScroll(e);\n        let el = e.target as HTMLBaseElement;\n        let scroller = new Scroller(el);\n        if (el.scrollTop < 30) {\n            if (onScrollTop !== undefined) {\n                let topTime = new Date().getTime();\n                if (topTime-this.topTime > scrollTimeGap) {\n                    this.topTime = topTime;\n\t\t\t\t\tonScrollTop(scroller).then(ret => {\n\t\t\t\t\t\t // has more\n\t\t\t\t\t\tif (ret === true) {\n\t\t\t\t\t\t\tlet sh = el.scrollHeight;\n\t\t\t\t\t\t\tlet top = 200;\n\t\t\t\t\t\t\tif (top > sh) top = sh;\n\t\t\t\t\t\t\tel.scrollTop = top;\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n                }\n            }\n        }\n        if (el.scrollTop + el.offsetHeight > el.scrollHeight - 30) {\n            //this.eachChild(this, 'bottom');\n            if (onScrollBottom !== undefined) {\n                let bottomTime = new Date().getTime();\n                if (bottomTime - this.bottomTime > scrollTimeGap) {\n                    this.bottomTime = bottomTime;\n                    onScrollBottom(scroller);\n                }\n            }\n        }\n    }\n    private eachChild(c:any, direct:'top'|'bottom') {\n        let { props } = c;\n        if (props === undefined)\n            return;\n        let { children } = props;\n        if (children === undefined)\n            return;\n        React.Children.forEach(children, (child, index) => {\n            let {_$scroll} = child as any;\n            if (_$scroll) _$scroll(direct);\n            console.log(child.toString());\n            this.eachChild(child, direct);\n        });\n\t}\n}\n\nexport class ScrollView extends ScrollViewBase<ScrollViewProps> {\n    render() {\n\t\tlet {className, style} = this.props;\n\t\treturn <div ref={this.refDiv} className=\"tv-page\"\n\t\t\tonScroll={this.onScroll} style={style}>\n\t\t\t<article className={className}>\n\t\t\t\t{this.props.children}\n\t\t\t</article>\n\t\t</div>;\n    }\n}\n\nexport interface PageWebNav {\n\tnavHeader?: JSX.Element; \n\tnavRawHeader?: JSX.Element; \n\tnavFooter?: JSX.Element; \n\tnavRawFooter?: JSX.Element; \n\trenderPageHeader?: (props:PageHeaderProps)=>JSX.Element;\n}\ninterface WebNavScrollViewProps extends ScrollViewProps {\n\twebNav: PageWebNav;\n}\n\nexport class WebNavScrollView extends ScrollViewBase<WebNavScrollViewProps> {\n    render() {\n\t\tlet {className, style, webNav} = this.props;\n\t\tlet {navHeader, navRawHeader, navFooter, navRawFooter} = webNav;\n\t\tlet vHeader:any, vFooter:any;\n\t\tif (navRawHeader) vHeader = navRawHeader;\n\t\telse if (navHeader) vHeader = <header><main>{navHeader}</main></header>\n\t\tif (navRawFooter) vFooter = navRawFooter;\n\t\telse if (navFooter) vFooter = <footer><main>{navFooter}</main></footer>\n\n\t\treturn <div ref={this.refDiv} className=\"tv-page-webnav\"\n\t\t\tonScroll={this.onScroll} style={style}>\n\t\t\t{vHeader}\n\t\t\t<article className={className}>\n\t\t\t\t{this.props.children}\n\t\t\t</article>\n\t\t\t{vFooter}\n\t\t</div>;\n    }\n}\n","import { Entity } from './entity';\nimport { ActionCaller } from './caller';\n\nexport class Action extends Entity {\n    get typeName(): string { return 'action';}\n    async submit(data:object, waiting: boolean = true) {\n\t\tlet caller = new ActionSubmitCaller(this, data)\n\t\tlet ret = await caller.request();\n\t\treturn ret;\n    }\n    async submitReturns(data:object):Promise<{[ret:string]:any[]}> {\n       return await new SubmitReturnsCaller(this, data).request();\n    }\n    async submitConvert(data:object) {\n        return await new SubmitConvertCaller(this, data).request();\n    }\n}\n\nexport class ActionSubmitCaller extends ActionCaller {\n    get path():string {return 'action/' + this.entity.name;}\n    buildParams():any {\n\t\treturn {data: this.entity.pack(this.params)}\n\t}\n}\n\nclass SubmitReturnsCaller extends ActionSubmitCaller {\n    get path():string {return 'action/' + this.entity.name + '/returns';}\n    xresult(res:any):any {\n        let {returns} = this.entity;\n        let len = returns.length;\n        let ret:{[r:string]:any[]} = {};\n        for (let i=0; i<len; i++) {\n            let retSchema = returns[i];\n            ret[retSchema.name] = res[i];\n        }\n        return ret;\n    }\n}\n\nclass SubmitConvertCaller extends ActionSubmitCaller {\n    get path():string {return 'action-convert/' + this.entity.name;}\n    buildParams():any {\n        return {\n            data: this.params\n        };\n    }\n}\n","import * as React from 'react';\nimport {observer} from 'mobx-react';\nimport classNames from 'classnames';\nimport '../../css/va-lmr.css';\n\nexport interface LMRProps {\n    className?: string | string[];\n    left?: string|JSX.Element;\n    right?: string|JSX.Element;\n    onClick?: ()=>void;\n}\n\n@observer\nexport class LMR extends React.Component<LMRProps> {\n    render() {\n        let {className, left, children, right, onClick} = this.props;\n        let l, r;\n        if (left !== undefined) l = <header>{left}</header>;\n        if (right !== undefined) r = <footer>{right}</footer>;\n        let cursor;\n        if (onClick !== undefined) cursor = 'cursor-pointer';\n        return <div className={classNames('va-lmr', className, cursor)} onClick={onClick}>\n            {l}\n            <div>{children}</div>\n            {r}\n        </div>;\n    }\n}\n","import * as React from 'react';\nimport {observer} from 'mobx-react';\nimport classNames from 'classnames';\nimport '../../css/va-badge.css';\n\nexport interface BadgeProps {\n    className?: string;\n    badge?: string|number;\n    size?: 'xs' | 'sm' | 'lg';\n    color?: 'secondary'|'success'|'danger'|'primary'|'info'|'warning';\n    badgeAlign?: 'left'|'center'|'right';\n    badgeVertical?: 'top'|'middle'|'bottom';\n}\n\n@observer\nexport class Badge extends React.Component<BadgeProps> {\n    render() {\n        let {className, badge, size, color, badgeAlign, badgeVertical, children} = this.props;\n        let cn = classNames(\n            className,\n            'va-badge',\n            size && 'va-badge-'+size,\n            'va-badge-' + (color||'secondary'),\n            badgeAlign && 'va-badg-'+badgeAlign,\n            badgeVertical && 'va-badg-'+badgeVertical,\n        );\n        let b;\n        if (badge) b = <b>{badge}</b>;\n        return <div className={cn}>\n            {children}\n            {b}\n        </div>;\n    }\n}\n","import * as React from 'react';\nimport classNames from 'classnames';\n\nexport interface FAProps {\n    name: string;\n    className?: string;\n    size?: 'lg'|'2x'|'3x'|'4x'|'5x';\n    spin?: boolean;\n    fixWidth?: boolean;\n    border?: boolean;\n    pull?: 'left'|'right';\n    pulse?: boolean;\n    rotate?: 90|180|270;\n    flip?: 'horizontal'|'vertical';\n    inverse?: boolean;\n}\n\nexport class FA extends React.Component<FAProps> {\n    render() {\n        let {name, className, size, spin, fixWidth, border, pull, pulse, rotate, flip, inverse} = this.props;\n        let cn = classNames(className, 'fa',\n            name && ('fa-' + name),\n            size && 'fa-'+size,\n            fixWidth && 'fa-fw',\n            border && 'fa-border',\n            pull && 'fa-pull-' + pull,\n            spin && 'fa-spin',\n            pulse && 'fa-pulse',\n            rotate && 'fa-rotate-' + rotate,\n            flip && 'fa-flip-' + flip,\n            inverse && 'fa-inverse',\n        );\n        return <i className={cn} />\n    }\n}\n\nexport interface StackedFAProps {\n    className?: string;\n    size?: 'lg',\n}\nexport class StackedFA extends React.Component<StackedFAProps> {\n    render() {\n        let {className, size, children} = this.props;\n        let cn = classNames(\n            'fa-stack',\n            className,\n            size && 'fa-' + size);\n        return <span className={cn}>\n            {children}\n        </span>;\n    }\n}\n","import * as React from 'react';\nimport {FA} from './FA';\n\nexport interface IconTextProps {\n    icon: string;\n    iconClass?: string;\n    text: string;\n    textClass?: string;\n}\n\nexport class IconText extends React.Component<IconTextProps> {\n    render() {\n        let {icon, iconClass, text, textClass} = this.props;\n        return <div className=\"py-2\">\n            <FA className={iconClass} name={icon} fixWidth={true} />\n            <span className={textClass}>{text}</span>\n        </div>;\n    }\n}\n","import * as React from 'react';\nimport classNames from 'classnames';\n\nexport const Muted = (props:any) => \n<small className={classNames('text-muted', props.className)} style={props.style}>\n    {props.children}\n</small>;\n","import _ from 'lodash';\n\nclass _LocalStorage {\n    getItem(key:string) {\n        return localStorage.getItem(key)\n    }\n    setItem(key:string, value:string) {\n        localStorage.setItem(key, value);\n    }\n    removeItem(key:string) {\n        localStorage.removeItem(key);\n    }\n}\n\nconst __ls = new _LocalStorage(); // new Ls;\n\nexport class LocalCache {\n    private readonly local: Local;\n    //private value: T;\n    readonly key: string|number;\n\n    constructor(local:Local, key:string|number) {\n        this.local = local;\n        this.key = key;\n    }\n    get():any {\n        try {\n            // 下面缓冲的内容不能有，可能会被修改，造成circular引用\n            //if (this.value !== undefined) return this.value;\n            let text = this.local.getItem(this.key);\n            if (text === null) return;\n            if (text === undefined) return undefined;\n            //return this.value = \n            return JSON.parse(text);\n        }\n        catch (err) {\n            this.local.removeItem(this.key);\n            return;\n        }\n    }\n    set(value:any) {\n\t\tlet t = JSON.stringify(value, (key, value) => {\n\t\t\tif (key !== '_tuid') return value;\n\t\t});\n\t\tthis.local.setItem(this.key, t);\n    }\n    remove(local?:Local) {\n        if (local === undefined) {\n            this.local.removeItem(this.key);\n        }\n        else {\n            this.local.removeLocal(local);\n        }\n    }\n    child(key:string|number):LocalCache {\n        return this.local.child(key);\n    }\n    arr(key:string|number):LocalArr {\n        return this.local.arr(key);\n    }\n    map(key:string|number):LocalMap {\n        return this.local.map(key);\n    }\n}\n\nabstract class Local {\n    private readonly caches: {[key:string]:LocalCache};\n    private readonly locals: {[key:string]:Local};\n    protected readonly name: string;\n    constructor(name: string) {\n        this.name = name;\n        this.caches = {};\n        this.locals = {};\n    }\n\n    protected abstract keyForGet(key:string|number):string;\n    protected abstract keyForSet(key:string|number):string;\n    protected abstract keyForRemove(key:string|number):string;\n    abstract removeAll():void;\n    getItem(key:string|number):string {\n        let k = this.keyForGet(key);\n        if (k === undefined) return;\n        return __ls.getItem(k);\n    }\n    setItem(key:string|number, value: string):void {\n        let k = this.keyForSet(key);\n        __ls.setItem(k, value);\n    }\n    removeItem(key:string|number):void {\n        let k = this.keyForSet(key);\n        if (k === undefined) return;\n        localStorage.removeItem(k);\n    }\n    arr(key:string|number):LocalArr {\n        let sk = String(key);\n        let arr = this.locals[sk] as LocalArr;\n        if (arr === undefined) {\n            let k = this.keyForSet(key);\n            this.locals[sk] = arr = new LocalArr(k);\n        }\n        return arr;\n    }\n    map(key:string|number):LocalMap {\n        let sk = String(key);\n        let map = this.locals[sk] as LocalMap;\n        if (map === undefined) {\n            let k = this.keyForSet(key);\n            this.locals[sk] = map = new LocalMap(k);\n        }\n        return map;\n    }\n    removeLocal(local:Local) {\n        let sk = local.name;\n        let k = this.keyForRemove(sk);\n        if (k === undefined) return;\n        let arr = this.locals[sk];\n        if (arr === undefined) arr = new LocalArr(k);\n        else this.locals[sk] = undefined;\n        arr.removeAll();\n    }\n    child(key:string|number):LocalCache {\n        let ks = String(key);\n        let ret = this.caches[ks];\n        if (ret !== undefined) return ret;\n        return this.caches[ks] =ret = new LocalCache(this, key);\n    }\n}\n\nconst maxArrSize = 500;\nexport class LocalArr extends Local {\n    private readonly index: number[];\n    constructor(name: string) {\n        super(name);\n        let index = __ls.getItem(this.name);\n        this.index = index === null? [] : index.split('\\n').map(v => Number(v));\n    }\n    private saveIndex() {\n        __ls.setItem(this.name, this.index.join('\\n'));\n    }\n    protected keyForGet(key:number):string {\n        let i = _.indexOf(this.index, key);\n        if (i < 0) return undefined;\n        return `${this.name}.${key}`;\n    }\n    protected keyForSet(key:number):string {\n        let i = _.indexOf(this.index, key);\n        if (i<0) {\n            this.index.unshift(key);\n            if (this.index.length > maxArrSize) this.index.pop();\n        }\n        else {\n            this.index.splice(i, 1);\n            this.index.unshift(key)\n        }\n        this.saveIndex();\n        return `${this.name}.${key}`;\n    }\n    protected keyForRemove(key:number):string {\n        let i = _.indexOf(this.index, key);\n        if (i<0) return;\n        this.index.splice(i, 1);\n        this.saveIndex();\n        return `${this.name}.${key}`;\n    }\n    removeAll():void {\n        for (let i of this.index) {\n            __ls.removeItem(`${this.name}.${i}`);\n        }\n        __ls.removeItem(this.name);\n        this.index.splice(0);\n    }\n    item(index:number):LocalCache {\n        return this.child(index);\n    }\n}\n\nexport class LocalMap extends Local {\n    private readonly index: {[key:string]:number};\n    private max: number;\n    constructor(name: string) {\n        super(name);\n        this.max = 0;\n        this.index = {};\n        let index = __ls.getItem(this.name);\n        if (index !== null) {\n            let ls = index.split('\\n');\n            ls.forEach(l => {\n                let p = l.indexOf('\\t');\n                if (p<0) return;\n                let key = l.substr(0, p);\n                let i = Number(l.substr(p+1));\n                if (isNaN(i) === true) return;\n                this.index[key] = i;\n                if (i>this.max) this.max = i;\n            });\n        }\n    }\n    private saveIndex() {\n        let ls:string[] = [];\n        for (let k in this.index) {\n            let v = this.index[k];\n            if (v === undefined) continue;\n            ls.push(`${k}\\t${v}`);\n        }\n        __ls.setItem(this.name, ls.join('\\n'));\n    }\n    protected keyForGet(key:number):string {\n        let i = this.index[key];\n        if (i === undefined) return undefined;\n        return `${this.name}.${i}`;\n    }\n    protected keyForSet(key:number):string {\n        let i = this.index[key];\n        if (i === undefined) {\n            ++this.max;\n            i = this.max;\n            this.index[key] = i;\n            this.saveIndex();\n        }\n        return `${this.name}.${i}`;\n    }\n    protected keyForRemove(key:string|number):string {\n        let i = this.index[key];\n        if (i===undefined) return;\n        this.index[key] = undefined;\n        this.saveIndex();\n        return `${this.name}.${i}`;\n    }\n    removeAll():void {\n        for (let i in this.index) {\n            __ls.removeItem(`${this.name}.${this.index[i]}`);\n            this.index[i] = undefined;\n        }\n        __ls.removeItem(this.name);\n        this.max = 0;\n    }\n    item(key:string):LocalCache {\n        return this.child(key);\n    }\n}\n","import * as React from 'react';\nimport { BoxId } from './boxId';\nimport { Tuid } from './tuid';\nimport { observer } from 'mobx-react';\n\nconst TuidContent = (tuidName:string, values:any, x?:any) => {\n    return <>{tuidName}: {uqStringify(values)}</>;\n};\n\nexport function uqStringify(values: any): string {\n    let s = '{';\n    if (values === undefined) return 'undefined';\n    for (let i in values) {\n        let v = values[i];\n        s += i + ': ';\n        if (v === undefined) {\n            s += 'undefined';\n        }\n        else if (v === null) {\n            s += 'null';\n        }\n        else {\n            switch (typeof v) {\n                default:\n                    s += v;\n                    break;\n                case 'function':\n                    s += 'function';\n                    break;\n                case 'object':\n                    s += '{obj}';\n                    break;\n            }\n        }\n        s += ', ';\n    }\n    return s + '}';\n}\n\nexport class ReactBoxId implements BoxId {\n    readonly id: number;\n    protected tuid: Tuid;\n    protected ui: (values:any) => JSX.Element;\n    readonly isUndefined:boolean;\n    constructor(id: number, tuid: Tuid, ui: (values:any) => JSX.Element) {\n        this.id = Number(id);\n        this.tuid = tuid;\n        this.ui = ui;\n        this.isUndefined = (this.tuid === undefined);\n    }\n\n    get obj():any {\n        return this.tuid.valueFromId(this.id);\n    }\n\n    equ(id:BoxId|number): boolean {\n        if (id === undefined || id === null) return false;\n        if (typeof id === 'object') return this.id === id.id;\n        return this.id === id;\n    }\n\n    render(ui:TvTemplet, x:any):JSX.Element {\n        if (this.id === undefined || this.id === null || isNaN(this.id) === true) return;\n        let boxName = this.boxName; // this.tuid.name;\n        let val = this.obj; // this.tuid.valueFromId(this.id);\n        if (this.isUndefined === true) {\n            if (ui !== undefined) return ui(val, x);\n            return TuidContent(boxName, val, x);\n        }\n        switch (typeof val) {\n            case 'undefined':\n                return <span className=\"text-black-50\">{boxName} undefined</span>;\n            case 'number':\n                return <span className=\"text-light\">{boxName} {this.id}</span>;\n        }\n        if (ui === undefined) {\n            ui = this.ui;\n        }\n        if (ui !== undefined) {\n            if (typeof ui !== 'function') {\n                ui = (ui as any).content;\n            }\n            if (ui !== undefined) {\n                let ret = ui(val/*, this.tuidUR.res*/);\n                if (ret !== undefined) return ret;\n                return <span className=\"text-danger\">{boxName} {this.id}</span>;\n            }\n        }\n\n        return TuidContent(boxName, val);\n    }\n\n    get boxName():string {return this.tuid.name}\n    // ui(): TvTemplet {return this.tuid.ui}\n    // res(): any {return this.tuid.res}\n\n    async assure(): Promise<BoxId> {\n        await this.tuid.assureBox(this.id);\n        return this;\n    }\n}\n\nfunction boxIdContent(bi: number|BoxId, ui:TvTemplet, x:any) {\n    let logContent:any;\n    let boxId:ReactBoxId = bi as ReactBoxId;\n    switch(typeof bi) {\n        case 'undefined': logContent = <>boxId undefined</>; break;\n        case 'number': logContent = <>id:{bi}</>; break;\n        default:\n            if (typeof boxId.render !== 'function') {\n                if (ui === undefined) {\n                    logContent = TuidContent(boxId.boxName, bi, x);\n                }\n                else {\n                    return ui(bi, x);\n                }\n            }\n            break;\n    }\n    if (logContent !== undefined) {\n        return <del className=\"text-danger\">{logContent}</del>;\n    }\n    return boxId.render(ui, x);\n}\n\nexport type TvTemplet = (values?:any, x?:any) => JSX.Element;\n\ninterface Props {\n    tuidValue: number|BoxId, \n    ui?: TvTemplet,\n    x?: any,\n    nullUI?: ()=>JSX.Element\n}\n\nconst Tv = observer(({tuidValue, ui, x, nullUI}:Props) => {\n    if (tuidValue === undefined) {\n        if (nullUI === undefined) return <small className=\"text-muted\">[无]</small>;\n        return nullUI();\n    }\n    if (tuidValue === null) {\n        if (nullUI === undefined) return <>[null]</>;\n        return nullUI();\n    }\n    let ttv = typeof tuidValue;\n    switch (ttv) {\n        default:\n            if (ui === undefined)\n                return <>{ttv}-{tuidValue}</>;\n            else {\n                let ret = ui(tuidValue, x);\n                if (ret !== undefined) return ret;\n                return <>{tuidValue}</>;\n            }\n        case 'object':\n            let divObj = boxIdContent(tuidValue, ui, x);\n            if (divObj !== undefined) return divObj;\n            return nullUI === undefined? <>id null</>: nullUI();\n        case 'number':\n            return <>id...{tuidValue}</>;\n    }\n});\n\nexport const tv = (tuidValue:number|BoxId, ui?:TvTemplet, x?:any, nullUI?:()=>JSX.Element):JSX.Element => {\n    return <Tv tuidValue={tuidValue} ui={ui} x={x} nullUI={nullUI} />;\n};\n","import * as React from 'react';\n\nexport function Loading() {\n    return <div className=\"d-flex h-100 align-items-center justify-content-center\">\n        <i className=\"fa fa-spinner fa-spin fa-2x fa-fw text-info\" />\n    </div>;\n}\n","//import _ from 'lodash';\nimport { KeyValueRes, Res } from './res';\n\nexport interface FormRes extends KeyValueRes {\n    required: string;\n    number: string;\n    integer: string;\n    min: string;\n    max: string;\n}\n\n/*eslint no-template-curly-in-string: 0*/\nexport const formRes:Res<FormRes> = {\n    _: {\n        required: 'required',\n        number: 'not valid number',\n        integer: 'not valid integer',\n        min: 'min value is ${min}',\n        max: 'max value is ${max}',\n    },\n    zh: {\n        _: {\n            required: '必须填',\n            number: '需要数字',\n            integer: '需要整数',\n            min: '不能小于${min}',\n            max: '不能大于${max}',\n        }\n    },\n}\n","import { KeyValueRes, Res } from './res';\n\nexport interface ListRes extends KeyValueRes {\n    none: string;\n}\n\n/*eslint no-template-curly-in-string: 0*/\nexport const listRes:Res<ListRes> = {\n    _: {\n        none: '[none]',\n    },\n    zh: {\n        _: {\n            none: '[无]',\n        }\n    },\n}\n","import { Res } from '../res';\n\nexport interface LoginRes {\n    a: string;\n}\n\nexport const loginRes: Res<LoginRes> = {\n    _: {\n        a: 'd',\n    }\n}\n","import { Res } from '../res';\n\nexport interface RegisterRes {\n    a: string;\n}\n\nexport const registerRes: Res<RegisterRes> = {\n    _: {\n        a: 'd',\n    }\n}\n","import { LocalMap } from './localDb';\r\nimport _ from 'lodash';\r\n\r\n// 如果路径上有独立的test单词，则是test环境\r\nfunction isTesting():boolean {\r\n\tlet ret = /(\\btest\\b)/i.test(document.location.href);\r\n\treturn ret;\r\n}\r\n\r\nexport const env = (function () {\r\n    let testing = isTesting();\r\n    let localDb = new LocalMap(testing===true? '$$':'$');\r\n    return {\r\n        testing: testing,\r\n        isDevelopment: process.env.NODE_ENV === 'development',\r\n        localDb: localDb,\r\n        setTimeout: (tag:string, callback: (...args: any[]) => void, ms: number, ...args: any[]):NodeJS.Timer => {\r\n            //if (tag !== undefined) console.log('setTimeout ' + tag);\r\n            return global.setTimeout(callback, ms, ...args);\r\n        },\r\n        clearTimeout: (handle:NodeJS.Timer):void => {\r\n            global.clearTimeout(handle);\r\n        },\r\n        setInterval: (callback: (...args: any[]) => void, ms: number, ...args: any[]): NodeJS.Timer => {\r\n            return global.setInterval(callback, ms, ...args);\r\n        },\r\n        clearInterval: (handle:NodeJS.Timer):void => {\r\n            global.clearInterval(handle);\r\n        }\r\n    }\r\n}());\r\n","\nexport * from './boxId';\nexport * from './tuid';\nexport { TuidsCache } from './tuidsCache';\nexport { tv, ReactBoxId, uqStringify } from './reactBoxId';","import {HttpChannel} from './httpChannel';\r\nimport { Caller } from './caller';\r\n\r\nexport async function refetchApi(channel:HttpChannel, url:string, options:any, \r\n    resolve:(values:any)=>any, reject:(reason:any)=>void)\r\n{\r\n    await channel.fetch(url, options, false, resolve, reject);\r\n}\r\n\r\nexport abstract class ApiBase {\r\n    protected token: string;\r\n    protected path: string;\r\n    protected showWaiting: boolean;\r\n\r\n    constructor(path: string, showWaiting: boolean) {\r\n        this.path = path || '';\r\n        this.showWaiting = showWaiting;\r\n    }\r\n\r\n    protected abstract getHttpChannel(): Promise<HttpChannel>;\r\n\r\n    async xcall(caller:Caller<any>):Promise<any> {\r\n        let channel = await this.getHttpChannel();\r\n        return await channel.xcall(this.path, caller);\r\n    }\r\n\r\n    public async call(url:string, method:string, body:any):Promise<any> {\r\n        let channel = await this.getHttpChannel();\r\n        return await channel.callFetch(url, method, body);\r\n    }\r\n\r\n    public async get(path:string, params:any=undefined): Promise<any> {\r\n        let channel = await this.getHttpChannel();\r\n        return await channel.get(this.path + path, params);\r\n    }\r\n\r\n    public async post(path:string, params:any): Promise<any> {\r\n        let channel = await this.getHttpChannel();\r\n        return await channel.post(this.path + path, params);\r\n    }\r\n\r\n    public async put(path:string, params:any): Promise<any> {\r\n        let channel = await this.getHttpChannel();\r\n        return await channel.put(this.path + path, params);\r\n    }\r\n\r\n    public async delete(path:string, params:any): Promise<any> {\r\n        let channel = await this.getHttpChannel();\r\n        return await channel.delete(this.path + path, params);\r\n    }\r\n}\r\n","import * as React from 'react';\nimport { observer } from 'mobx-react';\nimport { observable } from 'mobx';\nimport { UiImageItem } from '../schema';\nimport { ImageUploader } from '../resUploader';\nimport { nav } from '../nav';\nimport { ItemEdit } from './itemEdit';\n\nexport class ImageItemEdit extends ItemEdit {\n    get uiItem(): UiImageItem {return this._uiItem as UiImageItem}\n    @observable private resId: string;\n\n    protected async internalStart():Promise<any> {\n        this.resId = this.value;\n        return new Promise<any>((resolve, reject) => {\n            nav.push(React.createElement(this.page, {resolve:resolve, reject:reject}), ()=>reject());\n        });\n    }\n\n    /*\n    private upload = async () => {\n        if (!this.resUploader) return;\n        let ret = await this.resUploader.upload();\n        if (ret === null) {\n            this.overSize = true;\n            env.setTimeout('imageItemEdit upload', () => this.overSize = false, 3000);\n            return;\n        }\n        this.resId = ret;\n        this.isChanged = (this.resId !== this.value);\n    }\n    */\n\n    private page = observer((props:{resolve:(value:any)=>void, reject: (resean?:any)=>void}):JSX.Element => {\n        let {resolve} = props;\n        let size:any = this.uiItem && this.uiItem.size;\n\n        /*\n        let right = <button\n            className=\"btn btn-sm btn-success align-self-center\"\n            disabled={!this.isChanged}\n            onClick={()=>resolve(this.resId)}>保存</button>;\n        let overSize:any;\n        if (this.overSize === true) {\n            overSize = <div className=\"text-danger\">\n                <i className=\"fa fa-times-circle\" /> 图片文件大小超过2M，无法上传\n            </div>;\n        }\n        */\n        return <ImageUploader \n            label={'更改' + this.label}\n            id={this.resId}\n            size={size}\n            onSaved={(resId):Promise<void>=>{resolve(resId); return;}} />;\n        /*\n        return <Page header={'更改' + this.label} right={right}>\n            <div className=\"my-3 px-3 py-3 bg-white\">\n                <div>\n                    <div>上传图片：</div>\n                    <div className=\"my-3\">\n                        <ResUploader ref={v=>this.resUploader=v} multiple={false} maxSize={2048} />\n                    </div>\n                    <div>\n                        <button className=\"btn btn-primary\" onClick={this.upload}>上传</button>\n                    </div>\n                </div>\n                {overSize}\n                <div className=\"small muted my-4\">支持JPG、GIF、PNG格式图片，不超过2M。</div>\n                <div className=\"d-flex\">\n                    <div className=\"w-12c h-12c mr-4\"\n                        style={{border: '1px dotted gray', padding: '8px'}}>\n                        <Image className=\"w-100 h-100\" src={this.resId} />\n                    </div>\n                    <div>\n                        <div className=\"small\">图片预览</div>\n                        <Image className=\"w-4c h-4c mt-3\" src={this.resId} />\n                    </div>\n                </div>\n            </div>\n        </Page>;\n        */\n    })\n}\n","import _ from 'lodash';\r\nimport {observable, IObservableArray, computed} from 'mobx';\r\n\r\nexport abstract class PageItems<T> {\r\n    constructor(itemObservable:boolean = false) {\r\n\t\tif (itemObservable === undefined) itemObservable = false;\r\n        this._items = observable.array<T>([], {deep:itemObservable});\r\n    }\r\n\tprivate isFirst: boolean = true;\r\n\tprivate pageItemAction: (item:T, results:{[name:string]:any[]}) => void;\r\n\tprivate itemConverter: (item:any, queryResults:{[name:string]:any[]}) => T;\r\n    @observable loading: boolean = false;\r\n    @observable private beforeLoad: boolean = true;\r\n    @observable protected loaded: boolean = false;\r\n    protected _items:IObservableArray<T>;\r\n    @observable allLoaded: boolean = false;\r\n    @computed get items():IObservableArray<T> {\r\n        if (this.beforeLoad === true) return null;\r\n        if (this.loaded === false) return undefined;\r\n        return this._items;\r\n\t}\r\n\t\r\n\tsetEachPageItem(pageItemAction: (item:T, results:{[name:string]:any[]}) => void) {\r\n\t\tthis.pageItemAction = pageItemAction;\r\n\t}\r\n\r\n\tsetItemConverter(itemConverter: (item:any, queryResults:{[name:string]:any[]}) => T) {\r\n\t\tthis.itemConverter = itemConverter;\r\n\t}\r\n\r\n    @observable topDiv:string = '$$top';\r\n    @observable bottomDiv:string = '$$bottom';\r\n    scrollToTop = () => {\r\n\t\tthis.scrollIntoView(this.topDiv);\r\n\t\t//let id = '$$top'+uid();\r\n\t\t//this.topDiv = id;\r\n\t\t/*\r\n\t\tsetTimeout(() => {\r\n\t\t\tlet div = document.getElementById(this.topDiv);\r\n\t\t\tdiv?.scrollIntoView();\r\n\t\t}, 20);\r\n\t\t*/\r\n    }\r\n    scrollToBottom = () => {\r\n\t\tthis.scrollIntoView(this.bottomDiv);\r\n\t\t//let id = '$$bottom'+uid();\r\n\t\t//this.bottomDiv = id;\r\n\t\t/*\r\n\t\tsetTimeout(() => {\r\n\t\t\tlet div = document.getElementById(this.bottomDiv);\r\n\t\t\tdiv?.scrollIntoView();\r\n\t\t}, 20);\r\n\t\t*/\r\n\t}\r\n\tprivate scrollIntoView(divId:string) {\r\n\t\tsetTimeout(() => {\r\n\t\t\tlet div = document.getElementById(divId);\r\n\t\t\tdiv?.scrollIntoView();\r\n\t\t}, 20);\r\n\t}\r\n\r\n    protected param: any;\r\n    protected firstSize = 100;\r\n    protected pageStart:any = undefined;\r\n    protected pageSize = 30;\r\n    protected appendPosition:'head'|'tail' = 'tail';\r\n\r\n\tprotected sortOrder:'asc'|'desc';\r\n\tprotected abstract loadResults(param:any, pageStart:any, pageSize:number):Promise<{[name:string]:any[]}>;\r\n\tprotected getPageId(item:T):any {return;}\r\n\tprotected setPageStart(item:T) {\r\n\t\tthis.pageStart = this.getPageId(item);\r\n\t}\r\n\t\r\n\tprotected async load(param:any, pageStart:any, pageSize:number):Promise<any[]> {\r\n\t\tlet results = await this.loadResults(param, pageStart, pageSize);\r\n\t\tlet pageList = results.$page;\r\n\t\tif (this.itemConverter) {\r\n\t\t\tlet ret:T[] = [];\r\n\t\t\tlet len = pageList.length;\r\n\t\t\tfor (let i=0; i<len; i++) {\r\n\t\t\t\tlet item = this.itemConverter(pageList[i], results);\r\n\t\t\t\tret.push(item);\r\n\t\t\t}\r\n\t\t\treturn ret;\r\n\t\t}\r\n\t\tif (this.pageItemAction !== undefined) {\r\n\t\t\tlet len = pageList.length;\r\n\t\t\tfor (let i=0; i<len; i++) {\r\n\t\t\t\tthis.pageItemAction(pageList[i], results);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn pageList;\r\n\t}\r\n\r\n    reset() {\r\n        this.isFirst = true;\r\n        this.beforeLoad = true;\r\n        this.loaded = false;\r\n        this.param = undefined;\r\n\t\tthis.allLoaded = false;\r\n\t\tthis.pageStart = undefined;\r\n        this._items.clear();\r\n        //this.setPageStart(undefined);\r\n    }\r\n\r\n    append(item:T) {\r\n        if (this.appendPosition === 'tail')\r\n            this._items.unshift(item);\r\n        else\r\n            this._items.push(item);\r\n    }\r\n\r\n    async first(param:any):Promise<void> {\r\n        this.reset();\r\n        this.beforeLoad = false;\r\n        this.param = param;\r\n        await this.more();\r\n\t}\r\n\r\n\tprivate changing = false;\r\n\tasync attach(): Promise<void> {\r\n\t\tif (this.sortOrder === undefined) {\r\n\t\t\tconsole.error('没有定义增减序，无法attach');\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (this.changing === true) return;\r\n\t\tthis.changing = true;\r\n\t\tlet items = this._items;\r\n\t\tlet isAsc = this.sortOrder === 'asc';\r\n\t\t//let isTail:boolean, \r\n\t\tlet endItem:T;\r\n\t\tlet scrollToEnd:() => void;\r\n\t\tlet pushItem:(item:T) => void;\r\n\t\tif (this.appendPosition === 'tail') {\r\n\t\t\t//isTail = true;\r\n\t\t\tendItem = items[0];\r\n\t\t\tscrollToEnd = this.scrollToTop;\r\n\t\t\tpushItem = (item:T) => items.unshift(item);\r\n\r\n\t\t}\r\n\t\telse {\r\n\t\t\t//isTail = false;\r\n\t\t\tlet endIndex = items.length;\r\n\t\t\tendItem = items[endIndex-1];\r\n\t\t\tscrollToEnd = this.scrollToBottom;\r\n\t\t\tpushItem = (item:T) => items.splice(endIndex, 0, item);\r\n\t\t}\r\n\t\tlet startId = this.getPageId(endItem);\r\n\t\tlet pid = undefined;\r\n\t\tlet sum = 0, max = 50;\r\n\t\tfor (;sum < max;) {\r\n\t\t\tlet ret = await this.load(this.param, pid, 3);\r\n\t\t\tlet len = ret.length;\r\n\t\t\tif (len === 0) break;\r\n\r\n\t\t\tfor (let i=0; i<len; i++) {\r\n\t\t\t\tlet item = ret[i];\r\n\t\t\t\tpid = this.getPageId(item);\r\n\t\t\t\tif (isAsc === true) {\r\n\t\t\t\t\tif (pid >= startId) {\r\n\t\t\t\t\t\tmax = 0;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tif (pid <= startId) {\r\n\t\t\t\t\t\tmax = 0;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tpushItem(item);\r\n\t\t\t\t/*\r\n\t\t\t\tif (isTail === true) {\r\n\t\t\t\t\tthis._items.unshift(item);\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tthis._items.push(item);\r\n\t\t\t\t}\r\n\t\t\t\t*/\r\n\t\t\t\t++sum;\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis.changing = false;\r\n\t\tif (sum > 0) {\r\n\t\t\tscrollToEnd();\r\n\t\t\t/*\r\n\t\t\tif (isTail === true) this.scrollToTop();\r\n\t\t\telse this.scrollToBottom();\r\n\t\t\t*/\r\n\t\t}\r\n\t}\r\n\r\n\tasync refresh(): Promise<void> {\r\n\t\tif (this.changing === true) return;\r\n\t\tthis.changing = true;\r\n\t\tlet ret = await this.load(this.param, undefined, this.firstSize>this.pageSize? this.firstSize:this.pageSize);\r\n\t\tthis._items.clear();\r\n\t\tthis.setLoaded(ret);\r\n\t\t/*\r\n\t\tfor (let i=0; i<len; i++) {\r\n\t\t\tlet item = ret[i];\r\n\t\t\tlet pid = this.getRefreshPageId(item);\r\n\t\t\tlet index = this._items.findIndex(v => this.getRefreshPageId(v) === pid);\r\n\t\t\t//let index = _.sortedIndexBy(this._items, item, v=>this.getRefreshPageId(v));\r\n\t\t\t//let oldItem = this._items[index];\r\n\t\t\t//let oid = this.getRefreshPageId(oldItem);\r\n\t\t\tif (index >= 0) {\r\n\t\t\t\t_.merge(this._items[index], item);\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tthis._items.splice(0, 0, item);\r\n\t\t\t}\r\n\t\t}\r\n\t\t*/\r\n\t\tthis.changing = false;\r\n\t}\r\n\r\n\tprotected getRefreshPageId(item:T) {\r\n\t\treturn this.getPageId(item);\r\n\t}\r\n\r\n    protected async onLoad(): Promise<void> {}\r\n    protected async onLoaded(): Promise<void> {}\r\n\r\n    async more():Promise<boolean> {\r\n        if (this.allLoaded === true) return false;\r\n\t\tif (this.loading === true) return true;\r\n\t\tif (this.changing === true) return true;\r\n\t\tthis.loading = true;\r\n\t\tthis.changing = true;\r\n        await this.onLoad();\r\n        if (this.pageStart === undefined) this.setPageStart(undefined);\r\n        let pageSize = this.pageSize + 1;\r\n        if (this.isFirst === true) {\r\n            if (this.firstSize > this.pageSize) pageSize = this.firstSize+1;\r\n        }\r\n        let ret = await this.load(\r\n                this.param, \r\n                this.pageStart,\r\n\t\t\t\tpageSize);\r\n        this.loaded = true;\r\n\t\tlet len = ret.length;\r\n        if ((this.isFirst===true && len>this.firstSize) ||\r\n            (this.isFirst===false && len>this.pageSize))\r\n        {\r\n            this.allLoaded = false;\r\n            --len;\r\n            ret.splice(len, 1);\r\n        }\r\n        else {\r\n            this.allLoaded = true;\r\n\t\t}\r\n\t\t/*\r\n        if (len === 0) {\r\n\t\t\tthis.setPageStart(undefined);\r\n            this._items.clear();\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis.setPageStart(ret[len-1]);\r\n\t\t\tif (this.appendPosition === 'tail') {\r\n\t\t\t\tthis._items.push(...ret);\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tthis._items.unshift(...ret.reverse());\r\n\t\t\t}\r\n\t\t}\r\n\t\t*/\r\n\t\tthis.setLoaded(ret);\r\n\t\tthis.isFirst = false;\r\n\t\tthis.onLoaded();\r\n\t\tthis.changing = false;\r\n\t\tthis.loading = false;\r\n\t\treturn !this.allLoaded;\r\n\t}\r\n\t\r\n\tprivate setLoaded(data:any[]) {\r\n\t\tlet len = data.length;\r\n        if (len === 0) {\r\n\t\t\tthis.setPageStart(undefined);\r\n            this._items.clear();\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis.setPageStart(data[len-1]);\r\n\t\t\tif (this.appendPosition === 'tail') {\r\n\t\t\t\tthis._items.push(...data);\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tthis._items.unshift(...data.reverse());\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tfindItem(item:any):T {\r\n\t\tlet pid = this.getPageId(item);\r\n\t\tlet index = _.findIndex(this._items, v => this.getPageId(v) === pid);\r\n\t\tif (index < 0) return;\r\n\t\treturn this._items[index];\r\n\t\t//let oldItem = this._items[index];\r\n\t\t//let oid = this.getPageId(oldItem);\r\n\t\t//if (pid === oid) return oldItem;\r\n\t}\r\n}\r\n","class MessageHub {\n    private handlerSeed = 1;\n    private anyHandlers:{[id:number]:(msg:any)=>Promise<void>} = {};\n    private msgHandlers:{[id:number]:{type:string, handler:(msg:any)=>Promise<void>}} = {};\n\tregisterReceiveHandler(handler:(msg:any)=>Promise<void>):number;\n\tregisterReceiveHandler(type:string, handler:(msg:any)=>Promise<void>):number;\t\n    registerReceiveHandler(...args:any[]):number {\n\t\tlet seed = this.handlerSeed++;\n\t\tlet args0 = args[0];\n\t\tlet handler:(msg:any)=>Promise<void>;\n\t\tswitch (typeof args0) {\n\t\t\tcase 'string':\n\t\t\t\thandler = args[1];\n\t\t\t\tthis.msgHandlers[seed] = {type:args0, handler};\n\t\t\t\tbreak;\n\t\t\tcase 'function':\n\t\t\t\tthis.anyHandlers[seed] = args0;\n\t\t\t\tbreak;\n\t\t}\n\t\treturn seed;\n    }\n    unregisterReceiveHandler(handlerId:number) {\n        delete this.anyHandlers[handlerId];\n        delete this.msgHandlers[handlerId];\n    }\n    async dispatch(msg:any) {\n        let {$type} = msg;\n        for (let i in this.anyHandlers) {\n            await this.anyHandlers[i](msg);\n        }\n        for (let i in this.msgHandlers) {\n            let {type, handler} = this.msgHandlers[i];\n            if (type !== $type) continue;\n            await handler(msg);\n        }\n    }\n}\n\nexport const messageHub = new MessageHub();\n","// typescript version of krasimir/navigo\n\nexport type RouteFunc = (params?:string|{[name:string]:string}, query?:string) => void;\n\nexport interface NamedRoute {\n\tas: string;\n\tuses: RouteFunc;\n\thooks?: Hooks;\n}\nexport interface Hooks {\n\tbefore: (done:()=>void, params:object) => void;\n\tafter: (params:object) => void;\n\tleave: (params:object) => void;\n\talready: (params:object) => void;\n}\ninterface Handler {\n\thandler: RouteFunc;\n\thooks: Hooks;\n}\ninterface LastResolved {\n\turl: string;\n\tquery: string;\n\thooks: Hooks;\n\tparams?: {[name:string]:string};\n\tname?: string;\n}\ninterface Route {\n\troute: string|RegExp;\n\thandler: RouteFunc,\n\tname: string,\n\thooks: Hooks\n}\n\nexport class Navigo {\n\tprivate static PARAMETER_REGEXP = /([:*])(\\w+)/g;\n\tprivate static WILDCARD_REGEXP = /\\*/g;\n\tprivate static REPLACE_VARIABLE_REGEXP = '([^\\\\/]+)';   \t// 单\\，编译错误 ([^\\/]+)\n\tprivate static REPLACE_WILDCARD = `(?:.*)`;\n\tprivate static FOLLOWED_BY_SLASH_REGEXP = '(?:\\\\/$|$)';\t\t// 单\\，编译错误 (?:\\/$|$)\n\tprivate static MATCH_REGEXP_FLAGS = '';\n\n\tprivate static isPushStateAvailable() {\n\t\treturn !!(\n\t\t  typeof window !== 'undefined' &&\n\t\t  window.history &&\n\t\t  window.history.pushState\n\t\t);\n\t}\n\t\n\tprivate static clean(s:string|RegExp) {\n\t\tif (s instanceof RegExp) return s;\n\t\treturn Navigo.cleanUrl(s);\n\t}\n\tprivate static cleanUrl(s:string) {\n\t\treturn s.replace(/\\/+$/, '').replace(/^\\/+/, '^/');\n\t}\n\n\tprivate static regExpResultToParams(match:any[], names:string[]) {\n\t\tif (names.length === 0) return null;\n\t\tif (!match) return null;\n\t\treturn match\n\t\t  .slice(1, match.length)\n\t\t  .reduce((params, value, index) => {\n\t\t\t\tif (params === null) params = {};\n\t\t\t\tparams[names[index]] = decodeURIComponent(value);\n\t\t\t\treturn params;\n\t\t  }, null);\n\t}\n\t  \n\tprivate static replaceDynamicURLParts(route:string|RegExp) {\n\t\tlet paramNames:string[] = [], regexp:RegExp;\n\t  \n\t\tif (route instanceof RegExp) {\n\t\t\tregexp = route;\n\t\t}\n\t\telse {\n\t\t\tregexp = new RegExp(\n\t\t\t\troute.replace(Navigo.PARAMETER_REGEXP, function (full, dots, name) {\n\t\t\t\t\t\tparamNames.push(name);\n\t\t\t\t\t\treturn Navigo.REPLACE_VARIABLE_REGEXP;\n\t\t\t\t\t})\n\t\t\t\t\t.replace(Navigo.WILDCARD_REGEXP, Navigo.REPLACE_WILDCARD) + Navigo.FOLLOWED_BY_SLASH_REGEXP\n\t\t\t\t, Navigo.MATCH_REGEXP_FLAGS);\n\t\t}\n\t\treturn { regexp, paramNames };\n\t}\n\t  \n\tprivate static getUrlDepth(url:string):number {\n\t\treturn url.replace(/\\/$/, '').split('/').length;\n\t}\n\t  \n\tprivate static compareUrlDepth(urlA:string, urlB:string) {\n\t\treturn Navigo.getUrlDepth(urlB) - Navigo.getUrlDepth(urlA);\n\t}\n\t  \n\tprivate static findMatchedRoutes(url:string, routes:Route[] = []) {\n\t\treturn routes.map(route => {\n\t\t\tlet { regexp, paramNames } = Navigo.replaceDynamicURLParts(Navigo.clean(route.route));\n\t\t\tlet match = url.replace(/^\\/+/, '/').match(regexp);\n\t\t\tlet params = Navigo.regExpResultToParams(match, paramNames);\n\t\t\treturn match ? { match, route, params } : false;\n\t\t}).filter(m => m);\n\t}\n\t  \n\tprivate static match(url:string, routes:Route[]) {\n\t\treturn Navigo.findMatchedRoutes(url, routes)[0] || false;\n\t}\n\t  \n\tprivate static root(url:string, routes:Route[]) {\n\t\tconst colonExp = RegExp('\\\\/:\\\\D(\\\\w*)', 'g');\n\t\tconst exp = ''; // '($|\\\\/)';  // 单\\，编译报错 ($|\\/)\n\t\tlet matched = routes.map(\n\t\t\troute => {\n\t\t\t\tlet r = route.route;\n\t\t\t\tif (r === '' || r === '*') return url;\n\t\t\t\tif (typeof r === 'string') {\n\t\t\t\t\tr = r.replace(colonExp, '\\\\/\\\\w+');\n\t\t\t\t}\n\t\t\t\tlet routeExp = r + exp;\n\t\t\t\tlet ret = url.split(new RegExp(routeExp))[0];\n\t\t\t\treturn ret;\n\t\t\t}\n\t\t);\n\t\tlet fallbackURL = Navigo.cleanUrl(url);\n\t\tlet len = matched.length;\n\t\tif (len === 0) return fallbackURL;\n\t\tlet matched0 = matched[0];\n\t\tif (len === 1) return matched0;\n\t\treturn matched.reduce((result, url) => {\n\t\t\tif (result.length > url.length) result = url;\n\t\t\treturn result;\n\t\t}, matched0);\n\t}\n\t  \n\tprivate static isHashChangeAPIAvailable() {\n\t\treturn typeof window !== 'undefined' && 'onhashchange' in window;\n\t}\n\t  \n\tprivate static extractGETParameters(url:string):string {\n\t\treturn url.split(/\\?(.*)?$/).slice(1).join('');\n\t}\n\t  \n\tprivate static getOnlyURL(url:string, useHash:boolean, hash:string) {\n\t\tlet onlyURL = url, split:string[];\n\t\tvar cleanGETParam = (str:string) => str.split(/\\?(.*)?$/)[0];\n\t  \n\t\tif (typeof hash === 'undefined') {\n\t\t\t// To preserve BC\n\t\t\thash = '#';\n\t\t}\n\t  \n\t\tif (Navigo.isPushStateAvailable() && !useHash) {\n\t\t  \tonlyURL = cleanGETParam(url).split(hash)[0];\n\t\t}\n\t\telse {\n\t\t\tsplit = url.split(hash);\n\t\t\tonlyURL = split.length > 1 ? cleanGETParam(split[1]) : cleanGETParam(split[0]);\n\t\t}\n\t\treturn onlyURL;\n\t}\n\t  \n\tprivate static manageHooks(handler:RouteFunc, hooks:Hooks, params?:any, exHooks?:Hooks) {\n\t\tif (hooks && typeof hooks === 'object') {\n\t\t\tif (hooks.before) {\n\t\t\t\thooks.before((shouldRoute = true) => {\n\t\t\t\tif (!shouldRoute) return;\n\t\t\t\thandler();\n\t\t\t\thooks.after && hooks.after(params);\n\t\t\t\t}, params);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\telse if (hooks.after) {\n\t\t\t\thandler();\n\t\t\t\thooks.after && hooks.after(params);\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\t\thandler();\n\t}\n\t  \n\tprivate static isHashedRoot(url:string, useHash:boolean, hash:string) {\n\t\tif (Navigo.isPushStateAvailable() && !useHash) {\n\t\t  return false;\n\t\t}\n\t  \n\t\tif (!url.match(hash)) {\n\t\t  return false;\n\t\t}\n\t  \n\t\tlet split = url.split(hash);\n\t  \n\t\treturn split.length < 2 || split[1] === '';\n\t}\n\t\n\tprivate root:string;\n\tprivate _routes:Route[] = [];\n\tprivate _useHash:boolean;\n\tprivate _hash:string;\n\tprivate _paused:boolean;\n\tprivate _destroyed:boolean;\n\tprivate _lastRouteResolved:LastResolved;\n\tprivate _notFoundHandler:Handler;\n\tprivate _defaultHandler:Handler;\n\tprivate _usePushState:boolean;\n\tprivate _genericHooks:Hooks;\n\tprivate _historyUpdateMethod: 'pushState' | 'replaceState'; // HistoryUpdateMethod;\n\tprivate timout: any; //NodeJS.Timeout;\n\n\tconstructor(r:string = null, useHash:boolean = false, hash:string = '#') {\n\t\tthis.root = null;\n\t\tthis._useHash = useHash;\n\t\tthis._hash = (!hash)? '#' : hash;\n\t\tthis._paused = false;\n\t\tthis._destroyed = false;\n\t\tthis._lastRouteResolved = null;\n\t\tthis._notFoundHandler = null;\n\t\tthis._defaultHandler = null;\n\t\tthis._usePushState = !useHash && Navigo.isPushStateAvailable();\n\t\t//this._onLocationChange = this._onLocationChange.bind(this);\n\t\tthis._genericHooks = null;\n\t\tthis._historyUpdateMethod = 'pushState';\n\t\n\t\tif (r) {\n\t\t\tthis.root = useHash ? r.replace(/\\/$/, '/' + this._hash) : r.replace(/\\/$/, '');\n\t\t} else if (useHash) {\n\t\t\tthis.root = this._cLoc().split(this._hash)[0].replace(/\\/$/, '/' + this._hash);\n\t\t}\n\t\n\t\tthis._listen();\n\t\tthis.updatePageLinks();\n\t}\n  \n\tnavigate(path:string, absolute:boolean = false):Navigo {\n\t\tlet to:string;\n\t\tpath = path || '';\n\t\tif (this._usePushState) {\n\t\t\tto = (!absolute ? this._getRoot() + '/' : '') + path.replace(/^\\/+/, '/');\n\t\t\tto = to.replace(/([^:])(\\/{2,})/g, '$1/');\n\t\t\tthis._historyUpdate({}, '', to);\n\t\t\tthis.resolve();\n\t\t}\n\t\telse if (typeof window !== 'undefined') {\n\t\t\tpath = path.replace(new RegExp('^' + this._hash), '');\n\t\t\tlet {location} = window;\n\t\t\tlocation.href = location.href\n\t\t\t\t.replace(/#$/, '')\n\t\t\t\t.replace(new RegExp(this._hash + '.*$'), '') + this._hash + path;\n\t\t}\n\t\treturn this;\n\t}\n\n\ton(routeFunc:RouteFunc, hooks?:Hooks):Navigo;\n\ton(url:string, routeFunc:RouteFunc, hooks?:Hooks):Navigo;\n\ton(regex:RegExp, routeFunc:RouteFunc, hooks?:Hooks):Navigo;\n\ton(options: {[url:string]: RouteFunc|NamedRoute}):Navigo;\n\ton(...args:any[]):Navigo {\n\t\tlet arg0 = args[0];\n\t\tlet arg1 = args[1];\n\t\tswitch (typeof arg0) {\n\t\t\tcase 'function':\n\t\t\t\tthis._defaultHandler = { handler: arg0, hooks: arg1 };\n\t\t\t\tif (!this._notFoundHandler) {\n\t\t\t\t\tthis._notFoundHandler = this._defaultHandler;\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 'object':\n\t\t\t\tlet orderedRoutes = Object.keys(arg0).sort(Navigo.compareUrlDepth);\n\t\t\t\torderedRoutes.forEach(route => this.on(route, arg0[route]));\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tif (args.length < 2) break;\n\t\t\t\tif (arg0 === '/') {\n\t\t\t\t\tthis._defaultHandler = { \n\t\t\t\t\t\thandler: typeof arg1 === 'object'? arg1.uses : arg1, \n\t\t\t\t\t\thooks: args[2],\n\t\t\t\t\t};\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tthis._add(arg0, arg1, args[2]);\n\t\t\t\tbreak;\n\t\t}\n\t\treturn this;\n\t}\n\n\toff(handler:RouteFunc):Navigo {\n\t\tif (this._defaultHandler !== null && handler === this._defaultHandler.handler) {\n\t\t\tthis._defaultHandler = null;\n\t\t}\n\t\telse if (this._notFoundHandler !== null && handler === this._notFoundHandler.handler) {\n\t\t\tthis._notFoundHandler = null;\n\t\t}\n\t\tthis._routes = this._routes.reduce((result, r) => {\n\t\t\tif (r.handler !== handler) result.push(r);\n\t\t\treturn result;\n\t\t}, []);\n\t\treturn this;\n\t}\n\n\tnotFound(handler:RouteFunc, hooks:Hooks):Navigo {\n\t\tthis._notFoundHandler = { handler, hooks };\n\t\treturn this;\n\t}\n\n\tresolve(current?:string) {\n\t\tlet c = current || this._cLoc();\n\t\tlet root = this._getRoot();\n\t\tlet url = c.replace(root, '');\n\t\n\t\tif (this._useHash) {\n\t\t\tconst exp = '^\\\\/';  // 单\\，编译报错 ^\\/\n\t\t\turl = url.replace(new RegExp(exp + this._hash), '/');\n\t\t}\n\t\n\t\tlet GETParameters = Navigo.extractGETParameters(current || this._cLoc());\n\t\tlet onlyURL = Navigo.getOnlyURL(url, this._useHash, this._hash);\n\t\n\t\tif (this._paused) return false;\n\t\n\t\tif (\n\t\t\tthis._lastRouteResolved &&\n\t\t\tonlyURL === this._lastRouteResolved.url &&\n\t\t\tGETParameters === this._lastRouteResolved.query\n\t\t) {\n\t\t\tif (this._lastRouteResolved.hooks && this._lastRouteResolved.hooks.already) {\n\t\t\t\tthis._lastRouteResolved.hooks.already(this._lastRouteResolved.params);\n\t\t\t}\n\t\t\treturn false;\n\t\t}\n\t\n\t\tlet matched = Navigo.match(onlyURL, this._routes);\n\t\n\t\tlet manageHooks = (handler:Handler) => {\n\t\t\tNavigo.manageHooks(() => {\n\t\t\t\tNavigo.manageHooks(() => {\n\t\t\t\t\tthis._callLeave();\n\t\t\t\t\tthis._lastRouteResolved = {\n\t\t\t\t\t\turl: onlyURL,\n\t\t\t\t\t\tquery: GETParameters, \n\t\t\t\t\t\thooks: handler.hooks\n\t\t\t\t\t};\n\t\t\t\t\thandler.handler(GETParameters);\n\t\t\t\t}, handler.hooks);\n\t\t\t}, this._genericHooks);\n\t\t}\n\n\t\tif (matched === false) {\n\t\t\tif (this._defaultHandler && (\n\t\t\t\tonlyURL === '' ||\n\t\t\t\tonlyURL === '/' ||\n\t\t\t\tonlyURL === this._hash ||\n\t\t\t\tNavigo.isHashedRoot(onlyURL, this._useHash, this._hash)\n\t\t\t)) {\n\t\t\t\t/*\n\t\t\t\tNavigo.manageHooks(() => {\n\t\t\t\t\tNavigo.manageHooks(() => {\n\t\t\t\t\t\tthis._callLeave();\n\t\t\t\t\t\tthis._lastRouteResolved = {\n\t\t\t\t\t\t\turl: onlyURL,\n\t\t\t\t\t\t\tquery: GETParameters, \n\t\t\t\t\t\t\thooks: this._defaultHandler.hooks\n\t\t\t\t\t\t};\n\t\t\t\t\t\tthis._defaultHandler.handler(GETParameters);\n\t\t\t\t\t}, this._defaultHandler.hooks);\n\t\t\t\t}, this._genericHooks);\n\t\t\t\t*/\n\t\t\t\tmanageHooks(this._defaultHandler);\n\t\t\t\treturn true;\n\t\t\t}\n\t\t\telse if (this._notFoundHandler) {\n\t\t\t\t/*\n\t\t\t\tNavigo.manageHooks(() => {\n\t\t\t\t\tNavigo.manageHooks(() => {\n\t\t\t\t\t\tthis._callLeave();\n\t\t\t\t\t\tthis._lastRouteResolved = {\n\t\t\t\t\t\t\turl: onlyURL,\n\t\t\t\t\t\t\tquery: GETParameters,\n\t\t\t\t\t\t\thooks: this._notFoundHandler.hooks\n\t\t\t\t\t\t};\n\t\t\t\t\t\tthis._notFoundHandler.handler(GETParameters);\n\t\t\t\t\t}, this._notFoundHandler.hooks);\n\t\t\t\t}, this._genericHooks);\n\t\t\t\t*/\n\t\t\t\tmanageHooks(this._notFoundHandler);\n\t\t\t}\n\t\t\treturn false;\t\n\t\t}\n\t\tlet m = matched;\n\t\tif (m) {\n\t\t\tthis._callLeave();\n\t\t\tthis._lastRouteResolved = {\n\t\t\t\turl: onlyURL,\n\t\t\t\tquery: GETParameters,\n\t\t\t\thooks: m.route.hooks,\n\t\t\t\tparams: m.params,\n\t\t\t\tname: m.route.name\n\t\t\t};\n\t\t\tlet handler = m.route.handler;\n\t\t\tNavigo.manageHooks(() => {\n\t\t\t\tNavigo.manageHooks(() => {\n\t\t\t\t\tm.route.route instanceof RegExp ?\n\t\t\t\t\thandler(...(m.match.slice(1, m.match.length))) :\n\t\t\t\t\thandler(m.params, GETParameters);\n\t\t\t\t}, m.route.hooks, m.params, this._genericHooks);\n\t\t\t}, this._genericHooks, m.params);\n\t\t\treturn m;\n\t\t}\n\t}\n\n\tdestroy() {\n\t\tthis._routes = [];\n\t\tthis._destroyed = true;\n\t\tthis._lastRouteResolved = null;\n\t\tthis._genericHooks = null;\n\t\tclearTimeout(this.timout);\n\t\tif (typeof window !== 'undefined') {\n\t\t\twindow.removeEventListener('popstate', this._onLocationChange);\n\t\t\twindow.removeEventListener('hashchange', this._onLocationChange);\n\t\t}\n\t}\n\n\tupdatePageLinks() {\n\t\t//var self = this;\n\t\tif (typeof document === 'undefined') return;\n\t\t\tthis._findLinks().forEach(link => {\n\t\t\tif (!link.hasListenerAttached) {\n\t\t\t\tlink.addEventListener('click', (e: React.MouseEvent<HTMLElement>) => {\n\t\t\t\t\tif((e.ctrlKey || e.metaKey) && e.currentTarget.tagName.toLowerCase() === 'a'){ return false; }\n\t\t\t\t\tvar location = this.getLinkPath(link);\n\t\t\n\t\t\t\t\tif (!this._destroyed) {\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\tthis.navigate(location.replace(/\\/+$/, '').replace(/^\\/+/, '/'));\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tlink.hasListenerAttached = true;\n\t\t\t}\n\t\t});\n\t}\n\n\tgenerate(name:string, data:any = {}) {\n\t\tlet result = this._routes.reduce((result, route) => {\n\t\t\tif (route.name === name) {\n\t\t\t\tresult = route.route.toString();\n\t\t\t\tfor (let key in data) {\n\t\t\t\t\tresult = result.replace(':' + key, data[key]);\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn result;\n\t\t}, '');\n\t\n\t\treturn this._useHash ? this._hash + result : result;\n\t}\n\n\tlink(path:string) {\n\t\treturn this._getRoot() + path;\n\t}\n\n\tpause(status:boolean = true) {\n\t\tthis._paused = status;\n\t\tif (status) {\n\t\t\tthis._historyUpdateMethod = 'replaceState';\n\t\t}\n\t\telse {\n\t\t\tthis._historyUpdateMethod = 'pushState';\n\t\t}\n\t}\n\n\tresume() {\n\t\tthis.pause(false);\n\t}\n\n\thistoryAPIUpdateMethod(value:'pushState' | 'replaceState') {\n\t\tif (typeof value === 'undefined') return this._historyUpdateMethod;\n\t\tthis._historyUpdateMethod = value;\n\t\treturn value;\n\t}\n\n\tdisableIfAPINotAvailable() {\n\t\tif (!Navigo.isPushStateAvailable()) {\n\t\t\tthis.destroy();\n\t\t}\n\t}\n\n\tlastRouteResolved() {\n\t\treturn this._lastRouteResolved;\n\t}\n\n\tgetLinkPath(link:any) {\n\t\treturn link.getAttribute('href');\n\t}\n\n\thooks(hooks:Hooks) {\n\t\tthis._genericHooks = hooks;\n\t}\n\n\tprivate _add(route:string|RegExp, handler:RouteFunc|NamedRoute, hooks:Hooks) {\n\t\tif (typeof route === 'string') {\n\t\t\troute = encodeURI(route);\n\t\t}\n\t\tthis._routes.push(\n\t\t\ttypeof handler === 'object' ?\n\t\t\t{\n\t\t\t\troute,\n\t\t\t\thandler: handler.uses,\n\t\t\t\tname: handler.as,\n\t\t\t\thooks: hooks || handler.hooks\n\t\t\t} \n\t\t\t:\n\t\t\t{\n\t\t\t\troute,\n\t\t\t\thandler, \n\t\t\t\tname: undefined,\n\t\t\t\thooks,\n\t\t\t}\n\t\t);\n\t\treturn this._add;\n\t}\n\n\tprivate _historyUpdate(data:any, title:string, url?:string) {\n\t\tswitch (this._historyUpdateMethod) {\n\t\t\tdefault: throw Error('unknow history method ' + this._historyUpdateMethod);\n\t\t\tcase 'pushState': window.history.pushState(data, title, url); return;\n\t\t\tcase 'replaceState': window.history.replaceState(data, title, url); return;\n\t\t}\n\t}\n\n\tprivate _getRoot() {\n\t\tif (this.root !== null) return this.root;\n\t\tlet cLoc = this._cLoc();\n\t\tlet cLocRoot = cLoc.split('?')[0];\n\t\tthis.root = Navigo.root(cLocRoot, this._routes);\n\t\treturn this.root;\n\t}\n\n\tprivate _listen() {\n\t\tif (this._usePushState) {\n\t\t\twindow.addEventListener('popstate', this._onLocationChange);\n\t\t}\n\t\telse if (Navigo.isHashChangeAPIAvailable()) {\n\t\t\twindow.addEventListener('hashchange', this._onLocationChange);\n\t\t}\n\t\telse {\n\t\t\tlet cached = this._cLoc();\n\t\n\t\t\tlet check = () => {\n\t\t\t\tlet current = this._cLoc();\n\t\t\t\tif (cached !== current) {\n\t\t\t\t\tcached = current;\n\t\t\t\t\tthis.resolve();\n\t\t\t\t}\n\t\t\t\tif (this.timout) clearTimeout(this.timout);\n\t\t\t\tthis.timout = setTimeout(check, 200);\n\t\t\t};\n\t\t\tcheck();\n\t\t}\n\t}\n\n\tprivate _cLoc() {\n\t\tif (typeof window !== 'undefined') {\n\t\t\t//if (typeof window.__NAVIGO_WINDOW_LOCATION_MOCK__ !== 'undefined') {\n\t\t\t//\treturn window.__NAVIGO_WINDOW_LOCATION_MOCK__;\n\t\t\t//}\n\t\t\treturn Navigo.cleanUrl(window.location.href);\n\t\t}\n\t\treturn '';\n\t}\n\n\tprivate _findLinks() {\n\t\treturn [].slice.call(document.querySelectorAll('[data-navigo]'));\n\t}\n\n\tprivate _onLocationChange = () => {\n\t\tconsole.log('_onLocationChange');\n\t\tthis.resolve();\n\t}\n\n\tprivate _callLeave() {\n\t\tconst lastRouteResolved = this._lastRouteResolved;\t\n\t\tif (lastRouteResolved) {\n\t\t\tlet {params, hooks} = lastRouteResolved;\n\t\t\tif (hooks) {\n\t\t\t\tif (hooks.leave) {\n\t\t\t\t\thooks.leave(params);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n}\n\n//export default Navigo;\nexport const navigo = new Navigo();\n","import * as React from 'react';\r\nimport {nav} from '../nav';\r\n\r\nexport interface PageHeaderProps {\r\n    back?: 'back' | 'close' | 'none';\r\n    center: string | JSX.Element;\r\n    right?: JSX.Element;\r\n    logout?: boolean | (()=>Promise<void>);\r\n    className?: string;\r\n\tafterBack?: () => void;\r\n\tex?: JSX.Element;\r\n}\r\n\r\nexport function renderPageHeader(props: PageHeaderProps, inWebNav?: boolean) {\r\n    let onBack = async () => {\r\n        await nav.back(); // 这个才会显示confirm box，在dataForm里面，如果输入了数据的话\r\n\t\tlet {afterBack} = props;\r\n\t\tif (afterBack) afterBack();\r\n    }\r\n    let onLogoutClick = () => {\r\n\t\tlet logout = async () => {\r\n\t\t\tlet {logout} = props;\r\n\t\t\tif (typeof logout === 'function') {\r\n\t\t\t\tawait logout(); \r\n\t\t\t}\r\n\t\t\tawait nav.logout(undefined);\r\n\t\t}\r\n\t\tnav.showLogout(logout);\r\n    }\r\n\r\n\tlet b = nav.level > 1 || window.self !== window.top;\r\n\tlet {back, right, center, logout, className, ex} = props;\r\n\tif (inWebNav === true &&  !back && !right && !center) return;\r\n\tlet vBack:any, debugLogout:any;\r\n\tif (logout !== undefined && window.self === window.top) {\r\n\t\tif ((typeof logout === 'boolean' && logout === true)\r\n\t\t\t|| typeof logout === 'function')\r\n\t\t{\r\n\t\t\tlet {user} = nav;\r\n\t\t\tif (user !== undefined) {\r\n\t\t\t\tlet {nick, name} = user;\r\n\t\t\t\tdebugLogout = <div className=\"d-flex align-items-center\">\r\n\t\t\t\t\t<small className=\"text-light\">{nick || name}</small>\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\t// eslint-disable-next-line\r\n\t\t\t\t\t\t<div className=\"ml-2 py-2 px-3 cursor-pointer\"\r\n\t\t\t\t\t\t\trole=\"button\"\r\n\t\t\t\t\t\t\tonClick={onLogoutClick}>\r\n\t\t\t\t\t\t\t<i className=\"fa fa-sign-out fa-lg\" />\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t}\r\n\t\t\t\t</div>;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\tif (b) {\r\n\t\tswitch (props.back) {\r\n\t\t\tcase 'none':\r\n\t\t\t\tvBack = undefined;\r\n\t\t\t\tbreak;\r\n\t\t\tdefault:\r\n\t\t\tcase 'back':\r\n\t\t\t\tvBack = <nav onClick={onBack}>{nav.backIcon}</nav>;\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'close':\r\n\t\t\t\tvBack = <nav onClick={onBack}>{nav.backIcon}</nav>;\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t}\r\n\tif (window.self !== window.top) {\r\n\t\tconsole.log(window.location.href);\r\n\t\t// pop = <header onClick={this.openWindow} className=\"mx-1\"><FA name=\"external-link\" /></header>;\r\n\t}\r\n\tif (vBack === undefined && typeof center === 'string') {\r\n\t\tcenter = <div className=\"px-3\">{center}</div>;\r\n\t}\r\n\tlet rightView = (right || debugLogout) && <aside>{right} {debugLogout}</aside>;\r\n\tlet header = <header className={className}>\r\n\t\t<nav>\r\n\t\t\t{vBack}\r\n\t\t\t{/*pop 弹出window暂时停止作用 */}\r\n\t\t\t<div>{center}</div>\r\n\t\t\t{rightView}\r\n\t\t</nav>\r\n\t\t{ex}\r\n\t</header>;\r\n\tif (inWebNav === true) return header;\r\n\treturn <>\r\n\t\t<section className=\"tv-page-header\">{header}</section>\r\n\t\t{header}\r\n\t</>;\r\n}\r\n\r\nexport class PageHeader extends React.Component<PageHeaderProps> {\r\n\trender() {return renderPageHeader(this.props)}\r\n\t/*\r\n    private back = async () => {\r\n        await nav.back(); // 这个才会显示confirm box，在dataForm里面，如果输入了数据的话\r\n\t\tlet {afterBack} = this.props;\r\n\t\tif (afterBack) afterBack();\r\n    }\r\n    openWindow() {\r\n        window.open(document.location.href);\r\n    }\r\n    private logoutClick = () => {\r\n        nav.showLogout(this.logout);\r\n    }\r\n    private logout = async () => {\r\n        let {logout} = this.props;\r\n        if (typeof logout === 'function') {\r\n            await logout(); \r\n        }\r\n        await nav.logout(undefined);\r\n    }\r\n    render() {\r\n        let b = nav.level > 1 || window.self !== window.top;\r\n        let {right, center, logout, className, ex} = this.props;\r\n        let back:any, debugLogout:any;\r\n        if (logout !== undefined && window.self === window.top) {\r\n            if ((typeof logout === 'boolean' && logout === true)\r\n                || typeof logout === 'function')\r\n            {\r\n                let {user} = nav;\r\n                if (user !== undefined) {\r\n                    let {nick, name} = user;\r\n                    debugLogout = <div className=\"d-flex align-items-center\">\r\n                        <small className=\"text-light\">{nick || name}</small>\r\n                        {\r\n                            // eslint-disable-next-line\r\n                            <div className=\"ml-2 py-2 px-3 cursor-pointer\"\r\n                                role=\"button\"\r\n                                onClick={this.logoutClick}>\r\n                                <i className=\"fa fa-sign-out fa-lg\" />\r\n                            </div>\r\n                        }\r\n                    </div>;\r\n                }\r\n            }\r\n        }\r\n        if (b) {\r\n            switch (this.props.back) {\r\n                case 'none':\r\n                    back = undefined;\r\n                    break;\r\n                default:\r\n                case 'back':\r\n                    back = <nav onClick={this.back}><i className=\"fa fa-angle-left\" /></nav>;\r\n                    break;\r\n                case 'close':\r\n                    back = <nav onClick={this.back}><i className=\"fa fa-close\" /></nav>;\r\n                    break;\r\n            }\r\n        }\r\n        if (window.self !== window.top) {\r\n            console.log(document.location.href);\r\n            // pop = <header onClick={this.openWindow} className=\"mx-1\"><FA name=\"external-link\" /></header>;\r\n        }\r\n        if (back === undefined && typeof center === 'string') {\r\n            center = <div className=\"px-3\">{center}</div>;\r\n        }\r\n\t\tlet rightView = (right || debugLogout) && <aside>{right} {debugLogout}</aside>;\r\n\t\tlet header = <header className={className}>\r\n\t\t\t<nav>\r\n\t\t\t\t{back}\r\n\t\t\t\t<div>{center}</div>\r\n\t\t\t\t{rightView}\r\n\t\t\t</nav>\r\n\t\t\t{ex}\r\n\t\t</header>;\r\n        return <>\r\n\t\t\t<section className=\"tv-page-header\">{header}</section>\r\n\t\t\t{header}\r\n\t\t</>;\r\n\t}\r\n\t*/\r\n}\r\n","import * as React from 'react';\r\nimport { observable } from 'mobx';\r\nimport { observer } from 'mobx-react';\r\nimport classNames from 'classnames';\r\nimport { IVPage } from './page';\r\nimport { IObservableValue } from 'mobx';\r\nimport '../../css/va-tab.css';\r\nimport { ScrollView } from './scrollView';\r\n\r\nexport type TabCaption = (selected:boolean) => JSX.Element;\r\n\r\nexport interface TabProp {\r\n    name: string;\r\n    caption: TabCaption;\r\n\tcontent?: () => JSX.Element;\r\n\tpage?: IVPage;\r\n    notify?: IObservableValue<number>;\r\n    load?: () => Promise<void>;\r\n\tonShown?: () => Promise<void>;\r\n\tisSelected?: boolean;\r\n\tonScroll?: () => void;\r\n\tonScrollTop?: () => Promise<boolean>;\r\n\tonScrollBottom?: () => Promise<void>;\r\n\tclassName?: string;\r\n}\r\n\r\nexport interface TabsProps {\r\n    tabs: TabProp[];\r\n    tabPosition?: 'top' | 'bottom';\r\n    size?: 'sm' | 'lg' | 'md';\r\n    tabBg?: string;\r\n    contentBg?: string;\r\n    sep?: string;\r\n    selected?: string;\r\n    borderColor?: string;\r\n    borderWidth?: string;\r\n}\r\n\r\nclass Tab {\r\n\t@observable private loaded: boolean = false;\r\n    name: string;\r\n    @observable selected: boolean;\r\n    caption: TabCaption;\r\n\tcontentBuilder: ()=>JSX.Element;\r\n\tpage: IVPage;\r\n    notify: IObservableValue<number>;\r\n    load?: () => Promise<void>;\r\n\tonShown?: () => Promise<void>;\r\n\tonScroll?: () => void;\r\n\tonScrollTop?: () => Promise<boolean>;\r\n\tonScrollBottom?: () => Promise<void>;\r\n\tclassName?: string;\r\n\r\n    private _content: JSX.Element;\r\n    \r\n    get content(): JSX.Element {\r\n\t\tif (this.load && this.loaded === false) return null;\r\n\t\tif (this.selected === false) return this._content;\r\n\t\tif (!this._content) {\r\n\t\t\tif (this.contentBuilder !== undefined) {\r\n\t\t\t\tthis._content = this.contentBuilder();\r\n\t\t\t}\r\n\t\t\telse if (this.page !== undefined) {\r\n\t\t\t\tthis._content = this.page.content();\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tthis._content = <div className=\"p-5\">tab 应该定义content或者page</div>;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn this._content;\r\n    }\r\n\r\n    async shown() {\r\n        if (this.onShown !== undefined) {\r\n            await this.onShown();\r\n        }\r\n        if (this.load !== undefined) {\r\n\t\t\tif (this.loaded === false) {\r\n\t\t\t\tawait this.load();\r\n\t\t\t\tthis.loaded = true;\r\n\t\t\t}\r\n        }\r\n    }\r\n}\r\n\r\nexport const TabCaptionComponent = (label:string, icon:string, color:string) => <div \r\n    className={'d-flex justify-content-center align-items-center flex-column cursor-pointer ' + color}>\r\n    <div><i className={'fa fa-lg fa-' + icon} /></div>\r\n    <small>{label}</small>\r\n</div>;\r\n\r\nexport const TabCaption = TabCaptionComponent;\r\n\r\nexport class TabsView {\r\n\tprivate props: TabsProps;\r\n    private size: string;\r\n    private tabBg: string;\r\n    //private contentBg: string;\r\n    private sep: string;\r\n    @observable private selectedTab: Tab;\r\n    @observable private tabArr: Tab[];\r\n\r\n    constructor(props: TabsProps) {\r\n\t\tthis.props = props;\r\n\t\tlet {size, tabs, tabBg: tabBack, sep, selected} = props;\r\n\t\tthis.size = size || 'md';\r\n        this.tabArr = tabs.map(v => {\r\n            let tab = new Tab();\r\n            let {name, caption, content, page, notify, load, onShown, isSelected, onScroll, onScrollTop, onScrollBottom, className} = v;\r\n\t\t\ttab.name = name;\r\n\t\t\tif (isSelected === true || name === selected) {\r\n\t\t\t\tthis.selectedTab = tab;\r\n\t\t\t}\r\n\t\t\ttab.selected = false;\r\n\t\t\ttab.caption = caption;\r\n\t\t\tif (content !== undefined) {\r\n\t\t\t\ttab.contentBuilder = content;\r\n\t\t\t}\r\n\t\t\telse if (page !== undefined) {\r\n\t\t\t\ttab.page = page;\r\n\t\t\t\t//contentBuilder = () => {return page.content()};\r\n\t\t\t}\r\n            tab.notify = notify;\r\n            tab.load = load;\r\n\t\t\ttab.onShown = onShown;\r\n\t\t\ttab.onScroll = onScroll;\r\n\t\t\ttab.onScrollTop = onScrollTop;\r\n\t\t\ttab.onScrollBottom = onScrollBottom;\r\n\t\t\ttab.className = className;\r\n            return tab;\r\n        });\r\n        this.tabBg = tabBack;\r\n        //this.contentBg = contentBack;\r\n        this.sep = sep;\r\n        if (this.selectedTab === undefined) {\r\n\t\t\tthis.selectedTab = this.tabArr[0];\r\n\t\t}\r\n        this.selectedTab.selected = true;\r\n    }\r\n\r\n    tabClick = async (tab:Tab) => {\r\n\t\tif (!tab) {\r\n\t\t\ttab = this.selectedTab;\r\n\t\t\tif (tab === undefined) {\r\n\t\t\t\tif (this.tabArr === undefined) return;\r\n\t\t\t\tif (this.tabArr.length === 0) return;\r\n\t\t\t\ttab = this.tabArr[0];\r\n\t\t\t}\r\n\t\t}\r\n\r\n        this.selectedTab.selected = false;\r\n        tab.selected = true;\r\n\t\tthis.selectedTab = tab;\r\n\t\t\r\n\t\tawait tab.shown();\r\n    }\r\n\r\n\t/*\r\n    showTab(tabName: string) {\r\n        let tab = this.tabs.find(v => v.name === tabName);\r\n        if (tab === undefined) return;\r\n        if (this.selectedTab !== undefined) this.selectedTab.selected = false;\r\n        tab.selected = true;\r\n        this.selectedTab = tab;\r\n\t}\r\n\t*/\r\n\r\n\tprivate tabs = observer(() => {\r\n        let {tabPosition, borderColor} = this.props;\r\n        let bsCur:React.CSSProperties, bsTab:React.CSSProperties\r\n        if (borderColor) {\r\n            bsCur = {\r\n                borderColor: borderColor,\r\n                borderStyle: 'solid',\r\n                borderTopWidth: 1,\r\n                borderLeftWidth: 1,\r\n                borderRightWidth: 1,\r\n                borderBottomWidth: 1,\r\n            }\r\n            bsTab = {\r\n                borderColor: borderColor,\r\n                borderStyle: 'solid',\r\n                borderTopWidth: 1,\r\n                borderBottomWidth: 1,\r\n                borderLeftWidth: 0,\r\n                borderRightWidth: 0,\r\n            }\r\n            if (tabPosition === 'top') {\r\n                bsCur.borderBottomWidth = 0;\r\n                bsCur.borderTopLeftRadius = 10;\r\n                bsCur.borderTopRightRadius = 10;\r\n                bsTab.borderTopWidth = 0;\r\n            }\r\n            else {\r\n                bsCur.borderTopWidth = 0;\r\n                bsCur.borderBottomLeftRadius = 10;\r\n                bsCur.borderBottomRightRadius = 10;\r\n                bsTab.borderBottomWidth = 0;\r\n            }\r\n        }\r\n\t\tlet cn = classNames('tv-tabs', this.tabBg, this.sep, 'tv-tabs-' + this.size);\r\n\t\tlet tabs = <div className={cn}>\r\n            {this.tabArr.map((v,index) => {\r\n                let {selected, caption, notify} = v;\r\n                let notifyCircle:any;\r\n                if (notify !== undefined) {\r\n                    let num = notify.get();\r\n                    if (num !== undefined) {\r\n                        if (num > 0) notifyCircle = <u>{num>99?'99+':num}</u>;\r\n                        else if (num < 0) notifyCircle = <u className=\"dot\" />;\r\n                    }\r\n                }\r\n                return <div key={index} onClick={()=>this.tabClick(v)} style={selected===true? bsCur:bsTab}>\r\n\t\t\t\t\t<div>\r\n\t\t\t\t\t{notifyCircle}\r\n\t\t\t\t\t{caption(selected)}\r\n\t\t\t\t\t</div>\r\n                </div>\r\n            })}\r\n\t\t</div>;\r\n\t\treturn tabs;\r\n\t});\r\n\r\n\tcontent = observer(() => {\r\n\t\tlet displayNone:React.CSSProperties = {visibility: 'hidden'};\r\n\t\treturn <>\r\n\t\t\t{this.tabArr.map((v,index) => {\r\n\t\t\t\tlet {tabPosition} = this.props;\r\n\t\t\t\tlet {content, page, onScroll, onScrollTop, onScrollBottom, className} = v;\r\n\t\t\t\tlet tabs = React.createElement(this.tabs);\r\n\t\t\t\tlet pageHeader:any, pageFooter:any;\r\n\t\t\t\tif (page !== undefined) {\r\n\t\t\t\t\tpageHeader = page.header();\r\n\t\t\t\t\tpageFooter = page.footer();\r\n\t\t\t\t}\r\n\t\t\t\tlet header:any, footer:any;\r\n\t\t\t\tlet visibility:React.CSSProperties = {visibility:'hidden'};\r\n\t\t\t\tif (tabPosition === 'top') {\r\n\t\t\t\t\theader = <>\r\n\t\t\t\t\t\t<section className=\"tv-page-header\">\r\n\t\t\t\t\t\t\t<header>{tabs}{pageHeader}</header>\r\n\t\t\t\t\t\t</section>\r\n\t\t\t\t\t\t<header style={visibility}>{tabs}{pageHeader}</header>\r\n\t\t\t\t\t</>;\r\n\t\t\t\t\tif (pageFooter !== undefined) {\r\n\t\t\t\t\t\tfooter = <>\r\n\t\t\t\t\t\t\t<footer style={visibility}>{pageFooter}</footer>\r\n\t\t\t\t\t\t\t<section className=\"tv-page-footer\">\r\n\t\t\t\t\t\t\t\t<footer>{pageFooter}</footer>\r\n\t\t\t\t\t\t\t</section>\r\n\t\t\t\t\t\t</>;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tif (pageHeader !== undefined) {\r\n\t\t\t\t\t\theader = <>\r\n\t\t\t\t\t\t\t<section className='tv-page-header'>\r\n\t\t\t\t\t\t\t\t<header>{pageHeader}</header>\r\n\t\t\t\t\t\t\t</section>\r\n\t\t\t\t\t\t\t<header style={visibility}>{pageHeader}</header>\r\n\t\t\t\t\t\t</>;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tfooter = <>\r\n\t\t\t\t\t\t<footer style={visibility}>{pageFooter}{tabs}</footer>\r\n\t\t\t\t\t\t<section className='tv-page-footer'>\r\n\t\t\t\t\t\t\t<footer>{pageFooter}{tabs}</footer>\r\n\t\t\t\t\t\t</section>\r\n\t\t\t\t\t</>;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tlet style:React.CSSProperties;\r\n\t\t\t\tif (v.selected===false) style = displayNone;\r\n\t\t\t\treturn <ScrollView key={index} className={className}\r\n\t\t\t\t\tstyle={style}\r\n\t\t\t\t\tonScroll={onScroll} onScrollTop={onScrollTop} onScrollBottom={onScrollBottom}>\r\n\t\t\t\t\t{header}\r\n\t\t\t\t\t{content}\r\n\t\t\t\t\t{footer}\r\n\t\t\t\t</ScrollView>;\r\n\t\t\t})}\r\n\t\t</>;\r\n\t});\r\n\r\n    render() {\r\n\t\tlet {tabPosition} = this.props;\r\n\t\tlet tabs = React.createElement(this.tabs);\r\n\t\tlet header:any, footer:any;\r\n\t\tlet visibility:React.CSSProperties = {display:'none'};\r\n\t\tif (tabPosition === 'top') {\r\n\t\t\theader = <header>{tabs}</header>;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tfooter = <footer>{tabs}</footer>;\r\n\t\t}\r\n\t\treturn <>\r\n\t\t\t{header}\r\n\t\t\t{this.tabArr.map((v,index) => {\r\n\t\t\t\tlet style:React.CSSProperties;\r\n\t\t\t\tif (v.selected===false) style = visibility;\r\n\t\t\t\treturn <div key={index} className={classNames(v.className)} style={style}>\r\n\t\t\t\t\t{v.content}\r\n\t\t\t\t</div>;\r\n\t\t\t})}\r\n\t\t\t{footer}\r\n\t\t</>;\r\n    }\r\n};\r\n\r\n@observer export class Tabs extends React.Component<TabsProps> {\r\n\tprivate readonly tabsView: TabsView;\r\n    constructor(props: TabsProps) {\r\n\t\tsuper(props);\r\n\t\tthis.tabsView = new TabsView(props);\r\n\t\tsetTimeout(() => {\r\n\t\t\tthis.tabsView.tabClick(undefined);\r\n\t\t}, 100);\r\n    }\r\n\r\n    render() {\r\n\t\treturn this.tabsView.render();\r\n    }\r\n};\r\n\r\n@observer export class RootTabs extends React.Component<TabsProps> {\r\n\tprivate readonly tabsView: TabsView;\r\n    constructor(props: TabsProps) {\r\n\t\tsuper(props);\r\n\t\tthis.tabsView = new TabsView(props);\r\n\t\tsetTimeout(() => {\r\n\t\t\tthis.tabsView.tabClick(undefined);\r\n\t\t}, 100);\r\n    }\r\n\r\n    render() {\r\n\t\treturn React.createElement(this.tabsView.content);\r\n    }\r\n};\r\n","import * as React from 'react';\nimport { nav } from './nav';\nimport { Loading } from './loading';\nimport { Image as ImageControl } from './image';\nimport { Page } from './page/page';\nimport { observer } from 'mobx-react';\nimport { observable } from 'mobx';\nimport { LMR } from './simple';\n\nexport interface ResUploaderProps {\n    className?: string;\n    label?: string;\n    multiple?: boolean;\n    maxSize?: number;\n    onFilesChange?: (evt: React.ChangeEvent<HTMLInputElement>) => void;\n}\n\n@observer\nexport class ResUploader extends React.Component<ResUploaderProps> {\n    private fileInput: HTMLInputElement;\n    @observable private fileName: string;\n\n    buildFormData():FormData {\n        let {maxSize} = this.props;\n        if (maxSize === undefined || maxSize <= 0) \n            maxSize = 100000000000;\n        else\n            maxSize = maxSize * 1024;\n        var files:FileList = this.fileInput.files;\n        var data = new FormData();\n        let len = files.length;\n        for (let i=0; i<len; i++) {\n            let file = files[i];\n            if (file.size > maxSize) return null;\n            data.append('files[]', file, file.name);\n        }\n    }\n\n    getFile0(): File {\n        return this.fileInput.files[0];\n    }\n\n    upload = async (formData?: FormData):Promise<string|{error:any}> => {\n        let resUrl = nav.resUrl + 'upload';\n        if (!formData) formData = this.buildFormData();\n        try {\n            nav.startWait();\n            //let headers = new Headers();\n            //headers.append('Access-Control-Allow-Origin', '*');\n            let headers:{[name:string]: string} = {}; //new Headers();\n            headers['Access-Control-Allow-Origin'] = '*';\n                //2019-12-18：因为 vivo按oppo某些版本不支持，暂时先不要 \n            //let abortController = new AbortController();\n            let res = await fetch(resUrl, {\n                method: \"POST\",\n                body: formData,\n                headers: headers,\n                //signal: abortController.signal,\n            });\n            let json = await res.json();\n            return ':' + json.res.id;\n        }\n        catch (err) {\n            console.error('%s %s', resUrl, err);\n            return {error:err};\n        }\n        finally {\n            nav.endWait();\n        }\n    }\n\n    private onFilesChange = (evt: React.ChangeEvent<HTMLInputElement>) => {\n        let {onFilesChange} = this.props;\n        if (onFilesChange) onFilesChange(evt);\n        let files = evt.target.files;\n        let len = files.length;\n        let names:string[] = [];\n        for (let i=0; i<len; i++) {\n            names.push(files.item(i).name);\n        }\n        this.fileName = names.join(', ');\n    }\n\n    render() {\n        let {className, multiple, label} = this.props;\n        return <div>\n                <label className=\"btn btn-outline-success\">\n                    {label || '选择文件'} \n                    <input \n                        className={className}\n                        ref={t=>this.fileInput=t} \n                        onChange={this.onFilesChange}\n                        type='file' name='file' \n                        multiple={multiple} style={{display:'none'}} />\n                </label>\n                &nbsp;\n                {this.fileName}\n            </div>\n    }\n}\n\nfunction formatSize(size:number, pointLength:number=2, units?:string[]) {\n    var unit;\n    units = units || [ 'B', 'K', 'M', 'G', 'TB' ];\n    while ( (unit = units.shift()) && size > 1024 ) {\n        size = size / 1024;\n    }\n    return (unit === 'B' ? size : size.toFixed( pointLength === undefined ? 2 : pointLength)) + unit;\n}\n\ninterface ImageUploaderProps {\n    id?: string;\n    label?: string;\n    size?: 'sm' | 'md' | 'lg' | 'xl' | 'raw';\n\tonSaved?: (imageId:string) => Promise<void>;\n\timageTypes?: string[];\n}\n\nconst xlargeSize = 1600;\nconst largeSize = 800;\nconst mediumSize = 400;\nconst smallSize = 180;\n\n@observer\nexport class ImageUploader extends React.Component<ImageUploaderProps> {\n\tprivate static imageTypes = ['gif', 'jpg', 'jpeg', 'png', 'svg', 'apng', 'bmp', 'ico', 'cur', 'tiff', 'tif', 'webp'];\n\tprivate imgBaseSize: number;\n\tprivate imageTypes: string[];\n    private suffix: string;\n    private resUploader: ResUploader;\n    @observable private file: File;    \n    @observable private desImgWidth: number;\n    @observable private desImgHeight: number;\n    @observable private desImgSize: number;\n    @observable private srcImgWidth: number;\n    @observable private srcImgHeight: number;\n    @observable private isChanged: boolean = false;\n    @observable private resId: string;\n    @observable private enableUploadButton: boolean = false;\n    @observable private srcImage: string;\n    @observable private desImage: string;\n    @observable private fileError: string;\n    @observable private uploaded: boolean = false;\n\n    constructor(props: ImageUploaderProps) {\n        super(props);\n\t\tthis.resId = props.id;\n\t\tthis.imageTypes = props.imageTypes || ImageUploader.imageTypes;\n    }\n\n    private onFileChange = (evt: React.ChangeEvent<HTMLInputElement>) => {\n        this.fileError = undefined;\n        this.uploaded = false;\n        this.enableUploadButton = evt.target.files.length > 0;\n        if (this.enableUploadButton) {\n            this.file = evt.target.files[0];\n            let pos = this.file.name.lastIndexOf('.');\n            if (pos >= 0) this.suffix = this.file.name.substr(pos+1).toLowerCase();\n            if(this.imageTypes.indexOf(this.suffix) < 0){\n                this.fileError = `图片类型必须是 ${this.imageTypes.join(', ')} 中的一种`;\n                return;\n            }\n            let reader = new FileReader();\n            reader.readAsDataURL(this.file);\n            reader.onload = async () => {\n\t\t\t\tthis.srcImage = reader.result as string;\n\t\t\t\tswitch (this.suffix ) {\n\t\t\t\t\tdefault:\n\t\t\t\t\t\tawait this.setSize(this.props.size);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'svg':\n\t\t\t\t\t\tthis.imgBaseSize = mediumSize;\n\t\t\t\t\t\tthis.desImgSize = this.srcImage.length;\n\t\t\t\t\t\tthis.desImage = this.srcImage;\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n            };\n        }\n    }\n\n    private async setSize(size?: 'sm' | 'md' | 'lg' | 'xl' | 'raw') {\n        switch (size) {\n            default:\n            case 'sm':\n                this.imgBaseSize = smallSize; break;\n            case 'md':\n                this.imgBaseSize = mediumSize; break;\n            case 'lg':\n\t\t\t\tthis.imgBaseSize = largeSize; break;\n\t\t\tcase 'xl':\n\t\t\t\tthis.imgBaseSize = xlargeSize; break;\n\t\t\tcase 'raw':\n\t\t\t\tthis.imgBaseSize = -1; break;\n\t\t}\n\t\tthis.desImage = await this.compress();\n    }\n\n    private compress = ():Promise<string> => {\n        return new Promise<string>((resolve, reject) => {\n            var img = new Image();\n            img.src = this.srcImage;\n            img.onload = () => {\n                //var that = this;\n                // 默认按比例压缩\n                let {width, height} = img;\n                this.srcImgWidth = width;\n                this.srcImgHeight = height;\n                let scale = width / height;\n\t\t\t\tlet w:number, h:number;\n\t\t\t\tif (this.imgBaseSize < 0) {\n\t\t\t\t\tw = width;\n\t\t\t\t\th = height;\n\t\t\t\t}\n                else if (width <= this.imgBaseSize && height <= this.imgBaseSize) {\n                    w = width;\n                    h = height;\n                }\n                else if (scale < 0) {\n                    w = this.imgBaseSize;\n                    h = w / scale;\n                }\n                else {\n                    h = this.imgBaseSize;\n                    w = h * scale;\n                }\n                this.desImgWidth = Math.round(w);\n                this.desImgHeight = Math.round(h);\n                var quality = 0.7;  // 默认图片质量为0.7\n                //生成canvas\n                var canvas = document.createElement('canvas');\n                var ctx = canvas.getContext('2d');\n                // 创建属性节点\n                var anw = document.createAttribute(\"width\");\n                anw.nodeValue = String(w);\n                var anh = document.createAttribute(\"height\");\n                anh.nodeValue = String(h);\n                canvas.setAttributeNode(anw);\n                canvas.setAttributeNode(anh);\n                ctx.drawImage(img, 0, 0, w, h);\n                let base64 = canvas.toDataURL('image/' + this.suffix , quality);\n                let blob = this.convertBase64UrlToBlob(base64);\n                this.desImgSize = blob.size;\n                if (this.desImgSize > 3*1024*1024) {\n                    this.fileError = \"图片大于3M，无法上传\";\n                    this.enableUploadButton = false;\n                }\n                resolve(base64);\n            }\n        });\n    }\n\n    private convertBase64UrlToBlob(urlData: string):Blob {\n        let arr = urlData.split(',');\n        let mime = arr[0].match(/:(.*?);/)[1];\n        let bstr = atob(arr[1]);\n        let n = bstr.length;\n        let u8arr = new Uint8Array(n);\n        while(n--){\n            u8arr[n] = bstr.charCodeAt(n);\n        }\n        return new Blob([u8arr], {type:mime});\n    }\n\n    private upload = async () => {\n        if (!this.resUploader) return;\n        let formData = new FormData();\n        let blob = this.convertBase64UrlToBlob(this.desImage);\n        formData.append('image', blob, this.file.name);\n        let ret = await this.resUploader.upload(formData);\n        if (typeof ret === 'object') {\n            let {error} = ret;\n            let type = typeof error;\n            let err:string;\n            switch (type) {\n                case 'undefined': err = 'error: undefined'; break;\n                case 'string': err = error; break;\n                case 'object': err = error.message; break;\n                default: err = String(err); break;\n            }\n            this.fileError = 'error: ' + type + ' - ' + err;\n            return;\n        }\n        this.resId = ret;\n        this.isChanged = (this.resId !== this.props.id);\n        this.uploaded = true;\n    }\n\n    private onSaved = (): Promise<void> => {\n        let {onSaved} = this.props;\n        onSaved && onSaved(this.resId);\n        return;\n    }\n\n    private showOrgImage = () => {\n        nav.push(<Page header=\"原图\">\n            <div className=\"p-3 text-center\">\n                <ImageControl className=\"h-min-4c\" style={{maxWidth:'100%'}} src={this.srcImage} />\n            </div>\n        </Page>);\n    }\n\n    private levelDiv() {\n        if (this.props.size) return;\n        let arr = [{caption:'小图', size:'sm'}];\n        if (this.srcImgHeight > mediumSize || this.srcImgWidth > mediumSize) {\n            arr.push({caption:'中图', size:'md'});\n        }\n        if (this.srcImgHeight > largeSize || this.srcImgWidth > largeSize) {\n            arr.push({caption:'大图', size:'lg'});\n        }\n        if (this.srcImgHeight > xlargeSize || this.srcImgWidth > xlargeSize) {\n\t\t\tarr.push({caption:'超大图', size:'xl'});\n\t\t\tarr.push({caption:'原图', size:'raw'});\n        }\n        if (arr.length < 2) return;\n        return <div>{arr.map((v, index) => {\n            let {caption, size} = v;\n            return <label key={index} className=\"mr-3\"><input type=\"radio\" name=\"size\" \n                onChange={()=>this.setSize(size as any)}\n                defaultChecked={index===0} /> {caption}</label>;\n        })}</div>\n    }\n\n    render() {\n        let {label} = this.props;\n        let right = <button\n            className=\"btn btn-sm btn-success align-self-center mr-2\"\n            disabled={!this.isChanged}\n            onClick={this.onSaved}>保存</button>;\n        return <Page header={label || '更改图片'} right={right}>\n            <div className=\"my-3 px-3 py-3 bg-white\">\n                <div>\n                    <div className=\"mb-3\">\n                        <ResUploader ref={v=>this.resUploader=v} \n                            multiple={false} maxSize={2048} \n                            label=\"选择图片文件\"\n                            onFilesChange={this.onFileChange} />\n                        <div className=\"small text-muted\">支持 {this.imageTypes.join(', ')} 格式图片。</div>\n                        {this.fileError && <div className=\"text-danger\">{this.fileError}</div>}\n                    </div>\n                    <LMR left=\n                    {\n                        this.uploaded === true? \n                            <div className=\"text-success p-2\">上传成功！</div>\n                            :\n                            this.file && this.desImgSize > 0 && <div className=\"mb-3 d-flex align-items-end\">\n                                <div className=\"mr-5\">\n                                    {this.levelDiv()}\n                                    <div>分辨率：{this.desImgWidth} x {this.desImgHeight}\n                                    &nbsp; &nbsp;\n                                    文件大小：{formatSize(this.desImgSize)}\n                                    </div>\n                                </div>\n                                <button className=\"btn btn-primary\" \n                                    disabled={!this.enableUploadButton}\n                                    onClick={this.upload}>上传</button>\n                            </div>\n                    }\n                    right={this.desImage && \n                        <button className=\"btn btn-link btn-sm text-right mb-3\" onClick={this.showOrgImage}>\n                            原图大小: {formatSize(this.file.size)}<br/>\n                            分辨率：{this.srcImgWidth} x {this.srcImgHeight}\n                        </button>\n                    }\n                    ></LMR>\n                </div>\n                <div className=\"text-center\" \n                    style={{\n                        border: (this.uploaded===true? '2px solid green' : '1px dotted gray'),\n                        padding: '8px'\n                    }}>\n                    <ImageControl className=\"h-min-4c\" style={{maxWidth:'100%'}} src={this.desImage} />\n                </div>\n            </div>\n        </Page>;\n    }\n}\n\ninterface AudioUploaderProps {\n    id?: string;\n    label?: string;\n    onSaved?: (imageId:string) => Promise<void>;\n}\n\n@observer\nexport class AudioUploader extends React.Component<AudioUploaderProps> {\n\tprivate static audioTypes = ['mp3', 'wav'];\n\n    private suffix: string;\n\tprivate resUploader: ResUploader;\n\t@observable private content: string;\n\t@observable private file: File;    \n\t@observable private fileSize: number;\n\n    @observable private isChanged: boolean = false;\n    @observable private resId: string;\n    @observable private enableUploadButton: boolean = false;\n    @observable private fileError: string;\n\t@observable private uploaded: boolean = false;\n\t@observable private uploading: boolean = false;\n\n    constructor(props: AudioUploaderProps) {\n        super(props);\n        this.resId = props.id;\n    }\n\n    private onFileChange = (evt: React.ChangeEvent<HTMLInputElement>) => {\n        this.fileError = undefined;\n        this.uploaded = false;\n        this.enableUploadButton = evt.target.files.length > 0;\n        if (this.enableUploadButton) {\n            this.file = evt.target.files[0];\n            let pos = this.file.name.lastIndexOf('.');\n            if (pos >= 0) this.suffix = this.file.name.substr(pos+1).toLowerCase();\n            if(AudioUploader.audioTypes.indexOf(this.suffix) < 0){\n                this.fileError = `音频类型必须是 ${AudioUploader.audioTypes.join(', ')} 中的一种`;\n                return;\n            }\n            let reader = new FileReader();\n            reader.readAsDataURL(this.file);\n            reader.onload = async () => {\n\t\t\t\tthis.content = reader.result as string;\n\t\t\t\tthis.fileSize = this.content.length;\n            };\n        }\n    }\n\n    private convertBase64UrlToBlob(urlData: string):Blob {\n        let arr = urlData.split(',');\n        let mime = arr[0].match(/:(.*?);/)[1];\n        let bstr = atob(arr[1]);\n        let n = bstr.length;\n        let u8arr = new Uint8Array(n);\n        while(n--){\n            u8arr[n] = bstr.charCodeAt(n);\n        }\n        return new Blob([u8arr], {type:mime});\n    }\n\n    private upload = async () => {\n\t\tif (!this.resUploader) return;\n\t\tthis.uploading = true;\n        let formData = new FormData();\n        let blob = this.convertBase64UrlToBlob(this.content);\n        formData.append('image', blob, this.file.name);\n        let ret = await this.resUploader.upload(formData);\n        if (typeof ret === 'object') {\n            let {error} = ret;\n            let type = typeof error;\n            let err:string;\n            switch (type) {\n                case 'undefined': err = 'error: undefined'; break;\n                case 'string': err = error; break;\n                case 'object': err = error.message; break;\n                default: err = String(err); break;\n            }\n            this.fileError = 'error: ' + type + ' - ' + err;\n            return;\n        }\n        this.resId = ret;\n        this.isChanged = (this.resId !== this.props.id);\n        this.uploaded = true;\n    }\n\n    private onSaved = (): Promise<void> => {\n        let {onSaved} = this.props;\n        onSaved && onSaved(this.resId);\n        return;\n    }\n\n    render() {\n        let {label} = this.props;\n        let right = <button\n            className=\"btn btn-sm btn-success align-self-center mr-2\"\n            disabled={!this.isChanged}\n            onClick={this.onSaved}>保存</button>;\n        return <Page header={label || '更改文件'} right={right}>\n            <div className=\"my-3 px-3 py-3 bg-white\">\n                <div>\n                    <div className=\"mb-3\">\n                        <ResUploader ref={v=>this.resUploader=v} \n                            multiple={false} maxSize={2048} \n                            label=\"选择音频文件\"\n                            onFilesChange={this.onFileChange} />\n                        <div className=\"small text-muted\">支持 {AudioUploader.audioTypes.join(', ')} 格式。</div>\n                        {this.fileError && <div className=\"text-danger\">{this.fileError}</div>}\n                    </div>\n                </div>\n            </div>\n\t\t\t<LMR left=\n                    {\n                        this.uploaded === true? \n                            <div className=\"text-success p-2\">上传成功！</div>\n\t\t\t\t\t\t\t:\n\t\t\t\t\t\t\tthis.uploading === true?\n\t\t\t\t\t\t\t\t<div className=\"m-3\"><Loading /></div>\n\t\t\t\t\t\t\t\t:\n\t\t\t\t\t\t\t\tthis.file && this.content && <div className=\"m-3\">\n\t\t\t\t\t\t\t\t\t<div className=\"mb-3\">\n\t\t\t\t\t\t\t\t\t\t文件大小：{formatSize(this.fileSize)}\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<button className=\"btn btn-primary\" \n\t\t\t\t\t\t\t\t\t\tdisabled={!this.enableUploadButton}\n\t\t\t\t\t\t\t\t\t\tonClick={this.upload}>上传</button>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t}\n\t\t\t/>\n        </Page>;\n    }\n}\n","import _ from 'lodash';\r\nimport { UqApi, UqData, UnitxApi, appInFrame } from '../net';\r\nimport { Tuid, TuidDiv, TuidImport, TuidInner, TuidBox, TuidsCache } from './tuid';\r\nimport { Action } from './action';\r\nimport { Sheet } from './sheet';\r\nimport { Query } from './query';\r\nimport { Book } from './book';\r\nimport { History } from './history';\r\nimport { Map } from './map';\r\nimport { Pending } from './pending';\r\nimport { CreateBoxId, BoxId } from './tuid';\r\nimport { LocalMap, LocalCache } from '../tool';\r\nimport { UQsMan } from './uqsMan';\r\nimport { ReactBoxId } from './tuid/reactBoxId';\r\nimport { Tag } from './tag/tag';\r\n\r\nexport type FieldType = 'id' | 'tinyint' | 'smallint' | 'int' | 'bigint' | 'dec' | 'char' | 'text'\r\n    | 'datetime' | 'date' | 'time' | 'timestamp';\r\n\r\nexport function fieldDefaultValue(type:FieldType) {\r\n    switch (type) {\r\n        case 'tinyint':\r\n        case 'smallint':\r\n        case 'int':\r\n        case 'bigint':\r\n        case 'dec':\r\n            return 0;\r\n        case 'char':\r\n        case 'text':\r\n            return '';\r\n        case 'datetime':\r\n        case 'date':\r\n            return '2000-1-1';\r\n        case 'time':\r\n            return '0:00';\r\n    }\r\n}\r\n\r\nexport interface Field {\r\n    name: string;\r\n    type: FieldType;\r\n    tuid?: string;\r\n    arr?: string;\r\n    null?: boolean;\r\n    size?: number;\r\n    owner?: string;\r\n    _tuid: TuidBox;\r\n}\r\nexport interface ArrFields {\r\n    name: string;\r\n    fields: Field[];\r\n    id?: string;\r\n    order?: string;\r\n}\r\nexport interface FieldMap {\r\n    [name:string]: Field;\r\n}\r\nexport interface SchemaFrom {\r\n    owner:string;\r\n    uq:string;\r\n}\r\nexport interface TuidModify {\r\n    max: number;\r\n    seconds: number;\r\n}\r\n\r\nexport class UqMan {\r\n    private readonly actions: {[name:string]: Action} = {};\r\n    private readonly sheets: {[name:string]: Sheet} = {};\r\n    private readonly queries: {[name:string]: Query} = {};\r\n    private readonly books: {[name:string]: Book} = {};\r\n    private readonly maps: {[name:string]: Map} = {};\r\n    private readonly histories: {[name:string]: History} = {};\r\n\tprivate readonly pendings: {[name:string]: Pending} = {};\r\n\tprivate readonly tags: {[name:string]: Tag} = {};\r\n    private readonly tuidsCache: TuidsCache;\r\n    private readonly localAccess: LocalCache;\r\n    private readonly tvs:{[entity:string]:(values:any)=>JSX.Element};\r\n    readonly localMap: LocalMap;\r\n    readonly localModifyMax: LocalCache;\r\n    readonly tuids: {[name:string]: Tuid} = {};\r\n    readonly createBoxId: CreateBoxId;\r\n    readonly newVersion: boolean;\r\n    readonly uqOwner: string;\r\n    readonly uqName: string;\r\n    readonly name: string;\r\n    readonly uqApi: UqApi;\r\n    readonly id: number;\r\n\r\n    uqVersion: number;\r\n\r\n    constructor(uqs:UQsMan, uqData: UqData, createBoxId:CreateBoxId, tvs:{[entity:string]:(values:any)=>JSX.Element}) {\r\n        this.createBoxId = createBoxId;\r\n        if (createBoxId === undefined) {\r\n            this.createBoxId = this.createBoxIdFromTVs;\r\n            this.tvs = tvs || {};\r\n        }\r\n        let {id, uqOwner, uqName, access, newVersion} = uqData;\r\n        this.newVersion = newVersion;\r\n        this.uqOwner = uqOwner;\r\n        this.uqName = uqName;\r\n        this.id = id;\r\n        this.name = uqOwner + '/' + uqName;\r\n        this.uqVersion = 0;\r\n        this.localMap = uqs.localMap.map(this.name);\r\n        this.localModifyMax = this.localMap.child('$modifyMax');\r\n        this.localAccess = this.localMap.child('$access');\r\n        //let hash = document.location.hash;\r\n        let baseUrl = 'tv/';\r\n\r\n        let acc: string[];\r\n        if (access === null || access === undefined || access === '*') {\r\n            acc = [];\r\n        }\r\n        else {\r\n            acc = access.split(';').map(v => v.trim()).filter(v => v.length > 0);\r\n        }\r\n        if (this.name === '$$$/$unitx') {\r\n            // 这里假定，点击home link之后，已经设置unit了\r\n            // 调用 UnitxApi会自动搜索绑定 unitx service\r\n            this.uqApi = new UnitxApi(appInFrame.unit);\r\n        }\r\n        else {\r\n            let {appOwner, appName} = uqs;\r\n            this.uqApi = new UqApi(baseUrl, appOwner, appName, uqOwner, uqName, acc, true);\r\n        }\r\n        this.tuidsCache = new TuidsCache(this);\r\n    }\r\n\r\n    get entities() {\r\n        return _.merge({}, \r\n            this.actions, this.sheets, this.queries, this.books,\r\n\t\t\tthis.maps, this.histories, this.pendings, this.tuids,\r\n\t\t\tthis.tags,\r\n        );\r\n    }\r\n\r\n    private createBoxIdFromTVs:CreateBoxId = (tuid:Tuid, id:number):BoxId =>{\r\n        let {name} = tuid;\r\n        /*\r\n        let tuidUR = this.tuidURs[name];\r\n        if (tuidUR === undefined) {\r\n            let {ui, res} = this.getUI(tuid);\r\n            this.tuidURs[name] = tuidUR = new TuidWithUIRes(tuid, ui, res);\r\n        }\r\n        */\r\n        return new ReactBoxId(id, tuid, this.tvs[name]);\r\n    }\r\n\r\n    tuid(name:string):Tuid {return this.tuids[name.toLowerCase()]}\r\n    tuidDiv(name:string, div:string):TuidDiv {\r\n        let tuid = this.tuids[name.toLowerCase()]\r\n        return tuid && tuid.div(div.toLowerCase());\r\n    }\r\n    action(name:string):Action {return this.actions[name.toLowerCase()]}\r\n    sheet(name:string):Sheet {return this.sheets[name.toLowerCase()]}\r\n    query(name:string):Query {return this.queries[name.toLowerCase()]}\r\n    book(name:string):Book {return this.books[name.toLowerCase()]}\r\n    map(name:string):Map {return this.maps[name.toLowerCase()]}\r\n    history(name:string):History {return this.histories[name.toLowerCase()]}\r\n    pending(name:string):Pending {return this.pendings[name.toLowerCase()]}\r\n\r\n    sheetFromTypeId(typeId:number):Sheet {\r\n        for (let i in this.sheets) {\r\n            let sheet = this.sheets[i];\r\n            if (sheet.typeId === typeId) return sheet;\r\n        }\r\n    }\r\n\r\n    readonly tuidArr: Tuid[] = [];\r\n    readonly actionArr: Action[] = [];\r\n    readonly sheetArr: Sheet[] = [];\r\n    readonly queryArr: Query[] = [];\r\n    readonly bookArr: Book[] = [];\r\n    readonly mapArr: Map[] = [];\r\n    readonly historyArr: History[] = [];\r\n    readonly pendingArr: Pending[] = [];\r\n    readonly tagArr: Tag[] = [];\r\n\r\n    async init() {\r\n        await this.uqApi.init();\r\n    }\r\n\r\n    async loadEntities(): Promise<string> {\r\n        try {\r\n            let accesses = this.localAccess.get();\r\n            if (!accesses) {\r\n                accesses = await this.uqApi.loadAccess();\r\n            }\r\n            if (!accesses) return;\r\n            this.buildEntities(accesses);\r\n        }\r\n        catch (err) {\r\n            return err;\r\n        }\r\n    }\r\n\r\n\tbuildEntities(entities:any) {\r\n        if (entities === undefined) {\r\n            debugger;\r\n        }\r\n        this.localAccess.set(entities);\r\n        let {access, tuids, version} = entities;\r\n        this.uqVersion = version;\r\n        this.buildTuids(tuids);\r\n        this.buildAccess(access);\r\n\t}\r\n\t\r\n    private buildTuids(tuids:any) {\r\n        for (let i in tuids) {\r\n            let schema = tuids[i];\r\n            let {typeId, from} = schema;\r\n            let tuid = this.newTuid(i, typeId, from);\r\n            tuid.sys = true;\r\n        }\r\n        for (let i in tuids) {\r\n            let schema = tuids[i];\r\n            let tuid = this.getTuid(i);\r\n            tuid.setSchema(schema);\r\n        }\r\n        for (let i in this.tuids) {\r\n            let tuid = this.tuids[i];\r\n            tuid.buildFieldsTuid();\r\n        }\r\n\t}\r\n\r\n    async loadEntitySchema(entityName: string): Promise<any> {\r\n        return await this.uqApi.schema(entityName);\r\n    }\r\n\r\n    getTuid(name:string): Tuid {\r\n        return this.tuids[name];\r\n    }\r\n\r\n    private buildAccess(access:any) {\r\n        for (let a in access) {\r\n            let v = access[a];\r\n            switch (typeof v) {\r\n                case 'string': this.fromType(a, v); break;\r\n                case 'object': this.fromObj(a, v); break;\r\n            }\r\n        }\r\n    }\r\n\r\n    cacheTuids(defer:number) {\r\n        this.tuidsCache.cacheTuids(defer);\r\n    }\r\n\r\n    newAction(name:string, id:number):Action {\r\n        let action = this.actions[name];\r\n        if (action !== undefined) return action;\r\n        action = this.actions[name] = new Action(this, name, id)\r\n        this.actionArr.push(action);\r\n        return action;\r\n    }\r\n    private newTuid(name:string, id:number, from:SchemaFrom):Tuid {\r\n        let tuid = this.tuids[name];\r\n        if (tuid !== undefined) return tuid;\r\n        if (from !== undefined)\r\n            tuid = new TuidImport(this, name, id, from);\r\n        else\r\n            tuid = new TuidInner(this, name, id);\r\n        this.tuids[name] = tuid;\r\n        this.tuidArr.push(tuid);\r\n        return tuid;\r\n    }\r\n    newQuery(name:string, id:number):Query {\r\n        let query = this.queries[name];\r\n        if (query !== undefined) return query;\r\n        query = this.queries[name] = new Query(this, name, id)\r\n        this.queryArr.push(query);\r\n        return query;\r\n    }\r\n    private newBook(name:string, id:number):Book {\r\n        let book = this.books[name];\r\n        if (book !== undefined) return book;\r\n        book = this.books[name] = new Book(this, name, id);\r\n        this.bookArr.push(book);\r\n        return book;\r\n    }\r\n    private newMap(name:string, id:number):Map {\r\n        let map = this.maps[name];\r\n        if (map !== undefined) return map;\r\n        map = this.maps[name] = new Map(this, name, id)\r\n        this.mapArr.push(map);\r\n        return map;\r\n    }\r\n    private newTag(name:string, id:number):Tag {\r\n        let tag = this.tags[name];\r\n        if (tag !== undefined) return tag;\r\n        tag = this.tags[name] = new Tag(this, name, id)\r\n        this.tagArr.push(tag);\r\n        return tag;\r\n    }\r\n    private newHistory(name:string, id:number):History {\r\n        let history = this.histories[name];\r\n        if (history !== undefined) return;\r\n        history = this.histories[name] = new History(this, name, id)\r\n        this.historyArr.push(history);\r\n        return history;\r\n    }\r\n    private newPending(name:string, id:number):Pending {\r\n        let pending = this.pendings[name];\r\n        if (pending !== undefined) return;\r\n        pending = this.pendings[name] = new Pending(this, name, id)\r\n        this.pendingArr.push(pending);\r\n        return pending;\r\n    }\r\n    newSheet(name:string, id:number):Sheet {\r\n        let sheet = this.sheets[name];\r\n        if (sheet !== undefined) return sheet;\r\n        sheet = this.sheets[name] = new Sheet(this, name, id);\r\n        this.sheetArr.push(sheet);\r\n        return sheet;\r\n    }\r\n    private fromType(name:string, type:string) {\r\n        let parts = type.split('|');\r\n        type = parts[0];\r\n        let id = Number(parts[1]);\r\n        switch (type) {\r\n            //case 'uq': this.id = id; break;\r\n            case 'tuid':\r\n                // Tuid should not be created here!;\r\n                //let tuid = this.newTuid(name, id);\r\n                //tuid.sys = false;\r\n                break;\r\n            case 'action': this.newAction(name, id); break;\r\n            case 'query': this.newQuery(name, id); break;\r\n            case 'book': this.newBook(name, id); break;\r\n            case 'map': this.newMap(name, id); break;\r\n            case 'history': this.newHistory(name, id); break;\r\n            case 'sheet':this.newSheet(name, id); break;\r\n\t\t\tcase 'pending': this.newPending(name, id); break;\r\n\t\t\tcase 'tag': this.newTag(name, id); break;\r\n        }\r\n    }\r\n    private fromObj(name:string, obj:any) {\r\n        switch (obj['$']) {\r\n            case 'sheet': this.buildSheet(name, obj); break;\r\n        }\r\n    }\r\n    private buildSheet(name:string, obj:any) {\r\n        let sheet = this.sheets[name];\r\n        if (sheet === undefined) sheet = this.newSheet(name, obj.id);\r\n        sheet.build(obj);\r\n    }\r\n    buildFieldTuid(fields:Field[], mainFields?:Field[]) {\r\n        if (fields === undefined) return;\r\n        for (let f of fields) {\r\n            let {tuid} = f;\r\n            if (tuid === undefined) continue;\r\n            let t = this.getTuid(tuid);\r\n            if (t === undefined) continue;\r\n            f._tuid = t.buildTuidBox();\r\n        }\r\n        for (let f of fields) {\r\n            let {owner} = f;\r\n            if (owner === undefined) continue;\r\n            let ownerField = fields.find(v => v.name === owner);\r\n            if (ownerField === undefined) {\r\n                if (mainFields !== undefined) {\r\n                    ownerField = mainFields.find(v => v.name === owner);\r\n                }\r\n                if (ownerField === undefined) {\r\n                    debugger;\r\n                    throw new Error(`owner field ${owner} is undefined`);\r\n                }\r\n            }\r\n            let {arr, tuid} = f;\r\n            let t = this.getTuid(ownerField._tuid.tuid.name);\r\n            if (t === undefined) continue;\r\n            let div = t.div(arr || tuid);\r\n            f._tuid = div && div.buildTuidDivBox(ownerField);\r\n            if (f._tuid === undefined) {\r\n                debugger;\r\n                throw new Error(`owner field ${owner} is not tuid`);\r\n            }\r\n        }\r\n    }\r\n    buildArrFieldsTuid(arrFields:ArrFields[], mainFields:Field[]) {\r\n        if (arrFields === undefined) return;\r\n        for (let af of arrFields) {\r\n            let {fields} = af;\r\n            if (fields === undefined) continue;\r\n            this.buildFieldTuid(fields, mainFields);\r\n        }\r\n    }\r\n\r\n    pullModify(modifyMax:number) {\r\n        this.tuidsCache.pullModify(modifyMax);\r\n    }\r\n}\r\n","import { Entity } from './entity';\nimport { PageItems } from '../tool/pageItems';\nimport { EntityCaller } from './caller';\n\nexport interface SheetState {\n    name: string;\n    actions: SheetAction[];\n}\n\nexport interface SheetAction {\n    name: string;\n}\n\nexport interface StateCount {\n    state: string;\n    count: number;\n}\n\nexport class Sheet extends Entity {\n    get typeName(): string { return 'sheet';}\n    states: SheetState[];\n\n    /*\n    setStates(states: SheetState[]) {\n        for (let state of states) {\n            this.setStateAccess(this.states.find(s=>s.name==state.name), state);\n        }\n    }*/\n    setSchema(schema:any) {\n        super.setSchema(schema);\n        this.states = schema.states;\n    }\n    build(obj:any) {\n        this.states = [];\n        for (let op of obj.ops) {\n            this.states.push({name: op, actions:undefined});\n        }\n        /*\n        for (let p in obj) {\n            switch(p) {\n                case '#':\n                case '$': continue;\n                default: this.states.push(this.createSheetState(p, obj[p])); break;\n            }\n        }*/\n    }\n    private createSheetState(name:string, obj:object):SheetState {\n        let ret:SheetState = {name:name, actions:[]};\n        let actions = ret.actions;\n        for (let p in obj) {\n            let action:SheetAction = {name: p};\n            actions.push(action);\n        }\n        return ret;\n    }\n    /*\n    private setStateAccess(s:SheetState, s1:SheetState) {\n        if (s === undefined) return;\n        for (let action of s1.actions) {\n            let acn = action.name;\n            let ac = s.actions.find(a=>a.name === acn);\n            if (ac === undefined) continue;\n            s.actions.push(action);\n        }\n    }*/\n    async save(discription:string, data:any):Promise<any> {\n        /*\n        await this.loadSchema();\n        let {id} = this.uq;\n        let text = this.pack(data);\n\n        let ret = await this.uqApi.sheetSave(this.name, );\n        return ret;\n        */\n        let {id} = this.uq;\n        //let text = this.pack(data);\n        let params = {app: id, discription: discription, data:data};\n        return await new SaveCaller(this, params).request();\n        /*\n        let {id, state} = ret;\n        if (id > 0) this.changeStateCount(state, 1);\n        return ret;\n        */\n    }\n    async action(id:number, flow:number, state:string, action:string) {\n        /*\n        await this.loadSchema();\n        return await this.uqApi.sheetAction(this.name, {id:id, flow:flow, state:state, action:action});\n        */\n        return await new ActionCaller(this, {id:id, flow:flow, state:state, action:action}).request();\n    }\n    private unpack(data:any):any {\n        //if (this.schema === undefined) await this.loadSchema();\n        let ret = data[0];\n        let brief = ret[0];\n        let sheetData = this.unpackSheet(brief.data);\n        let flows = data[1];\n        return {\n            brief: brief,\n            data: sheetData,\n            flows: flows,\n        }\n    }\n    async getSheet(id:number):Promise<any> {\n        /*\n        await this.loadSchema();\n        let ret = await this.uqApi.getSheet(this.name, id);\n        */\n        let ret = await new GetSheetCaller(this, id).request();\n        if (ret[0].length === 0) return await this.getArchive(id);\n        return this.unpack(ret);\n    }\n    async getArchive(id:number):Promise<any> {\n        /*\n        await this.loadSchema();\n        let ret = await this.uqApi.sheetArchive(this.name, id)\n        return this.unpack(ret);\n        */\n        let ret = await new SheetArchiveCaller(this, id).request();\n        return this.unpack(ret);\n    }\n\n    async getArchives(pageStart:number, pageSize:number) {\n        /*\n        await this.loadSchema();\n        let ret = await this.uqApi.sheetArchives(this.name, {pageStart:pageStart, pageSize:pageSize});\n        return ret;\n        */\n        let params = {pageStart:pageStart, pageSize:pageSize};\n        return await new SheetArchivesCaller(this, params).request();\n    }\n\n    async getStateSheets(state:string, pageStart:number, pageSize:number):Promise<any[]> {\n        /*\n        await this.loadSchema();\n        let ret = await this.uqApi.stateSheets(this.name, {state:state, pageStart:pageStart, pageSize:pageSize});\n        return ret;\n        */\n        let params = {state:state, pageStart:pageStart, pageSize:pageSize};\n        return await new StateSheetsCaller(this, params).request();\n    }\n    createPageStateItems<T>(): PageStateItems<T> {return new PageStateItems<T>(this);}\n\n    async stateSheetCount():Promise<StateCount[]> {\n        /*\n        await this.loadSchema();\n        let ret:StateCount[] = await this.uqApi.stateSheetCount(this.name);\n        return this.states.map(s => {\n            let n = s.name, count = 0;\n            let r = ret.find(v => v.state === n);\n            if (r !== undefined) count = r.count;\n            return {state: n, count: count} \n        });\n        */\n        return await new StateSheetCountCaller(this, undefined).request();\n    }\n\n    async userSheets(state:string, user:number, pageStart:number, pageSize:number):Promise<any[]> {\n        let params = {state:state, user:user, pageStart:pageStart, pageSize:pageSize};\n        return await new UserSheetsCaller(this, params).request();\n    }\n\n    async mySheets(state:string, pageStart:number, pageSize:number):Promise<any[]> {\n        /*\n        await this.loadSchema();\n        let ret = await this.uqApi.mySheets(this.name, {state:state, pageStart:pageStart, pageSize:pageSize});\n        return ret;\n        */\n        let params = {state:state, pageStart:pageStart, pageSize:pageSize};\n        return await new MySheetsCaller(this, params).request();\n    }\n}\n\n\nabstract class SheetCaller<T> extends EntityCaller<T> {\n    protected get entity(): Sheet {return this._entity as Sheet;}\n    protected readonly suffix:string;\n    get path():string {return `sheet/${this.entity.name}/${this.suffix}`;}\n}\n\nclass SaveCaller extends SheetCaller<{app:number; discription:string; data:any}> {\n    get path():string {return `sheet/${this.entity.name}`;}\n    buildParams() {\n        let {app, discription, data} = this.params;\n        return {\n            app: app,\n            discription: discription,\n            data: this.entity.pack(data)\n        };\n    }\n}\n\nclass ActionCaller extends SheetCaller<{id:number, flow:number, state:string, action:string}> {\n    method = 'PUT';\n    get path():string {return `sheet/${this.entity.name}`;}\n    //buildParams() {return this.entity.buildParams(this.params);}\n}\n\nclass GetSheetCaller extends SheetCaller<number> {\n    //protected readonly params: number;  // id\n    method = 'GET';\n    //private id:number;\n    //protected readonly suffix = 'archive';\n    buildParams() {}\n    get path():string {return `sheet/${this.entity.name}/get/${this.params}`;}\n}\n\nclass SheetArchiveCaller extends SheetCaller<number> {\n    //protected readonly params: number;  // id\n    method = 'GET';\n    //protected readonly suffix = 'archive';\n    buildParams() {}\n    get path():string {return `sheet/${this.entity.name}/archive/${this.params}`;}\n}\n\nclass SheetArchivesCaller extends SheetCaller<{pageStart:number, pageSize:number}> {\n    protected readonly suffix = 'archives';\n}\n\nclass StateSheetsCaller extends SheetCaller<{state:string, pageStart:number, pageSize:number}> {\n    protected readonly suffix = 'states';\n}\n\nclass StateSheetCountCaller extends SheetCaller<undefined> {\n    method = 'GET';\n    protected readonly suffix = 'statecount';\n    xresult(res:any):any {\n        let {states} = this.entity;\n        return states.map(s => {\n            let n = s.name, count = 0;\n            let r = (res as any[]).find(v => v.state === n);\n            if (r !== undefined) count = r.count;\n            return {state: n, count: count} \n        });\n    }\n}\n\nclass UserSheetsCaller extends SheetCaller<{state:string, user:number, pageStart:number, pageSize:number}> {\n    protected readonly suffix = 'user-sheets';\n    xresult(res:any):any {\n        return res;\n    }\n}\n\nclass MySheetsCaller extends SheetCaller<{state:string, pageStart:number, pageSize:number}> {\n    protected readonly suffix = 'my-sheets';\n    xresult(res:any):any {\n        return res;\n    }\n}\n\nexport class PageStateItems<T> extends PageItems<T> {\n    private sheet: Sheet;\n    constructor(sheet: Sheet) {\n        super(true);\n        this.sheet = sheet;\n        this.pageSize = 10;\n\t}\n\tprotected async loadResults(param:any, pageStart:any, pageSize:number):Promise<{[name:string]:any[]}> {\n\t\tlet ret = await this.sheet.getStateSheets(param, pageStart, pageSize);\n\t\treturn {$page: ret};\n\t}\n\t/*\n    protected async load(param:any, pageStart:any, pageSize:number):Promise<any[]> {\n        let ret = await this.sheet.getStateSheets(param, pageStart, pageSize);\n        return ret;\n\t}\n\t*/\n\tprotected getPageId(item:T) {\n\t\treturn item === undefined? 0 : (item as any).id;\n\t}\n\t/*\n    protected setPageStart(item:any) {\n        this.pageStart = item === undefined? 0 : item.id;\n\t}\n\t*/\n}\n","import {Query} from './query';\nimport { QueryQueryCaller } from './caller';\n\nexport class Book extends Query {\n    get typeName(): string { return 'book';}\n    protected queryApiName = 'book';\n\n    protected queryCaller(params: any): QueryQueryCaller {\n        return new BookQueryCaller(this, params);\n    }\n}\n\nexport class BookQueryCaller extends QueryQueryCaller {\n    get path():string {return `book/${this.entity.name}`;}\n}\n","import {Query} from './query';\n\nexport class History extends Query {\n    get typeName(): string { return 'history';}\n    protected queryApiName = 'history';\n}\n","import { Entity } from './entity';\nimport { Action, ActionSubmitCaller } from './action';\nimport { Query } from './query';\nimport { Field } from './uqMan';\nimport { EntityCaller, QueryPageCaller, QueryQueryCaller } from './caller';\n\ninterface MapActions {\n    add: Action;\n    del: Action;\n}\ninterface MapQueries {\n    all: Query;\n    page: Query;\n    query: Query;\n}\n\nexport class Map extends Entity {\n    get typeName(): string { return 'map';}\n    keys: Field[];\n    actions: MapActions = {} as any;\n    queries: MapQueries = {} as any;\n    schemaFrom: {owner:string; uq:string};\n\n    setSchema(schema:any) {\n        super.setSchema(schema);\n        this.schemaFrom = this.schema.from;\n        let {actions, queries, keys} = schema;\n        this.uq.buildFieldTuid(this.keys = keys);\n        for (let i in actions) {\n            let actionSchema = actions[i];\n            let {name} = actionSchema;\n            let action = this.uq.newAction(name, undefined);\n            action.setSchema(actionSchema);\n            action.buildFieldsTuid();\n            (this.actions as any)[i] = action;\n        }\n        for (let i in queries) {\n            let querySchema = queries[i];\n            let {name} = querySchema;\n            let query = this.uq.newQuery(name, undefined);\n            query.setSchema(querySchema);\n            query.buildFieldsTuid();\n            (this.queries as any)[i] = query;\n        }\n    }\n\n    async add(param:any) {\n        let ret = await new AddCaller(this, param).request();\n        return ret;\n    }\n\n    async del(param:any) {\n        let ret = await new DelCaller(this, param).request();\n        return ret;\n    }\n\n    async all() {\n        let ret = await new AllCaller(this, undefined).request();\n        return ret;\n    }\n\n    async page(param:any, pageStart:any, pageSize: number) {\n        let ret = await new PageCaller(this, {pageStart:pageStart, pageSize:pageSize, param:param}).request();\n        return ret;\n    }\n\n    async query(param:any) {\n       let qc = new QueryCaller(this, param);\n       let ret = await qc.request();\n       return ret;\n   }\n    async table(params:any): Promise<any[]> {\n        let ret = await this.query(params);\n        for (let i in ret) {\n            return ret[i];\n        }\n    }\n    async obj(params:any):Promise<any> {\n        let ret = await this.table(params);\n        if (ret.length > 0) return ret[0];\n    }\n    async scalar(params:any):Promise<any> {\n        let ret = await this.obj(params);\n        for (let i in ret) return ret[i];\n    }\n}\n\nabstract class MapCaller extends EntityCaller<any> {\n    protected get entity(): Map {return this._entity as Map;}\n    get path():string {return undefined;}\n\n    protected abstract getCaller(param: any):EntityCaller<any>;\n\n    protected async innerCall(): Promise<any> {\n        let caller = this.getCaller(this.params);\n        let res = await this.entity.uqApi.xcall(caller);\n        let ret = caller.xresult(res.res);\n        return {res: ret};\n    }\n\n    buildParams() {\n        let p = super.buildParams();\n        return p;\n    }\n}\n\nclass AddCaller extends MapCaller {\n    protected getCaller(param:any):EntityCaller<any> {\n        return new MapAddCaller(this.entity, this.entity.actions.add, param);\n    }\n}\n\nclass DelCaller extends MapCaller {\n    protected getCaller(param:any):EntityCaller<any> {\n        return new MapDelCaller(this.entity, this.entity.actions.add, param);\n    }\n}\n\nclass AllCaller extends MapCaller {\n    protected getCaller(param:any):EntityCaller<any> {\n        return new MapAllCaller(this.entity, this.entity.queries.all, param);\n    }\n}\n\nclass PageCaller extends MapCaller {\n    protected getCaller(param:any):EntityCaller<any> {\n        return new MapPageCaller(this.entity, this.entity.queries.page, param);\n    }\n}\n\nclass QueryCaller extends MapCaller {\n    protected getCaller(param:any):EntityCaller<any> {\n        return new MapQueryCaller(this.entity, this.entity.queries.query, param);\n    }\n}\n\nclass MapAddCaller extends ActionSubmitCaller {\n    private map: Map;\n    constructor(map:Map, action:Action, params:any) {\n        super(action, params);\n        this.map = map;\n    }\n\n    get path():string {return `map/${this.map.name}/add`}\n    get headers(): {[header:string]: string} {return undefined;}\n}\n\nclass MapDelCaller extends ActionSubmitCaller {\n    private map: Map;\n    constructor(map:Map, action:Action, params:any) {\n        super(action, params);\n        this.map = map;\n    }\n\n    get path():string {return `map/${this.map.name}/del`}\n    get headers(): {[header:string]: string} {return undefined}\n}\n\nclass MapAllCaller extends QueryPageCaller {\n    private map: Map;\n    constructor(map:Map, query:Query, params:any) {\n        super(query, params);\n        this.map = map;\n    }\n\n    get path():string {return `map/${this.map.name}/all`}\n    get headers(): {[header:string]: string} {return undefined}\n}\n\nclass MapPageCaller extends QueryPageCaller {\n    private map: Map;\n    constructor(map:Map, query:Query, params:any) {\n        super(query, params);\n        this.map = map;\n    }\n\n    get path():string {return `map/${this.map.name}/page`}\n    get headers(): {[header:string]: string} {return undefined}\n}\n\nclass MapQueryCaller extends QueryQueryCaller {\n    private map: Map;\n    constructor(map:Map, query:Query, params:any) {\n        super(query, params);\n        this.map = map;\n    }\n\n    get path():string {return `map/${this.map.name}/query`}\n    get headers(): {[header:string]: string} {return undefined}\n}\n","import {Query} from './query';\n\nexport class Pending extends Query {\n    get typeName(): string { return 'pending';}\n    protected queryApiName = 'pending';\n}\n","import * as React from 'react';\nimport { IValuesView, IValuesViewRenderOptions } from '../../components';\nimport { Tag, TagValue } from './tag';\n\nconst radioStyle:React.CSSProperties = {height: 'auto'};\n\nexport class TagView implements IValuesView {\n\tprivate tag: Tag;\n\tconstructor(tag: Tag) {\n\t\tthis.tag = tag;\n\t}\n\trender(values: number|string):JSX.Element {\n\t\tlet names:string[];\n\t\tif (typeof values === 'number') {\n\t\t\tnames = [this.tag.nameFromId(values)];\n\t\t}\n\t\telse {\n\t\t\tnames = this.tag.namesFromIds(values);\n\t\t}\n\t\treturn <div className=\"d-flex flex-wrap \">{names.map((name, index)=>{\n\t\t\treturn <div key={index} className=\"mx-2 border border-muted rounded px-3 bg-light\">{name}</div>\n\t\t})}</div>;\n\t}\n\trenderRadios(value: number, options: IValuesViewRenderOptions): JSX.Element {\n        let content = this.tag.values.map((item,index) => {\n\t\t\treturn <div className=\"col\" key={index}>{this.renderRadio(item, value, options)}</div>;\n        });\n\t\treturn this.renderView(options, content);\n\t}\n\trenderChecks(values: string, options: IValuesViewRenderOptions): JSX.Element {\n\t\tlet arr = values===undefined? undefined : values.split('|').map(v => Number(v));\n\t\tlet content = this.tag.values.map((item,index) => {\n\t\t\tlet checked: boolean = arr===undefined? undefined : arr.indexOf(item.id)>=0;\n\t\t\treturn <div className=\"col\" key={index}>{this.renderCheck(item, checked, options)}</div>\n\t\t});\n\t\treturn this.renderView(options, content);\n\t}\n\tprivate renderView(options: IValuesViewRenderOptions, content:any) {\n\t\tlet {className, wrapClassName} = options;\n\t\twrapClassName = wrapClassName?\n\t\t\t'row ' + wrapClassName\n\t\t\t:\n\t\t\t'row row-cols-2 row-cols-sm-3 row-cols-md-4';\n\t\treturn <div className={className} style={radioStyle}>\n\t\t\t<div className={wrapClassName}>\n                {content}\n\t\t\t</div>\n        </div>;\n\t}\n\tprivate renderRadio(item:TagValue, value: number, options: IValuesViewRenderOptions):JSX.Element {\n\t\tlet {id, name} = item;\n\t\tlet {inputs, inputName, onInputChange} = options;\n\t\tlet ref = inputs && ((input:HTMLInputElement)=>inputs[id]=input);\n\t\treturn <label className=\"form-radio-inline\">\n\t\t\t<input ref={ref} type=\"radio\" name={inputName}\n\t\t\t\tvalue={id} defaultChecked={value===id}\n\t\t\t\tonChange={onInputChange} />\n\t\t\t{name}\n\t\t</label>;\n\t}\n\n\tprivate renderCheck(item:TagValue, checked: boolean, options: IValuesViewRenderOptions):JSX.Element {\n\t\tlet {id, name} = item;\n\t\tlet {inputs, onInputChange} = options;\n\t\tlet ref = inputs && ((input:HTMLInputElement)=>inputs[id]=input);\n\t\treturn <label className=\"form-radio-inline\">\n\t\t\t<input ref={ref} type=\"checkbox\"\n\t\t\t\tvalue={id} defaultChecked={checked}\n\t\t\t\tonChange={onInputChange} />\n\t\t\t{name}\n\t\t</label>;\n\t}\n}\n","import { Entity } from \"../entity\";\nimport { TagView } from \"./tagView\";\n\nexport interface TagValue {\n\tid: number;\n\tname: string;\n\text: string;\n}\n\nexport class Tag extends Entity {\n    get typeName(): string { return 'tag';}\n\tvalues: TagValue[];\n\tprivate coll: {[id:number]: TagValue} = {};\n\n\tprivate _view: TagView;\n\tget view(): TagView { \n\t\tif (this._view !== undefined) return this._view; \n\t\treturn this._view = new TagView(this);\n\t}\n\n\tnameFromId(id:number) {\n\t\tlet c = this.coll[id]; \n\t\treturn c===undefined? undefined : c.name;\n\t}\n\n\tnamesFromIds(ids:string):string[] {\n\t\tlet ret:string[] = [];\n\t\tfor (let id of ids.split('|')) {\n\t\t\tlet c = this.coll[Number(id)];\n\t\t\tlet name = c===undefined? undefined : c.name;\n\t\t\tif (name !== undefined) ret.push(name);\n\t\t}\n\t\treturn ret;\n\t}\n\n\tasync loadValues():Promise<TagValue[]> {\n\t\tif (this.values !== undefined) return this.values;\n\t\tthis.values = [];\n\t\tlet ret = await this.uqApi.get('tag/values/' + this.name);\n\t\tif (ret === undefined) return;\n\t\tlet lines = (ret as string).split('\\n');\n\t\tfor (let line of lines) {\n\t\t\tif (line.length === 0) continue;\n\t\t\tlet parts = line.split('\\t');\n\t\t\tlet id = Number(parts[0]);\n\t\t\tlet val = {\n\t\t\t\tid: id,\n\t\t\t\tname: parts[1],\n\t\t\t\text: parts[2],\n\t\t\t};\n\t\t\tthis.values.push(val);\n\t\t\tthis.coll[id] = val;\n\t\t}\n\t\treturn this.values;\n\t}\n}\n","export default __webpack_public_path__ + \"static/media/logo.103b5fa1.svg\";","import * as React from 'react';\nimport { nav, mobileRegex, emailRegex } from '../components';\nimport logo from '../img/logo.svg';\n//const logo = require('../img/logo.svg');\n\nexport function tonvaTop() {\n    return nav.loginTop(<div className=\"d-flex align-items-center position-relative\">\n        <img className=\"App-logo h-3c position-absolute\" src={logo} alt=\"img\" />\n        <div className=\"h3 flex-fill text-center\"><span className=\"text-primary mr-3\">同</span>\n            <span className=\"text-danger\">花</span>\n        </div>\n    </div>);\n}\n\ninterface Sender {\n    type: string;\n    caption: string;\n    regex: RegExp;\n}\n\nconst senders:Sender[] = [\n    {type:'mobile', caption:'手机号', regex: mobileRegex},\n    {type:'email', caption:'邮箱', regex: emailRegex}\n];\n\nexport function getSender(un: string):Sender {\n    let sender = senders.find(v => v.regex.test(un) === true);\n    return sender;\n}","export * from './page';\nexport * from './tabs';\nexport * from './scrollView';\nexport * from './pageHeader';","export * from './schema';\nexport * from './uiSchema';\nexport * from './toUiSelectItems';\nexport * from './IValuesView';","\nexport const mobileRegex = /^[0-9]*$/;\nexport const emailRegex = /\\w+([-+.]\\w+)*@\\w+([-.]\\w+)*\\.\\w+([-.]\\w+)*/;\n// /^([a-zA-Z0-9]+[_|\\_|\\.]?)*[a-zA-Z0-9]+@([a-zA-Z0-9]+[_|\\_|\\.]?)*[a-zA-Z0-9]+\\.[a-zA-Z]{2,3}$/\n\nexport const EmailFieldRule = (value:any): string|string[] => {\n    if (emailRegex.test(value as string) === false) return '电子邮件格式错误';\n}\n\nexport const MobileFieldRule = (value:any): string|string[] => {\n    if (emailRegex.test(value as string) === false) return '手机格式错误';\n}\n","import * as React from 'react';\nimport classNames from 'classnames';\n\nexport interface DropdownAction {\n    icon?: string;\n    caption?: string;\n\taction?: () => void;\n\ticonClass?: string;\n\tcaptionClass?: string;\n}\n\nexport interface DropdownActionsProps {\n    icon?: string;\n    actions: DropdownAction[];\n    isRight?: boolean;\n\tclassName?: string;\n\titemIconClass?: string;\n\titemCaptionClass?: string;\n}\n\nexport interface DropdownActionsState {\n    dropdownOpen: boolean;\n}\n\nexport class DropdownActions extends React.Component<DropdownActionsProps, DropdownActionsState> {\n    private menu: HTMLDivElement;\n    private button: HTMLElement;\n    constructor(props:DropdownActionsProps) {\n        super(props);\n        this.state = {\n            dropdownOpen: false\n        };\n    }\n\n    componentDidMount() {\n        document.addEventListener('click', this.handleDocumentClick);\n        document.addEventListener('touchstart', this.handleDocumentClick);\n    }\n\n    componentWillUnmount() {\n        document.removeEventListener('click', this.handleDocumentClick);\n        document.removeEventListener('touchstart', this.handleDocumentClick);\n    }\n\n    private handleDocumentClick = (evt:any) => {\n        if (this.state.dropdownOpen === false) return;\n        if (this.button && this.button.contains(evt.target)) return;\n        if (!this.menu) return;\n        //if (!this.menu.contains(evt.target)) \n        this.toggle();\n    }\n\n    private toggle = () => {\n        this.setState({\n            dropdownOpen: !this.state.dropdownOpen\n        });\n    }\n\n    render() {\n        let {icon, actions, isRight, className, itemIconClass, itemCaptionClass} = this.props;\n        if (isRight === undefined) isRight = true;\n        let hasIcon = actions.some(v => v.icon!==undefined);\n        let {dropdownOpen} = this.state;\n\t\t//isOpen={this.state.dropdownOpen} toggle={this.toggle}\n\t\tlet cn = className || 'cursor-pointer dropdown-toggle btn btn-sm';\n\t\t//if (className) cn += className;\n        return <div className={'dropdown'}>\n\t\t\t<button ref={v=>this.button=v} \n\t\t\t\tclassName={cn}\n                data-toggle=\"dropdown\"\n                aria-expanded={dropdownOpen}\n                onClick={this.toggle}>\n                <i className={classNames('fa fa-fw ', 'fa-'+(icon||'ellipsis-v'))} />\n            </button>\n            <div ref={v => this.menu=v} className={classNames({\"dropdown-menu\":true, \"dropdown-menu-right\":isRight, \"show\":dropdownOpen})}>\n                {\n                    actions.map((v,index) => {\n\t\t\t\t\t\tif (!v) {\n                            return <div className=\"dropdown-divider\" key={index}/>;\n\t\t\t\t\t\t}\n                        let {icon, caption, action, iconClass, captionClass} = v;\n                        if (icon === undefined && caption === undefined) \n                            return <div className=\"dropdown-divider\" />;\n                        let i:any;\n                        if (hasIcon === true) {\n                            if (icon !== undefined) icon = 'fa-' + icon;\n\t\t\t\t\t\t\ti = <i className={classNames('mr-2', 'fa', icon, 'fa-fw', iconClass || itemIconClass)}\n\t\t\t\t\t\t\t\taria-hidden={true}></i>;\n                        }\n                        if (action === undefined) \n                            return <h6 className=\"dropdown-header\">{i} {caption}</h6>;\n                        let onMenuItemClick = (evt:React.MouseEvent<HTMLAnchorElement>)=>{\n                            evt.preventDefault();\n                            action();\n                        }\n                        let onTouchStart = (evt: React.TouchEvent<HTMLAnchorElement>) => {\n                            action();\n                        }\n                            // eslint-disable-next-line\n                        return <a className=\"dropdown-item\" key={index} href=\"#/\" \n                            onClick={onMenuItemClick} onTouchStart={onTouchStart}\n                            >{i} <span className={captionClass || itemCaptionClass}>{caption}</span></a>\n                    })\n                }\n            </div>\n        </div>\n    }\n}\n","import * as React from 'react';\nimport { setRes } from '../../components';\n\nexport interface EasyDateProps {\n    date: Date | number;\n}\n\n//type YMD = (year:number, month:number, date:number) => string;\n//type MD = (month:number, date:number) => string;\n\nconst timeRes:{[prop:string]:any} = {\n\tmd: (month:number, date:number) => `${month}-${date}`,\n\tymd: (year:number, month:number, date:number) => `${year}-${month}-${date}`,\n\tyesterday: 'Yday',\n\ttoday: 'Today',\n\ttomorrow: 'Tmw',\n\t$zh: {\n\t\tmd: (month:number, date:number) => `${month}月${date}日`,\n\t\tymd: (year:number, month:number, date:number) => `${year}年${month}月${date}日`,\n\t\tyesterday: '昨天',\n\t\ttoday: '今天',\n\t\ttomorrow: '明天',\n\t},\n\t$en: {\n\t\tmd: (month:number, date:number) => `${month}-${date}`,\n\t\tymd: (year:number, month:number, date:number) => `${year}-${month}-${date}`,\n\t\tyesterday: 'Yday',\n\t\ttoday: 'Today',\n\t\ttomorrow: 'Tmw',\n\t}\n}\n\nsetRes(timeRes, timeRes);\n\nfunction tt(str:string):any {\n\treturn timeRes[str];\n}\n\nfunction renderDate(vDate:Date|number, withTime:boolean, always:boolean = false) {\n    if (!vDate) return null;\n    let date: Date;\n    switch (typeof vDate) {\n        default: date = vDate as Date; break;\n        case 'string': date = new Date(vDate); break;\n        case 'number': date = new Date((vDate as number)*1000); break;\n    }\n\n    let now = new Date();\n    let tick:number, nDate:number, _date:number, month:number, year:number, nowYear:number;\n    let d = date;\n    tick = now.getTime() - d.getTime();\n    let hour=d.getHours(), minute=d.getMinutes();\n    nDate=now.getDate();\n    _date=d.getDate();\n    month=d.getMonth()+1;\n    year=d.getFullYear();\n\tnowYear = now.getFullYear();\n\n\tlet appendTime:boolean = false;\n\tlet dPart:string = (function() {\n\t\tif (tick < -24*3600*1000) {\n\t\t\tif (year === nowYear) {\n\t\t\t\tappendTime = true;\n\t\t\t\treturn tt('md')(month, _date);\n\t\t\t}\n\t\t\telse {\n\t\t\t\tappendTime = true;\n\t\t\t\treturn tt('ymd')(year, month, _date);\n\t\t\t}\n\t\t}\n\t\tif (tick < 24*3600*1000) {\n\t\t\tif (_date!==nDate) {\n\t\t\t\tappendTime = true;\n\t\t\t\treturn tt(tick < 0? 'tomorrow' : 'yesterday');\n\t\t\t}\n\t\t\tif (withTime===true) {\n\t\t\t\tappendTime = true;\n\t\t\t\treturn '';\n\t\t\t}\n\t\t\treturn tt('today');\n\t\t}\n\t\tif (year === nowYear) {\n\t\t\treturn tt('md')(month, _date);\n\t\t}\n\t\treturn tt('ymd')(year, month, _date);\n\t})();\n\n\tlet hm = hour + ((minute<10?':0':':') + minute);\n\n\t/*\n    if (tick < -24*3600*1000) {\n        if (year === nowYear)\n            return tt('md')(month, _date) + ' ' + hm;\n        else\n            return tt('ymd')(year, month, _date) + ' ' + hm;\n    }\n    if (always === true || tick < 24*3600*1000) {\n        return _date!==nDate? \n            tt(tick < 0? 'tomorrow' : 'yesterday') + ' ' + hm \n            : withTime===true? hm : tt('today');\n    }\n    if (year === nowYear) {\n        return tt('md')(month, _date);\n    }\n\treturn tt('ymd')(year, month, _date);\n\t*/\n\tif (appendTime === true || always === true) {\n\t\treturn dPart + ' ' + hm;\n\t}\n\treturn dPart;\n}\n\n\nexport class EasyDate extends React.Component<EasyDateProps> {\n    render() {\n        return renderDate(this.props.date, false);\n    }\n}\n\ninterface EasyTimeProps extends EasyDateProps {\n\talways?: boolean;\n}\nexport class EasyTime extends React.Component<EasyTimeProps> {\n    render() {\n\t\tlet {date, always} = this.props;\n        return renderDate(date, true, always);\n    }\n}\n","import * as React from 'react';\nimport classNames from 'classnames';\nimport { Image } from '.';\n\nexport interface MediaProps {\n    icon: string;\n    main: string|JSX.Element;\n    discription?: string | JSX.Element;\n    px?: number;\n    py?: number;\n}\n\nexport class Media extends React.Component<MediaProps> {\n    render() {\n        let {icon, main, discription, px, py} = this.props;\n        let disp:any;\n        if (typeof discription === 'string')\n            disp = <div>{discription}</div>;\n        else\n            disp = discription;\n        let cn = classNames(\n            'media', \n            px===undefined? 'px-0':'px-'+px, \n            py===undefined? 'py-2':'py-'+py);\n        return <div className={cn}>\n            <Image className=\"mr-3 w-4c h-4c\" src={icon} />\n            <div className=\"media-body\">\n                <h5 className=\"mt-0\">{main}</h5>\n                {disp}\n            </div>\n        </div>\n    }\n}\n","import * as React from 'react';\nimport classNames from 'classnames';\nimport { observable } from 'mobx';\n\nexport interface SearchBoxProps {\n    className?: string;\n    label?: string;\n    initKey?: string;\n    placeholder?: string;\n    buttonText?: string;\n    maxLength?: number;\n    size?: 'sm' | 'md' | 'lg';\n    inputClassName?: string;\n    onSearch: (key:string)=>Promise<void>;\n    onFocus?: ()=>void;\n    allowEmptySearch?: boolean;\n}\n\n/*\nexport interface SearchBoxState {\n    disabled: boolean;\n}*/\n\nexport class SearchBox extends React.Component<SearchBoxProps> { //}, SearchBoxState> {\n    private input: HTMLInputElement;\n    private key: string = null;\n    @observable private disabled: boolean;\n\n    private onChange = (evt: React.ChangeEvent<any>) => {\n        this.key = evt.target.value;\n        if (this.key !== undefined) {\n            this.key = this.key.trim();\n            if (this.key === '') this.key = undefined;\n        }\n        if (this.props.allowEmptySearch !== true) {\n            this.disabled = !this.key;\n        }\n    }\n    private onSubmit = async (evt: React.FormEvent<any>) => {\n        evt.preventDefault();\n        if (this.key === null) this.key = this.props.initKey || '';\n        if (this.props.allowEmptySearch !== true) {\n            if (!this.key) return;\n            if (this.input) this.input.disabled = true;\n        }\n        await this.props.onSearch(this.key);\n        if (this.input) this.input.disabled = false;\n    }\n    clear() {\n        if (this.input) this.input.value = '';\n    }\n    render() {\n        let {className, inputClassName, onFocus,\n            label, placeholder, buttonText, maxLength, size} = this.props;\n        let inputSize:string;\n        switch (size) {\n            default:\n            case 'sm': inputSize = 'input-group-sm'; break;\n            case 'md': inputSize = 'input-group-md'; break;\n            case 'lg': inputSize = 'input-group-lg'; break;\n        }\n        return <form className={className} onSubmit={this.onSubmit} >\n            <div className={classNames(\"input-group\", inputSize)}>\n                {label && <div className=\"input-group-addon align-self-center mr-2\">{label}</div>}\n                <input ref={v=>this.input=v} onChange={this.onChange}\n                    type=\"text\"\n                    name=\"key\"\n                    onFocus={onFocus}\n                    className={classNames('form-control', inputClassName || 'border-primary')}\n                    placeholder={placeholder}\n                    defaultValue={this.props.initKey}\n                    maxLength={maxLength} />\n                <div className=\"input-group-append\">\n                    <button className=\"btn btn-primary\"\n                        type=\"submit\"\n                        disabled={this.disabled}>\n                        <i className='fa fa-search' />\n                        <i className=\"fa\"/>\n                        {buttonText}\n                    </button>\n                </div>\n            </div>\n        </form>;\n    }\n}\n","import * as React from 'react';\nimport classNames from 'classnames';\nimport { nav } from './nav';\nimport { observer } from 'mobx-react';\nimport { observable } from 'mobx';\nimport { userApi } from '../net';\nimport { User } from '../tool';\nimport _ from 'lodash';\n\nexport type UserLoader = (userId:number)=>Promise<any>;\n\nexport class UserCache<T> {\n\tprivate loader: UserLoader;\n\tprivate onLoaded: (user:User) => void;\n\tprivate map = observable(new Map<number, T|number>());\n\n\tconstructor(loader: UserLoader) {\n\t\tif (loader === undefined) loader = (userId:number)=>userApi.user(userId);\n\t\tthis.loader = loader;\n\t}\n\n\tuse(id:number|any, onLoaded?:(user:User)=>void) {\t\t\n\t\tif (!id) return;\n\t\tif (typeof id === 'object') id = id.id;\n\t\tif (!id) return;\n\t\tthis.onLoaded = onLoaded;\n\t\tid = Number(id);\n\t\tlet ret = this.map.get(id);\n\t\tif (ret === undefined) {\n\t\t\tthis.map.set(id, id);\n\t\t}\n\t}\n\n\tgetValue(id:number|any):any {\n\t\tif (!id) return;\n\t\tswitch (typeof(id)) {\n\t\t\tcase 'object': \n\t\t\t\tid = id.id; \n\t\t\t\tif (!id) return;\n\t\t\t\tbreak;\n\t\t}\n\t\tlet ret = this.map.get(id);\n\t\tif (!ret) return;\n\t\tswitch (typeof(ret)) {\n\t\tdefault:\n\t\t\treturn ret;\n\t\tcase 'number':\n\t\t\tif (ret < 0) return id;\n\t\t\tthis.map.set(id, -id);\n\t\t\tthis.loader(id).then(v => {\n\t\t\t\tif (!v) v = null;\n\t\t\t\tthis.map.set(id, v);\n\t\t\t\tif (this.onLoaded) this.onLoaded(v);\n\t\t\t}).catch(reason => {\n\t\t\t\tconsole.error(reason);\n\t\t\t});\n\t\t\treturn id;\n\t\t}\n\t}\n}\n\nconst userCache = new UserCache(undefined);\n\nexport interface UserIconProps {\n    id: number;\n    className?: string;\n    style?: React.CSSProperties;\n    altImage?: string;\n    noneImage?: any;\n}\n\nexport const UserIcon = observer((props: UserIconProps):JSX.Element => {\n    let {className, style, id, altImage, noneImage} = props;\n    let user = userCache.getValue(id);\n    switch (typeof user) {\n\tcase 'undefined':\n\tcase 'number':\n        return <div className={classNames(className, 'image-none')} style={style}>\n            {noneImage || <i className=\"fa fa-file-o\" />}\n        </div>;\n    }\n    let {icon} = user;\n    if (!icon) {\n        return <div className={classNames(className, 'image-none')} style={style}>\n            <i className=\"fa fa-file-o\" />\n        </div>;\n    }\n    if (_.startsWith(icon, ':') === true) {\n        icon = nav.resUrl + icon.substr(1);\n    }\n    return <img src={icon} className={className} alt=\"img\"\n        style={style}\n        onError={evt=>{\n            if (altImage) evt.currentTarget.src=altImage;\n            else evt.currentTarget.src = 'https://tv.jkchemical.com/imgs/0001.png';\n        }} />;\n});\n\nexport interface UserViewProps {\n\tid?: number;\n\tuser?: number|User;\n\trender: (user:User) => JSX.Element;\n\tonLoaded?: (user:User) => void\n}\n\nexport const UserView = observer((props: UserViewProps):JSX.Element => {\n\tlet {id:idProp, user, render, onLoaded} = props;\n\tif (user === null) return <>null</>;\n\tswitch (typeof user) {\n\t\tcase 'undefined': \n\t\t\tuser = userCache.getValue(idProp);\n\t\t\tbreak;\n\t\tcase 'object': \n\t\t\tlet {/*obj, */id} = user as any;\n\t\t\t//if (typeof obj !== 'object') {\n\t\t\t\tuseUser(id, onLoaded);\n\t\t\t\tuser = userCache.getValue(id);\n\t\t\t//}\n\t\t\tbreak;\n\t\tcase 'number':\n\t\t\tuseUser(user as number, onLoaded);\n\t\t\tuser = userCache.getValue(user as number);\n\t\t\tbreak;\n\t\tcase 'string':\n\t\t\tuseUser(Number(user), onLoaded);\n\t\t\tuser = userCache.getValue(Number(user));\n\t\t\tbreak;\n\t\tdefault:\n\t\t\tuser = undefined;\n\t\t\tbreak;\n\t}\n    switch (typeof user) {\n\t\tcase 'undefined':\n\t\tcase 'number':\n        \treturn <>{user}</>;\n    }\n    return render(user);\n});\n\nexport function useUser(id: number|object, onLoaded?: (user:User)=>void) {\n\tif (!id) return;\n\tif (typeof(id) === 'object') {\n\t\tid = (id as any).id;\n\t}\n\tuserCache.use(id, onLoaded);\n}\n","import React from \"react\";\r\nimport classNames from 'classnames';\r\nimport { nav } from \"../nav\";\r\n\r\nexport interface AxProps extends React.DetailedHTMLProps<React.AnchorHTMLAttributes<HTMLAnchorElement>, HTMLAnchorElement> {\r\n\t//children: React.ReactNode;\r\n\t//href: string;\r\n\t//onClick?: (event:React.MouseEvent) => void;\r\n\t//className?: string;\r\n\taClassName?: string;\r\n\tnaClassName?: string;\r\n\t//target?: string;\r\n\t//props?: any;\r\n}\r\n\r\n// 如果是web方式，用webNav方式route网页\r\n// 如果是app方式，用click方式压栈页面\r\nexport const Ax = (axProps: AxProps) => {\r\n\tlet {href, children, className, onClick} = axProps;\r\n\tif (nav.isWebNav === true) {\r\n\t\tlet {aClassName } = axProps;\r\n\t\tif (!href) return <span className=\"text-danger\">Error: href not defined in Ax</span>;\r\n\t\tlet onAxClick = (evt: React.MouseEvent<HTMLAnchorElement>) => {\r\n\t\t\tevt.preventDefault();\r\n\t\t\tlet ret:boolean;\r\n\t\t\tif (onClick) {\r\n\t\t\t\tret = onClick(evt) as unknown as boolean;\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tnav.navigate(href);\r\n\t\t\t\tret = false;\r\n\t\t\t}\r\n\t\t\treturn ret;\r\n\t\t}\r\n\t\treturn <a {...axProps} className={classNames(className, aClassName)} onClick={onAxClick}>{children}</a>;\r\n\t}\r\n\telse {\r\n\t\tlet {naClassName} = axProps;\r\n\t\tif (!onClick) {\r\n\t\t\tonClick = () => {\r\n\t\t\t\tnav.navigate(href);\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn <span className={classNames(className, 'cursor-pointer', naClassName)} onClick={onClick}>{children}</span>;\r\n\t}\r\n}\r\n\r\n// 同普通的a tag\r\n// 会自动处理href，处理生产版跟测试版之间的不同\r\nexport const A = (props: React.DetailedHTMLProps<React.AnchorHTMLAttributes<HTMLAnchorElement>, HTMLAnchorElement>) => {\r\n\tlet {children} = props;\r\n\tif (nav.isWebNav === false) {\r\n\t\treturn <a {...props}>{children}</a>;\r\n\t}\r\n\tlet {href} = props;\r\n\t//if (nav.testing === true) href += '#test';\r\n\tlet onClick = (evt: React.MouseEvent<HTMLAnchorElement>) => {\r\n\t\tevt.preventDefault();\r\n\t\tnav.navigate(href);\r\n\t\treturn false;\r\n\t}\r\n\treturn <a {...props} href={href} onClick={onClick}>{children}</a>;\r\n}\r\n","import React from 'react';\r\nimport { observer } from \"mobx-react\";\r\nimport { IObservableValue } from 'mobx';\r\n\r\n//export function autoHideTips(visible: IObservableValue<boolean>, tips:string|JSX.Element, timeout?:number):React.FunctionComponentElement<any>;\r\n//export function autoHideTips(tips: IObservableValue<string>, tips:string|JSX.Element, timeout?:number):React.FunctionComponentElement<any>;\r\n\r\nexport function autoHideTips(\r\n\ttips: IObservableValue<boolean|string|JSX.Element>, \r\n\ttemplet?:string|JSX.Element|((v:string|JSX.Element)=>JSX.Element), \r\n\ttimeout?:number):React.FunctionComponentElement<any> {\r\n/*\r\nexport function autoHideTips(tips: IObservableValue<boolean|string|JSX.Element>, timeout?:number):React.FunctionComponentElement<any>;\r\nexport function autoHideTips(tips: IObservableValue<boolean|string|JSX.Element>, templet:(tips: boolean|string|JSX.Element) => JSX.Element, timeout?:number):React.FunctionComponentElement<any>;\r\n\r\nexport function autoHideTips(tips: IObservableValue<boolean|string|JSX.Element>, ...params:any[]) {\r\n*/\r\n\tlet timer:any;\r\n\treturn React.createElement(observer(():JSX.Element => {\r\n\t\tif (timer) {\r\n\t\t\tclearTimeout(timer);\r\n\t\t\ttimer = undefined;\r\n\t\t}\r\n\t\tlet t = tips.get();\r\n\t\tif (!t) return null;\r\n\t\tif (timeout === undefined) timeout = 3000;\r\n\t\t//let p0 = params[0];\r\n\t\t//let timeout = 3000;\r\n\t\t//let templet: (tips: boolean|string|JSX.Element) => JSX.Element;\r\n\t\t/*\r\n\t\tswitch (typeof p0) {\r\n\t\t\tcase 'number':\r\n\t\t\t\ttimeout = p0;\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'function':\r\n\t\t\t\ttemplet = p0;\r\n\t\t\t\tlet p1 = params[1];\r\n\t\t\t\tif (typeof p1 === 'number') {\r\n\t\t\t\t\ttimeout = p1;\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t\t*/\r\n\r\n\t\tif (timeout > 0) {\r\n\t\t\ttimer = setTimeout(() => {\r\n\t\t\t\ttips.set(null);\r\n\t\t\t}, timeout);\r\n\t\t}\r\n\t\tswitch (typeof templet) {\r\n\t\t\tcase 'undefined': return <>{t}</>;\r\n\t\t\tcase 'function': return templet(t as string);\r\n\t\t\tcase 'string': return <>{templet}</>;\r\n\t\t\tdefault: return templet;\r\n\t\t}\r\n\t}));\r\n};\r\n","import { UqMan, TuidModify } from '../uqMan';\nimport { Tuid } from \"./tuid\";\nimport { env } from '../../tool';\n\ninterface Modify {\n    id: number;\n    entity: string;\n    key: string;\n}\n\nexport class TuidsCache {\n    private readonly uq: UqMan;\n    private modifyMax: TuidModify;\n    private cacheTimer: any;\n    constructor(uq: UqMan) {\n        this.uq = uq;\n    }\n\n    cacheTuids(defer:number) {\n        this.clearCacheTimer();\n        this.cacheTimer = env.setTimeout('TuidsCache.cacheTuids', this.loadIds, defer);\n    }\n    private clearCacheTimer() {\n        if (this.cacheTimer === undefined) return;\n        env.clearTimeout(this.cacheTimer);\n        this.cacheTimer = undefined;\n    }\n    private loadIds = () => {\n        this.clearCacheTimer();\n        let {tuids} = this.uq;\n        for (let i in tuids) {\n            let tuid = tuids[i];\n            tuid.cacheIds();\n        }\n    }\n    \n    pullModify(modifyMax:number) {\n        if (modifyMax === undefined) return;\n        let now = Math.floor(Date.now() / 1000);\n        if (this.modifyMax === undefined) {\n            this.modifyMax = this.uq.localModifyMax.get();\n            if (this.modifyMax === undefined) {\n                this.modifyMax = {\n                    max: modifyMax,\n                    seconds: now,\n                };\n                this.uq.localModifyMax.set(this.modifyMax);\n            }\n        }\n        let {max, seconds} = this.modifyMax;\n        let lockGap = 3600;\n        if (now - seconds < lockGap) return;\n        if (modifyMax <= max) return;\n        let tuidCached:string[] = [];\n        let {tuids} = this.uq;\n        for (let i in tuids) {\n            //if (tuids[i].cached === true) \n            tuidCached.push(i);\n        }\n        if (tuidCached.length === 0) return;\n        this.modifyMax.seconds = now;\n        this.innerPullModify(tuidCached.join('\\t'));\n    }\n\n    private async innerPullModify(tuidLists:string):Promise<void> {\n        let {uqApi, tuids} = this.uq;\n        let {max} = this.modifyMax;\n        let ret:{queue:Modify[], queueMax:number} = await uqApi.queueModify(max, 30, tuidLists);\n        let group:{[entity:string]: {tuid:Tuid; ids: string[]}} = {};\n        let modifyMax:number = 0;\n        for (let modify of ret.queue) {\n\t\t\tlet {id, entity, key} = modify;\n\t\t\tif (!key) continue;\n            let tuid = tuids[entity];\n            if (tuid === undefined) continue;\n            let item = group[entity];\n            if (item === undefined) {\n                item = group[entity] = {tuid: tuid, ids:[]};\n            }\n            item.ids.push(key);\n            if (id > modifyMax) modifyMax = id;\n        }\n        for (let i in group) {\n            let {tuid, ids} = group[i];\n            await tuid.modifyIds(ids);\n        }\n        let now = Math.floor(Date.now() / 1000);\n        this.modifyMax = {\n            max: modifyMax,\n            seconds: now,\n        }\n        this.uq.localModifyMax.set(this.modifyMax);\n    }\n}\n","import { LocalMap, LocalCache, env } from '../tool';\r\nimport { UqData, UqAppData, loadAppUqs } from '../net';\r\nimport { UqMan } from './uqMan';\r\nimport { TuidImport, TuidInner } from './tuid';\r\nimport { nav } from '../components';\r\n\r\nexport interface TVs {\r\n    [uqName:string]: {\r\n        [tuidName: string]: (values: any) => JSX.Element;\r\n    }\r\n}\r\n\r\nexport class UQsMan {\r\n\tstatic _uqs: any;\r\n\tstatic value: UQsMan;\r\n\tstatic errors: string[];\r\n\r\n\tstatic async load(tonvaAppName:string, version:string, tvs:TVs) {\r\n\t\tlet uqsMan = UQsMan.value = new UQsMan(tonvaAppName, tvs);\r\n        let {appOwner, appName} = uqsMan;\r\n        let {localData} = uqsMan;\r\n        let uqAppData:UqAppData = localData.get();\r\n        if (!uqAppData || uqAppData.version !== version) {\r\n\t\t\tuqAppData = await loadAppUqs(appOwner, appName);\r\n\t\t\tif (!uqAppData.id) {\r\n\t\t\t\treturn [\r\n\t\t\t\t\t`${appOwner}/${appName}不存在。请仔细检查app全名。`\r\n\t\t\t\t];\r\n\t\t\t}\r\n            uqAppData.version = version;\r\n            localData.set(uqAppData);\r\n            // \r\n            for (let uq of uqAppData.uqs) uq.newVersion = true;\r\n        }\r\n        let {id, uqs} = uqAppData;\r\n        uqsMan.id = id;\r\n        await uqsMan.init(uqs);\r\n        let retErrors = await uqsMan.load();\r\n        if (retErrors.length === 0) {\r\n            retErrors.push(...uqsMan.setTuidImportsLocal());\r\n            if (retErrors.length === 0) {\r\n                UQsMan._uqs = uqsMan.buildUQs();\r\n                return;\r\n            }\r\n        }\r\n        UQsMan.errors = retErrors;\r\n\t}\r\n\r\n    private collection: {[uqName: string]: UqMan};\r\n    private readonly tvs: TVs;\r\n\r\n    readonly name: string;\r\n    readonly appOwner: string;\r\n    readonly appName: string;\r\n    readonly localMap: LocalMap;\r\n    readonly localData: LocalCache;\r\n    id: number;\r\n\r\n    private constructor(tonvaAppName:string, tvs:TVs) {\r\n        this.tvs = tvs || {};\r\n        this.buildTVs();\r\n        this.collection = {};\r\n        let parts = tonvaAppName.split('/');\r\n        if (parts.length !== 2) {\r\n            throw new Error('tonvaApp name must be / separated, owner/app');\r\n        }\r\n        this.appOwner = parts[0];\r\n        this.appName = parts[1];\r\n        this.localMap = env.localDb.map(tonvaAppName);\r\n        this.localData = this.localMap.child('uqData');\r\n    }\r\n\r\n    // to be removed in the future\r\n    addUq(uq: UqMan) {\r\n        this.collection[uq.name] = uq;\r\n    }\r\n\r\n    private buildTVs() {\r\n        for (let i in this.tvs) {\r\n            let uqTVs = this.tvs[i];\r\n            if (uqTVs === undefined) continue;\r\n            let l = i.toLowerCase();\r\n            if (l === i) continue;\r\n            this.tvs[l] = uqTVs;\r\n            for (let j in uqTVs) {\r\n                let en = uqTVs[j];\r\n                if (en === undefined) continue;\r\n                let lj = j.toLowerCase();\r\n                if (lj === j) continue;\r\n                uqTVs[lj] = en;\r\n            }\r\n        }\r\n    }\r\n\r\n    async init(uqsData:UqData[]):Promise<void> {\r\n        let promiseInits: PromiseLike<void>[] = uqsData.map(uqData => {\r\n\t\t\tlet {uqOwner, uqName} = uqData;\r\n\t\t\tlet uqFullName = uqOwner + '/' + uqName;\r\n\t\t\t//let uqUI = this.ui.uqs[uqFullName] as UqUI || {};\r\n\t\t\t//let cUq = this.newCUq(uqData, uqUI);\r\n\t\t\t//this.cUqCollection[uqFullName] = cUq;\r\n\t\t\t//this.uqs.addUq(cUq.uq);\r\n\t\t\tlet uq = new UqMan(this, uqData, undefined, this.tvs[uqFullName] || this.tvs[uqName]);\r\n\t\t\tthis.collection[uqFullName] = uq;\r\n\t\t\tlet lower = uqFullName.toLowerCase();\r\n\t\t\tif (lower !== uqFullName) {\r\n\t\t\t\tthis.collection[lower] = uq;\r\n\t\t\t}\r\n\t\t\treturn uq.init();\r\n\t\t});\r\n        await Promise.all(promiseInits);\r\n    }\r\n\r\n    async load(): Promise<string[]> {\r\n        let retErrors:string[] = [];\r\n        let promises: PromiseLike<string>[] = [];\r\n        for (let i in this.collection) {\r\n            let uq = this.collection[i];\r\n            promises.push(uq.loadEntities());\r\n\t\t}\r\n        let results = await Promise.all(promises);\r\n        for (let result of results)\r\n        {\r\n            let retError = result; // await cUq.loadSchema();\r\n            if (retError !== undefined) {\r\n                retErrors.push(retError);\r\n                continue;\r\n            }\r\n\t\t}\r\n        return retErrors;\r\n    }\r\n\r\n    buildUQs(): any {\r\n        let that = this;\r\n        let uqs:any = {};\r\n        for (let i in this.collection) {\r\n            let uqMan = this.collection[i];\r\n            //let n = uqMan.name;\r\n            let uqName = uqMan.uqName;\r\n            let l = uqName.toLowerCase();\r\n            let entities = uqMan.entities;\r\n            let keys = Object.keys(entities);\r\n            for (let key of keys) {\r\n                let entity = entities[key];\r\n                let {name} = entity;\r\n                //if (name !== sName) \r\n                //entities[sName] = entity;\r\n                entities[name.toLowerCase()] = entity;\r\n            }\r\n            //uqs[i] = entities;\r\n            //uqs[uqName] = entities;\r\n            //if (l !== uqName) \r\n            uqs[l] = new Proxy(entities, {\r\n                get: function(target, key, receiver) {\r\n                    let lk = (key as string).toLowerCase();\r\n                    let ret = target[lk];\r\n                    if (ret !== undefined) return ret;\r\n\t\t\t\t\tdebugger;\r\n\t\t\t\t\tlet err = `entity ${uqName}.${String(key)} not defined`;\r\n                    console.error(err);\r\n                    that.showReload('UQ错误：' + err);\r\n                    return undefined;\r\n                }\r\n            });\r\n        }\r\n        //let uqs = this.collection;\r\n        return new Proxy(uqs, {\r\n            get: function (target, key, receiver) {\r\n                let lk = (key as string).toLowerCase();\r\n                let ret = target[lk];\r\n                if (ret !== undefined) return ret;\r\n                /*\r\n                for (let i in uqs) {\r\n                    if (i.toLowerCase() === lk) {\r\n                        return uqs[i];\r\n                    }\r\n                }*/\r\n                debugger;\r\n                console.error('error in uqs');\r\n                that.showReload(`代码错误：新增 uq ${String(key)}`);\r\n                return undefined;\r\n            },\r\n        });\r\n    }\r\n\r\n    private showReload(msg: string) {\r\n        this.localMap.removeAll();\r\n        nav.showReloadPage(msg);\r\n    }\r\n\r\n    setTuidImportsLocal():string[] {\r\n        let ret:string[] = [];\r\n        for (let i in this.collection) {\r\n            let uq = this.collection[i];\r\n            for (let tuid of uq.tuidArr) {\r\n                if (tuid.isImport === true) {\r\n                    let error = this.setInner(tuid as TuidImport);\r\n                    if (error) ret.push(error);\r\n                }\r\n            }\r\n        }\r\n        return ret;\r\n    }\r\n\r\n    private setInner(tuidImport: TuidImport):string {\r\n        let {from} = tuidImport;\r\n        let fromName = from.owner + '/' + from.uq;\r\n        let uq = this.collection[fromName];\r\n        if (uq === undefined) {\r\n            //debugger;\r\n            return `setInner(tuidImport: TuidImport): uq ${fromName} is not loaded`;\r\n        }\r\n        let iName = tuidImport.name\r\n        let tuid = uq.tuid(iName);\r\n        if (tuid === undefined) {\r\n            //debugger;\r\n            return `setInner(tuidImport: TuidImport): uq ${fromName} has no Tuid ${iName}`;\r\n        }\r\n        if (tuid.isImport === true) {\r\n            //debugger;\r\n            return `setInner(tuidImport: TuidImport): uq ${fromName} Tuid ${iName} is import`;\r\n        }\r\n        tuidImport.setFrom(tuid as TuidInner);\r\n    }\r\n}\r\n","import _ from 'lodash';\nimport { Context } from '../context';\nimport { FormRes } from '../../../res/formRes';\n\nexport abstract class Rule {\n    abstract check(defy:string[], value:any):void;\n}\n\nexport type ContextRule = (context:Context)=>{[target:string]:string[]|string} | string[] | string;\nexport type FieldRule = (value:any) => string[] | string;\n\nexport class RuleCustom extends Rule {\n    private func: FieldRule;\n    constructor(func: FieldRule) {\n        super();\n        this.func = func;\n    }\n    check(defy:string[], value:any) {\n        let ret = this.func(value);\n        if (ret === undefined) return;\n        switch (typeof ret) {\n            case 'undefined': return;\n            case 'string': defy.push(ret as string); return;\n            default: defy.push(...ret); return;\n        }        \n    }\n}\n\nexport abstract class RulePredefined extends Rule {\n    protected res: FormRes;\n    constructor(res: FormRes) {\n        super();\n        this.res = res;\n    }\n}\n\nexport class RuleRequired extends RulePredefined {\n    check(defy:string[], value:any) {\n        switch (typeof value) {\n            default:\n            case 'boolean': return;\n            case 'object':\n                if (value !== null) return;\n                break;\n            case 'string':\n                if ((value as string).trim().length > 0) return;\n                break;\n            case 'number':\n                if (isNaN(value as number) === false) return;\n                break;\n            case 'undefined':\n                break;\n        }\n        defy.push(this.res.required);\n    }\n}\n\nexport class RuleNum extends RulePredefined {\n    private minMsg: _.TemplateExecutor;\n    private maxMsg: _.TemplateExecutor;\n    protected min: number;\n    protected max: number\n    constructor(res: FormRes, min?: number, max?: number) {\n        super(res);\n        this.minMsg = _.template(res.min);\n        this.maxMsg = _.template(res.max);\n        this.min = min;\n        this.max = max;\n    }\n    check(defy:string[], value:any) {\n        if (value === undefined || value === null) return;\n        let n = Number(value);\n        if (isNaN(n) === true) {\n            defy.push(this.res.number);\n        }\n        else {\n            this.checkMore(defy, n);\n        }\n    }\n\n    protected checkMore(defy:string[], value: number) {\n        if (this.min !== undefined && Number(value) < this.min) {\n            defy.push(this.minMsg({min:this.min}));\n        }\n        if (this.max !== undefined && Number(value) > this.max) {\n            defy.push(this.maxMsg({max:this.max}));\n        }\n    }\n}\n\nexport class RuleInt extends RuleNum {\n    protected checkMore(defy:string[], n: number) {\n        super.checkMore(defy, n);\n        if (Number.isInteger(n) === false) {\n            defy.push(this.res.integer);\n        }\n    }\n}\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport { UiItem, ChangingHandler, ChangedHandler } from '../../schema';\r\nimport { FieldProps } from '../field';\r\nimport { Context } from '../context';\r\nimport { ItemSchema } from '../../schema';\r\nimport { Rule, RuleRequired, RuleCustom, FieldRule } from '../rules';\r\nimport { computed, observable } from 'mobx';\r\nimport { observer } from 'mobx-react';\r\n\r\nexport abstract class Widget {\r\n    name: string;\r\n    protected context: Context;\r\n    protected fieldProps:FieldProps;\r\n    protected children: React.ReactNode;\r\n    protected _itemSchema: ItemSchema;\r\n    protected _ui: UiItem;\r\n\tprotected defaultValue: any;\r\n\tprotected value: any;\r\n    protected rules: Rule[];\r\n    @observable errors: string[] = [];\r\n    @observable protected contextErrors: string[] = [];\r\n    @computed protected get hasError():boolean {return (this.errors.length + this.contextErrors.length)>0}\r\n    protected readOnly:boolean;\r\n    protected disabled:boolean;\r\n    @observable visible:boolean;\r\n\r\n    constructor(context:Context, itemSchema:ItemSchema, fieldProps:FieldProps, children: React.ReactNode) {\r\n        this.context = context;\r\n        let {name} = itemSchema;\r\n        this.name = name;\r\n        this._itemSchema = itemSchema;\r\n        this.fieldProps = fieldProps;\r\n        this.children = children;\r\n        this._ui = context.getUiItem(name);\r\n        if (this.ui === undefined) {\r\n            this.readOnly = false;\r\n            this.disabled = false;\r\n            this.visible = true;\r\n        }\r\n        else {\r\n            let {readOnly, disabled, visible} = this.ui;\r\n            this.readOnly = (readOnly === true);\r\n            this.disabled = (disabled === true);\r\n            this.visible = !(visible === false);            \r\n        }\r\n        this.value = this.defaultValue =  context.getValue(name); //defaultValue;\r\n        // this.init();\r\n    }\r\n\r\n    protected get itemSchema(): ItemSchema {return this._itemSchema};\r\n    protected get ui(): UiItem {return this._ui};\r\n\r\n    init() {\r\n        this.rules = [];\r\n        if (this.itemSchema.required === true) {\r\n            this.rules.push(new RuleRequired(this.context.form.res));\r\n        }\r\n        this.buildRules();\r\n        if (this.ui === undefined) return;\r\n        let {rules} = this.ui;\r\n        if (rules === undefined) return;\r\n        if (Array.isArray(rules) === false) {\r\n            this.rules.push(new RuleCustom(rules as FieldRule));\r\n            return;\r\n        }\r\n        for (let rule of rules as FieldRule[]) {\r\n            this.rules.push(new RuleCustom(rule));\r\n        }\r\n    }\r\n\r\n    protected buildRules() {\r\n    }\r\n\r\n    checkRules() {\r\n        let defy:string[] = [];\r\n        for (let r of this.rules) r.check(defy, this.value);\r\n        if (defy.length === 0) {\r\n            this.context.removeErrorWidget(this);\r\n        }\r\n        else {\r\n            this.context.addErrorWidget(this);\r\n            this.errors.push(...defy);\r\n        }\r\n    }\r\n\r\n    @computed get isOk() {\r\n        return this.errors.length ===0;\r\n    }\r\n\r\n    setError(err:string | string[]) {\r\n        if (err === undefined) return;\r\n        if (typeof err === 'string') this.errors.push(err);\r\n        else this.errors.push(...err);\r\n    }\r\n\r\n    setContextError(err:string | string[]) {\r\n        if (err === undefined) return;\r\n        if (typeof err === 'string') this.contextErrors.push(err);\r\n        else this.contextErrors.push(...err);\r\n    }\r\n\r\n    clearError() {\r\n        this.errors.splice(0);\r\n    }\r\n\r\n    clearContextError() {\r\n        this.contextErrors.splice(0);\r\n    }\r\n\r\n    protected parse(value:any):any {return value}\r\n\r\n    protected setElementValue(value:any) {}\r\n    protected setDataValue(value:any) {\r\n        if (this.isChanging === true) return;\r\n        this.context.initData[this.name] = this.value = this.parse(value);\r\n    }\r\n\r\n    setValue(value:any) {\r\n        if (this.isChanging === true) return;\r\n        //this.setDataValue(value);\r\n        //this.setElementValue(value);\r\n        this.changeValue(value, false);\r\n    }\r\n\r\n    getValue() {\r\n        return this.context.getValue(this.name);\r\n    }\r\n\r\n    getReadOnly():boolean {return this.readOnly}\r\n    getDisabled():boolean {return this.disabled}\r\n    getVisible():boolean {return this.visible}\r\n    setReadOnly(value:boolean) {this.readOnly = value}\r\n    setDisabled(value:boolean) {this.disabled = value}\r\n    setVisible(value:boolean) {this.visible = value}\r\n\r\n    private isChanging: boolean;\r\n    protected onInputChange = (evt: React.ChangeEvent<any>) => {\r\n        this.changeValue(evt.target.value, true);\r\n    }\r\n\r\n    protected changeValue(newValue: any, fromElement: boolean) {\r\n        let prev = this.value;\r\n        let onChanging: ChangingHandler;\r\n        let onChanged: ChangedHandler;\r\n        if (this.ui !== undefined) {\r\n            onChanging = this.ui.onChanging;\r\n            onChanged = this.ui.onChanged;\r\n        }\r\n        let allowChange = true;\r\n        if (onChanging !== undefined) {\r\n            this.isChanging = true;\r\n            allowChange = onChanging(this.context, this.value, prev);\r\n            this.isChanging = false;\r\n        }\r\n        if (allowChange === true) {\r\n            this.setDataValue(newValue);\r\n            if (fromElement !== true) this.setElementValue(newValue);\r\n            if (onChanged !== undefined) {\r\n                this.isChanging = true;\r\n                onChanged(this.context, this.value, prev);\r\n                this.isChanging = false;\r\n            }\r\n        }\r\n    }\r\n\r\n    protected get className():string {\r\n        let fieldClass:string;\r\n        if (this.context.inNode === false) fieldClass = 'form-control';\r\n        return classNames(fieldClass, this.context.form.FieldClass, this.ui && this.ui.className);\r\n    }\r\n\r\n    protected abstract render():JSX.Element;\r\n\r\n    protected renderBody():JSX.Element {\r\n        let elDiscription;\r\n        if (this.hasError === false && this.ui) {\r\n            let {discription, discriptionClassName} = this.ui;\r\n            if (discriptionClassName === undefined) discriptionClassName = 'small text-muted';\r\n            elDiscription = <span className={discriptionClassName}>\r\n                {discription}\r\n            </span>;\r\n        }\r\n        return <>\r\n            {this.render()}\r\n            {elDiscription}\r\n        </>;\r\n    }\r\n\r\n    container = observer(():JSX.Element => {\r\n        if (this.visible === false) return null;\r\n        let {form, inNode} = this.context;\r\n        if (inNode === true) return this.render();\r\n        let label:any = this.label;\r\n        if (this.itemSchema.required === true && form.props.requiredFlag !== false) {\r\n            if (label !== null) label = <>{label}&nbsp;<span className=\"text-danger\">*</span></>;\r\n        }\r\n        return form.FieldContainer(label, this.renderBody());\r\n    })\r\n\r\n    protected get label():string {\r\n        let label:any;\r\n        if (this.ui === undefined) {\r\n            label = this.name;\r\n        }\r\n        else {\r\n            let uiLabel = this.ui.label;\r\n            if (uiLabel === null) label = null;\r\n            else label = uiLabel || this.name;\r\n        }\r\n        return label;\r\n    }\r\n\r\n    protected renderTemplet():JSX.Element | undefined {\r\n        if (this.children !== undefined) {\r\n            return <>{this.children}</>;\r\n        }\r\n        if (this.ui === undefined) return undefined;\r\n        let {Templet} = this.ui;\r\n        if (typeof Templet === 'function') return Templet(this.value);\r\n        return Templet;\r\n    }\r\n\r\n    protected renderErrors() {\r\n        let errorList:string[] = [...this.errors, ...this.contextErrors];\r\n        if (errorList.length === 0) return null;\r\n        let {inNode} = this.context;\r\n        let tag = inNode === true? 'span' : 'div';\r\n        return errorList.map(err => React.createElement(tag, \r\n            {\r\n                key: err, \r\n                className: 'text-danger d-inline-block my-2 ml-3'\r\n            },\r\n            <><i className=\"fa fa-exclamation-circle\" /> &nbsp;{err}</>\r\n        ));\r\n    }\r\n}\r\n","import * as React from 'react';\nimport classNames from 'classnames';\nimport { Widget } from './widget';\nimport { UiTextItem, StringSchema } from '../../schema';\nimport { observable } from 'mobx';\n\nexport class TextWidget extends Widget {\n    protected inputType = 'text';\n    protected get ui(): UiTextItem {return this._ui as UiTextItem};\n    protected input: HTMLInputElement;\n    @observable protected hasFocus: boolean;\n\n    protected setElementValue(value:any) {\n        if (this.input === null) return;\n        this.input.value = value;\n    }\n    protected get placeholder() {return (this.ui && this.ui.placeholder) || this.name}\n    protected onKeyDown = async (evt:React.KeyboardEvent<HTMLInputElement>) => {\n        this.internalOnKeyDown(evt);\n        if (evt.keyCode !== 13) return;\n        let {onEnter} = this.context.form.props;\n        if (onEnter === undefined) return;\n\n        this.changeValue(evt.currentTarget.value, true);\n\n        //this.checkRules();\n        //this.context.checkContextRules();\n        this.input.blur();\n\n        let ret = await onEnter(this.name, this.context);\n        if (ret !== undefined) {\n            this.context.setError(this.name, ret);\n        }\n    }\n\n    protected internalOnKeyDown(evt:React.KeyboardEvent<HTMLInputElement>) {\n    }\n\n    protected onBlur = (evt: React.FocusEvent<any>) => {\n        this.onInputChange(evt);\n        this.checkRules();\n\t\tthis.context.checkContextRules();\n\t\tthis.hasFocus = false;\n    }\n    protected onFocus = (evt: React.FocusEvent<any>) => {\n        this.clearError();\n        this.context.removeErrorWidget(this);\n        this.context.clearErrors();\n\t\tthis.hasFocus = true;\n    }\n    protected onChange(evt: React.ChangeEvent<any>) {\n    }\n\n    setReadOnly(value:boolean) {\n        if (this.input === null) return;\n        this.input.readOnly = this.readOnly = value;\n    }\n    setDisabled(value:boolean) {\n        if (this.input === null) return;\n        this.input.disabled = this.disabled = value;\n    }\n\n    render() {\n        let renderTemplet = this.renderTemplet();\n        if (renderTemplet !== undefined) return renderTemplet;\n        let cn:any = {\n            //'form-control': true,\n        };\n        if (this.hasError === true) {\n            cn['is-invalid'] = true;\n        }\n        else {\n            cn['required-item'] = this.itemSchema.required === true;\n        }\n        return <><input ref={input=>this.input = input}\n            className={classNames(this.className, cn)}\n            type={this.inputType}\n            defaultValue={this.value}\n            onChange={(evt: React.ChangeEvent<any>) => this.onChange(evt)}\n            placeholder={this.placeholder}\n            readOnly={this.readOnly}\n            disabled={this.disabled}\n            onKeyDown = {this.onKeyDown}\n            onFocus = {this.onFocus}\n            onBlur={this.onBlur}\n            maxLength={(this.itemSchema as StringSchema).maxLength} />\n            {this.renderErrors()}\n        </>;\n    }\n}\n","import * as React from 'react';\nimport classNames from 'classnames';\nimport { Widget } from './widget';\nimport { UiTextAreaItem } from '../../schema';\nimport { StringSchema } from '../../schema';\n\nexport class TextAreaWidget extends Widget {\n    protected get itemSchema(): StringSchema {return this._itemSchema as StringSchema};\n    protected input: HTMLTextAreaElement;\n    protected get ui(): UiTextAreaItem {return this._ui as UiTextAreaItem};\n\n    protected setElementValue(value:any) {this.input.value = value}\n    protected onInputChange = (evt: React.ChangeEvent<HTMLTextAreaElement>) => {\n        this.setValue(evt.currentTarget.value);\n    }\n\n    setReadOnly(value:boolean) {this.input.readOnly = this.readOnly = value}\n    setDisabled(value:boolean) {this.input.disabled = this.disabled = value}\n\n\tprotected onBlur = (evt: React.FocusEvent<any>) => {\n        this.onInputChange(evt);\n        this.checkRules();\n        this.context.checkContextRules();\n    }\n    protected onFocus = (evt: React.FocusEvent<any>) => {\n        this.clearError();\n        this.context.removeErrorWidget(this);\n        this.context.clearErrors();\n    }\n\n    render() {\n        let renderTemplet = this.renderTemplet();\n        if (renderTemplet !== undefined) return renderTemplet;\n        let cn:any = {};\n        if (this.hasError === true) {\n            cn['is-invalid'] = true;\n        }\n        else {\n            cn['required-item'] = this.itemSchema.required === true;\n        }\n        return <>\n\t\t\t<textarea ref={(input) => this.input=input}\n\t\t\t\tonBlur={this.onBlur} \n\t\t\t\tonFocus={this.onFocus}\n                className={classNames(this.className, cn)}\n                rows={this.ui && this.ui.rows}\n                maxLength={this.itemSchema.maxLength}\n                defaultValue={this.defaultValue} onChange={this.onInputChange} />\n            {this.renderErrors()}\n        </>;\n    }\n}\n","//import * as React from 'react';\nimport { TextWidget } from './textWidget';\n\nexport class PasswordWidget extends TextWidget {\n    protected inputType = 'password';\n}\n\nexport class UrlWidget extends TextWidget {\n    protected inputType = 'url';\n}\n\nexport class EmailWidget extends TextWidget {\n    protected inputType = 'email';\n}\n","//import * as React from 'react';\nimport { TextWidget } from './textWidget';\nimport { RuleNum, RuleInt } from '../rules';\nimport { NumBaseSchema } from '../../schema';\n\nexport class NumberWidget extends TextWidget {\n    protected inputType = 'number';\n    protected get itemSchema(): NumBaseSchema {return this._itemSchema as NumBaseSchema};\n\n    protected buildRules() {\n        super.buildRules();\n        let res = this.context.form.res;\n        let {min, max} = this.itemSchema;\n        this.rules.push(\n            this.itemSchema.type === 'integer'?\n                new RuleNum(res, min, max) :\n                new RuleInt(res, min, max)\n        );\n        /*\n        if (this.itemSchema.type === 'integer') {\n            this.rules.push(new RuleInt);\n        }\n        let {min, max} = this.itemSchema;\n        if (min !== undefined) this.rules.push(new RuleMin(min));\n        if (max !== undefined) this.rules.push(new RuleMax(max));\n        */\n    }\n\n    protected parse(value:any):any {\n        if (value === undefined || value === null) return;\n        return Number(value);\n    }\n}\n","import * as React from 'react';\nimport { NumberWidget } from './numberWidget';\n\nexport class UpdownWidget extends NumberWidget {\n    protected inputType = 'number';\n\n    protected isValidKey(key:number):boolean {\n        return key===46 || key===8 || key===37 || key===39\n            || (key>=48 && key<=57)\n            || (key>=96 && key<=105)\n            || key===109 || key===189;\n    }\n    \n    protected internalOnKeyDown(evt:React.KeyboardEvent<HTMLInputElement>) {\n        let key = evt.keyCode;\n        window.event.returnValue = this.isValidKey(key);\n    }\n}\n","//import * as React from 'react';\nimport { TextWidget } from './textWidget';\n\nexport class DateWidget extends TextWidget {\n    protected inputType = 'date';\n}\n\nexport class DateTimeWidget extends TextWidget {\n    protected inputType = 'datetime';\n}\n\nexport class TimeWidget extends TextWidget {\n    protected inputType = 'time';\n}\n\nexport class MonthWidget extends TextWidget {\n    protected inputType = 'month';\n}\n","import * as React from 'react';\nimport classNames from 'classnames';\nimport { Widget } from './widget';\nimport { UiCheckItem } from '../../schema';\n\nexport class CheckBoxWidget extends Widget {\n    protected input: HTMLInputElement;\n    protected get ui(): UiCheckItem {return this._ui as UiCheckItem};\n    protected trueValue: any;\n    protected falseValue: any;\n\n    init() {\n        super.init();\n        if (this.ui !== undefined) {\n            let {trueValue, falseValue} = this.ui;\n            if (trueValue === undefined) this.trueValue = true;\n            else this.trueValue = trueValue;\n            if (falseValue === undefined) this.falseValue = false;\n            else this.falseValue = falseValue;\n        }\n        else {\n            this.trueValue = true;\n            this.falseValue = false;\n        }\n    }\n    protected setElementValue(value:any) {\n        this.input.checked = value === this.trueValue;\n    }\n    setReadOnly(value:boolean) {this.input.readOnly = this.readOnly = value}\n    setDisabled(value:boolean) {this.input.disabled = this.disabled = value}\n\n    protected onInputChange = (evt: React.ChangeEvent<HTMLInputElement>) => {\n        let v = evt.target.checked === true? this.trueValue : this.falseValue;\n        this.setDataValue(v);\n    }\n\n    protected onClick = () => {\n        this.context.clearErrors();\n    }\n\n    render() {\n        let cn = classNames(this.className, 'form-check-inline p-0');\n        let input = <input\n            ref={(input)=>this.input = input}\n            className={'align-self-center'}\n            type=\"checkbox\"\n            defaultChecked={this.defaultValue} \n            onChange={this.onInputChange}\n            onClick={this.onClick} />;\n        if (this.context.inNode === true) {\n            return <label className={cn}>\n                {input} {(this.ui&&this.ui.label) || this.name}\n            </label>\n        }\n        else {\n            return <div className={cn}>\n                <label className=\"w-100 h-100 mb-0 d-flex justify-content-center\">{input}</label>\n            </div>;\n        }\n    }\n}\n","import * as React from 'react';\nimport classNames from 'classnames';\nimport { observable } from 'mobx';\nimport { Widget } from './widget';\nimport { UiSelect } from '../../schema';\n\nexport class SelectWidget extends Widget {\n    protected select: HTMLSelectElement;\n    protected get ui(): UiSelect {return this._ui as UiSelect};\n    @observable protected readOnly: boolean;\n\n    protected setElementValue(value:any) {this.select.value = value}\n    protected onInputChange = (evt:React.ChangeEvent<HTMLSelectElement>) => {\n        this.setDataValue(evt.target.value);\n    }\n\n    setReadOnly(value:boolean) {this.select.disabled = this.readOnly = !value}\n    setDisabled(value:boolean) {this.select.disabled = this.disabled = value}\n\n    render() {\n        if (this.readOnly === true) {\n            let option = this.ui.list.find(v => v.value === this.value);\n            let title = (option === undefined)? '(???)' : option.title;\n            return <span className=\"form-control w-min-6c\">{title}</span>;\n        }\n        return <select\n            ref={(select)=>this.select = select}\n            className={classNames(this.className, 'form-control')}\n            defaultValue={this.defaultValue} \n            onChange={this.onInputChange}>\n            {this.ui.list.map((v,index) => {\n                let {title, value} = v;\n                let cn:string;\n                //if (value === undefined || value === null) cn = 'text-light small';\n                //else cn = 'text-danger';\n                return <option className={cn} key={index} value={value}>{title || value}</option>\n            })}\n        </select>\n    }\n}\n","import * as React from 'react';\nimport classNames from 'classnames';\n//import { TextWidget } from './textWidget';\nimport { Widget } from './widget';\nimport { UiRadio } from '../../schema';\nimport { RowContext } from '../context';\n\n\nconst radioStyle:React.CSSProperties = {height: 'auto'};\n\nexport class RadioWidget extends Widget {\n    protected inputs: {[index:number]: HTMLInputElement} = {};\n    protected get ui(): UiRadio {return this._ui as UiRadio};\n\n    protected setElementValue(value:any) {\n        for (let i in this.inputs) {\n            let input = this.inputs[i];\n            input.checked = value === input.value;\n        }\n    }\n    setReadOnly(value:boolean) {\n        this.readOnly = value;\n        for (let i in this.inputs) this.inputs[i].readOnly = value;\n    }\n    setDisabled(value:boolean) {\n        this.disabled = value;\n        for (let i in this.inputs) this.inputs[i].disabled = value\n    }\n\n    /*\n    protected onInputChange = (evt: React.ChangeEvent<any>) => {\n        this.changeValue(evt.target.value, true);\n    }\n    */\n\n    render() {\n        let {defaultValue, list} = this.ui;\n        let {isRow} = this.context;\n        let rowKey:number;\n        if (isRow === true) {\n            rowKey = (this.context as RowContext).rowKey;\n        }\n        let cn = classNames(this.className, 'py-0');\n        return <span className={cn} style={radioStyle}>\n                {list.map((v,index) => {\n                    let {value, title} = v;\n                    let name = this.name;\n                    if (rowKey !== undefined) name += '-' + rowKey;\n                    return <label key={index} className=\"form-radio-inline\">\n                        <input ref={input=>this.inputs[index]=input} type=\"radio\" name={name}\n                            value={value} defaultChecked={(this.defaultValue || defaultValue)===value}\n                            onChange={this.onInputChange} />\n                        {title || value}\n                    </label>;\n                    //</span>\n                })}\n            </span>;\n    }\n}\n","import * as React from 'react';\nimport classNames from 'classnames';\nimport { UiRange } from '../../schema';\nimport { Widget } from './widget';\n\nexport class RangeWidget extends Widget {\n    protected inputType = 'range';\n    protected input: HTMLInputElement;\n    protected get ui(): UiRange {return this._ui as UiRange};\n\n    setReadOnly(value:boolean) {this.input.readOnly = this.readOnly = value}\n    setDisabled(value:boolean) {this.input.disabled = this.disabled = value}\n\n    render() {\n        let {min, max, step} = this.ui;\n        return <><input ref={input=>this.input = input}\n            className={classNames(this.className, 'form-control', 'w-min-6c')}\n            type={this.inputType}\n            defaultValue={this.defaultValue} \n            onChange={this.onInputChange}\n            max={max}\n            min={min}\n            step={step}\n            />\n        </>;\n    }\n}\n","import * as React from 'react';\nimport classNames from 'classnames';\nimport { Widget } from './widget';\nimport { UiIdItem, TempletType } from '../../schema';\nimport { observable } from 'mobx';\n\nconst none = <small className=\"text-muted\">[无]</small>;\n\nexport class IdWidget extends Widget {\n    protected get ui(): UiIdItem {return this._ui as UiIdItem};\n    @observable protected value:number;\n    setReadOnly(value:boolean) {this.readOnly = value}\n    setDisabled(value:boolean) {this.disabled = value}    \n\n    protected onClick = async () => {\n        let pickId = this.ui && this.ui.pickId;\n        if (pickId === undefined) {\n            alert('no pickId defined!');\n            return;\n        }\n        let id = await pickId(this.context, this.name, this.value);        \n        this.setDataValue(id);\n        this.clearError();\n        this.clearContextError();\n        this.checkRules();\n    }\n\n    render() {\n        let placeholder:string|JSX.Element, Templet: TempletType;\n        if (this.ui !== undefined) {\n            placeholder = this.ui.placeholder;\n            Templet = this.ui.Templet;\n        }\n        let cn:any = {\n            'form-control': true,\n            'required-item': this.itemSchema.required === true,\n            'cursor-pointer': true,\n            'is-invalid': this.hasError,\n        };\n        let content;\n        if (this.value === undefined || this.value === null) {\n            content = placeholder || none;\n            cn['text-muted'] = true;\n        }\n        else if (Templet === undefined) {\n            let c: any;\n            if (this.value === null) {\n                c = 'null';\n            }\n            else {\n                switch (typeof this.value) {\n                    case 'undefined': c = none; break;\n                    case 'object': c = (this.value as any).id; break;\n                    default: c = this.value; break;\n                }\n            }\n            content = <>{c}</>;\n        }\n        else if (typeof Templet === 'function') {\n            content = Templet(this.value);\n        }\n        else {\n            content = Templet;\n        }\n        return <>\n            <div className={classNames(cn)} onClick={this.onClick}>{content}</div>\n            {this.renderErrors()}\n        </>;\n    }\n}\n","import * as React from 'react';\nimport { DataType } from '../../schema';\nimport { UiType } from '../../schema';\n\nexport const Unknown = (dataType:DataType, uiType:UiType, dataTypes:DataType[]) => {\n    return <span className=\"text-danger\">!!data type {dataType} only support {(dataTypes || []).join(', ')}, can't use ui {uiType}!!</span>;\n};\n","import * as React from 'react';\nimport { UiButton, TempletType } from '../../schema';\nimport { Unknown } from './unknown';\nimport { Widget } from './widget';\nimport { observer } from 'mobx-react';\n\nexport class ButtonWidget extends Widget {\n    protected get ui(): UiButton {return this._ui as UiButton};\n\n    protected onClick = async () => {\n        this.clearError();\n        this.clearContextError();\n        let {name, type} = this.itemSchema;\n        if (type === 'submit') {\n            await this.context.submit(name);\n        }\n        /*\n        let {onButtonClick} = this.context.form.props;\n        if (onButtonClick === undefined) {\n            alert(`button ${name} clicked. you should define form onButtonClick`);\n            return;\n        }\n        let ret = await onButtonClick(name, this.context);\n        if (ret === undefined) return;\n        this.context.setError(name, ret);\n        */\n    }\n\n    private observerRender = observer(() => {\n        let {name, type} = this.itemSchema;\n        let Templet:TempletType, cn:string, caption:string;\n        if (this.ui !== undefined) {\n            let {widget:widgetType} = this.ui;\n            if (widgetType !== 'button') return Unknown(type, widgetType, ['button']);\n            Templet = this.ui.Templet;\n            cn = this.ui.className;\n            caption = this.ui.label;\n        }\n        let {form, hasError} = this.context;\n        let context = this.context;\n        let disabled = type==='submit' && hasError;\n        let content:any;\n        if (this.children !== undefined) content = this.children;\n        else if (typeof Templet === 'function') content = Templet();\n        else if (Templet !== undefined) content = Templet;\n        else content = caption; \n        let button = <button \n            className={cn} \n            type=\"button\"\n            disabled={disabled}\n            onClick={this.onClick}>\n            {content || name}\n        </button>;\n        if (context.inNode === true) return <>{button}{this.renderErrors()}</>;\n        return <div className={form.ButtonClass}>\n            <div>{this.renderErrors()}</div>\n            {button}\n        </div>;\n    });\n    \n    protected get label():string {return null}\n\n    render() {\n        return React.createElement(this.observerRender);\n    }\n}\n","import * as React from 'react';\nimport { Form } from './form';\nimport { UiSchema, UiArr, UiItem } from '../schema';\nimport { ArrSchema, ItemSchema } from '../schema';\nimport { Widget } from './widgets/widget';\n//import { ArrRow } from './arrRow';\nimport { observable, computed } from 'mobx';\nimport { ContextRule } from './rules';\nimport { observer } from 'mobx-react';\n\nexport abstract class Context {\n    private subContexts:{[name:string]:{[rowKey:string]:Context}};\n    readonly form: Form;\n    readonly uiSchema: UiSchema;\n    readonly initData: any;\n    readonly inNode: boolean;           // true: 在</> 流中定义Field\n    readonly widgets: {[name:string]: Widget} = {};\n    readonly rules: ContextRule[];\n    readonly isRow: boolean;\n    @observable errors: string[] = [];\n    @observable errorWidgets:Widget[] = [];\n\n    constructor(form: Form, uiSchema: UiSchema, data: any, inNode: boolean, isRow: boolean) {\n        this.form = form;\n        this.uiSchema = uiSchema;\n        this.initData = data;\n        this.inNode = inNode;\n        this.isRow = isRow;\n        if (uiSchema !== undefined) {\n            let {rules} = uiSchema;\n            if (rules !== undefined) {\n                this.rules = [];\n                if (Array.isArray(rules) === false)\n                    this.rules.push(rules as ContextRule);\n                else\n                    this.rules.push(...rules as ContextRule[]);\n            }\n        }\n    }\n\n    getArrRowContexts(arrName: string) {\n        if (this.subContexts === undefined) this.subContexts = {};\n        let arrRowContexts = this.subContexts[arrName];\n        if (arrRowContexts === undefined) this.subContexts[arrName] = arrRowContexts = {};\n        return arrRowContexts;\n    }\n\n    abstract get data():any;\n    abstract getItemSchema(itemName:string):ItemSchema;\n    abstract getUiItem(itemName:string):UiItem;\n    get arrName():string {return undefined}\n    getValue(itemName:string):any {return this.initData[itemName]}\n    setValue(itemName:string, value:any) {\n        this.initData[itemName] = value;\n        let widget = this.widgets[itemName];\n        if (widget !== undefined) widget.setValue(value);\n    }\n    getDisabled(itemName:string):boolean {\n        let widget = this.widgets[itemName];\n        if (widget !== undefined) return widget.getDisabled();\n        return undefined;\n    }\n    setDisabled(itemName:string, value:boolean) {\n        let widget = this.widgets[itemName];\n        if (widget !== undefined) widget.setDisabled(value);\n    }\n    getReadOnly(itemName:string):boolean {\n        let widget = this.widgets[itemName];\n        if (widget !== undefined) widget.getReadOnly();\n        return undefined;\n    }\n    setReadOnly(itemName:string, value:boolean) {\n        let widget = this.widgets[itemName];\n        if (widget !== undefined) widget.setReadOnly(value);\n    }\n    getVisible(itemName:string):boolean {\n        let widget = this.widgets[itemName];\n        if (widget !== undefined) widget.getVisible();\n        return undefined;\n    }\n    setVisible(itemName:string, value:boolean) {\n        let widget = this.widgets[itemName];\n        if (widget !== undefined) widget.setVisible(value);\n    }\n\n    async submit(buttonName: string) {\n        this.checkRules()\n        if (this.hasError === true) {\n            let err = '';\n            for (let ew of this.errorWidgets) {\n                err += ew.name + ':\\n' + ew.errors.join('\\n');\n            }\n            console.error(err);\n            return;\n        }\n        let {onButtonClick} = this.form.props;\n        if (onButtonClick === undefined) {\n            alert(`button ${buttonName} clicked. you should define form onButtonClick`);\n            return;\n        }\n        let ret = await onButtonClick(buttonName, this);\n        if (ret === undefined) return;\n        this.setError(buttonName, ret);\n\n    }\n\n    checkFieldRules() {\n        for (let i in this.widgets) {\n            this.widgets[i].checkRules();\n        }\n        if (this.subContexts === undefined) return;\n        for (let i in this.subContexts) {\n            let arrRowContexts = this.subContexts[i];\n            for (let j in arrRowContexts) {\n                arrRowContexts[j].checkFieldRules();\n            }\n        }\n    }\n\n    checkContextRules() {\n        this.clearErrors();\n        if (this.rules === undefined) return;\n        for (let rule of this.rules) {\n            let ret = rule(this);\n            if (ret === undefined) continue;\n            if (Array.isArray(ret) === true) {\n                this.errors.push(...ret as string[]);\n            }\n            else if (typeof ret === 'string') {\n                this.errors.push(ret as string);\n            }\n            else {\n                for (let i in ret as object) this.setError(i, (ret as any)[i]);\n            }\n        }\n        if (this.subContexts === undefined) return;\n        for (let i in this.subContexts) {\n            let arrRowContexts = this.subContexts[i];\n            for (let j in arrRowContexts) {\n                let rowContext = arrRowContexts[j];\n                rowContext.clearErrors();\n                rowContext.checkContextRules();\n            }\n        }\n    }\n\n    setError(itemName:string, error:string) {\n        let widget = this.widgets[itemName];\n        if (widget === undefined) return;\n        widget.setContextError(error);\n        this.addErrorWidget(widget);\n    }\n\n    clearContextErrors() {\n        for (let i in this.widgets) {\n            let widget = this.widgets[i];\n            if (widget === undefined) continue;\n            widget.clearContextError();\n        }\n    }\n\n    clearWidgetsErrors() {\n        for (let i in this.widgets) {\n            let widget = this.widgets[i];\n            if (widget === undefined) continue;\n            widget.clearError();\n        }\n    }\n\n    checkRules() {\n        this.clearErrors();\n        this.clearWidgetsErrors();\n        this.checkFieldRules();\n        if (this.hasError === true) return;\n        this.checkContextRules();\n    }\n\n    addErrorWidget(widget:Widget) {\n        let pos = this.errorWidgets.findIndex(v => v === widget);\n        if (pos < 0) this.errorWidgets.push(widget);\n    }\n    removeErrorWidget(widget:Widget) {\n        let pos = this.errorWidgets.findIndex(v => v === widget);\n        if (pos >= 0) this.errorWidgets.splice(pos, 1);\n    }\n\n    protected checkHasError():boolean {\n        let ret = (this.errorWidgets.length + this.errors.length) > 0;\n        if (ret === true) return true;\n        if (this.subContexts === undefined) return false;\n        for (let i in this.subContexts) {\n            let arrRowContexts = this.subContexts[i];\n            for (let j in arrRowContexts) {\n                if (arrRowContexts[j].hasError === true) return true;\n            }\n        }\n        return false;\n    }\n\n    @computed get hasError():boolean {\n        return this.checkHasError();\n    };\n\n    clearErrors() {\n        this.errors.splice(0);\n        this.errorWidgets.splice(0);\n        this.clearContextErrors();\n    }\n\n    renderErrors = observer((): JSX.Element => {\n        let {errors} = this;\n        if (errors.length === 0) return null;\n        return <>\n            {errors.map(err => <span key={err} className=\"text-danger inline-block my-1 ml-3\">\n                <i className=\"fa fa-exclamation-circle\" /> &nbsp;{err}\n            </span>)}\n        </>\n    });\n}\n\nlet rowKeySeed:number = 1;\nexport class RowContext extends Context {\n    readonly parentContext: Context;\n    readonly arrSchema: ArrSchema;\n    readonly rowKey: number;\n\treadonly data: any;\n    //readonly uiSchema: UiArr;\n\t\n    constructor(parentContext:Context, arrSchema: ArrSchema, data: any, inNode: boolean) {\n        let uiArr:UiArr;\n        let {uiSchema} = parentContext;\n        if (uiSchema !== undefined) {\n            let {items} = uiSchema;\n            if (items !== undefined) uiArr = items[arrSchema.name] as UiArr;\n        }\n        super(parentContext.form, uiArr, data, inNode, true);\n        this.parentContext = parentContext;\n        this.arrSchema = arrSchema;\n        this.rowKey = rowKeySeed++;\n        this.data = data;\n    }\n    getItemSchema(itemName:string):ItemSchema {return this.arrSchema.itemSchemas[itemName]}\n    getUiItem(itemName:string):UiItem {\n        if (this.uiSchema === undefined) return undefined;\n        let {items} = this.uiSchema;\n        if (items === undefined) return undefined;\n        return items[itemName]\n    }\n    get arrName():string {return this.arrSchema.name}\n    clearErrors() {\n        super.clearErrors();\n        this.parentContext.clearErrors();\n    }\n\n    get parentData():any {return this.parentContext.data;}\n}\n\nexport class FormContext extends Context {\n    constructor(form:Form, inNode:boolean) {\n        super(form, form.uiSchema, form.data, inNode, false);\n    }\n    get data():any {return this.form.data}\n    getItemSchema(itemName:string):ItemSchema {return this.form.itemSchemas[itemName]}\n    getUiItem(itemName:string):UiItem {\n        let {uiSchema} = this.form;\n        if (uiSchema === undefined) return undefined;\n        let {items} = uiSchema;\n        if (items === undefined) return undefined;\n        return items[itemName];\n    }\n}\n\nexport const ContextContainer = React.createContext<Context>({} as any);\n","import * as React from 'react';\nimport {observer} from 'mobx-react';\nimport classNames from 'classnames';\n//import { ArrRow } from '../arrRow';\nimport { Context, RowContext, ContextContainer } from '../context';\nimport { ArrSchema } from '../../schema';\nimport { UiArr, TempletType } from '../../schema';\nimport { Unknown } from './unknown';\nimport { factory } from './factory';\n\nexport const ArrComponent = observer((\n    {parentContext, arrSchema, children}:{parentContext: Context, arrSchema: ArrSchema, children: React.ReactNode}) => \n{\n    let {name, arr} = arrSchema;\n    let data = parentContext.initData[name] as any[];\n    let {form} = parentContext;\n    let arrRowContexts = parentContext.getArrRowContexts(name);\n    let ui = parentContext.getUiItem(name) as UiArr;\n    let arrLabel = name;\n    let Templet:TempletType;\n    let selectable:boolean, deletable:boolean, restorable:boolean;\n    let {ArrContainer, RowContainer, RowSeperator, uiSchema} = form;\n    if (uiSchema !== undefined) {\n        let {selectable:formSelectable, deletable:formDeletable, restorable:formRestorable} = uiSchema;\n        if (selectable !== true) selectable = formSelectable;\n        if (deletable !== true) deletable = formDeletable;\n        if (restorable !== true) restorable = formRestorable;\n    }\n    if (ui !== undefined) {\n        let {widget:widgetType, label, \n            selectable:arrSelectable, deletable:arrDeletable, restorable:arrRestorable,\n            ArrContainer:ac, RowContainer:rc, RowSeperator:rs\n        } = ui;\n        if (arrSelectable !== undefined) selectable = arrSelectable;\n        if (arrDeletable !== undefined) deletable = arrDeletable;\n        if (arrRestorable !== undefined) restorable = arrRestorable;\n        if (ac !== undefined) ArrContainer = ac;\n        if (rc !== undefined) RowContainer = rc;\n        if (rs !== undefined) RowSeperator = rs;\n        Templet = ui.Templet;\n        if (widgetType !== 'arr') return Unknown(arrSchema.type, widgetType, ['arr']);\n        arrLabel = label || arrLabel;\n    }\n    let first = true;\n    return ArrContainer(arrLabel, <>\n        {data.map((row:any, index) => {\n            let rowContext: RowContext;\n            let rowContent: JSX.Element;\n            let sep = undefined;\n            if (first === false) sep = RowSeperator;\n            else first = false;\n            if (children !== undefined) {\n                rowContext = new RowContext(parentContext, arrSchema, row, true);\n                rowContent = <>{children}</>;\n            }\n            else {\n                let typeofTemplet = typeof Templet;\n                if (typeofTemplet === 'function') {\n                    rowContext = new RowContext(parentContext, arrSchema, row, true);\n                    rowContent = React.createElement(observer(Templet as React.StatelessComponent), row);\n                }\n                else if (typeofTemplet === 'object') {\n                    rowContext = new RowContext(parentContext, arrSchema, row, true);\n                    rowContent = Templet as JSX.Element;\n                }\n                else {\n                    rowContext = new RowContext(parentContext, arrSchema, row, false);\n                    rowContent = <>{\n                        arr.map((v, index) => {\n                            return <React.Fragment key={v.name}>\n                                {factory(rowContext, v, undefined)}\n                            </React.Fragment>\n                        })}\n                    </>;\n                }\n            }\n            let {rowKey} = rowContext;\n            arrRowContexts[rowKey] = rowContext;\n\n            let selectCheck:JSX.Element, deleteIcon:JSX.Element;\n            if (selectable === true) {\n                let onClick = (evt: React.MouseEvent<HTMLInputElement>)=>{\n                    let {checked} = (evt.target as HTMLInputElement);\n                    row.$isSelected = checked;\n                    let {$source} = row;\n                    if ($source !== undefined) $source.$isSelected = checked;\n                    rowContext.clearErrors();\n                }\n                selectCheck = <div className=\"form-row-checkbox\">\n                    <input type=\"checkbox\" onClick={onClick} defaultChecked={row.$isSelected} />\n                </div>;\n            }\n            let isDeleted = !(row.$isDeleted===undefined || row.$isDeleted===false);\n            if (deletable === true) {\n                let icon = isDeleted? 'fa-undo' : 'fa-trash';\n                let onDelClick = () => {\n                    if (restorable === true) {\n                        row.$isDeleted = !isDeleted;\n                        let {$source} = row;\n                        if ($source !== undefined) $source.$isDeleted = !isDeleted;\n                    }\n                    else {\n                        let p = data.indexOf(row);\n                        if (p>=0) data.splice(p, 1);\n                    }\n                    rowContext.clearErrors();\n                }\n                deleteIcon = <div className=\"form-row-edit text-info\" onClick={onDelClick}>\n                    <i className={classNames('fa', icon, 'fa-fw')} />\n                </div>;\n            }\n            let editContainer = selectable===true || deletable===true?\n                (content:any) => <fieldset disabled={isDeleted}><div className={classNames('d-flex', {'deleted':isDeleted, 'row-selected':row.$isSelected})}>\n                    {selectCheck}\n                    <div className={selectable===true && deletable===true? \"form-row-content\":\"form-row-content-1\"}>{content}</div>\n                    {deleteIcon}\n                </div></fieldset>\n                :\n                (content:any) => content;\n\n            return <ContextContainer.Provider key={rowKey} value={rowContext}>\n                {sep}\n                {RowContainer(editContainer(<><rowContext.renderErrors />{rowContent}</>))}\n            </ContextContainer.Provider>;\n        })}\n    </>);\n});\n","import * as React from 'react';\nimport classNames from 'classnames';\nimport { Widget } from './widget';\nimport { UiImageItem } from '../../schema';\nimport { Image } from '../../image';\nimport { ImageItemEdit } from '../../edit/imageItemEdit';\nimport { observer } from 'mobx-react';\nimport { observable } from 'mobx';\n\nexport class ImageWidget extends Widget {\n    protected input: HTMLInputElement;\n    protected get ui(): UiImageItem {return this._ui as UiImageItem};\n    @observable private imageSrc: string;\n\n    init() {\n        super.init();\n        this.imageSrc = this.value;\n    }\n\n    protected onClick = async () => {\n        let edit = new ImageItemEdit(undefined, this.itemSchema, this.ui, this.ui.label, this.value);\n        let ret = await edit.start();\n        if (ret !== null) {\n            this.setValue(ret);\n            this.imageSrc = ret;\n        }\n        await edit.end();\n    }\n\n    render() {\n        return React.createElement(this.observerRender);\n    }\n\n    private observerRender = observer(() => {\n        let cn = [\n            'bg-white p-1 d-flex justify-content-center',\n        ];\n        let onClick: any;\n        if (!this.readOnly && !this.disabled) {\n            cn.push('cursor-pointer');\n            onClick = this.onClick;\n        }\n        return <div className={classNames(cn)} onClick={onClick}>\n            <Image src={this.imageSrc} className=\"w-4c h-4c\"/>\n        </div>;\n    });\n}\n","import * as React from 'react';\nimport classNames from 'classnames';\nimport { Widget } from './widget';\nimport { UiTag, IValuesViewRenderOptions } from '../../schema';\nimport { RowContext } from '../context';\n\nabstract class TagWidget extends Widget {\n    protected inputs: {[index:number]: HTMLInputElement} = {};\n    protected get ui(): UiTag {return this._ui as UiTag};\n\n    protected setElementValue(value:any) {\n        for (let i in this.inputs) {\n            let input = this.inputs[i];\n            input.checked = value === input.value;\n        }\n    }\n    setReadOnly(value:boolean) {\n        this.readOnly = value;\n        for (let i in this.inputs) this.inputs[i].readOnly = value;\n    }\n    setDisabled(value:boolean) {\n        this.disabled = value;\n        for (let i in this.inputs) this.inputs[i].disabled = value\n\t}\n\t\n\tabstract render():JSX.Element;\n}\n\nexport class TagSingleWidget extends TagWidget {\n\trender() {\n\t\tlet {valuesView, wrapClassName} = this.ui;\n\t\tif (valuesView === undefined) return <>valuesView must be defined</>;\n        let {isRow} = this.context;\n        let rowKey:number;\n        if (isRow === true) {\n            rowKey = (this.context as RowContext).rowKey;\n        }\n        let cn = classNames(this.className, 'py-0');\n\t\tlet name = this.name;\n\t\tif (rowKey !== undefined) name += '-' + rowKey;\n\t\tlet options:IValuesViewRenderOptions = {\n\t\t\tclassName: cn,\n\t\t\tinputName: name,\n\t\t\twrapClassName,\n\t\t\tonInputChange: this.onInputChange\n\t\t}\n\t\treturn valuesView.renderRadios(this.defaultValue, options);\n    }\n}\n\nexport class TagMultiWidget extends TagWidget {\n\tprivate defaultArr:number[];\n\tinit() {\n\t\tsuper.init();\n\t\tlet def = this.defaultValue;\n\t\tswitch (typeof def) {\n\t\t\tdefault:\n\t\t\t\tthis.defaultArr = [];\n\t\t\t\tbreak;\n\t\t\tcase 'string':\n\t\t\t\tthis.defaultArr = def.split('|').map(v => Number(v));\n\t\t\t\tbreak;\n\t\t}\n\t}\n    protected onInputChange = (evt: React.ChangeEvent<any>) => {\n\t\tlet values:string[] = [];\n\t\tfor (let i in this.inputs) {\n\t\t\tlet input = this.inputs[i];\n\t\t\tif (input.checked === true) values.push(input.value);\n\t\t}\n        this.changeValue(values.join('|'), true);\n\t}\n\trender() {\n\t\tlet {valuesView, wrapClassName} = this.ui;\n\t\tif (valuesView === undefined) return <>valuesView must be defined</>;\n        let cn = classNames(this.className, 'py-0');\n\t\tlet options:IValuesViewRenderOptions = {\n\t\t\tclassName: cn,\n\t\t\tinputs: this.inputs,\n\t\t\twrapClassName,\n\t\t\tonInputChange: this.onInputChange\n\t\t}\n\t\treturn valuesView.renderChecks(this.defaultValue, options);\n    }\n}\n","import * as React from 'react';\r\nimport { ArrSchema, DataType, ItemSchema } from '../../schema';\r\nimport { TypeWidget, UiCustom } from '../../schema';\r\nimport { TextWidget } from './textWidget';\r\nimport { TextAreaWidget } from './textareaWidget';\r\nimport { PasswordWidget, UrlWidget, EmailWidget } from './passwordWidget';\r\nimport { UpdownWidget } from './updownWidget';\r\nimport { NumberWidget } from './numberWidget';\r\nimport { DateWidget, DateTimeWidget, TimeWidget, MonthWidget } from './dateWidget';\r\nimport { CheckBoxWidget } from './checkBoxWidget';\r\nimport { FieldProps } from '../field';\r\nimport { Context } from '../context';\r\nimport { SelectWidget } from './selectWidget';\r\nimport { RadioWidget } from './radioWidget';\r\nimport { RangeWidget } from './rangeWidget';\r\nimport { IdWidget } from './idWidget';\r\nimport { ButtonWidget } from './buttonWidget';\r\nimport { ArrComponent } from './arrComponent';\r\nimport { ImageWidget } from './imageWidget';\r\nimport { TagSingleWidget, TagMultiWidget } from './tagWidget';\r\n\r\nconst widgetsFactory: {[type: string]: {widget?: TypeWidget, dataTypes?: DataType[]}} = {\r\n    id: {\r\n        dataTypes: ['id'],\r\n        widget: IdWidget,\r\n    },\r\n    text: {\r\n        dataTypes: ['integer', 'number', 'string'],\r\n        widget: TextWidget\r\n    },\r\n    textarea: {\r\n        dataTypes: ['string'],\r\n        widget: TextAreaWidget\r\n    },\r\n    password: {\r\n        dataTypes: ['string'],\r\n        widget: PasswordWidget\r\n    },\r\n    date: {\r\n        dataTypes: ['date'],\r\n        widget: DateWidget\r\n    },\r\n    datetime: {\r\n        dataTypes: ['date'],\r\n        widget: DateTimeWidget\r\n    },\r\n    time: {\r\n        dataTypes: ['date'],\r\n        widget: TimeWidget\r\n    },\r\n    month: {\r\n        dataTypes: ['date'],\r\n        widget: MonthWidget\r\n    },\r\n    select: {\r\n        dataTypes: ['integer', 'number', 'string', 'date', 'boolean'],\r\n        widget: SelectWidget\r\n    },\r\n    url: {\r\n        dataTypes: ['string'],\r\n        widget: UrlWidget\r\n    },\r\n    email: {\r\n        dataTypes: ['string'],\r\n        widget: EmailWidget\r\n    },\r\n    number: {\r\n        dataTypes: ['integer', 'number'],\r\n        widget: NumberWidget\r\n    },\r\n    updown: {\r\n        dataTypes: ['integer', 'number'],\r\n        widget: UpdownWidget\r\n    },\r\n    color: {\r\n\r\n    },\r\n    checkbox: {\r\n        dataTypes: ['boolean', 'integer', 'number'],\r\n        widget: CheckBoxWidget\r\n    },\r\n    image: {\r\n        dataTypes: ['string'],\r\n        widget: ImageWidget,\r\n    },\r\n    checkboxes: {\r\n\r\n    },\r\n    radio: {\r\n        dataTypes: ['integer', 'number', 'string', 'date', 'boolean'],\r\n        widget: RadioWidget\r\n\t},\r\n\ttagSingle: {\r\n\t\tdataTypes: ['integer'],\r\n\t\twidget: TagSingleWidget\r\n\t},\r\n\ttagMulti: {\r\n\t\tdataTypes: ['string'],\r\n\t\twidget: TagMultiWidget\r\n\t},\r\n    range: {\r\n        dataTypes: ['integer'],\r\n        widget: RangeWidget,\r\n    },\r\n    button: {\r\n        dataTypes: ['button', 'submit'],\r\n        widget: ButtonWidget,\r\n    }\r\n}\r\n\r\nexport function factory(context: Context, itemSchema: ItemSchema, children:React.ReactNode, fieldProps?: FieldProps):JSX.Element {\r\n    if (context === undefined) {\r\n        debugger;\r\n        return null;\r\n    }\r\n    if (itemSchema === undefined) return undefined;\r\n    let {name, type} = itemSchema;\r\n    switch (type) {\r\n    case 'arr':\r\n        let arrSchema = context.getItemSchema(name) as ArrSchema;\r\n        return <ArrComponent parentContext={context} arrSchema={arrSchema} children={children} />;\r\n    default:\r\n        break;\r\n    }\r\n\r\n    let typeWidget: TypeWidget;\r\n    let ui = context.getUiItem(name);\r\n    function getTypeWidget(t:DataType): TypeWidget {\r\n        switch(t) {\r\n        default: return TextWidget; \r\n        case 'id': return IdWidget;\r\n        case 'integer': return UpdownWidget;\r\n        case 'number': return NumberWidget; \r\n        case 'string': return TextWidget; \r\n        case 'date': return DateWidget; \r\n        case 'boolean': return CheckBoxWidget; \r\n        case 'button':\r\n        case 'submit': return ButtonWidget;\r\n        }\r\n    }\r\n    if (ui === undefined) { \r\n        typeWidget = getTypeWidget(type);\r\n    }\r\n    else {\r\n        let {widget:widgetType} = ui;\r\n        switch (widgetType) {\r\n        default:\r\n            if (widgetType !== undefined) {\r\n                let widgetFactory = widgetsFactory[widgetType];\r\n                typeWidget = widgetFactory.widget;\r\n            }\r\n            if (typeWidget === undefined) typeWidget = getTypeWidget(type);\r\n            break;\r\n        case 'custom':\r\n            typeWidget = (ui as UiCustom).WidgetClass;\r\n            break;\r\n        case 'group':\r\n            return <span>impletment group</span>;\r\n        }\r\n        //label = uiLabel || name;\r\n    }\r\n    \r\n\tlet {widgets} = context;\r\n\tlet widget = widgets[name];\r\n\tif (!widget) {\r\n\t\twidget = new typeWidget(context, itemSchema, fieldProps, children);\r\n\t\twidget.init();\r\n\t\twidgets[name] = widget;\r\n\t}\r\n\r\n    return <widget.container />;\r\n    /*\r\n    if (isRow === false) {\r\n        let WidgetElement = observer(() => widget.container());\r\n        return <WidgetElement />;\r\n    }\r\n    else {\r\n        let widgetElement = widget.container();\r\n        return widgetElement;\r\n    }\r\n    */\r\n}\r\n\r\n","import * as React from 'react';\r\nimport {observable, IReactionDisposer, autorun} from 'mobx';\r\nimport classNames from 'classnames';\r\nimport { Schema, ItemSchema, ArrSchema } from '../schema';\r\nimport { UiSchema, TempletType } from '../schema';\r\nimport { factory } from './widgets';\r\nimport 'font-awesome/css/font-awesome.min.css';\r\nimport { ContextContainer, FormContext, Context } from './context';\r\nimport { FormRes, formRes } from '../../res';\r\nimport { resLang } from '../../res/res';\r\n\r\nexport type FormButtonClick = (name:string, context: Context) => Promise<any>;\r\nexport type InputEnter = (name:string, context: Context) => Promise<any>;\r\n\r\nexport interface FormProps {\r\n    className?: string;\r\n    schema: Schema;\r\n    uiSchema?: UiSchema;\r\n    formData?: any;\r\n    onButtonClick?: FormButtonClick;\r\n    onEnter?: InputEnter;\r\n    fieldLabelSize?: number;            // col-sm-2 for label\r\n    requiredFlag?: boolean;             // default=true\r\n    beforeShow?: (formContext:FormContext) => void;\r\n    res?: FormRes;\r\n\r\n    Container?: (content:JSX.Element) => JSX.Element;\r\n    FieldContainer?: (label:string|JSX.Element, content:JSX.Element) => JSX.Element;\r\n    FieldClass?: string;\r\n    ButtonClass?: string;\r\n}\r\n\r\nexport class Form extends React.Component<FormProps> {\r\n    readonly schema: Schema;\r\n    readonly itemSchemas: {[name:string]: ItemSchema};\r\n    readonly uiSchema: UiSchema;\r\n    readonly res?: FormRes;\r\n    protected formContext: FormContext;\r\n    private disposer: IReactionDisposer;\r\n    readonly data:any;\r\n\r\n    readonly Container: (content:JSX.Element) => JSX.Element;\r\n    readonly FieldContainer: (label:any, content:JSX.Element) => JSX.Element;\r\n    readonly FieldClass: string;\r\n    readonly ButtonClass: string;\r\n    \r\n    constructor(props:FormProps) {\r\n        super(props);\r\n        let {schema, uiSchema, \r\n            Container, FieldContainer, FieldClass, \r\n            ButtonClass, res,\r\n        } = props;\r\n        this.Container = Container || this.DefaultContainer;\r\n        this.FieldContainer = FieldContainer || this.DefaultFieldContainer;\r\n        this.FieldClass = FieldClass!==undefined && FieldClass!==''&&FieldClass!==null? FieldClass : this.DefaultFieldClass;\r\n        this.res = res || this.DefaultRes;\r\n        this.ButtonClass = ButtonClass || this.DefaultButtonClass;\r\n\r\n        this.schema = schema;\r\n        this.itemSchemas = {};\r\n        for (let itemSchema of this.schema) {\r\n            this.itemSchemas[itemSchema.name] = itemSchema;\r\n        }\r\n        this.uiSchema = uiSchema;\r\n\r\n        this.disposer = autorun(this.watch);\r\n        this.data = {};\r\n    }\r\n\r\n    private renderContent():any {\r\n        this.initData(this.props.formData);\r\n        let {children} = this.props;\r\n        if (children !== undefined) {\r\n            this.formContext = new FormContext(this, true);\r\n            return <>{children}</>;\r\n        }\r\n\r\n        let Templet: TempletType;\r\n        if (this.uiSchema !== undefined) {\r\n            Templet = this.uiSchema.Templet;\r\n        }\r\n        if (Templet !== undefined) {\r\n            this.formContext = new FormContext(this, true);\r\n            return typeof(Templet) === 'function'? Templet(this.data) : Templet;\r\n        }\r\n\r\n\t\tif (!this.formContext) {\r\n\t\t\tthis.formContext = new FormContext(this, false);\r\n\t\t}\r\n        return <>{this.schema.map((v, index) => {\r\n            return <React.Fragment key={index}>{factory(this.formContext, v, children)}</React.Fragment>\r\n        })}</>;\r\n    }\r\n\r\n    private initData(formData: any) {\r\n        if (formData === undefined) formData = {};\r\n        if (this.uiSchema !== undefined) {\r\n            let {items} = this.uiSchema;\r\n            if (items !== undefined) {\r\n                for (let i in items) {\r\n                    let ui = items[i];\r\n                    let dv = ui.defaultValue;\r\n                    if (dv !== undefined) {\r\n                        if (formData[i] === undefined) {\r\n                            formData[i] = dv;\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        for (let itemSchema of this.schema) {\r\n            this.initDataItem(itemSchema, this.data, formData);\r\n        }\r\n    }\r\n\r\n    private initDataItem(itemSchema: ItemSchema, data:any, formData: any):any {\r\n        let {name, type} = itemSchema;\r\n        if (type === 'button') return;\r\n        if (type !== 'arr') {\r\n            data[name] = formData[name];\r\n            return;\r\n        }\r\n\r\n        let arrItem:ArrSchema = itemSchema as ArrSchema;\r\n        let {arr:arrItems} = arrItem;\r\n        if (arrItems === undefined) return;\r\n        let arrDict:any = arrItem.itemSchemas = {};\r\n        for (let item of arrItems) {\r\n            arrDict[item.name] = item;\r\n        }\r\n        let val:any[] = formData[name];\r\n        if (val === undefined) val = [];\r\n        else if (Array.isArray(val) === false) val = [val];\r\n        let arr:any[] = [];\r\n        for (let row of val) {\r\n            let {$isSelected, $isDeleted} = row;\r\n            let r = {\r\n                $source: row,\r\n                $isSelected: $isSelected,\r\n                $isDeleted: $isDeleted,\r\n            };\r\n            for (let item of arrItems) {\r\n                this.initDataItem(item, r, row);\r\n            }\r\n            arr.push(r);\r\n        }\r\n        // 如果没有observable，行删除标志点击不管用\r\n        // 不知道这里为什么要去掉observable。有可能会有别的问题\r\n        data[name] = observable(arr);\r\n        //data[name] = arr;\r\n        return;\r\n    }\r\n\r\n    private watch = () => {\r\n        let {formData} = this.props;\r\n        if (formData === undefined) return;\r\n        //this.initData(formData);\r\n        this.calcSelectOrDelete();\r\n    }\r\n    private calcSelectOrDelete() {\r\n        for (let itemSchema of this.schema) {\r\n            this.arrItemOperated(itemSchema);\r\n        }\r\n    }\r\n\r\n    private arrItemOperated(itemSchema: ItemSchema) {\r\n        let {name, type} = itemSchema;\r\n        if (type !== 'arr') return;\r\n        if (this.data === undefined) return;\r\n        let formArrVal = this.data[name];\r\n        if (formArrVal === undefined) return;\r\n        let {arr: arrItems} = itemSchema as ArrSchema;\r\n        for (let row of formArrVal) {\r\n            let {$source} = row;\r\n            if ($source === undefined) continue;\r\n            let {$isSelected, $isDeleted} = $source;\r\n            row.$isSelected = $isSelected;\r\n            row.$isDeleted = $isDeleted;\r\n            //console.log($isSelected, $isDeleted);\r\n            for (let item of arrItems) {\r\n                this.arrItemOperated(item);\r\n            }\r\n        }\r\n    }\r\n\r\n    componentDidMount() {\r\n        let {beforeShow} = this.props;\r\n        if (beforeShow !== undefined) beforeShow(this.formContext);\r\n    }\r\n\r\n    componentWillUnmount() {\r\n        if (this.disposer !== undefined) this.disposer();\r\n    }\r\n\r\n    render() {\r\n        let content = this.renderContent();\r\n        return <ContextContainer.Provider value={this.formContext}>\r\n            {React.createElement(this.formContext.renderErrors)}\r\n            {this.Container(content)}\r\n        </ContextContainer.Provider>;\r\n    }\r\n\r\n    async buttonClick(buttonName:string) {\r\n        this.formContext.checkRules()\r\n        if (this.formContext.hasError === true) return;\r\n\r\n        let {onButtonClick} = this.formContext.form.props;\r\n        if (onButtonClick === undefined) {\r\n            alert(`you should define form onButtonClick`);\r\n            return;\r\n        }\r\n        let ret = await onButtonClick(buttonName, this.formContext);\r\n        if (ret === undefined) return;\r\n        this.formContext.setError(buttonName, ret);\r\n    }\r\n\r\n    protected DefaultContainer = (content:JSX.Element): JSX.Element => {\r\n        return <form className={classNames(this.props.className)} onSubmit={e=>e.preventDefault()}>\r\n            {content}\r\n        </form>;\r\n    }\r\n    protected DefaultFieldContainer = (label:string|JSX.Element, content:JSX.Element): JSX.Element => {\r\n        let {fieldLabelSize} = this.props;\r\n\r\n        if (fieldLabelSize > 0) {\r\n            let labelView:any;\r\n            if (label === null) {\r\n                fieldLabelSize = 0;\r\n            }\r\n            else {\r\n                labelView = <label className={classNames('col-sm-' + fieldLabelSize, 'col-form-label')}>{label}</label>\r\n            }\r\n            let fieldCol = 'col-sm-' + (12 - fieldLabelSize);\r\n            return <div className=\"form-group row\">\r\n                {labelView}\r\n                <div className={fieldCol}>{content}</div>\r\n            </div>;\r\n        }\r\n        return <div className=\"form-group\">\r\n            {label===null? null:<label className=\"col-form-label\">{label}</label>}\r\n            {content}\r\n        </div>;\r\n    }\r\n    protected DefaultFieldClass:string = undefined;\r\n    protected DefaultButtonClass = 'text-center py-2';\r\n    protected DefaultRes:FormRes = resLang<FormRes>(formRes);\r\n\r\n    ArrContainer = (label:any, content:JSX.Element): JSX.Element => {\r\n        return <div>\r\n            <div className={classNames('small text-muted text-center bg-light py-1 px-3 mt-4 mb-1')}>{label}</div>\r\n            {content}\r\n        </div>;\r\n    }\r\n    RowContainer = (content:JSX.Element): JSX.Element => {\r\n        let cn = classNames({\r\n            'py-3': true\r\n        });\r\n        return <div className={cn}>{content}</div>\r\n    }\r\n    RowSeperator = <div className=\"border border-gray border-top\" />;\r\n}\r\n","import * as React from 'react';\nimport { factory } from './widgets';\nimport { ContextContainer, Context } from './context';\n\nexport interface FieldProps {\n    name: string;\n}\n\nexport class FormField extends React.Component<FieldProps> {\n    static contextType = ContextContainer;\n    render() {\n        let {name, children } = this.props;\n        let context:Context = this.context;\n        if (context === undefined) return <span className=\"text-danger\">!only in Form!</span>;\n        let itemSchema = context.getItemSchema(name);\n        let content = factory(context, itemSchema, children, this.props);\n        if (content === undefined) {\n            return <span className=\"text-danger\">!!{name} is not defined!!</span>;\n        }\n        return content;\n    }\n}\n","import * as React from 'react';\nimport { UiTextItem } from '../schema';\nimport { nav } from '../nav';\nimport { Page } from '../page/page';\nimport { observer } from 'mobx-react';\nimport { ItemEdit } from './itemEdit';\n\nexport interface InputOptions {\n\ttype: string;\n\tmin?: number;\n\tmax?: number;\n\tstep?: number;\n}\n\nexport class StringItemEdit extends ItemEdit {\n    get uiItem(): UiTextItem {return this._uiItem as UiTextItem}\n    protected async internalStart():Promise<any> {\n        return new Promise<any>((resolve, reject) => {\n            let element = React.createElement(this.page, {resolve, reject});\n            nav.push(element,reject);\n        });\n    }\n\n    private onChange = (evt: React.ChangeEvent<HTMLInputElement>) => {\n        this.newValue = evt.target.value;\n        let preValue = this.value;\n        this.isChanged = (this.newValue !== preValue);\n    }\n\n    private onBlur = (evt: React.ChangeEvent<HTMLInputElement>) => {\n        this.verifyValue();\n    }\n\n    private onFocus = () => {\n        this.error = undefined;\n\t}\n\t\n\tprotected inputOptions():InputOptions {\n\t\treturn {\n\t\t\ttype: 'text',\n\t\t}\n\t}\n\n    private page = observer((props:{resolve:(value:any)=>void, reject: (resean?:any)=>void}):JSX.Element => {\n\t\tlet {resolve} = props;\n\t\tlet onSave = () => {\n\t\t\tthis.verifyValue();\n\t\t\tif (this.error === undefined) {\n\t\t\t\tlet val = this.newValue;\n\t\t\t\tresolve(val);\t\t\t\t\n\t\t\t}\n\t\t}\n        let right = <button\n            className=\"btn btn-sm btn-success align-self-center mr-2\"\n            disabled={!this.isChanged}\n            onClick={onSave}>保存</button>;\n\t\tlet onKeyDown = (evt: React.KeyboardEvent<HTMLInputElement>) => {\n\t\t\tif (evt.keyCode === 13) onSave();\n\t\t}\n\t\tlet {type, max, min, step} = this.inputOptions();\n        return <Page header={this.label} right={right}>\n            <div className=\"m-3\">\n\t\t\t\t<input type={type}\n\t\t\t\t\tonChange={this.onChange}\n\t\t\t\t\tonKeyDown={onKeyDown}\n                    onBlur={this.onBlur}\n                    onFocus={this.onFocus}\n                    className=\"form-control\" \n                    defaultValue={this.value} min={min} max={max} step={step} />\n                {\n                    this.uiItem && <div className=\"small muted m-2\">{this.uiItem.placeholder}</div>\n                }\n                {this.error && <div className=\"text-danger\">{this.error}</div>}\n            </div>\n        </Page>;\n    })\n}\n","import * as React from 'react';\nimport { UiRadio } from '../schema';\nimport { nav } from '../nav';\nimport { Page } from '../page/page';\nimport { observer } from 'mobx-react';\nimport { ItemEdit } from './itemEdit';\n\nexport class RadioItemEdit extends ItemEdit {\n    get uiItem(): UiRadio {return this._uiItem as UiRadio}\n\n\tinit() {\n        if (this.value === undefined) {\n            this.value = this._uiItem===undefined? undefined : this._uiItem.defaultValue;\n        }\n\t}\n\n    protected async internalStart():Promise<any> {\n        return new Promise<any>((resolve, reject) => {\n            let element = React.createElement(this.page, {resolve:resolve, reject:reject});\n            nav.push(element,reject);\n        });\n    }\n\n    private onChange = (value: any) => {\n        this.newValue = value;\n        let preValue = this.value;\n        this.isChanged = (this.newValue !== preValue);\n    }\n\n    private page = observer((props:{resolve:(value:any)=>void, reject: (resean?:any)=>void}):JSX.Element => {\n        let {resolve} = props;\n        let {name} = this.itemSchema;\n        let {list} = this.uiItem;\n        let right = <button\n            className=\"btn btn-sm btn-success align-self-center\"\n            disabled={!this.isChanged}\n            onClick={()=>{\n                this.verifyValue();\n                if (this.error === undefined) resolve(this.newValue);\n            }}>保存</button>;\n        let content = list?\n            list.map((v, index:number) => {\n                let {title, value} = v;\n                return <div key={index} className=\"col\"><label className=\"px-3 py-2 cursor-pointer\">\n                    <input name={name} type=\"radio\" value={value} \n                        onClick={()=>this.onChange(value)} \n                        defaultChecked={value === this.value} /> {title || value} &nbsp;\n                </label></div>;\n            })\n            :\n            <>no list defined</>;\n        return <Page header={'更改' + this.label} right={right}>\n            <div className=\"m-3\">\n\t\t\t\t<div className=\"row row-cols-2 row-cols-sm-3 row-cols-md-4\">{content}</div>\n\t\t\t</div>\n        </Page>;\n    })\n}\n","import * as React from 'react';\nimport { UiSelect } from '../schema';\nimport { nav } from '../nav';\nimport { Page } from '../page/page';\nimport { observer } from 'mobx-react';\nimport { ItemEdit } from './itemEdit';\n\nexport class SelectItemEdit extends ItemEdit {\n    get uiItem(): UiSelect {return this._uiItem as UiSelect}\n    protected async internalStart():Promise<any> {\n        return new Promise<any>((resolve, reject) => {\n            let element = React.createElement(this.page, {resolve:resolve, reject:reject});\n            nav.push(element,reject);\n        });\n    }\n\n    private onChange = (value:any) => {\n        this.newValue = value;\n        let preValue = this.value;\n        this.isChanged = (this.newValue !== preValue);\n    }\n\n    private page = observer((props:{resolve:(value:any)=>void, reject: (resean?:any)=>void}):JSX.Element => {\n        let {resolve} = props;\n        let {list} = this.uiItem;\n        let content = list?\n            list.map((v, index:number) => {\n                let {title, value} = v;\n                return <div key={index} className=\"px-3 py-2 cursor-pointer bg-white mb-1\" onClick={()=>{this.onChange(value); resolve(this.newValue)}}>\n                    {title || value}\n                </div>;\n            })\n            :\n            <>no list defined</>;\n        return <Page header={'更改' + this.label}>\n            <div className=\"my-3\">\n                {content}\n            </div>\n        </Page>;\n    })\n}\n","import * as React from 'react';\nimport { UiIdItem } from '../schema';\nimport { Page } from '../page/page';\nimport { observer } from 'mobx-react';\nimport { ItemEdit } from './itemEdit';\n\nexport class IdItemEdit extends ItemEdit {\n    get uiItem(): UiIdItem {return this._uiItem as UiIdItem}\n    protected async internalStart():Promise<any> {\n        return new Promise<any>(async (resolve, reject) => {\n            //let element = React.createElement(this.page, {resolve:resolve, reject:reject});\n            //nav.push(element,reject);\n\n            let {pickId} = this.uiItem;\n            if (pickId === undefined) {\n                alert('IdItemEdit.pickId = undefined');\n                return;\n            }\n            let boxId = await pickId(undefined, undefined, this.value);\n            //if (typeof id === 'object') {\n            //    id = (id as any).id;\n            //}\n            this.onChange(boxId.id);\n            resolve(boxId);\n            //this.newValue = id;\n        });\n    }\n\n    protected async internalEnd():Promise<void> {}\n\n    private onChange = (value:any) => {\n        this.newValue = value;\n        let preValue = this.value;\n        this.isChanged = (this.newValue !== preValue);\n    }\n\n    private page = observer((props:{resolve:(value:any)=>void, reject: (resean?:any)=>void}):JSX.Element => {\n        /*\n        let {resolve, reject} = props;\n        let {list} = this.uiItem;\n        let content = list?\n            list.map((v, index:number) => {\n                let {title, value} = v;\n                return <div key={index} className=\"px-3 py-2 cursor-pointer bg-white mb-1\" onClick={()=>{this.onChange(value); resolve(this.newValue)}}>\n                    {title || value}\n                </div>;\n            })\n            :\n            <>no list defined</>;\n        return <Page header={'更改' + this.label}>\n            <div className=\"my-3\">\n                {content}\n            </div>\n        </Page>;\n        */\n        return <Page header={'更改' + this.label}>\n            ddd\n        </Page>\n    })\n}\n","import * as React from 'react';\nimport { UiTag } from '../schema';\nimport { nav } from '../nav';\nimport { Page } from '../page/page';\nimport { observer } from 'mobx-react';\nimport { ItemEdit } from './itemEdit';\n\nabstract class TagItemEdit extends ItemEdit {\n\tprotected inputs: {[index:number]: HTMLInputElement} = {};\n\tprotected inputType: 'checkbox' | 'radio';\n    get uiItem(): UiTag {return this._uiItem as UiTag};\n\n\tinit() {\n        if (this.value === undefined) {\n            this.value = this._uiItem===undefined? undefined : this._uiItem.defaultValue;\n        }\n\t}\n\n    protected async internalStart():Promise<any> {\n        return new Promise<any>((resolve, reject) => {\n            let element = React.createElement(this.page, {resolve:resolve, reject:reject});\n            nav.push(element,reject);\n        });\n\t}\n\t\n\trenderContent() {\n\t\tlet valuesView = this.uiItem.valuesView;\n\t\tif (valuesView === undefined) return super.renderContent();\n\t\treturn valuesView.render(this.value);\n\t}\n\n\tprotected abstract renderInputs():JSX.Element;\n    private page = observer((props:{resolve:(value:any)=>void, reject: (resean?:any)=>void}):JSX.Element => {\n        let {resolve} = props;\n        let right = <button\n            className=\"btn btn-sm btn-success align-self-center\"\n            disabled={!this.isChanged}\n            onClick={()=>{\n                this.verifyValue();\n                if (this.error === undefined) resolve(this.newValue);\n\t\t\t}}>保存</button>;\n\t\t/*\n        let content = list?\n            list.map((v, index:number) => {\n                let {name:itemName, id} = v;\n                return <div key={index} className=\"col\"><label className=\"px-3 py-2 cursor-pointer\">\n                    <input ref={input=>this.inputs[id] = input} name={name} type={this.inputType} value={id} \n\t\t\t\t\t\tonClick={(e)=>this.onChange(e.currentTarget.checked, id)}\n                        defaultChecked={this.defaultChecked(id)} /> {itemName} &nbsp;\n                </label></div>;\n            })\n            :\n\t\t\t<>no list defined</>;\n\t\t*/\n        return <Page header={'更改' + this.label} right={right}>\n\t\t\t<div className=\"p-3\">\n\t\t\t\t{this.renderInputs()}\n\t\t\t</div>\n        </Page>;\n    })\n}\n\nexport class TagSingleItemEdit extends TagItemEdit {\n\tprotected inputType:'radio'|'checkbox' = 'radio';\n    protected onInputChange = (evt: React.ChangeEvent<HTMLInputElement>) => {\n\t\tlet {currentTarget} = evt;\n\t\tif (currentTarget.checked === false) return;\n        this.newValue = Number(currentTarget.value);\n        let preValue = this.value;\n        this.isChanged = (this.newValue !== preValue);\n\t}\n\t\n\tprotected renderInputs():JSX.Element {\n\t\tlet {valuesView} = this.uiItem;\n\t\tlet options = {\n\t\t\tinputs: this.inputs,\n\t\t\tonInputChange: this.onInputChange,\n\t\t};\n\t\treturn valuesView.renderRadios(this.value, options);\n\t}\n}\n\nexport class TagMultiItemEdit extends TagItemEdit {\n\t//private arr:number[];\n\tprotected inputType:'radio'|'checkbox' = 'checkbox';\n\n\tprivate onInputChange = (evt: React.ChangeEvent<HTMLInputElement>) => {\n\t\tlet values:string[] = [];\n\t\tfor (let i in this.inputs) {\n\t\t\tlet input = this.inputs[i];\n\t\t\tif (input.checked === true) values.push(input.value);\n\t\t}\n        this.newValue = values.join('|');\n        //this.newValue = value;\n        let preValue = this.value;\n        this.isChanged = (this.newValue !== preValue);\n\t}\n\tprotected renderInputs():JSX.Element {\n\t\tlet {valuesView} = this.uiItem;\n\t\tlet options = {\n\t\t\tinputs: this.inputs,\n\t\t\tonInputChange: this.onInputChange\n\t\t};\n\t\treturn valuesView.renderChecks(this.value, options);\n\t}\n}\n","import * as React from 'react';\nimport { UiTextItem } from '../schema';\nimport { nav } from '../nav';\nimport { Page } from '../page/page';\nimport { observer } from 'mobx-react';\nimport { ItemEdit } from './itemEdit';\n\nexport class TextAreaItemEdit extends ItemEdit {\n    get uiItem(): UiTextItem {return this._uiItem as UiTextItem}\n    protected async internalStart():Promise<any> {\n        return new Promise<any>((resolve, reject) => {\n            let element = React.createElement(this.page, {resolve, reject});\n            nav.push(element,reject);\n        });\n    }\n\n    private onChange = (evt: React.ChangeEvent<HTMLTextAreaElement>) => {\n        this.newValue = evt.target.value;\n        let preValue = this.value;\n        this.isChanged = (this.newValue !== preValue);\n    }\n\n    private onBlur = (evt: React.ChangeEvent<HTMLTextAreaElement>) => {\n        this.verifyValue();\n    }\n\n    private onFocus = () => {\n        this.error = undefined;\n    }\n\n    private page = observer((props:{resolve:(value:any)=>void, reject: (resean?:any)=>void}):JSX.Element => {\n\t\tlet {resolve} = props;\n\t\tlet onSave = () => {\n\t\t\tthis.verifyValue();\n\t\t\tif (this.error === undefined) {\n\t\t\t\tlet val = this.newValue;\n\t\t\t\tresolve(val);\t\t\t\t\n\t\t\t}\n\t\t}\n        let right = <button\n            className=\"btn btn-sm btn-success align-self-center mr-2\"\n            disabled={!this.isChanged}\n            onClick={onSave}>保存</button>;\n\t\tlet onKeyDown = (evt: React.KeyboardEvent<HTMLTextAreaElement>) => {\n\t\t\t// if (evt.keyCode === 13) onSave();\n\t\t}\n        return <Page header={this.label} right={right}>\n            <div className=\"m-3\">\n                <textarea\n\t\t\t\t\tonChange={this.onChange}\n\t\t\t\t\tonKeyDown={onKeyDown}\n                    onBlur={this.onBlur}\n                    onFocus={this.onFocus}\n                    className=\"form-control\" \n\t\t\t\t\tdefaultValue={this.value}\n\t\t\t\t\trows={6} />\n                {\n                    this.uiItem && <div className=\"small muted m-2\">{this.uiItem.placeholder}</div>\n                }\n                {this.error && <div className=\"text-danger\">{this.error}</div>}\n            </div>\n        </Page>;\n    })\n}\n","import React from 'react';\nimport { UiCheckItem } from '../schema';\nimport { ItemEdit } from './itemEdit';\n\nexport class CheckBoxItemEdit extends ItemEdit {\n\tprivate input: HTMLInputElement;\n    get uiItem(): UiCheckItem {return this._uiItem as UiCheckItem}\n\tget editInRow(): boolean {return true;}\n    protected async internalStart():Promise<any> {\n\t\tif (!this.input) return;\n\t\tlet uiItem = this.uiItem;\n\t\tif (uiItem === undefined) return this.input.checked;\n\t\tlet {checked} = this.input;\n\t\treturn this.getValue(checked);\n    }\n\tasync end():Promise<any> {}\n\trenderContent() {\n\t\tlet {readOnly} = this.uiItem;\n\t\tlet disabled = readOnly === true;\n\t\tlet onChange:any;\n\t\tif (readOnly !== true) onChange = this.onChange;\n\t\treturn <input ref={r => this.input=r} type=\"checkbox\" \n\t\t\tdefaultChecked={this.value} disabled={disabled}\n\t\t\tonChange={onChange} />\n\t}\n\n\tprivate getValue(checked: boolean) {\n\t\tlet {trueValue, falseValue} = this.uiItem;\n        return checked === true? (trueValue??true) : (falseValue??false);\n\t}\n\n    private onChange = (evt: React.ChangeEvent<HTMLInputElement>) => {\n        this.newValue = this.getValue(evt.target.checked);\n        let preValue = this.value;\n\t\tthis.isChanged = (this.newValue !== preValue);\n\t\tthis.edit.onItemChanged(this, this.newValue);\n    }\n}\n","import { UiRange } from \"../schema\";\nimport { InputOptions, StringItemEdit } from \"./stringItemEdit\";\n\nexport class RangeItemEdit extends StringItemEdit {\n\tprotected inputOptions():InputOptions {\n\t\tlet min:number, max:number, step:number;\n\t\tif (this._uiItem) {\n\t\t\tmin = (this._uiItem as UiRange).min\n\t\t\tmax = (this._uiItem as UiRange).max\n\t\t\tstep = (this._uiItem as UiRange).step\n\t\t}\n\t\treturn {\n\t\t\ttype: 'range',\n\t\t\tmin, max, step\n\t\t}\n\t}\n}\n","import { UiNumberItem } from \"../schema\";\nimport { InputOptions, StringItemEdit } from \"./stringItemEdit\";\n\nexport class NumberItemEdit extends StringItemEdit {\n\tprotected inputOptions():InputOptions {\n\t\tlet min:number, max:number, step:number;\n\t\tif (this._uiItem) {\n\t\t\tmin = (this._uiItem as UiNumberItem).min\n\t\t\tmax = (this._uiItem as UiNumberItem).max\n\t\t\tstep = (this._uiItem as UiNumberItem).step\n\t\t}\n\t\treturn {\n\t\t\ttype: 'number',\n\t\t\tmin, max, step\n\t\t}\n\t}\n}\n","import * as React from 'react';\n//import _ from 'lodash';\nimport { observer } from 'mobx-react';\nimport { Schema, UiSchema, ItemSchema, UiItem, UiRadio, UiTagSingle, UiTagMulti } from '../schema';\nimport { ItemEdit } from './itemEdit';\nimport { StringItemEdit } from './stringItemEdit';\nimport { ImageItemEdit } from './imageItemEdit';\nimport { RadioItemEdit } from './radioItemEdit';\nimport { SelectItemEdit } from './selectItemEdit';\nimport { IdItemEdit } from './idItemEdit';\nimport { TagSingleItemEdit, TagMultiItemEdit } from './tagItemEdit';\nimport { TextAreaItemEdit } from './textAreaItemEdit';\nimport { CheckBoxItemEdit } from './checkBoxItemEdit';\nimport { RangeItemEdit } from './rangeItemEdit';\nimport { NumberItemEdit } from './numberItemEdit';\n\nexport interface EditProps {\n    className?: string;\n    schema: Schema;\n    data: any;\n    onItemClick?: (itemSchema: ItemSchema, uiItem: UiItem, value: any) => Promise<void>;\n    onItemChanged?: (itemSchema: ItemSchema, newValue:any, preValue:any) => Promise<void>;\n    stopEdit?: boolean;\n    uiSchema?: UiSchema;\n    sepClassName?: string;\n    topBorderClassName?: string;\n    bottomBorderClassName?: string;\n    rowContainerClassName?: string;\n}\n\n@observer\nexport class Edit extends React.Component<EditProps> {\n    private defaultSepClassName = 'border-top edit-sep-light-gray';\n    private defaultRowContainerClassName = 'd-flex px-3 py-2 bg-white align-items-center';\n    private topBorder:JSX.Element;\n    private bottomBorder:JSX.Element;\n    private rowContainerClassName?: string;\n    private sep:JSX.Element;\n\tprivate uiSchema: {[name:string]: UiItem};\n\n    constructor(props: EditProps) {\n        super(props);\n        let {topBorderClassName, bottomBorderClassName, sepClassName, rowContainerClassName, uiSchema} = props;\n        this.topBorder = <div className={topBorderClassName || this.defaultSepClassName} />;\n        this.bottomBorder = <div className={bottomBorderClassName || this.defaultSepClassName} />;\n        this.rowContainerClassName = rowContainerClassName || this.defaultRowContainerClassName;\n        //if (stopEdit !== true) this.rowContainerClassName += ' cursor-pointer';\n        this.sep = <div className={sepClassName || this.defaultSepClassName} />;\n\t\tthis.uiSchema = (uiSchema && uiSchema.items) || {};\n    }\n\n    render() {\n        let {schema} = this.props;\n\t\tlet sep:any;\n        return <div>\n\t\t\t{this.topBorder}\n            {schema.map((itemSchema, index) => {\n\t\t\t\tlet {stopEdit} = this.props;\n\t\t\t\tlet {name} = itemSchema;\n\t\t\t\tlet uiItem = this.uiSchema===undefined? undefined : this.uiSchema[name];\n\t\t\t\tlet label:string, labelHide:any;\n\t\t\t\tif (uiItem !== undefined) {\n\t\t\t\t\tlabel = uiItem.label || name;\n\t\t\t\t\tlabelHide = uiItem.labelHide;\n\t\t\t\t};\n\t\t\t\tlet value = this.props.data[name];\n\t\t\t\tlet itemEdit = createItemEdit(this, itemSchema, uiItem, label, value);\n\t\t\t\tlet rowContainerClassName = this.rowContainerClassName;\n\t\t\t\tlet {editInRow} = itemEdit;\n\t\t\t\tif (editInRow === false) {\n\t\t\t\t\tif (stopEdit !== true) editInRow = false;\n\t\t\t\t}\n\t\t\t\tif (editInRow === false) rowContainerClassName += ' cursor-pointer';\n\n\t\t\t\tlet {required} = itemSchema;\n\t\t\t\tlet requireFlag = required===true && <span className=\"text-danger\">*</span>;\n\t\t\t\tlet divLabel:any, cn:string = 'flex-fill d-flex ';\n\t\t\t\tif (labelHide === true) {\n\t\t\t\t\tdivLabel = undefined;\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tdivLabel = <div>{label} {requireFlag}</div>;\n\t\t\t\t\tcn += 'justify-content-end';\n\t\t\t\t}\n\t\t\t\tlet ret = <React.Fragment key={index}>\n\t\t\t\t\t{sep}\n\t\t\t\t\t<div className={'d-flex align-items-center' + rowContainerClassName} \n\t\t\t\t\t\tonClick={async ()=>await this.rowClick(itemEdit)}>\n\t\t\t\t\t\t{divLabel}\n\t\t\t\t\t\t<div className={cn}>{\n\t\t\t\t\t\t\titemEdit===undefined? undefined: itemEdit.renderContent()\n\t\t\t\t\t\t}</div>\n\t\t\t\t\t\t{editInRow === false && <div className=\"w-2c text-right\"><i className=\"fa fa-angle-right\" /></div>}\n\t\t\t\t\t</div>\n\t\t\t\t</React.Fragment>;\n\t\t\t\tsep = this.sep;\n\t\t\t\treturn ret;\n\t\t\t})}\n\t\t\t{this.bottomBorder}\n\t\t</div>;\n    }\n\n\tasync onItemChanged(itemEdit:ItemEdit, newValue:any) {\n\t\tlet {itemSchema, uiItem, value} = itemEdit;\n\t\tthis.props.data[itemSchema.name] = newValue;\n        let {onItemChanged, stopEdit} = this.props;\n\t\tif (stopEdit === true) return;\n\t\tif (uiItem?.readOnly === true) return;\n\t\tif (onItemChanged === undefined) {\n\t\t\talert(`${itemSchema.name} value changed, new: ${newValue}, pre: ${value}`);\n\t\t\t// 2020-04-15：改值之后，应该赋值吧。所以这一句移到前面去\n\t\t\t//this.props.data[itemSchema.name] = changeValue;\n\t\t}\n\t\telse {\n\t\t\tawait onItemChanged(itemSchema, newValue, value);\n\t\t}\n\t}\n\n\tprivate rowClick = async (itemEdit:ItemEdit) => {\n\t\tif (itemEdit === undefined) {\n\t\t\talert('item has no edit');\n\t\t\treturn;\n\t\t}\n\t\tlet {itemSchema, uiItem, value, editInRow} = itemEdit;\n\t\tif (editInRow === true) return;\n        let {onItemChanged, onItemClick, stopEdit} = this.props;\n\t\tif (stopEdit === true) return;\n\t\tif (uiItem?.readOnly === true) return;\n        let changeValue:any;\n        if (onItemClick !== undefined) {\n            await onItemClick(itemSchema, uiItem, value);\n            return;\n        }\n        //let itemEdit:ItemEdit = createItemEdit(itemSchema, uiItem, label, value);\n        if (itemEdit === undefined) {\n            alert('undefined: let itemEdit:ItemEdit = createItemEdit(itemSchema, uiItem, label, value);');\n            return;\n        }\n        try {\n            changeValue = await itemEdit.start();\n            if (changeValue !== value) {\n\t\t\t\t// 2020-04-15：改值之后，应该赋值吧。所以移到这里来\n\t\t\t\tthis.props.data[itemSchema.name] = changeValue;\n                if (onItemChanged === undefined) {\n                    alert(`${itemSchema.name} value changed, new: ${changeValue}, pre: ${value}`);\n\t\t\t\t\t// 2020-04-15：改值之后，应该赋值吧。所以这一句移到前面去\n                    //this.props.data[itemSchema.name] = changeValue;\n                }\n                else {\n                    await onItemChanged(itemSchema, changeValue, value);\n                }\n            }\n            await itemEdit.end();\n        }\n        catch (err) {\n            // 如果直接back，会触发reject，就到这里了\n\t\t\tconsole.log('no value changed');\n\t\t\tconsole.error(err);\n        }\n    }\n}\n\ntype NewItemEdit = new (edit: Edit, itemSchema: ItemSchema, uiItem:UiItem, label:string, value: any) => ItemEdit;\n\nfunction createItemEdit(edit: Edit, itemSchema: ItemSchema, uiItem:UiItem, label:string, value: any):ItemEdit {\n\tlet ie: ItemEdit;\n    let itemEdit: NewItemEdit;\n    if (uiItem !== undefined) {\n        switch (uiItem.widget) {\n            default: break;\n            case 'id': itemEdit = IdItemEdit; break;\n\t\t\tcase 'text': itemEdit = StringItemEdit; break;\n\t\t\tcase 'textarea': itemEdit = TextAreaItemEdit; break;\n            case 'image': itemEdit = ImageItemEdit; break;\n\t\t\tcase 'select': itemEdit = SelectItemEdit; break;\n\t\t\tcase 'range': itemEdit = RangeItemEdit; break;\n\t\t\tcase 'number':\n\t\t\tcase 'updown': itemEdit = NumberItemEdit; break;\n\t\t\tcase 'checkbox': itemEdit = CheckBoxItemEdit; break;\n            case 'radio': \n\t\t\t\tie = new RadioItemEdit(edit, itemSchema, uiItem as UiRadio, label, value);\n\t\t\t\tbreak;\n\t\t\tcase 'tagSingle':\n\t\t\t\tie = new TagSingleItemEdit(edit, itemSchema, uiItem as UiTagSingle, label, value);\n\t\t\t\tbreak;\n\t\t\tcase 'tagMulti':\n\t\t\t\tie = new TagMultiItemEdit(edit, itemSchema, uiItem as UiTagMulti, label, value);\n\t\t\t\tbreak;\n\t\t\t}\n\t}\n\tif (ie === undefined) {\n\t\tif (itemEdit === undefined) {\n\t\t\tswitch (itemSchema.type) {\n\t\t\t\tcase 'string': itemEdit = StringItemEdit; break;\n\t\t\t\tcase 'image': itemEdit = ImageItemEdit; break;\n\t\t\t\tcase 'boolean': itemEdit = CheckBoxItemEdit; break;\n\t\t\t\tcase 'number':\n\t\t\t\tcase 'integer': itemEdit = RangeItemEdit; break;\n\t\t\t}\n\t\t}\n\t\tif (itemEdit === undefined) return;\n\t\tie = new itemEdit(edit, itemSchema, uiItem, label, value);\n\t}\n\tie.init();\n\treturn ie;\n}\n","import {CenterApiBase} from '../net';\n\nexport class CenterApi extends CenterApiBase {\n    async userAppUnits(app:number):Promise<any[]> {\n        return await this.get('tie/user-app-units', {app:app});\n    }\n    async userFromId(userId:number):Promise<any> {\n        return await this.get('user/user-name-nick-icon-from-id', {userId:userId});\n\t}\n\tasync userFromKey(userName:string):Promise<any> {\n\t\treturn await this.get('tie/user-from-key', {key:userName});\n\t}\n}\n\nexport const centerApi = new CenterApi('tv/', undefined);\n","import * as React from 'react';\nimport { Page, FA, nav, LMR, List } from \"../components\";\nimport { VPage } from '../vm';\nimport { appInFrame } from '../net';\nimport { CAppBase } from \"./CAppBase\";\nimport { UQsMan } from '../uq';\n\n/*\nexport class VAppMain extends VPage<CMainBase> {\n    async open(param?:any) {\n        this.openPage(this.appPage);\n    }\n\n    render(param?:any) {\n        return this.appContent();\n    }\n\n    protected appPage = () => {\n        let {caption} = this.controller;\n        return <Page header={caption} logout={async()=>{appInFrame.unit = undefined}}>\n            {this.appContent()}\n        </Page>;\n    }\n\n    protected appContent = () => {\n        let {cUqArr} = this.controller;\n        let content:any;\n        if (cUqArr.length === 0) {\n            content = <div className=\"text-danger\">\n                <FA name=\"\" /> 此APP没有绑定任何的UQ\n            </div>;\n        }\n        else {\n            content = cUqArr.map((v,i) => <div key={i}>{v.render()}</div>);\n        }\n        return <>{content}</>;\n    };\n}\n*/\nexport class VUnsupportedUnit extends VPage<CAppBase> {\n    async open(predefinedUnit: number) {\n        this.openPage(this.page, {predefinedUnit:predefinedUnit});\n    }\n\n    private page = ({predefinedUnit}:{predefinedUnit: number}) => {\n        let {user} = nav;\n        let userName:string = user? user.name : '[未登录]';\n        let {appOwner, appName} = UQsMan.value;\n        return <Page header=\"APP无法运行\" logout={true}>\n            <div className=\"m-3 text-danger container\">\n                <div className=\"form-group row\">\n                    <div className=\"col-sm-3 font-weight-bold\">登录用户</div>\n                    <div className=\"col-sm text-body\">{userName}</div>\n                </div>\n                <div className=\"form-group row\">\n                    <div className=\"col-sm-3 font-weight-bold\">App</div>\n                    <div className=\"col-sm text-body\">{`${appOwner}/${appName}`}</div>\n                </div>\n                <div className=\"form-group row\">\n                    <div className=\"col-sm-3 font-weight-bold\">预设小号</div>\n                    <div className=\"col-sm text-body\">{predefinedUnit || <small className=\"\">[无预设小号]</small>}</div>\n                </div>\n                <div className=\"form-group row\">\n                    <div className=\"col-sm-3 font-weight-bold\">\n                        可能原因<FA name=\"exclamation-triangle\" />\n                    </div>\n                    <div className=\"col-sm text-body\">\n                        <ul className=\"p-0\">\n                            <li>没有小号运行 {appName}</li>\n                            <li>用户 <b>{userName}</b> 没有加入任何一个运行{appName}的小号</li>\n                            {\n                                predefinedUnit && \n                                <li>预设小号 <b>{predefinedUnit}</b> 没有运行App {appName}</li>\n                            }\n                        </ul>\n                    </div>\n                </div>\n                <div className=\"form-group row\">\n                    <div className=\"col-sm-3 font-weight-bold\">小号{predefinedUnit}</div>\n                    <div className=\"col-sm text-body\">\n                        预设小号定义在 public/unit.json 文件中。\n                        定义了这个文件的程序，只能由url直接启动。\n                        用户第一次访问app之后，会缓存在localStorage里。<br/>\n                        如果要删去缓存的预定义Unit，logout然后再login。\n                    </div>\n                </div>\n            </div>\n        </Page>;\n    }\n}\n\nexport class VUnitSelect extends VPage<CAppBase> {\n    async open() {\n        this.openPage(this.page);\n    }\n\n    private renderRow = (item: any, index: number):JSX.Element => {\n        let {id, nick, name} = item;\n        return <LMR className=\"px-3 py-2\" right={'id: ' + id}>\n            <div>{nick || name}</div>\n        </LMR>;\n    }\n    private onRowClick = async (appUnit: any) => {\n\t\tappInFrame.unit = appUnit.id; // 25;\n\t\tthis.controller.setAppUnit(appUnit);\n        await this.controller.start();\n    }\n\n    private page = () => {\n        return <Page header=\"选择小号\" logout={true}>\n            <List items={this.controller.appUnits} item={{render: this.renderRow, onClick: this.onRowClick}}/>\n        </Page>\n    }\n}\n\nexport class VErrorsPage extends VPage<CAppBase> {\n    async open(errors:string[]) {\n        this.openPage(this.page, {errors:errors});\n    }\n\n    private page = (errors:{errors:string[]}) => {\n        return <Page header=\"ERROR\">\n            <div className=\"m-3\">\n\t\t\t\t<div className=\"p-3 d-flex justify-content-center align-items-center\">\n\t\t\t\t\t<button className=\"btn btn-danger\" onClick={nav.resetAll}>重启网页</button>\n\t\t\t\t</div>\n\n                <div>Load Uqs 发生错误：</div>\n                {errors.errors.map((r, i) => <div key={i}>{r}</div>)}\n            </div>\n        </Page>;\n    }\n}\n\nexport class VStartError extends VPage<CAppBase> {\n    async open(error:any) {\n        this.openPage(this.page, {error:error});\n    }\n\n    private page = ({error}:{error:any}) => {\n        return <Page header=\"App start error!\">\n            <pre>\n                {typeof error === 'string'? error : error.message}\n            </pre>\n        </Page>;\n    }\n}","import { nav, t, setGlobalRes, RouteFunc, Hooks, Navigo, NamedRoute } from \"../components\";\r\nimport { Controller } from '../vm';\r\nimport { UQsMan, TVs } from \"../uq\";\r\nimport { appInFrame } from \"../net\";\r\nimport { centerApi } from \"./centerApi\";\r\nimport { VUnitSelect, VErrorsPage, VStartError, VUnsupportedUnit } from \"./vMain\";\r\n\r\nexport interface IConstructor<T> {\r\n    new (...args: any[]): T;\r\n}\r\n\r\nexport interface AppConfig {\r\n    appName: string;        // 格式: owner/appName\r\n    version: string;        // 版本变化，缓存的uqs才会重载\r\n    tvs: TVs;\r\n    uqNameMap?: {[uqName:string]: string};      // uqName='owner/uq' 映射到内存简单名字：uq, 可以注明映射，也可以自动。有可能重\r\n    loginTop?: JSX.Element;\r\n    oem?: string;               // 用户注册发送验证码的oem厂家，默认同花\r\n\tprivacy?: string;\r\n\tnoUnit?: boolean;\t\t\t// app的运行，不跟unit绑定\r\n\thtmlTitle?: string;\r\n}\r\n\r\nexport interface Elements {\r\n\t[id:string]: (element: HTMLElement)=>void,\r\n}\r\n\r\nexport abstract class CAppBase extends Controller {\r\n\tprivate appConfig: AppConfig;\r\n    protected _uqs: any;\r\n\r\n    protected readonly name: string;\r\n\tprotected readonly noUnit: boolean;\r\n\r\n    appUnits:any[];\r\n\r\n    constructor(config?: AppConfig) {\r\n\t\tsuper(undefined);\r\n\t\tthis.appConfig = config || (nav.navSettings as AppConfig);\r\n        let {appName, noUnit} = this.appConfig;\r\n        this.name = appName;\r\n        if (appName === undefined) {\r\n            throw new Error('appName like \"owner/app\" must be defined in MainConfig');\r\n        }\r\n\t\tthis.noUnit = noUnit;\r\n    }\r\n\r\n    get uqs(): any {return this._uqs;}\r\n\r\n\tinternalT(str:string):any {\r\n\t\treturn t(str);\r\n\t}\r\n\t\r\n\tprotected setRes(res:any) {\r\n\t\tsetGlobalRes(res);\r\n\t}\r\n\r\n\tprivate appUnit:any;\r\n\tprivate roleDefines: string[];\r\n\thasRole(role: string|number):boolean {\r\n\t\tlet nRole:number;\r\n\t\tif (typeof role === 'string') {\r\n\t\t\tif (role.length === 0) return false;\r\n\t\t\tlet index = this.roleDefines.findIndex(v => v === role);\r\n\t\t\tif (index < 0) return false;\r\n\t\t\tnRole = 1<<index;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tnRole = role;\r\n\t\t}\r\n\t\treturn (this.appUnit.roles & nRole) !== 0;\r\n\t}\r\n\r\n\tsetAppUnit(appUnit:any) {\r\n\t\tthis.appUnit = appUnit;\r\n\t\tlet {roleDefs} = appUnit;\r\n\t\tif (roleDefs) {\r\n\t\t\tthis.roleDefines = roleDefs.split('\\t');\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis.roleDefines = [];\r\n\t\t}\r\n}\r\n\t\r\n    protected async beforeStart():Promise<boolean> {\r\n        try {\r\n\t\t\tnav.onSysNavRoutes();\r\n\t\t\tthis.onNavRoutes();\r\n\t\t\t//if (nav.isRouting === false) {\r\n\t\t\t\t//await nav.init();\r\n\t\t\t\tlet {appName, version, tvs} = this.appConfig;\r\n\t\t\t\tawait UQsMan.load(appName, version, tvs);\r\n\t\t\t//}\r\n\t\t\tthis._uqs = UQsMan._uqs;\r\n\t\t\r\n            //let retErrors = await this.load();\r\n            //let app = await loadAppUqs(this.appOwner, this.appName);\r\n            // if (isDevelopment === true) {\r\n\t\t\t// 这段代码原本打算只是在程序员调试方式下使用，实际上，也可以开放给普通用户，production方式下\r\n\t\t\tlet retErrors = UQsMan.errors;\r\n            let {predefinedUnit} = appInFrame;\r\n            let {user} = nav;\r\n            if (user !== undefined && user.id > 0) {\r\n\t\t\t\tlet result = await centerApi.userAppUnits(UQsMan.value.id);\r\n\t\t\t\tthis.appUnits = result;\r\n\t\t\t\t/*\r\n\t\t\t\t// 老版本，只返回一个数组。新版本，返回两个数组。下面做两个数组的判断\r\n\t\t\t\tif (result.length === 0) {\r\n\t\t\t\t\tthis.appUnits = result;\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tif (Array.isArray(result[0]) === true) {\r\n\t\t\t\t\t\tthis.appUnits = result[0];\r\n\t\t\t\t\t\tlet result1 = result[1];\r\n\t\t\t\t\t\tif (Array.isArray(result1) === true) {\r\n\t\t\t\t\t\t\tthis.roleDefines = result1[0]?.roles?.split('\\t');\r\n\t\t\t\t\t\t\tif (this.roleDefines === undefined) this.roleDefines = [];\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\tthis.appUnits = result;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\t*/\r\n\t\t\t\tif (this.noUnit === true) return true;\r\n                switch (this.appUnits.length) {\r\n                    case 0:\r\n                        this.showUnsupport(predefinedUnit);\r\n\t\t\t\t\t\treturn false;\r\n                    case 1:\r\n\t\t\t\t\t\tlet appUnit = this.appUnits[0];\r\n\t\t\t\t\t\tthis.setAppUnit(appUnit);\r\n\t\t\t\t\t\tlet {id} = appUnit;\r\n                        let appUnitId = id;\r\n                        if (appUnitId === undefined || appUnitId < 0 || \r\n                            (predefinedUnit !== undefined && appUnitId !== predefinedUnit))\r\n                        {\r\n                            this.showUnsupport(predefinedUnit);\r\n                            return false;\r\n                        }\r\n                        appInFrame.unit = appUnitId;\r\n                        break;\r\n                    default:\r\n                        if (predefinedUnit>0 && this.appUnits.find(v => v.id===predefinedUnit) !== undefined) {\r\n                            appInFrame.unit = predefinedUnit;\r\n                            break;\r\n                        }\r\n                        this.openVPage(VUnitSelect);\r\n                        return false;\r\n                }\r\n            }\r\n            if (retErrors !== undefined) {\r\n                this.openVPage(VErrorsPage, retErrors);\r\n                return false;\r\n            }\r\n            return true;\r\n        }\r\n        catch (err) {\r\n            this.openVPage(VStartError, err);\r\n            return false;\r\n        }\r\n    }\r\n\tprotected async afterStart():Promise<void> {\r\n\t\tnav.resolveRoute();\r\n\t}\r\n\r\n    async userFromId(userId:number):Promise<any> {\r\n        return await centerApi.userFromId(userId);\r\n    }\r\n\r\n\tprotected on(routeFunc:RouteFunc, hooks?:Hooks):Navigo;\r\n\tprotected on(url:string, routeFunc:RouteFunc, hooks?:Hooks):Navigo;\r\n\tprotected on(regex:RegExp, routeFunc:RouteFunc, hooks?:Hooks):Navigo;\r\n\tprotected on(options: {[url:string]: RouteFunc|NamedRoute}):Navigo;\r\n\tprotected on(...args:any[]):Navigo {\r\n\t\treturn nav.on(args[0], args[1], args[2]);\r\n\t}\r\n\r\n\tprotected onNavRoutes() {return;}\r\n\r\n    private showUnsupport(predefinedUnit: number) {\r\n        nav.clear();\r\n        this.openVPage(VUnsupportedUnit, predefinedUnit);\r\n    }\r\n}\r\n","import { nav } from '../components';\r\nimport { AppConfig, CAppBase } from './CAppBase';\r\n\r\nexport async function start(CApp: new (config: AppConfig) => CAppBase, appConfig: AppConfig, isUserLogin?:boolean) {\t\r\n\tlet {htmlTitle} = appConfig;\r\n\tif (htmlTitle) {\r\n\t\tdocument.title = htmlTitle;\r\n\t}\r\n\tlet html = document.getElementsByTagName('html');\r\n\tlet html0 = html[0];\r\n\tif (html0) {\r\n\t\tlet version = html0?.getAttribute('data-version');\r\n\t\tif (version) appConfig.version = version;\r\n\t}\r\n\r\n\tnav.setSettings(appConfig);\r\n\tlet cApp = new CApp(appConfig);\r\n\tcApp.init();\r\n    await cApp.start(isUserLogin);\r\n}\r\n","import _ from 'lodash';\r\nimport { Controller, WebNav } from \"../vm\";\r\nimport { IConstructor } from \"./CAppBase\";\r\n\r\nexport abstract class CBase extends Controller {\r\n    protected readonly _uqs: any;\r\n    protected readonly _cApp: any;\r\n\r\n    constructor(cApp: any) {\r\n        super(cApp.res);\r\n        this._cApp = cApp;\r\n        this._uqs = cApp && cApp.uqs;\r\n\t}\r\n\r\n    protected get uqs(): any {return this._uqs}\r\n\tget cApp(): any {return this._cApp}\r\n\thasRole(role:string|number):boolean {\r\n\t\treturn this._cApp?.hasRole(role);\r\n\t}\r\n\r\n\tinternalT(str:string):any {\r\n\t\tlet r = super.internalT(str);\r\n\t\tif (r!==undefined) return r;\r\n\t\treturn this._cApp.internalT(str);\r\n\t}\r\n\r\n    protected newC<T extends CBase>(type: IConstructor<T>, param?:any):T {\r\n\t\tlet c = new type(this.cApp);\r\n\t\tc.init(param);\r\n\t\treturn c;\r\n    }\r\n\r\n    protected newSub<O extends CBase, T extends CSub<O>>(type: IConstructor<T>, param?:any):T {\r\n\t\tlet s = new type(this);\r\n\t\ts.init(param);\r\n\t\treturn s;\r\n\t}\r\n\t\r\n\tgetWebNav(): WebNav<any> {\r\n\t\tlet wn = this._cApp?.getWebNav();\r\n\t\tif (wn === undefined) return;\r\n\t\tlet ret = _.clone(wn);\r\n\t\t_.merge(ret, this.webNav);\r\n\t\treturn ret;\r\n\t}\r\n}\r\n\r\nexport abstract class CSub<T extends CBase> extends CBase {\r\n    protected _owner: T;\r\n\r\n    constructor(owner: T) {\r\n        super(owner.cApp);\r\n        this._owner = owner;\r\n\t}\r\n\r\n\tinternalT(str:string):any {\r\n\t\tlet r = super.internalT(str);\r\n\t\tif (r!==undefined) return r;\r\n\t\treturn this._owner.internalT(str);\r\n\t}\r\n\r\n    protected get owner(): CBase {return this._owner}\r\n\t\r\n\tgetWebNav(): WebNav<any> {\r\n\t\tlet wn = this._cApp?.getWebNav();\r\n\t\tif (wn === undefined) return;\r\n\t\tlet ownerWNs:WebNav<any>[] = [];\r\n\t\tfor (let p = this.owner; p!==undefined; p = (p as any)?.owner) {\r\n\t\t\townerWNs.push(p.webNav);\r\n\t\t}\r\n\t\tlet ret = _.clone(wn);\r\n\t\tfor (;;) {\r\n\t\t\tlet own = ownerWNs.pop();\r\n\t\t\tif (own === undefined) break;\r\n\t\t\t_.merge(ret, own);\r\n\t\t}\r\n\t\t_.merge(ret, this.webNav);\r\n\t\treturn ret;\r\n\t}\r\n}\r\n","import * as React from 'react';\nimport { IObservableArray, computed } from 'mobx';\nimport { PageItems } from '../../tool/pageItems';\nimport {List} from './index';\n\nexport abstract class ListBase {\n    protected list: List;\n    constructor(list: List) {\n        this.list = list;\n    }\n    get isPaged():boolean {\n        let items = this.list.props.items;\n        return (items !== null && items !== undefined && Array.isArray(items) === false);\n    }\n    get items():any[]|IObservableArray<any> {\n        let items = this.list.props.items;\n        if (items === null) return null;\n        if (items === undefined) return undefined;\n        if (Array.isArray(items) === true)\n            return items as IObservableArray<any>;\n        else\n            return (items as PageItems<any>).items;\n    }\n    @computed get loading():boolean {\n        let items = this.list.props.items;\n        if (items === null) return false;\n        if (items === undefined) return true;\n        let pageItems = items as PageItems<any>;\n        if (pageItems.items === undefined) return false;\n        return pageItems.loading;\n    }\n    get selectedItems():any[] { return undefined; }\n    //updateProps(nextProps:any) {}\n    dispose() {};\n    abstract render: (item:any, index:number) => JSX.Element;\n    protected renderContent(item:any, index:number) {\n        let {render} = this.list.props.item;\n        if (render === undefined) return <div className=\"px-3 py-2\">{JSON.stringify(item)}</div>;\n        return render(item, index);\n    }\n}\n","import * as React from 'react';\nimport classNames from 'classnames';\nimport {ListBase} from './base';\n\nexport class Clickable extends ListBase {\n    render = (item:any, index:number):JSX.Element => {\n        let {className, key, onClick} = this.list.props.item;\n        return <li key={key===undefined?index:key(item)} className={classNames('va-row-clickable', className)} onClick={()=>onClick && onClick(item)}>\n            {this.renderContent(item, index)}\n        </li>\n    }\n}\n","import * as React from 'react';\nimport classNames from 'classnames';\nimport { ListBase } from './base';\nimport { uid } from '../../tool/uid';\n\nexport class Static extends ListBase {\n    render = (item:any, index:number):JSX.Element => {\n        let {className, key} = this.list.props.item;\n        if (typeof item === 'string') {\n            let cn = classNames('va-list-gap', 'px-3', 'pt-1');\n            return <li key={uid()} className={cn}>{item}</li>;\n        }\n        return <li key={key===undefined?index:key(item)} className={classNames(className)}>\n            {this.renderContent(item, index)}\n        </li>\n    }\n}\n","import * as React from 'react';\nimport {observable, IObservableArray, isObservableArray, observe} from 'mobx';\nimport classNames from 'classnames';\nimport {ListBase} from './base';\nimport {uid} from '../../tool/uid';\nimport { PageItems } from '../../tool/pageItems';\nimport { List } from './index';\nimport { observer } from 'mobx-react';\n\nexport interface SelectableItem {\n    selected: boolean;\n    item: any;\n    labelId: string;\n}\n\nexport class Selectable extends ListBase {\n    @observable private _items: SelectableItem[];\n    private inputItems:{[uid:string]: HTMLInputElement} = {};\n\n    constructor(list: List) {\n        super(list);\n        this.buildItems();\n        this.listenArraySplice();\n    }    \n\n    private listenArraySplice() {\n        let {items} = this.list.props;\n        if (items === undefined) return;\n        if (items === null) return;\n        let itemsArray:any;\n        if (Array.isArray(items) === true) {\n            itemsArray = items as any;\n        }\n        else {\n            itemsArray = (items as PageItems<any>).items;\n        }\n        if (isObservableArray(items) === true) {\n            observe(itemsArray as IObservableArray<any>, (change) => {                \n                if (change.type === 'splice') {\n                    let {index, removedCount, added} = change;\n                    let _added = added && added.map(v => {\n                        return {\n                            selected: false, \n                            item: v, \n                            labelId:uid()\n                        }\n                    });\n                    this._items.splice(index, removedCount, ..._added);\n                    this.buildItems();\n                }\n            }, true);\n        }\n    }\n\n    private buildItems = () => {\n        let {items, isItemSelected, selectedItems, compare} = this.list.props;\n        let itemsArray:any[] | IObservableArray<any>;\n        if (items === undefined) {\n            this._items = undefined;\n            return;\n        }\n        if (items === null) {\n            this._items = null;\n            return;\n        }\n        \n        if (Array.isArray(items) === true) {\n            itemsArray = items as any;\n        }\n        else {\n            itemsArray = (items as PageItems<any>).items;\n        }\n\n\t\tif (isItemSelected) {\n\t\t\tlet retItems = itemsArray.map(v => {\n\t\t\t\treturn {\n\t\t\t\t\tselected: isItemSelected(v),\n\t\t\t\t\titem: v, \n\t\t\t\t\tlabelId:uid()\n\t\t\t\t};\n\t\t\t});\n\t\t\tthis._items = retItems;\n\t\t}\n\t\telse {\n\t\t\tlet comp: ((item:any, selectItem:any)=>boolean);\n\t\t\tif (compare === undefined) {\n\t\t\t\tcomp = (item:any, selectItem:any) => item === selectItem;\n\t\t\t}\n\t\t\telse {\n\t\t\t\tcomp = compare;\n\t\t\t}\n\t\t\tlet retItems = itemsArray.map(v => {\n\t\t\t\t//let isObserved = isObservable(v);\n\t\t\t\t//let obj = isObserved === true? toJS(v) : v;\n\t\t\t\t//let obj = v;\n\t\t\t\tlet selected = selectedItems === undefined?\n\t\t\t\t\tfalse\n\t\t\t\t\t: selectedItems.find(si => comp(v, si)) !== undefined;\n\t\t\t\treturn {\n\t\t\t\t\tselected: selected, \n\t\t\t\t\titem: v, \n\t\t\t\t\tlabelId:uid()\n\t\t\t\t};\n\t\t\t});\n\t\t\tthis._items = retItems;\n\t\t}\n    }\n\n    get items() {\n        //if (this._items === undefined) \n        //this.buildItems();\n        return this._items;\n    }\n    private checkAll(on: boolean) {\n        for (let i in this.inputItems) this.inputItems[i].checked = on;\n        for (let item of this._items) item.selected = on;\n    }\n    selectAll() {\n        //if (this._items) this._items.forEach(v => v.selected = true);\n        this.checkAll(true);\n        this.list.props.item.onSelect(undefined, true, this.anySelected);\n    }\n    unselectAll() {\n        // if (this._items) this._items.forEach(v => v.selected = false);\n        this.checkAll(false);\n        this.list.props.item.onSelect(undefined, false, this.anySelected);\n    }\n    /*\n    updateProps(nextProps:any) {\n        if (nextProps.selectedItems === this._selectedItems) return;\n        this.buildItems();\n    }\n    */\n    private get anySelected():boolean {return this._items.some(v => v.selected)}\n    private onSelect(item:SelectableItem, selected:boolean) {\n        item.selected = selected;\n        this.list.props.item.onSelect(item.item, selected, this.anySelected);\n    }\n    \n    get selectedItems():any[] {\n        return this._items.filter(v => v.selected === true).map(v => v.item);\n    }\n    /*\n    set selectedItems(value: any[]) {\n        if (value === undefined) return;\n        if (this._items === undefined) return;\n        let sLen = this._items.length;\n        let list = value.slice();\n        for (let n=0; n<sLen; n++) {\n            let sItem = this._items[n];\n            let len = list.length;\n            if (len === 0) break;\n            let item = sItem.item;\n            for (let i=0; i<len; i++) {\n                let v = list[i];\n                if (item === v) {\n                    sItem.selected = true;\n                    value.splice(i, 1);\n                    break;\n                }\n            }\n        };\n    }\n    */\n    //w-100 mb-0 pl-3\n    //m-0 w-100\n    render = (item:SelectableItem, index:number):JSX.Element => {\n        let {key} = this.list.props.item;\n\t\treturn React.createElement(this.row, {item, index, key:key===undefined?index:key(item)});\n    }\n\n    private row = observer((props: {item:SelectableItem, index:number}):JSX.Element => {\n        let {item, index} = props;\n        let {className} = this.list.props.item;\n        let {labelId, selected, item:obItem} = item;\n        return <li className={classNames(className)}>\n            <div className=\"d-flex align-items-center px-3\">\n                <input ref={input=>{if (input) this.inputItems[labelId] = input;}}\n                    className=\"\" type=\"checkbox\" value=\"\" id={labelId}\n                    defaultChecked={selected}\n                    onChange={(e)=>{\n                        this.onSelect(item, e.target.checked)} \n                    }/>\n                <label className=\"\" style={{flex:1, marginBottom:0}} htmlFor={labelId}>\n                    {this.renderContent(obItem, index)}\n                </label>\n            </div>\n        </li>\n    })\n}\n","import * as React from 'react';\nimport classNames from 'classnames';\nimport {observer} from 'mobx-react';\nimport _ from 'lodash';\nimport {PageItems} from '../../tool/pageItems';\nimport {ListBase} from './base';\nimport {Clickable} from './clickable';\nimport {Static} from './static';\nimport {Selectable} from './selectable';\nimport '../../css/va-list.css';\nimport { IObservableArray } from 'mobx';\nimport { resLang } from '../../res/res';\nimport { ListRes, listRes } from '../../res';\n\ntype StaticRow = string|JSX.Element|(()=>string|JSX.Element);\ninterface ItemProps {\n\tclassName?: string|string[];\n\trender?: (item:any, index:number) => JSX.Element;\n\tonSelect?: (item:any, isSelected:boolean, anySelected:boolean)=>void;\n\tonClick?: (item:any)=>void;\n\tkey?: (item:any)=>string|number;\n}\n\nexport interface ListProps {\n    className?: string|string[];\n    items: any[] | IObservableArray<any> | PageItems<any>;\n    item: ItemProps;\n\tisItemSelected?: (item:any) => boolean;\n    compare?: (item:any, selectItem:any) => boolean;\n\tselectedItems?:any[];\n    header?: StaticRow;\n    footer?: StaticRow;\n    before?: StaticRow;\n    loading?: StaticRow;\n\tnone?: StaticRow;\n\tonFocus?: (evt: React.FocusEvent<HTMLUListElement>)=>void;\n}\n\n@observer\nexport class List extends React.Component<ListProps> {\n\tprivate static res:ListRes = resLang<ListRes>(listRes);\n\n\tprivate listBase: ListBase;\n\tprivate selectable: Selectable;\n    constructor(props:ListProps) {\n\t\tsuper(props);\n        this.buildBase();\n    }\n    _$scroll = (direct: 'top'|'bottom') => {\n        console.log('############### items scroll to ' + direct);\n    }\n    private buildBase() {\n        let {item} = this.props;\n        let {onClick, onSelect} = item;\n        if (onSelect !== undefined)\n            this.selectable = this.listBase = new Selectable(this);\n        else if (onClick !== undefined)\n            this.listBase = new Clickable(this);\n        else\n            this.listBase = new Static(this);\n\t}\n\tcomponentDidUpdate(prevProps: Readonly<ListProps>, prevState: Readonly<any>) {\n\t\tif (_.isEqual(this.props.item, prevProps.item) === false) {\n\t\t\tthis.buildBase();\n\t\t\tthis.forceUpdate();\n\t\t}\n\t}\n    componentWillUnmount() {\n        this.listBase.dispose();\n    }\n    selectAll() {\n        if (this.selectable) this.selectable.selectAll();\n    }\n    unselectAll() {\n        if (this.selectable) this.selectable.unselectAll();\n    }\n    get selectedItems():any[] {\n        return this.listBase.selectedItems;\n    }\n    render() {\n        let {className, header, footer, before, loading, none, onFocus} = this.props;\n        if (before === undefined) before = '-';\n        if (loading === undefined) loading = () => <i className=\"fa fa-spinner fa-spin fa-2x fa-fw text-info\" />;\n        if (none === undefined) none = List.res.none;\n        //this.listBase.selectedItems = selectedItems;\n        let {items, loading:isLoading} = this.listBase;\n        function staticRow(row:StaticRow, type:string) {\n            if (!row) return;\n            switch (typeof row) {\n                default:\n                case 'string': return <li className={\"va-list-\"+type}>{row}</li>;\n                case 'function': return <li className={\"va-list-\"+type}>{(row as ()=>string|JSX.Element)()}</li>;\n                case 'object': return <li>{row}</li>\n            } \n        }\n        let content:any, waitingMore:any;\n        if (items === null)\n            content = staticRow(before, 'before');\n        else if (items === undefined)\n            content = staticRow(loading, 'loading');\n        else if (items.length === 0)\n            content = staticRow(none, 'none');\n        else {\n            content = items.map((item, index) => {\n                return this.listBase.render(item, index);\n            });\n        }\n        if (isLoading === true && items) {\n            waitingMore = staticRow(loading, 'loading');\n\t\t}\n\t\tlet tabIndex:number;\n\t\tif (onFocus !== undefined) tabIndex = -1;\n        return <ul className={classNames('va-list', className)} onFocus={onFocus} tabIndex={tabIndex}>\n            {staticRow(header, 'header')}\n            {content}\n            {waitingMore}\n            {staticRow(footer, 'footer')}\n        </ul>;\n    }\n}\n","import * as React from 'react';\nimport className from 'classnames';\nimport {PropGridProps} from './PropGrid';\nimport {LabeledProp, StringProp, NumberProp, ListProp, ComponentProp} from './propView';\n\nexport abstract class PropRow {\n    setValues(values: any) {}\n    abstract render(key:string): any;\n}\n\nexport class PropBorder extends PropRow {\n    render(key:string): JSX.Element {\n        return <div key={'_b_' + key} className=\"\">\n            <div className=\"w-100\">\n                <div style={{borderTop: '1px solid #f0f0f0'}} />\n            </div>\n        </div>;\n    }\n}\n\nexport class PropGap extends PropRow {\n    private param: string;\n    constructor(param?: string) {\n        super();\n        this.param = param;\n    }\n    render(key:string): JSX.Element {\n        let w: string;\n        switch (this.param) {\n            default: w = 'py-2'; break;\n            case '=': w = 'py-1'; break;\n            case '-': w = 'pb-1'; break;\n        }\n        let cn = className(w);\n        return <div key={'_g_' + key} className={cn} />;\n    }\n}\n\nconst valueAlignStart = 'justify-content-start';\nconst valueAlignCenter = 'justify-content-center';\nconst valueAlignEnd = 'justify-content-end';\nexport abstract class LabeledPropRow extends PropRow {\n    protected gridProps: PropGridProps;\n    protected _prop: LabeledProp;\n    protected get prop():LabeledProp {return this._prop}\n    protected content: any;\n    protected col: string;\n    //protected values: any;\n    constructor(gridProps:PropGridProps, prop: LabeledProp) {\n        super();\n        this.gridProps = gridProps;\n        this._prop = prop;\n        this.col = gridProps.labelFixLeft === true? 'col' : 'col-sm';\n        //this.values = values;\n    }\n    render(key:string):any {\n        let {onClick, bk} = this.prop;\n        let cn = className({\n            \"cursor-pointer\": onClick !== undefined,\n            \"bg-white\": bk === undefined, \n            \"row\": true\n        });\n        return <div key={key} className={cn} onClick={onClick}>\n            {this.renderLabel()}\n            {this.renderProp()}\n        </div>;\n    }\n    protected renderLabel():any {\n        let {label} = this.prop;\n        if (label === undefined) return null;\n        return <label className={this.col + '-3 col-form-label'}>\n            {label}\n        </label>;\n    }\n    protected renderProp():any {\n        let {label} = this.prop;\n        let align, vAlign;\n        switch (this.gridProps.alignValue) {\n            case 'left': align = valueAlignStart; break;\n            case 'center': align = valueAlignCenter; break;\n            case 'right': align = valueAlignEnd; break;\n        }\n        switch (this.prop.vAlign) {\n            case 'top': vAlign = 'align-items-start'; break;\n            default:\n            case 'center': vAlign = 'align-items-center'; break;\n            case 'bottom': vAlign = 'align-items-end'; break;\n            case 'stretch': vAlign = 'align-items-stretch'; break;\n        }\n        let col:string = this.col + (label===undefined? '-12':'-9');\n        let cn = className(align, vAlign, col, 'd-flex');\n        return <div className={cn}>\n            {this.renderPropBody()}\n        </div>;\n    }\n    protected renderPropBody():any {\n        return <div className=\"form-control-plaintext\">\n            {this.renderPropContent()}\n        </div>;\n    }\n    protected renderPropContent():any {\n        return this.content;\n    }\n}\n\nexport class StringPropRow extends LabeledPropRow {\n    protected get prop(): StringProp {return this._prop as StringProp;}\n    setValues(values:any) {\n        if (values === undefined) this.content = undefined;\n        else this.content = values[this.prop.name];\n    }\n}\n\nexport class NumberPropRow extends LabeledPropRow {\n    protected get prop(): NumberProp {return this._prop as NumberProp;}\n    setValues(values:any) {\n        if (values === undefined) this.content = undefined;\n        else this.content = values[this.prop.name];\n    }\n}\n\nexport class ListPropRow extends LabeledPropRow {\n    protected get prop(): ListProp {return this._prop as ListProp;}\n    setValues(values:any) {\n        if (values === undefined) this.content = undefined;\n        else {\n            let list = this.prop.list;\n            if (typeof list === 'string') this.content = values[list];\n            else this.content = undefined;\n        }\n    }\n    protected renderPropBody() {\n        let {list, row} = this.prop;\n        let items:any[] = typeof list === 'string'? this.content : list;\n        if (items === undefined) return <div/>;\n        // new row(item)\n        return <div className=\"w-100\">\n            {\n                items.map((item, index) => <React.Fragment key={index}>\n                    {index===0? null: <div style={{width:'100%', borderBottom:'1px solid #f0f0f0'}} />}\n                    {React.createElement(row, item)}\n                </React.Fragment>)\n            }\n        </div>;\n    }\n}\n\nexport class ComponentPropRow extends LabeledPropRow {\n    protected get prop(): ComponentProp {return this._prop as ComponentProp;}\n    protected renderPropBody() {\n        let {component} = this.prop;\n        return component;\n    }\n    protected renderProp():any {\n        let {label, full} = this.prop;\n        let align, vAlign;\n        switch (this.gridProps.alignValue) {\n            case 'left': align = valueAlignStart; break;\n            case 'center': align = valueAlignCenter; break;\n            case 'right': align = valueAlignEnd; break;\n        }\n        switch (this.prop.vAlign) {\n            case 'top': vAlign = 'align-items-start'; break;\n            default:\n            case 'center': vAlign = 'align-items-center'; break;\n            case 'bottom': vAlign = 'align-items-end'; break;\n            case 'stretch': vAlign = 'align-items-stretch'; break;\n        }\n        let col:string;\n        if (full !== true)\n            col = this.col + (label===undefined? '-12':'-9');\n        else\n            col = 'w-100';\n        let cn = className(align, vAlign, col, 'd-flex');\n        return <div className={cn}>\n            {this.renderPropBody()}\n        </div>;\n    }\n}\n","import { PropGridProps } from './PropGrid';\nimport {\n    PropRow, PropBorder, PropGap, \n    StringPropRow, NumberPropRow, ListPropRow, ComponentPropRow\n} from './row';\n\nexport interface Format {\n\n}\n\nexport interface PropBase {\n    onClick?: () => void;\n}\n\nexport interface LabeledProp extends PropBase {\n    label?: string;\n    bk?: string;\n    vAlign?: 'top' | 'bottom' | 'center' | 'stretch';\n}\n\nexport interface StringProp extends LabeledProp {\n    type: 'string';\n    name: string;\n}\n\nexport interface NumberProp extends LabeledProp {\n    type: 'number';\n    name: string;\n}\n\nexport interface FormatProp extends LabeledProp {\n    type: 'format';\n    format: Format;\n}\n\nexport interface ListProp extends LabeledProp {\n    type: 'list';\n    list: string | any[];  // string 表示名字，否则就是值\n    row: new (props: any) => React.Component;\n}\n\nexport interface ComponentProp extends LabeledProp {\n    type: 'component';\n    full?: boolean;\n    component: any; //JSX.Element;\n}\n\nexport type Prop = StringProp | NumberProp | FormatProp | ListProp | ComponentProp | string;\n\nexport class PropView {\n    private gridProps: PropGridProps\n    private props: Prop[];\n    //private values:any;\n    private rows: PropRow[];\n\n    constructor(gridProps: PropGridProps, props: Prop[]) {\n        this.gridProps = gridProps;\n        this.props = props;\n        //this.values = values;\n        this.buildRows();\n    }\n\n    private buildRows() {\n        this.rows = [];\n        let isGap: boolean = true;\n        for (let prop of this.props) {\n            if (typeof prop === 'string') {\n                this.rows.push(new PropGap(prop));\n                isGap = true;\n            }\n            else {\n                if (!isGap) this.rows.push(new PropBorder());\n                let row;\n                switch (prop.type) {\n                    default: continue;\n                    case 'string': row = new StringPropRow(this.gridProps, prop); break;\n                    case 'number': row = new NumberPropRow(this.gridProps, prop); break;\n                    case 'list': row = new ListPropRow(this.gridProps, prop); break;\n                    case 'component': row = new ComponentPropRow(this.gridProps, prop); break;\n                }\n                this.rows.push(row);\n                isGap = false;\n            }\n        }\n    }\n\n    setValues(values: any) {\n        for (let r of this.rows) r.setValues(values);\n    }\n\n    render() {\n        return this.rows.map((row, index) => row.render(String(index)));\n    }\n}\n","import * as React from 'react';\nimport classNames from 'classnames';\nimport {observer} from 'mobx-react';\nimport {Prop, PropView} from './propView';\n\nexport interface PropGridProps {\n    className?: string;\n    rows: Prop[];\n    values: any;\n    alignValue?: 'left'|'center'|'right';\n    labelFixLeft?: boolean;\n}\n\n@observer\nexport class PropGrid extends React.Component<PropGridProps> {\n    render() {\n        let {className, rows, values} = this.props;\n        let propView = new PropView(this.props, rows);\n        propView.setValues(values);\n        let cn = classNames('container-fluid', className);\n        return <div className={cn}>\n            {propView.render()}\n        </div>;\n    }\n}\n","import * as React from 'react';\nimport { observable } from 'mobx';\nimport { Page, ItemSchema, UiSchema, StringSchema, UiTextItem, Edit, ImageSchema, nav, UiImageItem } from '../components';\nimport { userApi } from '../net';\n\nexport class EditMeInfo extends React.Component {\n    private schema:ItemSchema[] = [\n        {name:'nick', type:'string'} as StringSchema,\n        {name:'icon', type:'image'} as ImageSchema\n    ];\n    private uiSchema:UiSchema = {\n        items: {\n            nick: {widget:'text', label:'别名', placeholder:'好的别名更方便记忆'} as UiTextItem,\n            icon: {widget:'image', label:'头像'} as UiImageItem,\n        }\n    }\n    @observable private data:any;\n\n    constructor(props:any) {\n        super(props);\n        let {nick, icon} = nav.user;\n        this.data = {\n            nick: nick,\n            icon: icon,\n        }\n    }\n\n    private onItemChanged = async (itemSchema:ItemSchema, newValue:any, preValue:any) => {\n        let {name} = itemSchema;        \n        await userApi.userSetProp(name, newValue);\n        this.data[name] = newValue;\n        let user:any = nav.user;\n        user[name] = newValue;\n        nav.saveLocalUser();\n    }\n\n    render() {\n        return <Page header=\"个人信息\">\n            <Edit schema={this.schema} uiSchema={this.uiSchema}\n                data={this.data}\n                onItemChanged={this.onItemChanged} />\n        </Page>;\n    }\n}\n","import { observable } from 'mobx';\nimport { isNumber } from 'util';\nimport _ from 'lodash';\nimport { LocalArr } from '../../tool';\nimport { BoxId } from './boxId';\nimport { TuidInner, TuidDiv } from './tuid';\n\nconst maxCacheSize = 1000;\n\nexport class IdCache {\n    private queue: number[] = [];               // 每次使用，都排到队头\n\tprivate cache = observable.map({}, {deep: false});    // 已经缓冲的\n\tprivate loading:boolean = false;\n\n    protected localArr:LocalArr;\n    protected waitingIds: number[] = [];          // 等待loading的\n    protected tuidInner: TuidInner;\n\n    constructor(tuidLocal: TuidInner) {\n        this.tuidInner = tuidLocal;\n        this.initLocalArr();\n    }\n\n    protected initLocalArr() {\n        this.localArr = this.tuidInner.cache.arr(this.tuidInner.name + '.ids');\n    }\n\n    useId(id:number, defer?:boolean) {\n        if (!id) return;\n        if (isNumber(id) === false) return;\n        if (this.cache.has(id) === true) {\n            this.moveToHead(id);\n            return;\n        }\n        this.tuidInner.cacheTuids(defer===true?70:20);\n        this.cache.set(id, id);\n        if (this.waitingIds.findIndex(v => v === id) >= 0) {\n            this.moveToHead(id);\n            return;\n        }\n\n        if (this.queue.length >= maxCacheSize) {\n            // 缓冲已满，先去掉最不常用的\n            let r = this.queue.shift();\n            if (r === id) {\n                // 如果移除的，正好是现在用的，则插入\n                this.queue.push(r);\n                return;\n            }\n\n            //let rKey = String(r);\n            if (this.cache.has(r) === true) {\n                // 如果移除r已经缓存\n                this.cache.delete(r);\n            }\n            else {\n                // 如果移除r还没有缓存\n                let index = this.waitingIds.findIndex(v => v === r);\n                this.waitingIds.splice(index, 1);\n            }\n        }\n        this.waitingIds.push(id);\n        this.queue.push(id);\n        return;\n    }\n\n    private moveToHead(id:number) {\n        let index = this.queue.findIndex(v => v === id);\n        this.queue.splice(index, 1);\n        this.queue.push(id);\n    }\n\n    getValue(id:number) {\n        return this.cache.get(id);\n    }\n\n    remove(id:number) {\n        this.cache.delete(id);\n        let index = this.queue.findIndex(v => v === id);\n\t\tthis.queue.splice(index, 1);\n\t\tthis.localArr.removeItem(id);\n    }\n\n    valueFromId(id:number|BoxId):any {\n        let _id:number;\n        switch (typeof id) {\n            case 'object': _id = (id as BoxId).id; break;\n            case 'number': _id = id as number; break;\n            default: return;\n        }\n        return this.getValue(_id);\n    }\n\n    resetCache(id:number) {\n        this.remove(id);\n        this.useId(id);\n    }\n\n    cacheValue(val:any):boolean {\n        if (val === undefined) return false;\n        let id = this.getIdFromObj(val);\n        if (id === undefined) return false;\n        let index = this.waitingIds.findIndex(v => v === id);\n        if (index>=0) this.waitingIds.splice(index, 1);\n        this.cache.set(id, val);\n        return true;\n    }\n    protected getIdFromObj(val:any) {return this.tuidInner.getIdFromObj(val)}\n\n    async cacheIds():Promise<void> {\n        if (this.waitingIds.length === 0) return;\n\t\tlet tuidValues = await this.loadIds();\n\t\tif (tuidValues === undefined || tuidValues.length === 0) {\n\t\t\tthis.waitingIds.splice(0, this.waitingIds.length);\n\t\t\treturn;\n\t\t}\n        this.cacheIdValues(tuidValues);\n    }\n\n    private cacheIdValues(tuidValues: any[]) {\n        if (tuidValues === undefined) return;\n        let tuids = this.unpackTuidIds(tuidValues);\n        for (let tuidValue of tuids) {\n            if (this.cacheValue(tuidValue) === false) continue;\n            this.cacheTuidFieldValues(tuidValue);\n        }\n    }\n    async modifyIds(ids:any[]):Promise<void> {\n        let tuidValues:string[] = await this.loadTuidIdsOrLocal(ids);\n        let localedValues = tuidValues.filter(v => {\n            let p = v.indexOf('\\t');\n            if (p<0) p = v.length;\n            let id = Number(v.substr(0, p));\n            let val = this.localArr.getItem(id);\n            return (val !== undefined);\n        });\n        if (localedValues.length === 0) return;\n        this.cacheIdValues(localedValues);\n    }\n    protected divName:string = undefined;\n    protected async loadIds(): Promise<any[]> {\n\t\tif (this.loading === true) return;\n\t\tthis.loading = true;\n\t\tlet ret = await this.loadTuidIdsOrLocal(this.waitingIds);\n\t\tthis.loading = false;\n        return ret;\n    }\n    protected unpackTuidIds(values:string[]):any[] {\n        return this.tuidInner.unpackTuidIds(values);\n    }\n    protected cacheTuidFieldValues(tuidValue: any) {\n        this.tuidInner.cacheTuidFieldValues(tuidValue);\n    }\n\n    async assureObj(id:number):Promise<void> {\n        let val = this.cache.get(id);\n        switch (typeof val) {\n            case 'object': return val;\n            case 'number': this.cache.set(id, id); break;\n        }\n        let ret = await this.loadTuidIdsOrLocal([id]);\n        this.cacheIdValues(ret);\n    }\n\n    private async loadTuidIdsOrLocal(ids:number[]):Promise<string[]> {\n        let ret:string[] = [];        \n        let netIds:number[] = [];\n        for (let id of ids) {\n            let value = this.localArr.getItem(id);\n            //if (value === undefined)\n            // 值不存在或者是空字符串，重新获取\n            if (!value)\n                netIds.push(id);\n            else\n                ret.push(value);\n        }\n        let len = netIds.length;\n        if (len > 0) {\n            let netRet = await this.tuidInner.loadTuidIds(this.divName, netIds);\n            for (let i=0; i<len; i++) {\n                //有些id可能没有内容，不会返回\n                //let id = netIds[i]; \n                let row:string = netRet[i];\n                if (!row) continue;\n                let p = row.indexOf('\\t');\n                if (p < 0) p = row.length;\n                let id = Number(row.substr(0, p));\n\t\t\t\t_.remove(netIds, v => v === id);\n                ret.push(row);\n                this.localArr.setItem(id, row);\n            }\n            len = netIds.length;\n            for (let i=0; i<len; i++) {\n                this.localArr.setItem(netIds[i], '');\n            }\n        }\n        return ret;\n    }\n}\n\nexport class IdDivCache extends IdCache {\n    private div: TuidDiv;\n    protected divName:string;\n\n    constructor(tuidLocal:TuidInner, div: TuidDiv) {\n        super(tuidLocal);\n        this.div = div;\n        this.divName = div.name;\n        this.localArr = tuidLocal.cache.arr(tuidLocal.name + '.ids.' + this.divName);\n    }\n\n    protected initLocalArr() {\n        // 这个不需要，必须去掉\n        // this.localArr = this.tuidInner.cache.arr(this.tuidInner.name + '.ids');\n    }\n\n    protected getIdFromObj(val:any) {return this.div.getIdFromObj(val)}\n    protected unpackTuidIds(values:string[]):any[] {\n        return this.div.unpackTuidIds(values);\n    }\n    protected cacheTuidFieldValues(tuidValue: any) {\n        this.div.cacheTuidFieldValues(tuidValue);\n    }\n\n    /*\n    async cacheIds():Promise<void> {\n        if (this.waitingIds.length === 0) return;\n        let tuidValues = await this.loadIds();\n        if (tuidValues !== undefined) {\n            let tuids = this.tuidLocal.unpackTuidIds(tuidValues);\n            for (let tuidValue of tuids) {\n                if (this.cacheValue(tuidValue) === false) continue;\n                this.tuidLocal.cacheTuidFieldValues(tuidValue);\n                this.afterCacheValue(tuidValue);\n            }\n        }\n    }\n    */\n}\n","import _ from 'lodash';\r\nimport { LocalArr } from '../../tool';\r\nimport { Entity } from '../entity';\r\nimport { UqMan, ArrFields, Field, SchemaFrom } from '../uqMan';\r\nimport { EntityCaller } from '../caller';\r\nimport { BoxId } from './boxId';\r\nimport { IdCache, IdDivCache } from './idCache';\r\n\r\nexport interface TuidSaveResult {\r\n    id: number;\r\n    inId: number;\r\n}\r\n\r\nexport interface TuidNOResult {\r\n\tdate: string;\r\n\tno: number;\r\n}\r\n\r\nexport abstract class Tuid extends Entity {\r\n    protected noCache: boolean;\r\n    readonly typeName:string = 'tuid';\r\n    protected idName: string;\r\n    cached: boolean;\r\n    unique: string[];\r\n\r\n    public setSchema(schema:any) {\r\n        super.setSchema(schema);\r\n        let {id} = schema;\r\n        this.idName = id;\r\n    }\r\n\r\n    buildTuidBox(): TuidBox {\r\n        return new TuidBox(this);\r\n    }\r\n\r\n    getIdFromObj(obj:any):number {return obj[this.idName]}\r\n    stopCache():void {this.noCache = true}\r\n    abstract useId(id:number):void;\r\n    abstract boxId(id:number):BoxId;\r\n    abstract valueFromId(id:number):any;\r\n\tabstract resetCache(id:number|BoxId):void;\r\n\tabstract assureBox<T> (id:number|BoxId): Promise<T>;\r\n\tstatic idValue(id: {id:number}|number):number {\r\n\t\tswitch (typeof id) {\r\n\t\t\tdefault: debugger; throw new Error('unknown id');\r\n\t\t\tcase 'object': return id.id;\r\n\t\t\tcase 'number': return id;\r\n\t\t}\r\n\t}\r\n    static equ(id1:{id:number}|number, id2:{id:number}|number): boolean {\r\n        if (id1 === undefined || id1 === null) return false;\r\n\t\tif (id2 === undefined || id2 === null) return false;\r\n\t\treturn Tuid.idValue(id1) === Tuid.idValue(id2);\r\n\t\t/*\r\n        if (typeof id1 === 'object') {\r\n\t\t\tlet id1Id = id1.id;\r\n            return typeof id2 === 'object'? id1Id === id2.id : id1Id === id2;\r\n        }\r\n        if (typeof id2 === 'object') {\r\n\t\t\tlet id2Id = id2.id;\r\n            return typeof id1 === 'object'? id2Id === id1.id : id2Id === id1;\r\n        }\r\n\t\treturn id1 === id2;\r\n\t\t*/\r\n    }\r\n    cacheIds() {}\r\n    async modifyIds(ids:any[]) {}\r\n    isImport = false;\r\n    abstract get hasDiv():boolean;// {return this.divs!==undefined}\r\n    abstract div(name:string):TuidDiv;\r\n    abstract loadMain(id:number|BoxId):Promise<any>;\r\n\tabstract load(id:number|BoxId):Promise<any>;\r\n    abstract all():Promise<any[]>;\r\n\tabstract save(id:number, props:any):Promise<TuidSaveResult>;\r\n\tabstract saveProp(id:number, prop:string, value:any):Promise<void>;\r\n    abstract search(key:string, pageStart:string|number, pageSize:number):Promise<any>;\r\n    abstract searchArr(owner:number, key:string, pageStart:string|number, pageSize:number):Promise<any>;\r\n    abstract loadArr(arr:string, owner:number, id:number):Promise<any>;\r\n    abstract saveArr(arr:string, owner:number, id:number, props:any):Promise<void>;\r\n\tabstract posArr(arr:string, owner:number, id:number, order:number):Promise<void>;\r\n\tabstract no():Promise<TuidNOResult>;\r\n}\r\n\r\nexport class TuidInner extends Tuid {\r\n    private divs: {[div:string]: TuidDiv};\r\n    protected cacheFields: Field[];\r\n    protected idCache: IdCache;\r\n    protected localArr:LocalArr;\r\n    constructor(uq:UqMan, name:string, typeId:number) {\r\n        super(uq, name, typeId);\r\n        this.idCache = new IdCache(this);\r\n        this.localArr = this.cache.arr(this.name + '.whole');\r\n        if (uq.newVersion === true) this.localArr.removeAll();\r\n    }\r\n\r\n    public setSchema(schema:any) {\r\n        super.setSchema(schema);\r\n        let {arrs} = schema;\r\n        if (arrs !== undefined) {\r\n            this.divs = {};\r\n            for (let arr of arrs) {\r\n                let {name} = arr;\r\n                let tuidDiv = new TuidDiv(this.uq, this, name);\r\n                this.divs[name] = tuidDiv;\r\n                tuidDiv.setSchema(arr);\r\n                tuidDiv.buildFieldsTuid();\r\n            }\r\n        }\r\n    }\r\n    \r\n    useId(id:number, defer?:boolean) {\r\n        if (this.noCache === true) return;\r\n        if (!id) return;\r\n        this.idCache.useId(id, defer);\r\n    }\r\n    boxId(id:number):BoxId {\r\n        if (!id) return;\r\n        if (typeof id === 'object') return id;\r\n        this.useId(id);\r\n        let {createBoxId} = this.uq;\r\n        if (!createBoxId) return {id: id} as BoxId;\r\n        return createBoxId(this, id);\r\n    }\r\n    valueFromId(id:number) {return this.idCache.getValue(id)}\r\n\tresetCache(id:number|BoxId):void {\r\n\t\tif (typeof id === 'object') id = id.id;\r\n\t\tthis.idCache.resetCache(id);\r\n\t}\r\n    async assureBox<T> (id:number|BoxId):Promise<T> {\r\n\t\tif (!id) return;\r\n\t\tif (typeof id === 'object') id = id.id;\r\n\t\tawait this.idCache.assureObj(id);\r\n\t\treturn this.idCache.getValue(id);\r\n    }\r\n\r\n    cacheIds() {\r\n        this.idCache.cacheIds();\r\n        if (this.divs === undefined) return;\r\n        for (let i in this.divs) this.divs[i].cacheIds();\r\n    }\r\n    async modifyIds(ids:any[]) {\r\n        await this.idCache.modifyIds(ids);\r\n    }\r\n    cacheTuids(defer:number) {this.uq.cacheTuids(defer)}\r\n    get hasDiv():boolean {return this.divs!==undefined}\r\n    div(name:string):TuidDiv {\r\n        return this.divs && this.divs[name];\r\n    }\r\n    async loadTuidIds(divName:string, ids:number[]):Promise<any[]> {\r\n        let ret:any[] = await new IdsCaller(this, {divName:divName, ids:ids}, false).request();\r\n        if (ret.length > 0) this.cached = true;\r\n        return ret;\r\n    }\r\n    async loadMain(id:number|BoxId):Promise<any> {\r\n        if (typeof id === 'object') id = id.id;\r\n        await this.idCache.assureObj(id);\r\n        return this.idCache.valueFromId(id);\r\n    }\r\n    async load(id:number|BoxId):Promise<any> {\r\n        if (id === undefined || id === 0) return;\r\n        //let cacheValue = this.idCache.valueFromId(id); \r\n        //if (typeof cacheValue === 'object') return cacheValue;\r\n        if (typeof id === 'object') id = id.id;\r\n        let valuesText = undefined; //this.localArr.getItem(id);\r\n        let values: any;\r\n        if (valuesText) {\r\n            values = JSON.parse(valuesText);\r\n        }\r\n        else {\r\n            values = await new GetCaller(this, id).request();\r\n            if (values !== undefined) {\r\n                // this.localArr.setItem(id, JSON.stringify(values));\r\n            }\r\n        }\r\n        if (values === undefined) return;\r\n        for (let f of this.schema.fields) {\r\n            let {tuid} = f;\r\n            if (tuid === undefined) continue;\r\n            let t = this.uq.getTuid(tuid);\r\n            if (t === undefined) continue;\r\n            let n = f.name;\r\n            values[n] = t.boxId(values[n]);\r\n        }\r\n        this.idCache.cacheValue(values);\r\n        this.cacheTuidFieldValues(values);\r\n        return values;\r\n    }\r\n\r\n    cacheTuidFieldValues(values:any) {\r\n        let {fields, arrs} = this.schema;\r\n        this.cacheFieldsInValue(values, fields);\r\n        if (arrs !== undefined) {\r\n            for (let arr of arrs as ArrFields[]) {\r\n                let {name, fields} = arr;\r\n                let arrValues = values[name];\r\n                if (arrValues === undefined) continue;\r\n                let tuidDiv = this.div(name);\r\n                for (let row of arrValues) {\r\n                    //row._$tuid = tuidDiv;\r\n                    //row.$owner = this.boxId(row.owner);\r\n                    tuidDiv.cacheValue(row);\r\n                    this.cacheFieldsInValue(row, fields);\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    public buildFieldsTuid() {\r\n        super.buildFieldsTuid();\r\n        let {mainFields, $create, $update, stampOnMain} = this.schema;\r\n\t\tif (mainFields === undefined) debugger;\r\n\t\tthis.cacheFields = mainFields || this.fields;\r\n\t\tif (stampOnMain === true) {\r\n\t\t\tif ($create === true) this.cacheFields.push({name: '$create', type: 'timestamp', _tuid: undefined});\r\n\t\t\tif ($update === true) this.cacheFields.push({name: '$update', type: 'timestamp', _tuid: undefined});\r\n\t\t}\r\n        this.uq.buildFieldTuid(this.cacheFields);\r\n    }\r\n\r\n    unpackTuidIds(values:string[]):any[] {\r\n        return this.unpackTuidIdsOfFields(values, this.cacheFields);\r\n    }\r\n\r\n    async save(id:number, props:any):Promise<TuidSaveResult> {\r\n        let ret = await new SaveCaller(this, {id:id, props:props}).request();\r\n        if (id !== undefined) {\r\n            this.idCache.remove(id);\r\n            this.localArr.removeItem(id);\r\n        }\r\n        return ret;\r\n\t}\r\n\tasync saveProp(id:number, prop:string, value:any):Promise<void> {\r\n\t\tawait new SavePropCaller(this, {id, prop, value}).request();\r\n\t\tthis.idCache.remove(id);\r\n\t\tawait this.idCache.assureObj(id);\r\n\t}\r\n    async all():Promise<any[]> {\r\n        let ret: any[] = await new AllCaller(this, {}).request();\r\n        return ret;\r\n    }\r\n    async search(key:string, pageStart:string|number, pageSize:number):Promise<any[]> {\r\n        let ret:any[] = await this.searchArr(undefined, key, pageStart, pageSize);\r\n        return ret;\r\n    }\r\n    async searchArr(owner:number, key:string, pageStart:string|number, pageSize:number):Promise<any> {\r\n        //let api = this.uqApi;\r\n        //let ret = await api.tuidSearch(this.name, undefined, owner, key, pageStart, pageSize);\r\n        let params:any = {arr:undefined, owner:owner, key:key, pageStart:pageStart, pageSize:pageSize};\r\n        let ret = await new SearchCaller(this, params).request();\r\n        let {fields} = this.schema;\r\n        for (let row of ret) {\r\n            this.cacheFieldsInValue(row, fields);\r\n        }\r\n        return ret;\r\n    }\r\n    async loadArr(arr:string, owner:number, id:number):Promise<any> {\r\n        if (id === undefined || id === 0) return;\r\n        //let api = this.uqApi;\r\n        //return await api.tuidArrGet(this.name, arr, owner, id);\r\n        return await new LoadArrCaller(this, {arr:arr, owner:owner, id:id}).request();\r\n    }\r\n    async saveArr(arr:string, owner:number, id:number, props:any) {\r\n        //let params = _.clone(props);\r\n        //params[\"$id\"] = id;\r\n        //return await this.uqApi.tuidArrSave(this.name, arr, owner, params);\r\n        return await new SaveArrCaller(this, {arr:arr, owner:owner, id:id, props:props}).request();\r\n    }\r\n\r\n    async posArr(arr:string, owner:number, id:number, order:number) {\r\n        //return await this.uqApi.tuidArrPos(this.name, arr, owner, id, order);\r\n        return await new ArrPosCaller(this, {arr:arr, owner:owner, id:id, order:order}).request();\r\n\t}\r\n\tasync no():Promise<TuidNOResult> {\r\n\t\treturn await new TuidNoCaller(this, undefined).request();\r\n\t}\r\n}\r\n\r\nabstract class TuidCaller<T> extends EntityCaller<T> {\r\n    protected get entity(): Tuid {return this._entity as Tuid};\r\n}\r\n\r\n// 包含main字段的load id\r\n// 当前为了兼容，先调用的包含所有字段的内容\r\nclass GetCaller extends TuidCaller<number> {\r\n    method = 'GET';\r\n    get path():string {return `tuid/${this.entity.name}/${this.params}`}\r\n}\r\n\r\nclass IdsCaller extends TuidCaller<{divName:string, ids:number[]}> {\r\n    get path():string {\r\n        let {divName} = this.params;\r\n        return `tuidids/${this.entity.name}/${divName !== undefined?divName:'$'}`;\r\n    }\r\n    buildParams():any {return this.params.ids}\r\n    xresult(res:any):any {\r\n        return (res as string).split('\\n');\r\n    }\r\n}\r\n\r\n\r\nclass SaveCaller extends TuidCaller<{id:number, props:any}> {\r\n    get path():string {return `tuid/${this.entity.name}`}\r\n    buildParams():any {\r\n        let {fields, arrs} = this.entity.schema;\r\n        let {id, props} = this.params;\r\n        let params:any = {$id: id};\r\n        this.transParams(params, props, fields);\r\n        if (arrs !== undefined) {\r\n            for (let arr of arrs) {\r\n                let arrName = arr.name;\r\n                let arrParams = [];\r\n                let arrFields = arr.fields;\r\n                let arrValues = props[arrName];\r\n                if (arrValues !== undefined) {\r\n                    for (let arrValue of arrValues) {\r\n                        let row = {};\r\n                        this.transParams(row, arrValue, arrFields);\r\n                        arrParams.push(row);\r\n                    }\r\n                }\r\n                params[arrName] = arrParams;\r\n            }\r\n        }\r\n        return params;\r\n    }\r\n    private transParams(values:any, params:any, fields:Field[]) {\r\n        if (params === undefined) return;\r\n        for (let field of fields) {\r\n            let {name, tuid, type} = field;\r\n            let val = params[name];\r\n            if (tuid !== undefined) {\r\n                if (typeof val === 'object') {\r\n                    if (val !== null) val = val.id;\r\n                }\r\n            }\r\n            else {\r\n                switch (type) {\r\n                    case 'date':\r\n                        val = this.entity.buildDateParam(val); \r\n                        //val = (val as string).replace('T', ' ');\r\n                        //val = (val as string).replace('Z', '');\r\n                        break;\r\n                    case 'datetime':\r\n                        val = this.entity.buildDateTimeParam(val);\r\n                        //val = new Date(val).toISOString();\r\n                        //val = (val as string).replace('T', ' ');\r\n                        //val = (val as string).replace('Z', '');\r\n                        break;\r\n                }\r\n            }\r\n            values[name] = val;\r\n        }\r\n    }\r\n}\r\n\r\nclass SearchCaller extends TuidCaller<{arr:string, owner:number, key:string, pageStart:string|number, pageSize:number}> {\r\n    get path():string {return `tuids/${this.entity.name}`}\r\n}\r\n\r\nclass AllCaller extends TuidCaller<{}> {\r\n    method = 'GET';\r\n    get path():string {return `tuid-all/${this.entity.name}`}\r\n}\r\n\r\nclass LoadArrCaller extends TuidCaller<{arr:string, owner:number, id:number}> {\r\n    method = 'GET';\r\n    get path():string {\r\n        let {arr, owner, id} = this.params;\r\n        return `tuid-arr/${this.entity.name}/${owner}/${arr}/${id}`;\r\n    }\r\n}\r\nclass SavePropCaller extends TuidCaller<{id:number, prop:string, value:any}> {\r\n    get path():string {return `tuid-prop/${this.entity.name}/`;}\r\n}\r\nclass SaveArrCaller extends TuidCaller<{arr:string, owner:number, id:number, props:any}> {\r\n    get path():string {\r\n        let {arr, owner} = this.params;\r\n        return `tuid-arr/${this.entity.name}/${owner}/${arr}/`;\r\n    }\r\n    buildParams():any {\r\n        let {id, props} = this.params;\r\n        let params = _.clone(props);\r\n        params['$id'] = id;\r\n        return params;\r\n    }\r\n}\r\nclass ArrPosCaller extends TuidCaller<{arr:string, owner:number, id:number, order:number}> {\r\n    get path():string {\r\n        let {arr, owner} = this.params;\r\n        return `tuid-arr-pos/${this.entity.name}/${owner}/${arr}/`;\r\n    }\r\n    buildParams():any {\r\n        let {id, order} = this.params;\r\n        return { bid: id, $order: order}\r\n    }\r\n}\r\nclass TuidNoCaller extends TuidCaller<{}> {\r\n    get path():string {\r\n        return `tuid-no/${this.entity.name}/`;\r\n    }\r\n    buildParams():any {\r\n\t\tlet d = new Date();\r\n\t\tlet year = d.getFullYear();\r\n\t\tlet month = d.getMonth() + 1;\r\n\t\tlet date = d.getDate();\r\n        return {year, month, date};\r\n    }\r\n}\r\n\r\nexport class TuidImport extends Tuid {\r\n    private tuidLocal: TuidInner;\r\n\r\n    constructor(uq:UqMan, name:string, typeId:number, from: SchemaFrom) {\r\n        super(uq, name, typeId);\r\n        this.from = from;\r\n    }\r\n\r\n    setFrom(tuidLocal: TuidInner) {this.tuidLocal = tuidLocal}\r\n    \r\n    readonly from: SchemaFrom;\r\n    isImport = true;\r\n\r\n    useId(id:number) {this.tuidLocal.useId(id);}\r\n    boxId(id:number):BoxId {return this.tuidLocal.boxId(id);}\r\n    valueFromId(id:number) {return this.tuidLocal.valueFromId(id)}\r\n\tresetCache(id:number|BoxId):void {\r\n\t\tthis.tuidLocal.resetCache(id);\r\n\t}\r\n    async assureBox<T>(id:number):Promise<T> {\r\n        await this.tuidLocal.assureBox(id);\r\n\t\treturn this.tuidLocal.valueFromId(id);\r\n    }\r\n    get hasDiv():boolean {return this.tuidLocal.hasDiv}\r\n    div(name:string):TuidDiv {return this.tuidLocal.div(name)}\r\n    async loadMain(id:number|BoxId):Promise<any> {\r\n        let ret = await this.tuidLocal.loadMain(id);\r\n        return ret;\r\n    }\r\n    async load(id:number|BoxId):Promise<any> {\r\n        return await this.tuidLocal.load(id);\r\n    }\r\n    async save(id:number, props:any):Promise<TuidSaveResult> {\r\n        return await this.tuidLocal.save(id, props);\r\n\t}\r\n\tasync saveProp(id:number, prop:string, value:any):Promise<void> {\r\n\t\tawait this.tuidLocal.saveProp(id, prop, value);\r\n\t}\r\n    async all():Promise<any[]> {\r\n        return await this.tuidLocal.all();\r\n    }\r\n    async search(key:string, pageStart:string|number, pageSize:number):Promise<any> {\r\n        return await this.tuidLocal.search(key, pageStart, pageSize);\r\n    }\r\n    async searchArr(owner:number, key:string, pageStart:string|number, pageSize:number):Promise<any> {\r\n        return await this.tuidLocal.searchArr(owner, key, pageStart, pageSize);\r\n    }\r\n    async loadArr(arr:string, owner:number, id:number):Promise<any> {\r\n        return await this.tuidLocal.loadArr(arr, owner, id);\r\n    }\r\n    async saveArr(arr:string, owner:number, id:number, props:any):Promise<void> {\r\n        await this.tuidLocal.saveArr(arr, owner, id, props);\r\n    }\r\n    async posArr(arr:string, owner:number, id:number, order:number):Promise<void> {\r\n        await this.tuidLocal.posArr(arr, owner, id, order);\r\n    }\r\n\tasync no():Promise<TuidNOResult> {\r\n\t\treturn await this.tuidLocal.no();\r\n\t}\r\n}\r\n\r\n// field._tuid 用这个接口\r\n// Tuid, TuidDiv 实现这个接口\r\nexport class TuidBox {\r\n    tuid: Tuid;\r\n    ownerField:Field = undefined;\r\n    constructor(tuid: Tuid) {\r\n        this.tuid = tuid;\r\n    }\r\n\r\n    boxId(id:number):BoxId {\r\n        return this.tuid.boxId(id);\r\n    }\r\n    getIdFromObj(obj:any):number {\r\n        return this.tuid.getIdFromObj(obj);\r\n    }\r\n    useId(id:number):void {\r\n        return this.tuid.useId(id);\r\n    }\r\n    async showInfo() {\r\n        alert('showInfo not implemented');\r\n    }\r\n}\r\n\r\n\r\nexport class TuidDiv extends TuidInner /* Entity*/ {\r\n    readonly typeName:string = 'div';\r\n    protected cacheFields: Field[];\r\n    protected tuid: TuidInner;\r\n    protected idName: string;\r\n    protected idCache: IdDivCache;\r\n\r\n    //ui: React.StatelessComponent<any>;\r\n    //res: any;\r\n\r\n    constructor(uq: UqMan, tuid: TuidInner, name: string) {\r\n        super(uq, name, 0);\r\n        this.tuid = tuid;\r\n        this.idName = 'id';\r\n        this.idCache = new IdDivCache(tuid, this);\r\n    }\r\n\r\n    get owner() {return this.tuid}\r\n\r\n    /*\r\n    setSchema(schema:any) {\r\n        super.setSchema(schema);\r\n        this.buildFieldsTuid();\r\n    }*/\r\n\r\n    /*\r\n    setUIRes(ui:any, res:any) {\r\n        this.ui = ui && ui.content;\r\n        this.res = res;\r\n    }\r\n    */\r\n\r\n    buildFieldsTuid() {\r\n        super.buildFieldsTuid();\r\n        let {mainFields} = this.schema;\r\n        if (mainFields === undefined) debugger;\r\n        this.uq.buildFieldTuid(this.cacheFields = mainFields);\r\n    }\r\n\r\n    buildTuidDivBox(ownerField: Field): TuidBoxDiv {\r\n        return new TuidBoxDiv(this.tuid, this, ownerField);\r\n    }\r\n\r\n    getIdFromObj(obj:any):number {return obj[this.idName]}\r\n    cacheValue(value:any):void {\r\n        this.idCache.cacheValue(value);\r\n    }\r\n\r\n    useId(id:number, defer?:boolean):void {\r\n        if (this.noCache === true) return;\r\n        this.idCache.useId(id, defer);\r\n    }\r\n\r\n    /*\r\n    boxId(id:number):BoxId {\r\n        if (typeof id === 'object') return id;\r\n        this.useId(id);\r\n        //return new BoxDivId(this.tuid, this, id);\r\n        return this.tuid.boxDivId(this, id);\r\n    }\r\n    */\r\n    valueFromId(id:number):any {\r\n        return this.idCache.getValue(id)\r\n    }\r\n\r\n    async assureBox<T>(id:number):Promise<T> {\r\n\t\tawait this.idCache.assureObj(id);\r\n\t\treturn this.idCache.getValue(id);\r\n    }\r\n\r\n    async cacheIds() {\r\n        await this.idCache.cacheIds();\r\n    }\r\n\r\n    cacheTuidFieldValues(values:any) {\r\n        let fields = this.schema.fields;\r\n        this.cacheFieldsInValue(values, fields);\r\n    }\r\n\r\n    unpackTuidIds(values:string[]):any[] {\r\n        return this.unpackTuidIdsOfFields(values, this.cacheFields);\r\n    }\r\n}\r\n\r\nexport class TuidBoxDiv extends TuidBox {\r\n    ownerField: Field;\r\n    private div: TuidDiv;\r\n    constructor(tuid: Tuid, div: TuidDiv, ownerField: Field) {\r\n        super(tuid);\r\n        this.div = div;\r\n        this.ownerField = ownerField;\r\n    }\r\n\r\n    boxId(id:number):BoxId {\r\n        return this.div.boxId(id);\r\n    }\r\n    getIdFromObj(obj:any):number {\r\n        return this.div.getIdFromObj(obj);\r\n    }\r\n    useId(id:number):void {\r\n        return this.div.useId(id);\r\n    }\r\n}\r\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.0/8 are considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\ntype Config = {\n  onSuccess?: (registration: ServiceWorkerRegistration) => void;\n  onUpdate?: (registration: ServiceWorkerRegistration) => void;\n};\n\nexport function register(config?: Config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(\n      process.env.PUBLIC_URL,\n      window.location.href\n    );\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl: string, config?: Config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl: string, config?: Config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl, {\n    headers: { 'Service-Worker': 'script' }\n  })\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready\n      .then(registration => {\n        registration.unregister();\n      })\n      .catch(error => {\n        console.error(error.message);\n      });\n  }\n}\n","import { AppConfig } from \"tonva\";\nimport { appName } from \"./appName\";\n\nexport const appConfig: AppConfig = {\n    appName: appName,\n\tversion: '1.0.0',\n\tnoUnit: true,\n    tvs: {},\n\toem: undefined,\n\thtmlTitle: '小单',\n};\n","export const appName = 'Bruce/notes';\n","import { CSub, CBase, CAppBase, IConstructor } from '../tonva';\nimport { UQs } from './uqs';\nimport { CApp } from './CApp';\n\nexport abstract class CUqBase extends CBase {\n    get cApp(): CApp { return this._cApp; }\n    protected get uqs(): UQs { return this._uqs as UQs };\n}\n\nexport abstract class CUqSub<T extends CUqBase> extends CSub<T> {\n    get cApp(): CApp { return this._cApp; }\n    protected get uqs(): UQs { return this._uqs as UQs };\n    get owner(): T { return this._owner as T }\n}\n\nexport abstract class CUqApp extends CAppBase {\n    get uqs(): UQs { return this._uqs };\n\n    protected newC<T extends CUqBase>(type: IConstructor<T>): T {\n\t\tlet c = new type(this);\n\t\tc.init();\n\t\treturn c;\n    }\n}\n","import * as React from 'react';\nimport { VPage, TabCaptionComponent, Page, TabProp, t } from '../tonva';\nimport { CApp } from './CApp';\n\nconst color = (selected: boolean) => selected === true ? 'text-primary' : 'text-muted';\nfunction caption(label:string, icon:string) {\n\treturn (selected: boolean) => TabCaptionComponent(label, icon, color(selected));\n}\nexport class VMain extends VPage<CApp> {\n    async open(param?: any, onClosePage?: (ret:any)=>void) {\n        this.openPage(this.render, param, onClosePage);\n    }\n\n    render = (param?: any): JSX.Element => {\n\t\tlet { cHome, cRelation, cDiscover, cMe } = this.controller;\n\t\tlet tabs: TabProp[] = [\n\t\t\t{name: 'home', caption: caption(t('home'), 'home'), content: cHome.tab},\n\t\t\t{name: 'relation', caption: caption(t('relation'), 'user-plus'), content: cRelation.tab, onShown: cRelation.load},\n\t\t\t{name: 'discover', caption: caption(t('discover'), 'arrows-alt'), content: cDiscover.tab, load: cDiscover.loadBookProjects},\n\t\t\t{name: 'me', caption: caption(t('me'), 'user-o'), content: cMe.tab},\n\t\t];\n\t\treturn <Page tabsProps={{tabs}} webNav={{navHeader: <div>webNav header</div>, navFooter: <div>webNav footer</div>}} />;\n    }\n}\n","import { BoxId } from \"tonva\";\nimport { EnumTaskState } from \"./note/task/TaskState\";\n\nexport enum EnumNoteType {\n\ttext=0, task=1, comment=2, folder=3, group=4, groupFolder=5, unit=6, assign=7,\n\ttextList=8, textCheckable=9, unitNote=10,\n}\n\nexport interface NoteItem {\n\tseconds: number;\n\towner: number | BoxId;\n\tnote: number;\n\ttype: EnumNoteType;\n\tcaption: string;\n\tcontent: string;\n\tx: number;\n\tassigned: string;\n\tfrom: number | BoxId;\n\tfromAssigned: string;\n\tstate: EnumTaskState;\n\tflowContent?: string;\n\tgroupFolder?:number;\n\tunread: number;\n\tobj: any;\n\ttoCount?: number;\n\tspawnCount?: number;\n\tcommentCount?: number;\n\tcommentUnread?: number;\n\t$create: Date;\n\t$update: Date;\n}\n\nexport interface NoteFlow {\t\n}\n\nexport interface Access {\n\tuser: number;\n\taccess: number;\n\tassigned: string;\n}\n\nexport interface CommentItem {\n\tid: number;\n\tcontent: string;\n\towner: number;\n\tassigned: string;\n\t$create: Date;\n\t$update: Date;\n}\n\nexport interface NoteModel {\n\tid: number;\n\tcaption: string;\n\tcontent: string;\n\ttype: EnumNoteType,\n\tflowContent?: string;\n\t$create: Date;\n\t$update: Date;\n\tto: Access[];\n\tflow: NoteFlow[];\n\tspawn: NoteItem[];\n\tcontain: NoteItem[];\n\tcomments: CommentItem[];\n}\n\nexport function replaceAll(str:string, findStr:string, repStr:string):string {\n\tif (!str) return str;\n\treturn str.split(findStr).join(repStr);\n}\n\nexport function numberFromId(id:number|BoxId):number {\n\tlet _id:number;\n\tswitch (typeof id) {\n\t\t\tcase 'object': _id = (id as BoxId).id; break;\n\t\t\tcase 'number': _id = id as number; break;\n\t\t\tdefault: return;\n\t}\n\treturn _id;\n}\n\nexport function compareID(id1:number|BoxId, id2:number|BoxId):boolean {\n\treturn numberFromId(id1) === numberFromId(id2);\n}\n\nexport function checkHourMinutes(v:string): number {\n\tlet reTime = /^(?:(?:[0-9])|(?:[0-2][0-3])|(?:[0-1][0-9])):[0-5][0-9]$/;\n\tif (reTime.test(v)) {\n\t\tlet r = v.split(':');\n\t\treturn Number(r[0]) * 60 + Number(r[1]);\n\t}\n\tlet h = Number(v);\n\tif (isNaN(h) || h > 20 || h < 0) {\n\t\treturn -1;\n\t}\n\treturn h * 60;\n}\n\nexport function taskTimeToString(t:number):string {\n\tif (isNaN(t) || t <= 0)\n\t\treturn '';\n\tlet h = Math.floor(t / 60);\n\tlet m = Math.floor(t % 60);\n\tlet ms = m.toString();\n\tif (m < 10) {\n\t\tms = '0' + ms;\n\t}\n\treturn h.toString() + ':' + ms;\n}\n\n\nexport function initNoteItemObj(item:NoteItem):void {\n\tlet {type, content, flowContent} = item;\n\tif (flowContent) {\n\t\tlet obj = JSON.parse(flowContent);\n\t\titem.obj = obj;\n\t}\n\telse if (content) {\n\t\tif (content[0] === '{') {\n\t\t\tlet obj = JSON.parse(content);\n\t\t\tif (type === EnumNoteType.text) {\n\t\t\t\tswitch (obj.check) {\n\t\t\t\t\tcase 1: item.type = EnumNoteType.textList; break;\n\t\t\t\t\tcase 2: item.type = EnumNoteType.textCheckable; break;\n\t\t\t\t}\n\t\t\t}\n\t\t\titem.obj = obj;\n\t\t}\n\t\telse {\n\t\t\titem.obj = content;\n\t\t}\n\t}\n}\n\n","import React from 'react';\nimport { VPage, User, Image, UserView, CBase } from \"../../tonva\";\nimport { Contact } from 'model';\n\nexport abstract class VBasePage<T extends CBase> extends VPage<T> {\n\tprotected renderContact = (userId:number, assigned:string) => {\n\t\tlet renderUser = (user:User) => {\n\t\t\tlet {name, nick, icon} = user;\n\t\t\treturn <>\n\t\t\t\t<Image className=\"w-1-5c h-1-5c mr-2\" src={icon || '.user-o'} />\n\t\t\t\t{assigned || nick || name}\n\t\t\t</>\n\t\t}\n\t\treturn <UserView user={userId as number} render={renderUser} />;\n\t}\n\n\tprotected renderContactItem = (item:Contact, index:number) => {\n\t\tlet {contact, assigned} = item;\n\t\treturn <div className=\"px-3 py-2\">\n\t\t\t{this.renderContact(contact, assigned)}\n\t\t</div>;\n\t}\n\n\tprotected renderSelectedContact(contacts:Contact[]) {\n\t\treturn contacts.map((c, index) => {\n\t\t\tlet {contact, assigned} = c;\n\t\t\treturn <span key={index} className=\"mr-3\">{this.renderContact(contact, assigned)}</span>;\n\t\t});\n\t}\n}\n","import React from 'react';\nimport { observable } from 'mobx';\nimport { observer } from 'mobx-react';\nimport { VBasePage } from './VBasePage';\nimport { List, FA } from '../../tonva';\nimport { Contact } from '../../model';\nimport { CNotes } from '../CNotes';\n\nexport interface SelectContactOptions {\n\ttitle?: string;\n\taction?: string;\n\tsingle?: boolean;\n}\n\nexport class VSelectContact extends VBasePage<CNotes> {\n\t@observable private anySelected:boolean = false;\n\t@observable private contacts: Contact[];\n\t@observable private multiple:boolean = false;\n\tprivate list: List;\n\tprivate options: SelectContactOptions;\n\n\tinit(options: SelectContactOptions):void {\n\t\tthis.options = options;\n\t}\n\n\tprotected get back(): 'close' | 'back' | 'none' {return 'close'}\n\n\theader() {return this.options?.title ?? '选择'}\n\tright() {\n\t\treturn React.createElement(observer(this.buildRight));\n\t}\n\n\tprivate buildRight = () => {\n\t\tif (this.options?.single === true) return;\n\t\tlet cn = 'btn btn-sm btn-success mr-1';\n\t\tif (this.multiple === false) {\n\t\t\treturn <button className={cn} onClick={this.onToggleSelect}>多选</button>;\n\t\t}\n\t\tif (this.contacts && this.contacts.length > 0) {\n\t\t\treturn <button className={cn} onClick={this.onNext} disabled={!this.anySelected}>\n\t\t\t\t{this.options?.action ?? '选中'}({this.contacts.length}) <FA name=\"angle-right\" />\n\t\t\t</button>;\n\t\t}\n\t\treturn <button className={cn} onClick={this.onToggleSelect}>单选</button>;\n\t}\n\n\tprivate onToggleSelect = () => {\n\t\tthis.multiple = !this.multiple;\n\t}\n\n\tcontent() {\n\t\tlet render = () => {\n\t\t\tlet list:any;\n\t\t\tlet items = this.controller.cApp.contacts;\n\t\t\tif (this.multiple === true) {\n\t\t\t\tlist = <List ref={v => this.list = v}\n\t\t\t\t\titems={items} \n\t\t\t\t\titem={{render:this.renderContactItem, onSelect:this.onContactSelect}} />\n\t\t\t}\n\t\t\telse {\n\t\t\t\tlist = <List ref={v => this.list = v}\n\t\t\t\t\titems={items} \n\t\t\t\t\titem={{render:this.renderContactItem, onClick:this.onContactClick}} />\n\t\t\t}\n\t\t\treturn <div className=\"\">\n\t\t\t\t{list}\n\t\t\t</div>;\n\t\t}\n\t\treturn React.createElement(observer(render));\n\t}\n\n\tprivate onContactSelect = (item:Contact, isSelected:boolean, anySelected:boolean):void => {\n\t\tthis.anySelected = anySelected;\n\t\tthis.contacts = this.list.selectedItems;\n\t}\n\n\tprivate onContactClick = (item:Contact) => {\n\t\tthis.returnCall([item]);\n\t}\n\n\tprivate onNext = () => {\n\t\tthis.returnCall(this.list.selectedItems);\n\t}\n}\n","import React from 'react';\nimport { View, DropdownActions, DropdownAction } from \"../../tonva\";\nimport { CNotes } from \"../CNotes\";\n\nexport abstract class VNotesDropDown extends View<CNotes> {\n\tprotected text = {\n\t\ticon:'file-o', \n\t\tcaption:this.t('noteText'), \n\t\taction: this.controller.showAddNoteTextPage, \n\t\tcaptionClass: 'text-primary'\n\t};\n\tprotected list = {\n\t\ticon:'list', \n\t\tcaption:this.t('noteList'),\n\t\taction: this.controller.showAddNoteListPage,\n\t};\n\tprotected checkable = {\n\t\ticon:'check-square-o', \n\t\tcaption:this.t('noteCheckable'), \n\t\taction: this.controller.showAddNoteCheckablePage,\n\t};\n\tprotected task = {\n\t\ticon:'hand-pointer-o', \n\t\tcaption:this.t('noteTask'), \n\t\taction: this.controller.showAddAssignPage,\n\t\ticonClass: 'text-primary'\n\t};\n\tprotected folder = {\n\t\ticon:'folder', \n\t\tcaption:this.t('noteFolder'), \n\t\taction: this.controller.showAddMyFolderPage,\n\t\ticonClass: 'text-warning'\n\t};\n\tprotected space = {\n\t\ticon:'users', \n\t\tcaption:this.t('noteCreateSpace'), \n\t\taction: this.controller.showAddGroupPage,\n\t\ticonClass: 'text-danger'\n\t};\n\n\tprotected abstract get dropdownActions(): DropdownAction[];\n\n\trender() {\n\t\treturn <DropdownActions actions={this.dropdownActions}\n\t\t\ticon=\"plus\"\n\t\t\titemIconClass=\"text-info\"\n\t\t\tclassName=\"cursor-pointer btn btn-lg text-white p-1 mr-1\"/>\n\t}\n}\n\nexport class VHomeDropdown extends VNotesDropDown {\n\tprotected get dropdownActions(): DropdownAction[] {\n\t\treturn [this.text, this.list, this.checkable, this.folder, undefined, this.space];\n\t}\n}\n\nexport class VFolderDropdown extends VNotesDropDown {\n\tprotected get dropdownActions(): DropdownAction[] {\n\t\treturn [this.text, this.list, this.checkable, this.folder];\n\t}\n}\n\nexport class  VSpaceDropdown extends VNotesDropDown {\n\tprotected get dropdownActions(): DropdownAction[] {\n\t\treturn [this.text, this.list, this.checkable, this.task, this.folder];\n\t}\n}\n","import { observable, computed } from \"mobx\";\nimport { CUqSub } from '../../tapp';\nimport { NoteItem, NoteModel, EnumNoteType, initNoteItemObj } from '../model';\nimport { CNotes } from '../CNotes';\n\nexport abstract class CNoteBase extends CUqSub<CNotes> {\n\tdisableFrom: boolean = false;\n\t@observable noteModel: NoteModel;\n\t@observable noteItem: NoteItem;\n\n\t@observable activeRelativeTab: string;\n\tget isContentChanged():boolean {return false;}; // {return this.cContent.changed}\n\n\tget groupFolder(): number {\n\t\tif (!this.noteItem)\n\t\t\treturn undefined;\n\t\tlet ret = this.noteItem.groupFolder;\n\t\tif (!ret && this.noteItem.type === EnumNoteType.groupFolder) {\n\t\t\tret = this.noteItem.note;\n\t\t}\n\t\treturn ret;\n\t}\n\n\tinit(param: NoteItem): void {\n\t\tthis.noteItem = param;\n\t}\n\n\tasync lodeModel() {\n\t\tlet folderId = this.owner.currentFold?.folderId;\n\t\tlet ret = await this.uqs.notes.GetNote.query({folder: folderId, note: this.noteItem.note});\n\t\tlet noteModel:NoteModel = ret.ret[0];\n\t\tnoteModel.to = ret.to;\n\t\tnoteModel.flow = ret.flow;\n\t\tnoteModel.spawn = ret.spawn;\n\t\tnoteModel.contain = ret.contain;\n\t\tnoteModel.comments = ret.comments;\n\t\tfor (var sItem of noteModel.spawn) {\n\t\t\tinitNoteItemObj(sItem);\n\t\t}\n\t\tthis.noteModel = noteModel;\n\t}\n\n\tabstract get type():EnumNoteType;\n\n\tprotected async internalStart() { }\n\n\t@observable caption: string;\n\tget isCaptionChanged() {return this.caption !== this.noteItem?.caption;}\n\t@computed get isNoteChanged(): boolean {\n\t\treturn this.isContentChanged || this.isCaptionChanged;\n\t}\n\n\tabstract renderIcon(): JSX.Element;\n\tabstract renderDirItem(index: number): JSX.Element;\n\tabstract showViewPage():void;\n\tabstract showEditPage():void;\n\tabstract showAddPage():void;\n\n\tprotected endContentInput():any {\n\t\tlet obj = this.noteItem ? { ...this.noteItem.obj } : {};\n\t\treturn obj;\n\t}\n\n\tasync showShareTo() {\n\t\tawait this.owner.showShareTo();\n\t}\n\n\tasync SetNote(showWaiting: boolean = true) {\n\t\tlet obj = this.endContentInput();\n\t\tlet noteContent = JSON.stringify(obj);\n\t\tawait this.owner.editNote(showWaiting,\n\t\t\tthis.noteItem,\n\t\t\tthis.caption,\n\t\t\tnoteContent,\n\t\t\tobj);\n\t\tthis.updateChange();\n\t}\n\n\tprotected updateChange() {\n\t\tif (!this.noteItem) {\n\t\t\tdebugger;\n\t\t\tthrow new Error('this.noteItem can not be undefined');\n\t\t}\n\t\tthis.noteItem.$update = new Date();\n\t\tif (this.caption && this.caption !== this.noteItem.caption) {\n\t\t\tthis.noteItem.caption = this.caption;\n\t\t}\n\t\tthis.owner.itemChanged(this.noteItem);\n\t}\n\n\t// return the folder noteItem\n\titemChanged(noteItem: NoteItem):NoteItem {\n\t\t//if (this.noteItem) {\n\t\tthis.noteItem.$update = noteItem.$update;\n\t\treturn this.noteItem;\n\t\t//}\n\t}\n\n\tasync AddNote() {\n\t\tlet obj = this.endContentInput();\n\t\tlet noteContent = JSON.stringify(obj);\n\t\tlet {folderId} = this.owner.currentFold;\n\t\tlet ret = await this.owner.addNote(folderId, this.caption, noteContent, obj, this.type);\n\t\tif (this.noteItem) {\n\t\t\tthis.updateChange();\n\t\t}\n\t\treturn ret;\n\t}\n}\n","import { VBasePage } from \"../../notes/views/VBasePage\";\nimport React from \"react\";\nimport { User, Image, UserView, Page, EasyTime, FA } from \"../../tonva\";\nimport { CNoteBase } from \"./CNoteBase\";\n\nexport function renderIcon(name:string, cn:string) {\n\treturn <span className=\"fa-stack fa-lg\">\n\t\t<i className={'fa fa-square-o fa-stack-2x ' + cn}></i>\n\t\t<i className={'fa fa-stack-1x fa-' + name + ' ' + cn}></i>\n\t</span>\n\t//return <FA name={name} size=\"lg\" className={cn} fixWidth={true} />;\n}\n\nexport abstract class VNoteBase<T extends CNoteBase> extends VBasePage<T> {\n\t// VPage 里面的页面主体\n\tcontent() {\n\t\treturn this.renderBody();\n\t}\n\n\t// 页面主体\n\tprotected renderBody():JSX.Element {\n\t\treturn;\n\t}\n\n\t// 小单的主要部分，top, caption和content\n\tprotected renderTopCaptionContent() {\n\t\treturn <div className=\"bg-white\">\n\t\t\t{this.renderTop()}\n\t\t\t<div className=\"py-2\">\n\t\t\t\t{this.renderCaption()}\n\t\t\t\t{this.renderContent()}\n\t\t\t</div>\n\t\t</div>;\n\t}\n\n\tprotected renderTop():JSX.Element {\n\t\treturn <div className=\"d-flex px-3 py-2 align-items-center border-top border-bottom bg-light\">\n\t\t\t{this.renderIcon()}\n\t\t\t{this.renderEditTime()}\n\t\t\t{this.renderFrom()}\n\t\t</div>;\n\t}\n\tprotected renderIcon():JSX.Element {return;}\n\t\n\tprotected renderFrom = () => {\n\t\tlet {noteItem, disableFrom: disableOwnerFrom} = this.controller;\n\t\tif (!noteItem) return <div>noteItem undefined in renderFrom</div>;\n\t\tlet {owner, assigned, from} = noteItem;\n\t\tlet contact:number = from? from as number : owner as number;\n\t\tif (disableOwnerFrom === false && this.isMe(contact) === false) {\n\t\t\tlet renderUser = (user:User) => {\n\t\t\t\tlet {name, nick, icon} = user;\n\t\t\t\tlet vImage:any, cnName:string = 'text-muted';\n\t\t\t\tif (icon) {\n\t\t\t\t\tcnName += ' small'\n\t\t\t\t\tvImage = <Image className=\"w-1c h-1c mr-1\" src={icon} />;\n\t\t\t\t}\n\t\t\t\treturn <>\n\t\t\t\t\t{vImage} <span className={cnName}>{assigned || nick || name}</span>\n\t\t\t\t</>\n\t\t\t}\n\t\t\treturn <span className=\"mr-3\"><UserView user={contact} render={renderUser} /></span>;\n\t\t}\n\t}\n\n\tprotected renderEditTime() {\n\t\tlet {$create, $update} = this.controller.noteItem;\n\t\tlet create:Date = $create;\n\t\tlet update:Date = $update;\n\t\tif (create && update) {\n\t\t\tlet time:Date, action:any;\n\t\t\tif (update.getTime() - create.getTime() > 60*1000) {\n\t\t\t\taction = <FA className=\"mr-1 text-info\" name=\"pencil\" />;\n\t\t\t\ttime = update;\n\t\t\t}\n\t\t\telse {\n\t\t\t\ttime = create;\n\t\t\t}\n\t\t\treturn <small className=\"text-muted\">\n\t\t\t\t{action}\n\t\t\t\t<span><EasyTime date={time} /></span>\n\t\t\t</small>\n\t\t}\n\t}\n\n\tprotected renderCaption() {\n\t\tlet {caption: title} = this.controller;\n\t\tif (title) {\n\t\t\treturn <div className=\"pr-3\">\n\t\t\t\t<div><b>{title}</b></div>\n\t\t\t</div>;\n\t\t}\n\t}\n\n\tprotected renderContent():JSX.Element {return;}\n\n\tprotected renderToCount() {\n\t\tlet {toCount} = this.controller.noteItem;\n\t\tif (toCount === undefined || toCount <= 0)\n\t\t\treturn;\n\t\treturn <span className=\"mr-5 text-muted\">\n\t\t\t<FA className=\"mr-2\" name=\"share\"/><small className=\"\">{toCount}</small> \n\t\t</span>;\n\t}\n\n\tprotected renderSpawnCount() {\n\t\tlet {spawnCount} = this.controller.noteItem;\n\t\tif (spawnCount === undefined || spawnCount <= 0)\n\t\t\treturn;\n\t\treturn  <span className=\"mr-5 text-muted\">\n\t\t\t<FA className=\"mr-2\" name=\"hand-pointer-o\"/><small className=\"\">{spawnCount}</small>\n\t\t</span>;\n\t}\n\n\tprotected renderCommentFlag = () => {\n\t\tlet {commentCount, commentUnread} = this.controller.noteItem;\n\t\tif (commentCount === undefined || commentCount <= 0)\n\t\t\treturn;\n\t\tlet vCU:any;\n\t\tif (commentUnread > 0) {\n\t\t\tlet cu:any = commentUnread>99? <>99<sup>+</sup></> : commentUnread;\n\t\t\tvCU = <div className=\"unread-num\">{cu}</div>;\n\t\t};\n\t\treturn  <span className=\"mr-5 text-muted position-relative\">\n\t\t\t<FA className=\"mr-2\" name=\"comment-o\"/><small className=\"\">{commentCount}</small>\n\t\t\t{vCU}\n\t\t</span>;\n\t}\n\n\tprotected showActionEndPage({content, onClick}:{content:any; onClick?:()=>void}) {\n\t\tthis.openPage(() => {\n\t\t\tonClick = onClick || (()=>this.closePage());\n\t\t\tlet {caption: title} = this.controller;\n\t\t\treturn <Page header={title} back=\"close\">\n\t\t\t\t<div className=\"border bg-white rounded m-5\">\n\t\t\t\t\t<div className=\"py-5 text-center\">\n\t\t\t\t\t\t{content}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div className=\"border-top text-center py-3\">\n\t\t\t\t\t\t<button className=\"btn btn-outline-info\" onClick={onClick}>返回</button>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</Page>;\n\t\t});\n\t}\n\n\tprotected renderShareButton() {\n\t\treturn <span onClick={this.onSendNote} className=\"cursor-pointer text-primary mr-5\">\n\t\t\t<FA name=\"share\" />\n\t\t</span>;\n\t}\n\n\tprotected onSendNote = async () => {\n\t\tawait this.controller.cApp.loadRelation();\n\t\tthis.controller.showShareTo();\n\t}\n\n\tprotected renderEditButton() : JSX.Element {\n\t\treturn <span onClick={()=>this.onEdit()} className=\"cursor-pointer text-primary\">\n\t\t\t<FA name=\"pencil-square-o\" />\n\t\t</span>;\n\t}\n\t\n\tprotected renderStateSpan(content: string, isEnd: boolean = false) {\n\t\tif (isEnd === true) {\n\t\t\treturn <span className=\"small text-danger\"><FA className=\"small mr-1\" name=\"stop\" />{content}</span>;\n\t\t}\n\t\treturn <span className=\"small text-success border border-success rounded px-2\">{content}</span>;\n\t}\n\n\tprotected onEdit() {this.controller.showEditPage()}\n}\n","import React from 'react';\nimport { observer } from 'mobx-react';\nimport { VNoteBase } from \"./VNoteBase\";\nimport { CNoteBase } from \"./CNoteBase\";\n\nexport class VNoteBaseDir<T extends CNoteBase> extends VNoteBase<T> {\n\trender() {\n\t\treturn this.renderBody();\n\t}\n\n\tprotected renderBody() {\n\t\treturn React.createElement(observer(() => {\n\t\t\treturn <div className=\"d-block bg-white\">\n\t\t\t\t{this.renderTopCaptionContent()}\n\t\t\t\t{this.renderDirBottom()}\n\t\t\t</div>;\n\t\t}));\n\t}\n\n\tprotected renderTopCaptionContent() {\n\t\treturn <div className=\"bg-white\">\n\t\t\t{this.renderTop()}\n\t\t\t<div className=\"py-2\">\n\t\t\t\t{this.renderContent()}\n\t\t\t</div>\n\t\t</div>;\n\t}\n\n\tprotected renderTop():JSX.Element {\n\t\treturn <div className=\"d-flex pl-2 pr-3 py-2 border-top\">\n\t\t\t{this.renderIcon()}\n\t\t\t<div>\n\t\t\t\t{this.renderCaption()}\n\t\t\t\t{this.renderFrom()}\n\t\t\t</div>\n\t\t\t<div className=\"ml-auto\">{this.renderEditTime()}</div>\n\t\t</div>;\n\t}\n\n\tprotected renderDirBottom():JSX.Element {\n\t\tlet divToCount = this.renderToCount();\n\t\tlet divSpawnCount = this.renderSpawnCount();\n\t\tlet divComment = this.renderCommentFlag();\n\t\tif (divToCount || divSpawnCount || divComment) {\n\t\t\treturn <div className=\"d-flex align-items-center px-3 mb-1\">\n\t\t\t\t{divToCount}\n\t\t\t\t{divSpawnCount}\n\t\t\t\t{divComment}\n\t\t\t\t<div className=\"mr-auto\" />\n\t\t\t</div>;\n\t\t}\n\t}\n\n\tprotected renderIcon(): JSX.Element {\n\t\tlet {unread} = this.controller.noteItem;\n\t\tlet dot:any;\n\t\tif (unread>0) dot = <u/>;\n\t\treturn <div className=\"mr-3 unread-dot\">{this.controller.renderIcon()}{dot}</div>\n\t}\n}\n\nexport class VNoteBaseDirView extends VNoteBaseDir<CNoteBase> {\n}\n","import React from 'react';\nimport { observer } from 'mobx-react';\nimport { CNoteBase } from \"./CNoteBase\";\nimport { VNoteBaseForm } from './VNoteBaseForm';\n\nexport class VNoteBaseEdit<T extends CNoteBase> extends VNoteBaseForm<T> {\n\t/*\n\t@computed protected get btnSaveDisabled():boolean {\n\t\tif (this.controller.isContentChanged === true) return false;\n\t\tif (this.controller.isCaptionChanged === true) return false;\n\t\treturn true;\n\t}\n\t*/\n\n\tprotected renderEditBottom():JSX.Element {\n\t\treturn <div className=\"py-2 pl-3 bg-light border-top d-flex\">\n\t\t\t<div className=\"mr-auto\" />\n\t\t\t{React.createElement(observer(() => <>\n\t\t\t\t<button onClick={() => this.onButtonSave()}\n\t\t\t\t\tclassName=\"btn btn-primary mr-3\" disabled={!this.controller.isNoteChanged}>\n\t\t\t\t\t保存\n\t\t\t\t</button>\n\t\t\t</>))}\n\t\t\t{this.renderExButtons()}\n\t\t</div>;\n\t}\n\n\tprotected async onButtonSave(): Promise<void> {\n\t\tawait this.controller.SetNote();\n\t\tthis.closePage();\n\t}\n\n\tprotected renderExButtons():JSX.Element {return}\n}\n\nexport class VNoteBaseEditPage extends VNoteBaseEdit<CNoteBase> {\n}\n","import React from 'react';\nimport { observer } from 'mobx-react';\nimport { VNoteBase } from \"./VNoteBase\";\nimport { CNoteBase } from \"./CNoteBase\";\n//import { computed } from 'mobx';\nimport { ConfirmOptions, FA } from '../../tonva';\n\nexport class VNoteBaseForm<T extends CNoteBase> extends VNoteBase<T> {\n\t//@computed protected get changed(): boolean {return this.controller.captionChanged};\n\n\tprotected get back(): 'close' | 'back' | 'none' {return 'close'}\n\theader() {return this.t('notes')};\n\n\tprotected renderBody() {\n\t\treturn React.createElement(observer(() => {\n\t\t\treturn <div className=\"d-block\">\n\t\t\t\t{this.renderTopCaptionContent()}\n\t\t\t\t{this.renderEditBottom()}\n\t\t\t</div>;\n\t\t}));\n\t}\n\n\tprotected renderTopCaptionContent():JSX.Element {\n\t\treturn <div className=\"\">\n\t\t\t{this.renderCaptionInput()}\n\t\t\t<div className=\"mx-1 py-1 bg-white\">\n\t\t\t\t{this.renderContent()}\n\t\t\t</div>\n\t\t</div>;\n\t}\n\n\tprotected renderCaptionInput() {\n\t\treturn <div className=\"py-2 px-1\">\n\t\t\t<input type=\"text\" className=\"w-100 border-0 form-control font-weight-bold\" placeholder=\"标题\" maxLength={80}\n\t\t\t\tonChange={this.onCaptionChange}\n\t\t\t\tdefaultValue={this.controller.caption} />\n\t\t</div>;\n\t\t//autoFocus={true}\n\t}\n\n\tprotected onCaptionChange = (evt: React.ChangeEvent<HTMLInputElement>) => {\n\t\tthis.controller.caption = evt.target.value.trim();\n\t}\n\n\tprotected renderEditBottom():JSX.Element {\n\t\treturn;\n\t}\n\n\tprotected async onDelete(): Promise<void> {\n\t\tlet options: ConfirmOptions = {\n\t\t\tcaption: '请确认',\n\t\t\tmessage: <div className=\"my-3\"><FA name=\"question-circle-o\" size=\"2x\" className=\"mr-3 text-danger\" />真的要删除这个小单吗？</div>,\n\t\t\tyes: '确认删除',\n\t\t\tno: '不删除'\n\t\t};\n\t\tif (await this.controller.confirm(options) === 'yes') {\n\t\t\tawait this.controller.owner.hideNote(this.controller.noteItem.note, 1);\n\t\t\tthis.closePage(2);\n\t\t}\n\t}\n\n\tprotected renderDeleteButton() {\n\t\treturn <button className=\"btn btn-outline-secondary mr-3\" onClick={() => this.onDelete()}>\n\t\t\t删除\n\t\t</button>;\n\t}\n}\n","import React from 'react';\nimport { observer } from 'mobx-react';\nimport { VNoteBase } from \"./VNoteBase\";\nimport { CNoteBase } from \"./CNoteBase\";\n\nexport class VNoteBaseView<T extends CNoteBase> extends VNoteBase<T> {\n\theader() {return this.t('notes')}\n\n\tprotected renderBody() {\n\t\treturn React.createElement(observer(() => {\n\t\t\treturn <div className=\"d-block\">\n\t\t\t\t{this.renderTopCaptionContent()}\n\t\t\t\t{this.renderViewBottom()}\n\t\t\t\t{this.renderRelatives()}\n\t\t\t</div>;\n\t\t}));\n\t}\n\n\tprotected renderTop():JSX.Element {\n\t\tlet vEditButton:any;\n\t\tlet isMe = this.isMe(this.controller.noteItem.owner);\n\t\tif (isMe === true) {\n\t\t\tvEditButton = <div className=\"ml-auto\">{this.renderEditButton()}</div>;\n\t\t}\n\t\treturn <div className=\"d-flex px-3 py-3 border-top border-bottom bg-light\">\n\t\t\t{this.renderIcon()}\n\t\t\t<div>\n\t\t\t\t{this.renderCaption()}\n\t\t\t\t<div className=\"d-flex align-items-center mt-1\">\n\t\t\t\t\t{this.renderFrom()}\n\t\t\t\t\t<span className=\"mr-3\">{this.renderEditTime()}</span>\n\t\t\t\t\t{vEditButton}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>;\n\t}\n\n\t// 小单的主要部分，top, caption和content\n\tprotected renderTopCaptionContent() {\n\t\treturn <div className=\"bg-white\">\n\t\t\t{this.renderTop()}\n\t\t\t<div className=\"py-2\">\n\t\t\t\t{this.renderContent()}\n\t\t\t</div>\n\t\t</div>;\n\t}\n\n\tprotected renderViewBottom():JSX.Element {\n\t\treturn <div className=\"h-1c\"></div>;\n\t}\n\n\tprotected renderRelatives():JSX.Element {\n\t\treturn;\n\t}\n\n\tprotected renderIcon(): JSX.Element {\n\t\treturn <div className=\"mr-3\">{this.controller.renderIcon()}</div>;\n\t}\n}\n","import React from 'react';\n\nexport const none = <small className=\"text-muted\">[无]</small>;\n","import React from \"react\";\nimport { VPage, SearchBox, userApi, Image, FA, Muted, Controller } from \"../tonva\";\nimport { observable } from \"mobx\";\nimport { observer } from \"mobx-react\";\n\nexport abstract class VAddContact<T extends Controller> extends VPage<T> {\n\t@observable private hasError = false;\n\t@observable protected user:{id:number, name:string, nick:string, icon:string};\n\n\theader() {\n\t\treturn <div className=\"w-100 mr-1 d-flex\">\n\t\t\t<SearchBox className=\"flex-fill\" \n\t\t\t\tonSearch={this.onSearch} \n\t\t\t\tonFocus={this.onFocus}\n\t\t\t\tplaceholder=\"搜索联系人\" />\n\t\t\t<button className=\"btn btn-sm btn-outline-info ml-1\" onClick={()=>this.closePage()}>取消</button>\n\t\t</div>;\n\t}\n\n\tprivate onSearch = async (key:string) => {\n\t\tlet ret = await userApi.fromKey(key);\n\t\tif (!ret) {\n\t\t\tthis.hasError = true;\n\t\t\treturn;\n\t\t}\n\t\tif (this.controller.isMe(ret.id)) {\n\t\t\treturn;\n\t\t}\n\t\tthis.user = ret;\n\t}\n\n\tprivate onFocus = () => {\n\t\tthis.hasError = false;\n\t}\n\n\tprivate onAddContact = async () => {\n\t\t//await this.controller.AddContact(this.user.id);\n\t\tawait this.addContact();\n\t\tthis.closePage();\n\t}\n\n\tprotected abstract addContact():Promise<void>;\n\tprotected renderFields():JSX.Element {return;}\n\n\tcontent() {\n\t\tlet c = observer(() => {\n\t\t\tif (this.hasError === true) {\n\t\t\t\treturn <div className=\"p-4\">\n\t\t\t\t\t<FA className=\"text-danger mr-2\" name=\"times-circle\" />\n\t\t\t\t\t<Muted>账号不存在或者不接受邀请</Muted>\n\t\t\t\t</div>\n\t\t\t}\n\t\t\tif (!this.user) return;\n\n\t\t\tlet {name, nick, icon} = this.user;\n\t\t\tlet div:any;\n\t\t\tif (nick) {\n\t\t\t\tdiv =  <div>\n\t\t\t\t\t<div><b>{nick}</b></div>\n\t\t\t\t\t<div>{name}</div>\n\t\t\t\t</div>;\n\t\t\t}\n\t\t\telse {\n\t\t\t\tdiv = <div><b>{name}</b></div>\n\t\t\t}\n\t\t\treturn <div className=\"my-3 mx-3 border rounded\">\n\t\t\t\t<div className=\"p-4 d-flex bg-white rounded-top\">\n\t\t\t\t\t<Image className=\"w-3c h-3c mr-3\" src={icon || '.user-o'} />\n\t\t\t\t\t{div}\n\t\t\t\t</div>\n\t\t\t\t{this.renderFields()}\n\t\t\t\t<div className=\"py-3 px-4\">\n\t\t\t\t\t<button className=\"btn btn-primary\" onClick={this.onAddContact}>增加</button>\n\t\t\t\t</div>\n\t\t\t</div>;\n\t\t});\n\t\treturn React.createElement(c);\n\t}\n}\n","import React from 'react';\nimport { observer } from 'mobx-react';\nimport { User, Image, UserView, FA } from \"../../tonva\";\nimport { VNoteBase, CNoteBase } from '.';\nimport { none } from '../../tool';\n\nexport interface TabRelative {\n\tname: string;\n\tcaption: (isAction:boolean) => JSX.Element;\n\trender: () => JSX.Element;\n\tvisible: () => boolean;\n}\n\nexport class VRelativesBase<T extends CNoteBase> extends VNoteBase<T> {\n\n\tprotected tabShare:TabRelative = {\n\t\tname: 'share',\n\t\tvisible: () => this.controller.noteItem.toCount>0,\n\t\tcaption: (isAction:boolean) => {\n\t\t\tlet {toCount} = this.controller.noteItem;\n\t\t\tlet vCount:any;\n\t\t\tif (toCount > 0) vCount = <small>{toCount}</small>;\n\t\t\treturn <>\n\t\t\t\t<FA className=\"mr-2\" name=\"share\" /> \n\t\t\t\t{vCount}\n\t\t\t</>;\n\t\t},\n\t\trender: () => {\n\t\t\tlet {to} = this.controller.noteModel;\n\t\t\tif (!to || to.length === 0) return;\n\t\t\treturn <div className=\"px-3 py-2\">\n\t\t\t\t<small className=\"text-muted mr-3\">已分享给: </small>\n\t\t\t\t{to.map((t, index) => {\n\t\t\t\t\tlet {user, assigned} = t;\n\t\t\t\t\treturn <span key={index} className=\"mr-3\">{this.renderContact(user, assigned)}</span>;\n\t\t\t\t})}\n\t\t\t</div>\n\t\t}\n\t}\n\tprotected renderContact = (userId:number, assigned:string) => {\n\t\tlet renderUser = (user:User) => {\n\t\t\tlet {name, nick, icon} = user;\n\t\t\treturn <>\n\t\t\t\t<Image className=\"w-1-5c h-1-5c mr-2\" src={icon || '.user-o'} />\n\t\t\t\t{assigned || nick || name}\n\t\t\t</>\n\t\t}\n\t\treturn <UserView user={userId as number} render={renderUser} />;\n\t}\n\n\tprotected get tabs():TabRelative[] { return [this.tabShare] };\n\n\tprotected renderTabs():JSX.Element {\n\t\tlet render = observer(() => {\n\t\t\tlet {activeRelativeTab} = this.controller;\n\t\t\tlet tabs = this.tabs.filter(tab => tab.visible?.());\n\t\t\tif (tabs.length === 0) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tlet tab = tabs.find(v => v.name === activeRelativeTab);\n\t\t\tif (!tab) tab = tabs[0];\n\t\t\treturn <div className=\"bg-white\">\n\t\t\t\t<div className=\"d-flex px-3 pt-3\">\n\t\t\t\t\t{tabs.map(v => {\n\t\t\t\t\t\tlet {name, caption} = v;\n\t\t\t\t\t\tlet isActive = v === tab;\n\t\t\t\t\t\treturn this.renderTab(isActive, name, caption(isActive));\n\t\t\t\t\t})}\n\t\t\t\t</div>\n\t\t\t\t<div className=\"border-top\" style={{marginTop: '-1px'}}>\n\t\t\t\t\t{tab.render() || <div className=\"p-3\">{none}</div>}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t});\n\t\treturn React.createElement(render);\n\t}\n\n\trender():JSX.Element {\n\t\treturn this.renderTabs();\n\t}\n\n\tprivate renderTab(isAction:boolean, tabName:string, tabContent:any) {\n\t\tlet cn:string = isAction === true? ' bg-white' : ' bg-light text-muted border-bottom';\n\t\treturn <div key={tabName}\n\t\t\tclassName={'border-left border-top border-right rounded-top px-3 py-2 cursor-pointer' + cn}\n\t\t\tonClick={()=>this.controller.activeRelativeTab = tabName}>\n\t\t\t{tabContent}\n\t\t</div>;\n\t}\n}\n","import { Controller } from \"../../../tonva\";\nimport { observable } from \"mobx\";\n\nexport abstract class CContent extends Controller {\n\t@observable changed: boolean = false;\n\tprotected async internalStart() {}\n\tget isEmpty():boolean { return true; }\n\n\t//onContentChanged: () => Promise<void>;\n\ttoString(): string {return};\n\tprotected fromString(v:string):void {};\n\t\n\tstartInput(): void {\n\t\tthis.changed = false;\n\t}\n\tendInput(obj:any): void {this.buildObj(obj)}\n\tprotected abstract buildObj(obj:any): void;\n\n\tabstract renderInput(): JSX.Element;\n\tabstract renderViewContent(): JSX.Element;\n\trenderDirContent(): JSX.Element {return this.renderViewContent();}\n\n\treset(content:string) {\n\t\tthis.fromString(content);\n\t\tthis.startInput();\n\t\tthis.changed = true;\n\t}\n}\n","import React from 'react';\nimport { View } from \"../../../../tonva\";\nimport { CCheckable, ContentCheckItem } from './CCheckable';\nimport { observer } from 'mobx-react';\n\nexport abstract class VBase extends View<CCheckable> {\n\trender() {\n\t\treturn React.createElement(observer(() => {\n\t\t\tlet {uncheckedItems, checkedItems} = this.controller.doneItems;\n\t\t\treturn <div className=\"mb-2\">\n\t\t\t\t{uncheckedItems.map((v, index) => this.renderCheckItem(v))}\n\t\t\t\t{this.renderCheckedItems(checkedItems)}\n\t\t\t</div>;\n\t\t}));\n\t}\n\n\tprotected abstract renderCheckItem(v:ContentCheckItem):JSX.Element;\n\tprotected abstract renderCheckedItems(checkedItems:ContentCheckItem[]):JSX.Element;\n}\n","import React from 'react';\nimport { ContentCheckItem } from './CCheckable';\nimport { VBase } from './VBase';\n\nexport class VView extends VBase {\n\tprotected renderCheckItem(v:ContentCheckItem) {\n\t\tlet {key, text, checked} = v;\n\t\tlet cn = 'ml-3 ';\n\t\tlet content: any;\n\t\tif (checked === true) {\n\t\t\tcn += 'text-muted ';\n\t\t\tcontent = <del>{text}</del>;\n\t\t}\n\t\telse {\n\t\t\tcontent = text;\n\t\t}\n\t\treturn <label key={key} className=\"d-flex mx-3 align-items-center form-check mb-0\">\n\t\t\t<input className=\"form-check-input mr-3 mt-0\" type=\"checkbox\"\n\t\t\t\tdefaultChecked={checked}\n\t\t\t\tdata-key={key}\n\t\t\t\tonChange={e => this.onCheckChange(v, e.currentTarget.checked)} />\n\t\t\t<div className={'form-control-plaintext ' + cn}>{content}</div>\n\t\t</label>;\n\t}\n\n\tprivate onCheckChange(item:ContentCheckItem, checked:boolean) {\n\t\titem.checked = checked;\n\t}\n\n\tprotected renderCheckedItems(checkedItems:ContentCheckItem[]):JSX.Element {\n\t\tlet checkedCount = checkedItems.length;\n\t\tif (checkedCount > 0) {\n\t\t\treturn <div className=\"border-top py-2\">\n\t\t\t\t<div className=\"px-3 pt-2 small text-muted\">{checkedCount}项完成</div>\n\t\t\t\t{checkedItems.map((v, index) => this.renderCheckItem(v))}\n\t\t\t</div>;\n\t\t}\n\t}\n}\n","import React from 'react';\nimport { VBase } from \"./VBase\";\nimport { ContentCheckItem } from \"./CCheckable\";\nimport { FA } from '../../../../tonva';\n\nexport class VItem extends VBase {\n\tprotected renderCheckItem(v:ContentCheckItem) {\n\t\tlet {key, text, checked} = v;\n\t\tlet cn = 'ml-3 ';\n\t\tlet content: any;\n\t\tlet icon: string;\n\t\tif (checked === true) {\n\t\t\tcn += 'text-muted ';\n\t\t\tcontent = <del>{text}</del>;\n\t\t\ticon = 'check-square';\n\t\t}\n\t\telse {\n\t\t\tcontent = text;\n\t\t\ticon = 'square-o';\n\t\t}\n\t\treturn <div key={key} className=\"d-flex mx-3 align-items-center\">\n\t\t\t<FA name={icon} />\n\t\t\t<div className={'py-1 ' + cn}>{content}</div>\n\t\t</div>;\n\t}\n\n\tprotected renderCheckedItems(checkedItems:ContentCheckItem[]):JSX.Element {\n\t\tlet checkedCount = checkedItems.length;\n\t\tif (checkedCount > 0) {\n\t\t\treturn <div className=\"\">\n\t\t\t\t{checkedItems.map((v, index) => this.renderCheckItem(v))}\n\t\t\t</div>;\n\t\t}\n\t}\n}\n","import React from 'react';\nimport { observer } from 'mobx-react';\nimport { observable, toJS } from 'mobx';\nimport { FA } from '../../../tonva';\n\ninterface Focusable<T> {\n\titem: T;\n\tfocused: boolean;\n}\n\nexport interface ListInputProps<T> {\n\titems: T[];\n\tuniqueKey: () => number;\n\tonChanged: () => void;\n}\n\nexport abstract class ListInputBase<T> {\n\tprotected props: ListInputProps<T>;\n\t@observable private focusables: Focusable<T>[];\n\tprivate currentFocusable: Focusable<T>;\n\tprivate inputingText: string;\n\tprivate focuseTimeout: any;\n\n\tconstructor(props: ListInputProps<T>) {\n\t\tthis.props = props;\n\t\tlet {items} = props;\n\t\tthis.focusables = items? items.map(item => ({\n\t\t\titem: toJS(item), \n\t\t\tfocused: false\n\t\t})) : [];\n\t}\n\n\tprotected abstract getItemKey(item:T): number;\n\tprotected abstract getItemText(item:T): string;\n\tprotected abstract setItemText(item:T, text:string): void;\n\tprotected abstract newItem(key:number, text:string): T;\n\n\tgetList():T[] { return this.focusables.map(v => toJS(v.item))}\n\n\trender(): JSX.Element {\n\t\treturn React.createElement(observer(() => <div>\n\t\t\t{this.focusables.map(this.renderItem)}\n\t\t\t{this.renderNewInput()}\n\t\t</div>));\n\t}\n\n\tprotected renderItem = (focusable: Focusable<T>):JSX.Element => {\n\t\tlet {focused} = focusable;\n\t\treturn focused === true? this.renderInputItem(focusable) : this.renderTextItem(focusable);\n\t}\n\n\tprotected renderTextItem(focusable:Focusable<T>):JSX.Element {\n\t\tlet {item} = focusable;\n\t\tlet key = this.getItemKey(item);\n\t\tlet text = this.getItemText(item);\n\t\treturn <div key={key} className=\"d-flex mr-3 align-items-stretch\">\n\t\t\t{this.renderItemHeader(item)}\n\t\t\t<div className=\"flex-fill py-2\" onMouseDown={() => this.onItemClick(focusable)}>{text}</div>\n\t\t</div>;\n\t}\n\n\tprotected renderItemHeader(item:T):JSX.Element {\n\t\treturn <span>item</span>;\n\t}\n\n\tprotected onItemClick(focusable: Focusable<T>) {\n\t\tif (this.currentFocusable) {\n\t\t\tthis.currentFocusable.focused = false;\n\t\t}\n\t\tthis.currentFocusable = focusable;\n\t\tfocusable.focused = true;\n\t\tif (this.focuseTimeout) {\n\t\t\tclearTimeout(this.focuseTimeout);\n\t\t\tthis.focuseTimeout = undefined;\n\t\t}\n\t\tthis.focuseTimeout = setTimeout(() => {\n\t\t\tthis.input?.focus();\n\t\t\tconsole.log('this.input ' + (this.input? 'null' : 'focus') );\n\t\t}, 10);\n\t}\n\n\tprotected renderInputItem(focusable: Focusable<T>):JSX.Element {\n\t\tlet {item} = focusable;\n\t\tlet key = this.getItemKey(item);\n\t\treturn <div key={key} className=\"d-flex mr-3 align-items-stretch\">\n\t\t\t{this.renderItemHeader(item)}\n\t\t\t{this.renderInput(focusable)}\n\t\t</div>;\n\t}\n\n\tprotected renderInput(focusable?: Focusable<T>):JSX.Element {\n\t\treturn <input type=\"text\" className=\"flex-fill form-control\"\n\t\t\tdefaultValue={this.getItemText(focusable?.item)}\n\t\t\tref={this.inputRef}\n\t\t\tonBlur={this.onBlur}\n\t\t\tonKeyDown={this.onKeyDown}\n\t\t\tonChange={this.onChange} />;\n\t}\n\n\tprotected renderNewInput():JSX.Element {\n\t\treturn <div className=\"d-flex mr-3 my-2 align-items-center\">\n\t\t\t<div className=\"w-3c w-min-3c w-max-3c text-center\">\n\t\t\t\t<FA name=\"plus\" className=\"text-info mt-1\" fixWidth={true} /> \n\t\t\t</div>\n\t\t\t<input className=\"flex-fill form-control\" \n\t\t\t\ttype=\"text\" \n\t\t\t\tplaceholder=\"新增\" \n\t\t\t\tonBlur={this.onBlurAddNew}\n\t\t\t\tonChange={this.onChange}\n\t\t\t\tonKeyDown={this.onAddNewEnter} />\n\t\t</div>;\n\t}\n\n\tprivate onAddNewEnter = (evt: React.KeyboardEvent<HTMLInputElement>) => {\n\t\tif (evt.keyCode !== 13) return;\n\t\tevt.currentTarget.value = '';\n\t\tthis.addNewItem();\n\t}\n\n\tprivate addNewItem() {\n\t\tif (!this.inputingText) return;\n\t\tif (this.inputingText.trim().length === 0) return;\n\t\tthis.focusables.push(\n\t\t\t{\n\t\t\t\titem: this.newItem(this.props.uniqueKey(), this.inputingText.trimRight()),\n\t\t\t\tfocused: false\n\t\t\t}\n\t\t);\n\t\tthis.inputingText = undefined;\n\t}\n\n\tprotected input: HTMLInputElement;\n\tprivate onKeyDown = (evt: React.KeyboardEvent<HTMLInputElement>) => {\n\t\tif (evt.keyCode !== 13) return;\n\t\tthis.currentFocusable.focused = false;\n\t\tevt.currentTarget.value = '';\n\t\tthis.inputingText = undefined;\n\t\tthis.currentFocusable = undefined;\n\t}\n\n\tprivate onBlur = (evt: React.FocusEvent<HTMLInputElement>) => {\n\t\tthis.currentFocusable.focused = false;\n\t\tthis.currentFocusable = undefined;\n\t}\n\tprivate onChange = (evt: React.ChangeEvent<HTMLInputElement>) => {\n\t\tlet {value} = evt.target;\n\t\tthis.inputingText = value;\n\t\tif (this.currentFocusable) this.setItemText(this.currentFocusable.item, value);\n\t\tthis.props.onChanged();\n\t}\n\tprivate inputRef = (input: any) => {\n\t\tif (!input) return;\n\t\tif (window.getComputedStyle(input).visibility === 'hidden') return;\n\t\tthis.input = input;\n\t\t//this.input.focus();\n\t}\n\tprivate onBlurAddNew = (evt: React.FocusEvent<HTMLInputElement>) => {\n\t\tevt.currentTarget.value = '';\n\t\tthis.addNewItem();\n\t}\n}\n","import React from 'react';\nimport { ListInputBase } from \"../ListInputBase\";\nimport { ContentCheckItem } from \"./CCheckable\";\n\nexport class CheckableListInput extends ListInputBase<ContentCheckItem> {\n\tprotected getItemKey(item:ContentCheckItem): number {return item.key}\n\tprotected getItemText(item:ContentCheckItem): string {return item?.text}\n\tprotected setItemText(item:ContentCheckItem, text:string): void {if (item) {item.text = text}}\n\tprotected newItem(key:number, text:string): ContentCheckItem {return {key, text, checked:false}};\n\n\tprotected renderItemHeader(item:ContentCheckItem):JSX.Element {\n\t\treturn <label className=\"w-3c w-min-3c w-max-3c text-center mb-0\">\n\t\t\t<input className=\"mt-3\" type=\"checkbox\"\n\t\t\t\tdefaultChecked={item.checked}\n\t\t\t\tonChange={e => this.onCheckChange(item, e.currentTarget.checked)} />\n\t\t</label>;\n\t}\n\n\tprivate onCheckChange = (item:ContentCheckItem, checked:boolean) => {\n\t\titem.checked = checked;\n\t\tthis.props.onChanged();\n\t}\n}\n","import { observable, computed } from \"mobx\";\nimport { CContent } from \"../CContent\";\nimport { VView } from \"./VView\";\nimport { VItem } from \"./VItem\";\nimport { CheckableListInput } from \"./CheckableListInput\";\n\nexport interface ContentCheckItem {\n\tkey: number;\n\ttext: string;\n\tchecked: boolean;\n}\n\nexport class CCheckable extends CContent {\n\tprivate listInput: CheckableListInput;\n\t@observable items: ContentCheckItem[] = [];\n\titemKey: number = 1;\n\t\n\tget isEmpty():boolean { return this.listInput.getList().length === 0; }\n\n\tinit(obj:any) {\n\t\tif (obj) {\n\t\t\tthis.itemKey = obj.itemKey;\n\t\t\tthis.items = obj.items;\n\t\t}\n\t}\n\n\tstartInput(): void {\n\t\tsuper.startInput();\n\t\tthis.listInput = new CheckableListInput({\n\t\t\titems: this.items,\n\t\t\tuniqueKey: () => this.itemKey++,\n\t\t\tonChanged: () => this.changed = true,\t\t\t\t\t\n\t\t});\n\t}\n\n\trenderInput():JSX.Element {\n\t\treturn this.listInput.render();\n\t\t/*\n\t\tlet v = new VInput(this, this.items);\n\t\treturn v.render();\n\t\t*/\n\t}\n\n\trenderViewContent():JSX.Element {return this.renderView(VView)}\n\trenderDirContent():JSX.Element {return this.renderView(VItem)}\n\n\tendInput(obj:any): void {\n\t\tthis.items = this.listInput.getList();\n\t\tthis.buildObj(obj);\n\t}\n\n\tprotected buildObj(obj:any): void {\n\t\tobj.itemKey = this.itemKey;\n\t\tobj.items = this.items;\n\t\tdelete obj.content;\n\t}\n\n\ttoString():string { \n\t\treturn this.items?.map(v => v.text).join('\\n')\n\t}\n\n\tfromString(value: string) {\n\t\tif (value) {\n\t\t\tthis.items = [];\n\t\t\tthis.itemKey = 1;\n\t\t\tthis.items.push(...value.split('\\n').filter((v, index) => {\n\t\t\t\treturn v.trim().length > 0;\n\t\t\t}).map((v, index) => {\n\t\t\t\treturn {\n\t\t\t\t\tkey: this.itemKey++,\n\t\t\t\t\ttext: v,\n\t\t\t\t\tchecked: false\n\t\t\t\t}\n\t\t\t}));\n\t\t}\n\t}\n\t/*\n\tasync onCheckChange(key: number, checked: boolean) {\n\t\tlet item = this.items.find(v => v.key === key);\n\t\tif (item) item.checked = checked;\n\t\tawait this.onContentChanged?.();\n\t\t//await this.SetNote(false);\n\t}\n\n\tonItemChanged = (key: number, value: string) => {\n\t\tlet item = key && this.items.find(v => v.key === key);\n\t\tif (item) {\n\t\t\titem.text = value;\n\t\t}\n\t\telse {\n\t\t\tthis.inputingText = value;\n\t\t}\n\t\tthis.changed = true;\n\t}\n\n\taddNewItem(): void {\n\t\tif (this.inputingText === undefined) return;\n\t\tlet text = this.inputingText.trim();\n\t\tif (text.length === 0) return;\n\t\tthis.items.push({\n\t\t\tkey: this.itemKey++,\n\t\t\ttext,\n\t\t\tchecked: false,\n\t\t});\n\t\tthis.changed = true;\n\t\tthis.inputingText = undefined;\n\t}\n*/\n\t@computed get doneItems():{uncheckedItems:ContentCheckItem[], checkedItems: ContentCheckItem[]} {\n\t\tlet uncheckedItems:ContentCheckItem[] = [];\n\t\tlet checkedItems:ContentCheckItem[] = [];\n\t\tfor (let ci of this.items) {\n\t\t\tlet {checked} = ci;\n\t\t\tif (checked === true) checkedItems.push(ci);\n\t\t\telse uncheckedItems.push(ci);\n\t\t}\n\t\treturn {uncheckedItems, checkedItems};\n\t}\n}\n","import React from 'react';\nimport { View } from \"../../../../tonva\";\nimport { CList } from './CList';\nimport { observer } from 'mobx-react';\n\nexport class VView extends View<CList> {\n\trender() {\n\t\treturn React.createElement(observer(() => {\n\t\t\tlet items = this.controller.items;\n\t\t\treturn <ul className=\"note-content-list px-3 my-2\">\n\t\t\t\t{items.map((v, index) => {\n\t\t\t\t\tlet {key, text} = v;\n\t\t\t\t\treturn <li key={key} className=\"ml-3 pt-1 pb-2 align-items-center\">\n\t\t\t\t\t\t{text}\n\t\t\t\t\t</li>\n\t\t\t\t})}\n\t\t\t</ul>;\n\t\t}));\n\t}\n}\n","import React from 'react';\nimport { ListInputBase } from \"../ListInputBase\";\nimport { ListItem } from \"./CList\";\n\nexport class ListInput extends ListInputBase<ListItem> {\n\tprotected getItemKey(item:ListItem): number {return item.key}\n\tprotected getItemText(item:ListItem): string {return item?.text}\n\tprotected setItemText(item:ListItem, text:string): void {if (item) {item.text = text}}\n\tprotected newItem(key:number, text:string): ListItem {return {key, text}};\n\n\tprotected renderItemHeader(item:ListItem):JSX.Element {\n\t\treturn <div className=\"w-3c w-min-3c w-max-3c pt-2 text-center\">●</div>;\n\t}\n}\n","import { CContent } from \"../CContent\";\n//import { VInput } from \"./VInput\";\nimport { VView } from \"./VView\";\nimport { observable } from \"mobx\";\nimport { ListInput } from \"./ListInput\";\n\nexport interface ListItem {\n\tkey: number;\n\ttext: string;\n}\n\nexport class CList extends CContent {\n\tprivate listInput: ListInput;\n\t@observable items: ListItem[] = [];\n\titemKey: number = 1;\n\n\tinit(obj:any) {\n\t\tthis.itemKey = obj.itemKey;\n\t\tthis.items = obj.items;\n\t}\n\n\tget isEmpty():boolean { return this.items.length === 0; }\n\n\tstartInput(): void {\n\t\tsuper.startInput();\n\t\tthis.listInput = new ListInput({\n\t\t\titems: this.items,\n\t\t\tuniqueKey: () => this.itemKey++,\n\t\t\tonChanged: () => this.changed = true,\t\t\t\t\t\n\t\t});\n\t}\n\n\trenderInput():JSX.Element {\n\t\treturn this.listInput.render();\n\t\t//let v = new VInput(this);\n\t\t//return v.render();\n\t}\n\trenderViewContent():JSX.Element {return this.renderView(VView)}\n\n\tendInput(obj:any): void {\n\t\tthis.items = this.listInput.getList();\n\t\tthis.buildObj(obj);\n\t}\n\n\tprotected buildObj(obj:any): void {\n\t\tobj.itemKey = this.itemKey;\n\t\tobj.items = this.items;\n\t\tdelete obj.content;\n\t}\n\n\ttoString():string { \n\t\treturn this.items?.map(v => v.text).join('\\n')\n\t}\n\n\tfromString(value: string) {\n\t\tif (value) {\n\t\t\tthis.items = [];\n\t\t\tthis.itemKey = 1;\n\t\t\tthis.items.push(...value.split('\\n').filter((v, index) => {\n\t\t\t\treturn v.trim().length > 0;\n\t\t\t}).map((v, index) => {\n\t\t\t\treturn {\n\t\t\t\t\tkey: this.itemKey++,\n\t\t\t\t\ttext: v,\n\t\t\t\t}\n\t\t\t}));\n\t\t}\n\t}\n/*\n\tonItemChanged = (key: number, value: string) => {\n\t\tlet item = this.items.find(v => v.key === key);\n\t\tif (item) {\n\t\t\titem.text = value;\n\t\t}\n\t\telse {\n\t\t\tthis.inputingText = value;\n\t\t}\n\t\tthis.changed = true;\n\t}\n\n\taddNewItem(): void {\n\t\tif (this.inputingText === undefined) return;\n\t\tlet text = this.inputingText.trim();\n\t\tif (text.length === 0) return;\n\t\tthis.items.push({\n\t\t\tkey: this.itemKey++,\n\t\t\ttext: text,\n\t\t});\n\t\tthis.changed = true;\n\t\tthis.inputingText = undefined;\n\t}\n*/\n}\n","import { CContent } from \"../CContent\";\nimport { observable } from \"mobx\";\n\nexport abstract class CTextBase extends CContent {\n\t@observable noteContent: string;\n\t@observable changedNoteContent: string;\n\n\tget isEmpty():boolean { return this.noteContent === undefined || this.noteContent.trim().length === 0; }\n\n\tinit(obj: any): void {\n\t\tswitch (typeof obj) {\n\t\t\tdefault: break;\t\t\t\t// Add状态，没有初始值\n\t\t\tcase 'undefined': break;\n\t\t\tcase \"string\":  this.noteContent = (obj as string).trim(); break;\n\t\t\tcase \"object\": this.noteContent = obj.content?.trim(); break;\n\t\t}\n\t}\n\n\tendInput(obj:any): void {\n\t\tif (this.changedNoteContent !== undefined) {\n\t\t\tthis.noteContent = this.changedNoteContent;\n\t\t\tthis.changedNoteContent = undefined;\n\t\t}\n\t\tthis.buildObj(obj);\n\t}\n\n\tprotected buildObj(obj:any) {\n\t\tobj.content = this.changedNoteContent || this.noteContent;\n\t\tdelete obj.itemKey;\n\t\tdelete obj.items;\n\t}\n}\n","import { renderParagraphs } from '../../../components';\nimport React from 'react';\nimport { View } from \"../../../../tonva\";\nimport { CTextBase } from './CTextBase';\n\nexport class VTextBaseView<T extends CTextBase> extends View<T> {\n\trender() {\n\t\treturn <div className=\"px-3 my-2\">\n\t\t\t{this.renderParagraphs(this.controller.noteContent)}\n\t\t</div>;\n\t}\n\t\n\tprotected renderParagraphs(content:string):JSX.Element {\n\t\treturn renderParagraphs(content);\n\t}\n}\n","import React from 'react';\nimport { View } from \"../../../../tonva\";\nimport { CTextBase } from './CTextBase';\nimport { observer } from 'mobx-react';\n\nexport class VTextBaseInput<T extends CTextBase> extends View<T> {\n\trender() {\n\t\treturn <div className=\"py-1 px-1\">\n\t\t\t{React.createElement(observer(() => this.renderContentTextArea()))}\n\t\t</div>;\n\t}\n\n\tprivate renderContentTextArea() {\n\t\treturn <textarea rows={10} \n\t\t\tclassName=\"w-100 border-0 form-control\" \n\t\t\tplaceholder={this.t('content')} maxLength={20000}\n\t\t\tdefaultValue={this.controller.noteContent}\n\t\t\tonChange={this.onContentChange} />;\n\t}\n\n\tprivate onContentChange = (evt:React.ChangeEvent<HTMLTextAreaElement>) => {\n\t\tthis.controller.changedNoteContent = evt.target.value;\n\t\tthis.controller.changed = true;\n\t}\n}\n","//import React from 'react';\nimport { CText } from './CText';\n//import { observer } from 'mobx-react';\n//import { View, t } from 'tonva';\nimport { VTextBaseInput } from '../textBase';\n\nexport class VInput<T extends CText> extends VTextBaseInput<T> {\n\t/*\n\trender() {\n\t\treturn <div className=\"py-1 px-1\">\n\t\t\t{React.createElement(observer(() => this.renderContentTextArea()))}\n\t\t</div>;\n\t}\n\n\tprivate renderContentTextArea() {\n\t\treturn <textarea rows={10} \n\t\t\tclassName=\"w-100 border-0 form-control\" \n\t\t\tplaceholder={t('content')} maxLength={20000}\n\t\t\tdefaultValue={this.controller.noteContent}\n\t\t\tonChange={this.onContentChange} />;\n\t}\n\n\tprivate onContentChange = (evt:React.ChangeEvent<HTMLTextAreaElement>) => {\n\t\tthis.controller.changedNoteContent = evt.target.value;\n\t\tthis.controller.changed = true;\n\t}\n\t*/\n}\n","import React from 'react';\nimport { VTextBaseView } from '../textBase';\nimport { CText } from './CText';\n\nexport class VView<T extends CText> extends VTextBaseView<T> {\n\trender() {\n\t\treturn <div className=\"px-3 my-2\">\n\t\t\t{this.renderParagraphs(this.controller.noteContent)}\n\t\t</div>;\n\t}\n}\n","import { VInput } from \"./VInput\";\nimport { VView } from \"./VView\";\nimport { CTextBase } from \"../textBase\";\n\nexport class CText extends CTextBase {\n\trenderInput():JSX.Element {return this.renderView<this>(VInput)}\n\trenderViewContent():JSX.Element {return this.renderView<this>(VView)}\n\n\ttoString():string { return this.changedNoteContent || this.noteContent }\n\tfromString(v: string) {\n\t\tthis.noteContent = v.trim();\n\t}\n}\n\n","//import React from 'react';\n//import { View, t } from \"tonva\";\nimport { CFolder } from './CFolder';\n//import { observer } from 'mobx-react';\nimport { VTextBaseInput } from '../textBase';\n\nexport class VInput extends VTextBaseInput<CFolder> {\n\t/*\n\trender() {\n\t\treturn <div className=\"py-1 px-1\">\n\t\t\t{React.createElement(observer(() => this.renderContentTextArea()))}\n\t\t</div>;\n\t}\n\n\tprivate renderContentTextArea() {\n\t\treturn <textarea rows={10} \n\t\t\tclassName=\"w-100 border-0 form-control\" \n\t\t\tplaceholder={t('content')} maxLength={20000}\n\t\t\tdefaultValue={this.controller.noteContent}\n\t\t\tonChange={this.onContentChange} />;\n\t}\n\n\tprivate onContentChange = (evt:React.ChangeEvent<HTMLTextAreaElement>) => {\n\t\tthis.controller.changedNoteContent = evt.target.value;\n\t\tthis.controller.changed = true;\n\t}\n\t*/\n}\n","//import React from 'react';\n//import { View } from \"tonva\";\nimport { CFolder } from './CFolder';\nimport { VTextBaseView } from '../textBase';\n\nexport class VView extends VTextBaseView<CFolder> {\n\t/*\n\trender() {\n\t\treturn <div className=\"px-3 my-2\">\n\t\t\t{this.renderParagraphs(this.controller.noteContent)}\n\t\t</div>;\n\t}\n\n\tprotected renderParagraphs(content:string):JSX.Element {\n\t\tif (!content) return;\n\t\treturn <>{content.trimRight().split('\\n').map((v, index) => {\n\t\t\tlet c:any;\n\t\t\tif (!v) {\n\t\t\t\tc = '\\u00A0'; //<>&nbsp;</>;\n\t\t\t}\n\t\t\telse {\n\t\t\t\tc = '';\n\t\t\t\tlet len = v.length, i=0;\n\t\t\t\tfor (; i<len; i++) {\n\t\t\t\t\tswitch(v.charCodeAt(i)) {\n\t\t\t\t\t\tcase 0x20: c +='\\u2000'; continue;\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tc += v.substr(i);\n\t\t\t}\n\t\t\treturn <div key={index} className=\"pt-1 pb-2\">{c}</div>;\n\t\t})}</>;\n\t}\n\t*/\n}\n","import { VInput } from \"./VInput\";\nimport { VView } from \"./VView\";\nimport { CTextBase } from \"../textBase\";\n\nexport class CFolder extends CTextBase {\n\trenderInput():JSX.Element {return this.renderView(VInput)}\n\trenderViewContent():JSX.Element {\n\t\treturn this.renderView(VView)\n\t}\n}\n\n","import React from 'react';\nimport { VBasePage } from '../../views/VBasePage';\nimport { CTo } from './CTo';\n\nexport class VSent extends VBasePage<CTo> {\n\tprotected get back(): 'close' | 'back' | 'none' {return 'close'}\n\theader() {return '已发送'}\n\tcontent() {\n\t\treturn <div className=\"m-5 border rounded bg-white\">\n\t\t\t<div className=\"p-5 text-center border-bottom\">已发送</div>\n\t\t\t<div className=\"text-center py-3\">\n\t\t\t\t<button className=\"btn btn-outline-info\" onClick={()=>this.backPage()}>返回</button>\n\t\t\t</div>\n\t\t</div>;\n\t}\n}\n","import React from 'react';\nimport { observable } from 'mobx';\nimport { observer } from 'mobx-react';\nimport { List, FA } from '../../../tonva';\nimport { Contact } from '../../../model';\nimport { VBasePage } from '../../views/VBasePage';\n//import { VActions } from './VActions';\nimport { CTo } from './CTo';\n\nexport class VTo extends VBasePage<CTo> {\n\t//protected backPageCount = 2;\n\t/*\n\tinit(param?:any):void {\n\t\tif (param) {\n\t\t\tthis.backPageCount = Number(param);\n\t\t}\t\n\t}\n\t*/\n\n\t@observable private anyChanged:boolean = false;\n\tprivate list: List;\n\n\tprotected get back(): 'close' | 'back' | 'none' {return 'close'}\n\n\theader() {return '收件人'}\n\tright():any {\n\t\tlet c = observer(() => <button className=\"btn btn-sm btn-primary mr-1\" onClick={this.onNext} disabled={!this.anyChanged}>\n\t\t\t下一步 <FA name=\"angle-right\" />\n\t\t</button>);\n\t\treturn React.createElement(c);\n\t}\n\tcontent() {\n\t\tlet items = this.controller.groupContacts; //.cApp.contacts;\n\t\treturn <div className=\"\">\n\t\t\t<List ref={v => this.list = v}\n\t\t\t\titems={items} \n\t\t\t\titem={{render:this.renderContactItem, onSelect:this.onContactSelect}}\n\t\t\t\tisItemSelected={v => v.already} />\n\t\t</div>\n\t}\n\n\tprivate onContactSelect = (item:Contact, isSelected:boolean, anySelected:boolean):void => {\n\t\tlet {already} = item;\n\t\tif (\n\t\t\t\t(isSelected === true && already === 0)\n\t\t\t || (isSelected === false && already > 0)\n\t\t\t)\n\t\t{\n\t\t\tthis.anyChanged = true;\n\t\t}\n\t}\n\n\tprivate onNext = async () => {\n\t\tlet contacts = this.list.selectedItems;\n\t\tawait this.controller.onContactsSelected(contacts);\n\t\t//this.controller.contacts = contacts;\n\t\t//this.openVPage(VActions, this.backPageCount + 1); //, {contacts, noteId: this.currentNoteId});\n\t}\n}\n","import { observable } from \"mobx\";\nimport { CUqBase } from \"../../../tapp\";\nimport { Contact } from \"../../../model\";\nimport { VSent } from \"./VSent\";\nimport { VTo } from \"./VTo\";\nimport { Query } from \"tonva\";\nimport { NoteItem } from \"notes/model\";\n\nexport abstract class CTo extends CUqBase {\n\tprotected currentGroupFolder: number;\n\tcurrentNoteItem: NoteItem;\n\t@observable groupContacts: Contact[];\n\t@observable contacts: Contact[];\n\n\tconstructor(cApp:any, currentGroupFolder: number, currentNoteItem: NoteItem) {\n\t\tsuper(cApp);\n\t\tthis.currentGroupFolder = currentGroupFolder;\n\t\tthis.currentNoteItem = currentNoteItem;\n\t}\n\n\tprotected abstract get GetContacts(): Query; // this.uqs.notes.GetMyContacts\n\tprotected abstract sendOut(toList:number[]):Promise<void>;\n\tprotected abstract afterContactsSelected(): Promise<void>;\n\n\tprotected async internalStart():Promise<void> {\n\t\tlet ret = await this.GetContacts.page(\n\t\t\t{\n\t\t\t\tgroupFolder: this.currentGroupFolder,\n\t\t\t\tnote: this.currentNoteItem.note,\n\t\t\t}, 0, 50, true);\n\t\tthis.groupContacts = ret.$page;\n\t\tthis.startAction();\n\t\tthis.openVPage(VTo);\n\t}\n\n\tonSendOut = async (): Promise<void> => {\n\t\t//let {contacts, noteItem, currentFold: currentFoldItem} = this.controller;\n\t\tlet toList = this.contacts.map (v => {\n\t\t\tlet {contact} = v;\n\t\t\tif (!contact) return undefined;\n\t\t\tif (typeof contact === 'object') return (contact as any).id;\n\t\t\treturn contact;\n\t\t});\n\t\t//await this.controller.sendNoteTo(currentFoldItem.folderId, noteItem.note, toList);\n\t\tawait this.sendOut(toList);\n\t\tthis.popToTopPage();\n\t\tthis.openVPage(VSent);\n\t}\n\n\tasync onContactsSelected(contacts: Contact[]) {\n\t\tthis.contacts = contacts;\n\t\tawait this.afterContactsSelected();\n\t}\n}\n","import React from 'react';\nimport { observable } from 'mobx';\nimport { observer } from 'mobx-react';\nimport { List, FA } from '../../../tonva';\nimport { Contact } from '../../../model';\nimport { CSelectContact } from './CSelectContact';\nimport { VBasePage } from '../../views/VBasePage';\n\nexport interface SelectContactOptions {\n\ttitle?: string;\n\taction?: string;\n\tsingle?: boolean;\n}\n\nexport class VSelectContact extends VBasePage<CSelectContact> {\n\t@observable private anySelected:boolean = false;\n\t@observable private contacts: Contact[];\n\t@observable private multiple:boolean = false;\n\tprivate list: List;\n\tprivate options: SelectContactOptions;\n\n\tinit(options: SelectContactOptions):void {\n\t\tthis.options = options;\n\t}\n\n\tprotected get back(): 'close' | 'back' | 'none' {return 'close'}\n\n\theader() {return this.options?.title ?? '选择'}\n\tright() {\n\t\treturn React.createElement(observer(this.buildRight));\n\t}\n\n\tprivate buildRight = () => {\n\t\tif (this.options?.single === true) return;\n\t\tlet cn = 'btn btn-sm btn-success mr-1';\n\t\tif (this.multiple === false) {\n\t\t\treturn <button className={cn} onClick={this.onToggleSelect}>多选</button>;\n\t\t}\n\t\tif (this.contacts && this.contacts.length > 0) {\n\t\t\treturn <button className={cn} onClick={this.onNext} disabled={!this.anySelected}>\n\t\t\t\t{this.options?.action ?? '选中'}({this.contacts.length}) <FA name=\"angle-right\" />\n\t\t\t</button>;\n\t\t}\n\t\treturn <button className={cn} onClick={this.onToggleSelect}>单选</button>;\n\t}\n\n\tprivate onToggleSelect = () => {\n\t\tthis.multiple = !this.multiple;\n\t}\n\n\tcontent() {\n\t\tlet render = () => {\n\t\t\tlet list:any;\n\t\t\tlet items = this.controller.contacts;\n\t\t\tif (this.multiple === true) {\n\t\t\t\tlist = <List ref={v => this.list = v}\n\t\t\t\t\titems={items} \n\t\t\t\t\titem={{render:this.renderContactItem, onSelect:this.onContactSelect}} />\n\t\t\t}\n\t\t\telse {\n\t\t\t\tlist = <List ref={v => this.list = v}\n\t\t\t\t\titems={items} \n\t\t\t\t\titem={{render:this.renderContactItem, onClick:this.onContactClick}} />\n\t\t\t}\n\t\t\treturn <div className=\"\">\n\t\t\t\t{list}\n\t\t\t</div>;\n\t\t}\n\t\treturn React.createElement(observer(render));\n\t}\n\n\tprivate onContactSelect = (item:Contact, isSelected:boolean, anySelected:boolean):void => {\n\t\tthis.anySelected = anySelected;\n\t\tthis.contacts = this.list.selectedItems;\n\t}\n\n\tprivate onContactClick = (item:Contact) => {\n\t\tthis.returnCall([item]);\n\t}\n\n\tprivate onNext = () => {\n\t\tthis.returnCall(this.list.selectedItems);\n\t}\n}\n","import { observable } from \"mobx\";\nimport { Contact } from \"model\";\nimport { SelectContactOptions, VSelectContact } from \"./VSelectContact\";\nimport { CUqBase } from \"../../../tapp\";\n\nexport abstract class CSelectContact extends CUqBase {\n\t@observable contacts: Contact[];\n\n\t//protected abstract get GetContacts(): Query; // this.uqs.notes.GetMyContacts\n\tprotected abstract loadContacts(): Promise<void>;\n\n\tprotected async internalStart():Promise<void> {\n\t\tawait this.loadContacts();\n\t\t/*\n\t\tlet ret = await this.GetContacts.page(\n\t\t\t{\n\t\t\t\tgroupFolder: this.currentGroupFolder,\n\t\t\t\tnote: this.currentNoteItem.note,\n\t\t\t}, 0, 50, true);\n\t\tthis.groupContacts = ret.$page;\n\t\tthis.startAction();\n\t\t*/\n\t\tthis.openVPage(VSelectContact);\n\t}\n\n\tSetContacts(contacts:Contact[]) {\n\t\tthis.contacts = [];\n\t\tfor (var ci of contacts) {\n\t\t\tlet n = {...ci};\n\t\t\tthis.contacts.push(n);\n\t\t}\n\t}\n\n\tasync callSelectContact(options: SelectContactOptions): Promise<Contact[]> {\n\t\treturn await this.vCall(VSelectContact, options);\n\t}\n}\n","import React from 'react';\nimport { CInputHours } from './CInputHours';\nimport { VBasePage } from '../../views/VBasePage';\nimport { checkHourMinutes, taskTimeToString } from '../../../notes/model';\n\nexport class VInputHours extends VBasePage<CInputHours> {\n\tprotected get back(): 'close' | 'back' | 'none' {return 'close'}\n\n\tprivate hourminutes: number;\n\theader() {return '输入工时'}\n\n\tcontent() {\n\t\tlet render = () => {\n\t\t\treturn <div>\n\t\t\t\t<div className=\"flex-fill ml-2 mr-2 mt-2 \"><input className=\"flex-fill form-control border-0\"\n\t\t\t\t\ttype=\"text\" defaultValue={taskTimeToString(this.controller.hourminutes)}\n\t\t\t\t\tplaceholder=\"2.5或者2:30表示两个半小时\"\n\t\t\t\t\tautoFocus={true}\n\t\t\t\t\tonBlur={e=>this.onHoursBlur(e)}\n\t\t\t\t\tonChange={e=>this.onHoursChange(e)}/>\n\t\t\t\t</div>\n\t\t\t\t<button onClick={() => this.onNext()}\n\t\t\t\t\tclassName=\"btn btn-primary ml-2 mt-2\" >\n\t\t\t\t\t确认\n\t\t\t\t</button>\n\t\t\t</div>\n\t\t}\n\t\treturn React.createElement(render);\n\t}\n\n\tprotected onHoursChange = (evt:React.ChangeEvent<HTMLInputElement>) => {\n\t\tlet m = checkHourMinutes(evt.target.value);\n\t\tif (m < 0) {\n\t\t\tm = undefined;\n\t\t}\n\t\tthis.hourminutes = m;\n\t}\n\n\tprotected onHoursBlur = (evt: React.FocusEvent<HTMLInputElement>) => {\n\t\tif (checkHourMinutes(evt.target.value) < 0) {\n\t\t\tevt.target.value = '';\n\t\t\tthis.hourminutes = undefined;\n\t\t}\n\t}\n\n\tprivate onNext = () => {\n\t\tlet r = this.hourminutes !== undefined ? this.hourminutes : this.controller.hourminutes;\n\t\tthis.returnCall(r);\n\t}\n}\n","import { CUqBase } from \"../../../tapp\";\nimport { VInputHours } from \"./VInputHours\";\n\nexport class CInputHours extends CUqBase {\n\thourminutes: number;\n\n\tprotected async internalStart():Promise<void> {\n\t\tthis.openVPage(VInputHours);\n\t}\n\n\tasync inputHours(h?:number) {\n\t\tthis.hourminutes = h;\n\t\treturn await this.vCall(VInputHours);\n\t}\n}\n","import React from 'react';\n\nexport function renderParagraphs(content:string):JSX.Element {\n\tif (!content) return;\n\treturn <>{content.trimRight().split('\\n').map((v, index) => {\n\t\tlet c:any;\n\t\tif (!v) {\n\t\t\tc = '\\u00A0'; //<>&nbsp;</>;\n\t\t}\n\t\telse {\n\t\t\tc = '';\n\t\t\tlet len = v.length, i=0;\n\t\t\tfor (; i<len; i++) {\n\t\t\t\tswitch(v.charCodeAt(i)) {\n\t\t\t\t\tcase 0x20: c +='\\u2000'; continue;\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tc += v.substr(i);\n\t\t}\n\t\treturn <div key={index} className=\"pt-1 pb-2\">{c}</div>;\n\t})}</>;\n}\n","import React from 'react';\nimport { List, FA, User, Image, UserView } from '../../../tonva';\nimport { CContainer } from '../CContainer';\nimport { CNoteBase, VNoteBase } from \"../../noteBase\";\nimport { observer } from 'mobx-react';\nimport { renderParagraphs } from '../../components';\n\nexport class VFolder<T extends CContainer> extends VNoteBase<T> {\n\tafterBack() {\n\t\tthis.controller.owner.popFolder();\n\t}\n\theader() {\n\t\treturn React.createElement(observer(() => {\n\t\t\t\tlet {noteItem} = this.controller;\n\t\t\tif (noteItem) {\n\t\t\t\treturn noteItem.caption;\n\t\t\t}\n\t\t\treturn this.t('notes');\n\t\t}));\n\t}\n\n\tright() {\n\t\t// 应该任何群成员都可以发小单吧\n\t\t//if (this.isMe(this.controller.noteItem.owner)) {\n\t\t\treturn this.controller.owner.renderFolderDropDown();\n\t\t//}\n\t}\n\n\tprotected top() {\n\t\tlet {noteItem} = this.controller;\n\t\tif (!noteItem) return;\n\n\t\tlet paragraphs: string;\n\t\tlet {content: contentString} = noteItem;\n\t\tlet json = JSON.parse(contentString);\n\t\tif (json) {\n\t\t\tlet {content} = json;\n\t\t\tparagraphs = (content as string)?.trimEnd();\n\t\t}\n\t\telse {\n\t\t\tparagraphs = \"整理小单\";\n\t\t}\n\t\tlet left: any;\n\t\tif (this.isMe(this.controller.noteItem.owner)) {\n\t\t\tleft = <>\n\t\t\t\t<FA className=\"mr-3 text-warning py-3\" name={noteItem.toCount > 0 ? \"folder-open\":\"folder\"} size=\"3x\" />\n\t\t\t\t<div className=\"small text-muted py-3\">{this.renderParagraphs(paragraphs)}</div>\n\t\t\t</>;\n\t\t}\n\t\telse {\n\t\t\tlet {owner, assigned} = noteItem;\n\t\t\tlet renderUser = (user:User) => {\n\t\t\t\tlet {name, nick, icon} = user;\n\t\t\t\treturn <>\n\t\t\t\t\t<Image className=\"w-3c h-3c mr-2 my-3\" src={icon || '.user-o'} />\n\t\t\t\t\t<div className=\"py-3\">\n\t\t\t\t\t\t<div className=\"small\">{assigned || nick || name}</div>\n\t\t\t\t\t\t<div className=\"small text-muted py-3\">{this.renderParagraphs(paragraphs)}</div>\n\t\t\t\t\t</div>\n\t\t\t\t</>;\n\t\t\t}\n\t\t\tleft = <UserView user={owner as number} render={renderUser} />;\n\t\t}\n\t\treturn <div className=\"d-flex ml-3\">\n\t\t\t{left}\n\t\t\t<div className=\"ml-auto align-self-stretch cursor-pointer px-3 d-flex align-items-center\" \n\t\t\t\tonClick={(e)=>{e.stopPropagation(); this.controller.showFolderView()}}>\n\t\t\t\t<FA name=\"ellipsis-h\" />\n\t\t\t</div>\n\t\t</div>;\n\t}\n\n\tcontent() {\n\t\tlet {notesPager, showNoteItem} = this.controller;\n\t\treturn <div>\n\t\t\t{React.createElement(observer(() => this.top()))}\n\t\t\t<List className=\"\" \n\t\t\t\titems={notesPager} \n\t\t\t\titem={{\n\t\t\t\t\trender: this.renderItemInFolder,\n\t\t\t\t\tkey: this.noteKey, \n\t\t\t\t\tonClick: showNoteItem,\n\t\t\t\t\tclassName:'notes'}} />\n\t\t</div>\n\t}\n\n\tprotected renderParagraphs(content:string):JSX.Element {\n\t\treturn renderParagraphs(content);\n\t}\n\n\trenderListView() {\n\t\treturn this.content();\n\t}\n\n\tprivate noteKey = (item: CNoteBase) => {\n\t\tlet note = item.noteItem.note;\n\t\treturn note;\n\t}\n\n\tprivate renderItemInFolder = (cNoteBase: CNoteBase, index:number) => {\n\t\treturn <div className=\"d-block mb-2 bg-white\">{cNoteBase.renderDirItem(index)}</div>;\n\t}\n}\n","\nexport interface BookProject {\n\tid: number;\n\tname: string;\n\tcaption: string;\n\tmemo: string;\n\tratioX: number;\t\t\t\t\t// ratioX / ratioY 是显示内容值\n\tratioY: number;\n\treadUnit: string;\n\t$create: Date;\n\t$update: Date;\n\torderNo: number;\n}\nexport interface ReportProject {\n\towner: number;\n\tid: number;\n\tproject: number;\n\theader: string;\n\treadUnit: string;\n}\nexport interface BookReport {\n\tid: number;\n\trootUnit: number;\n\tcaption: string;\n\tprojects: ReportProject[];\n}\n\nexport enum EnumUnitRole {owner=1, admin=2, unitAdmin=4};\nexport enum EnumPeriod {day=1, week=2, month=3, year=4};\nexport interface UnitItem {\n\tid:number; \n\tcaption:string; \n\tcontent:string;\n\trole: EnumUnitRole;\n\tmemberCount: number;\n}\nexport interface MemberItem {\n\tmember: number;\n\tassigned: string;\n\tdiscription: string;\n\trole: EnumUnitRole;\n}\nexport interface ProjectSum {\n\tproject: BookProject;\n\tdebit: number;\n\tcredit: number;\n}\n\nexport interface UnitProjectsSum {\n\tunit: UnitItem;\n\tprojectSums: ProjectSum[];\n}\n\nexport interface MemberProjectsSum {\n\tmember: MemberItem;\n\tprojectSums: ProjectSum[];\n}\n","import React from 'react';\nimport { FA } from '../../../tonva';\nimport { CContainer } from '../CContainer';\nimport { observer } from 'mobx-react';\nimport { VNoteBase } from '../../noteBase/VNoteBase';\n\nexport class VFolderDir extends VNoteBase<CContainer> {\n\trender() {\n\t\treturn React.createElement(observer(() => {\n\t\t\tlet {noteItem} = this.controller;\n\t\t\tlet {toCount, unread} = noteItem;\n\t\t\tlet divToCount:any;\n\t\t\tif (toCount > 0) {\n\t\t\t\tdivToCount = <small className=\"ml-4 text-muted\">\n\t\t\t\t\t<FA name=\"share\" className=\"mr-1\" />\n\t\t\t\t\t{toCount}\n\t\t\t\t</small>;\n\t\t\t}\n\n\t\t\tlet dot:any;\n\t\t\tif (unread>0) {\n\t\t\t\tdot = <u/>;\n\t\t\t}\n\t\n\t\t\tlet vIcon = <div className=\"unread-dot mr-3\">\n\t\t\t\t<FA name=\"folder\" className=\"text-warning\" size=\"lg\" fixWidth={true} />\n\t\t\t\t{dot}\n\t\t\t</div>;\n\n\t\t\treturn <div className=\"d-block bg-white\">\n\t\t\t\t<div className=\"d-flex px-3 py-2 align-items-center\">\n\t\t\t\t\t{vIcon}\n\t\t\t\t\t<b className=\"\">{noteItem.caption}</b>\n\t\t\t\t\t{divToCount}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t}));\n\t}\n}\n","//import React from 'react';\nimport { VRelativesBase, TabRelative } from \"../../noteBase\";\nimport { CFolder } from \"../CFolder\";\n\nexport class VFolderRelatives extends VRelativesBase<CFolder> {\n\tprotected get tabs():TabRelative[] { return [this.tabShare] };\n}\n","import React from 'react';\nimport { observer } from 'mobx-react';\nimport { VNoteBaseView } from '../../noteBase';\nimport { CContainer } from '../CContainer';\nimport { VFolderRelatives } from './VFolderRelatives';\n\nexport class VFolderView<T extends CContainer> extends VNoteBaseView<T> {\n\tprotected get back(): 'close' | 'back' | 'none' {return 'close'}\n\theader() {\n\t\treturn React.createElement(observer(() => {\n\t\t\tlet {noteItem} = this.controller;\n\t\t\tif (noteItem) {\n\t\t\t\treturn noteItem.caption;\n\t\t\t}\n\t\t\treturn this.t('notes');\n\t\t}));\n\t}\n\n\tprotected renderRelatives() {\n\t\treturn this.renderVm(VFolderRelatives as any);\n\t}\n\n\tprotected renderContent() {\n\t\treturn this.controller.cContent.renderViewContent();\n\t}\n}\n","import { CNoteBase } from \"../noteBase\";\nimport { NoteItem, EnumNoteType } from '../model';\nimport { QueryPager } from \"../../tonva\";\nimport { EnumSpecFolder } from \"../../tapp\";\nimport { VFolder } from \"./views/VFolder\"\nimport { VFolderDir } from \"./views/VFolderDir\";\nimport { VFolderView } from \"./views/VFolderView\";\nimport { observable, computed } from \"mobx\";\nimport { CContent, CFolder } from \"../../notes/components\";\n\nexport abstract class CContainer extends CNoteBase {\n\t@observable cContent: CContent;\n\tfolderId: number;\n\tnotesPager: QueryPager<CNoteBase>;\n\tcurrentNoteItem: NoteItem;\n\n\tinit(param: NoteItem):void {\n\t\tsuper.init(param);\n\t\tthis.cContent = new CFolder(this.res)\n\t\tif (param) {\n\t\t\tthis.caption = param.caption;\n\t\t\tthis.cContent.init(param.obj);\n\t\t}\n\n\t\tlet folderId = this.noteItem?.note;\n\t\tif (!folderId) this.folderId = -EnumSpecFolder.notes;\n\t\telse this.folderId = folderId;\n\n\t\tthis.notesPager = new QueryPager<CNoteBase>(this.uqs.notes.GetNotes, undefined, undefined, true);\n\t\tthis.notesPager.setItemConverter(this.getItemConverter());\n\t}\n\n\t@computed get isContentChanged():boolean {return this.cContent.changed}\n\n\tprotected getItemConverter() {\n\t\treturn this.owner.noteItemConverter;\n\t}\n\n\tasync load() {\n\t\tawait this.notesPager.first({folderId: this.folderId, withX: 0});\n\t}\n\n\tasync refresh() {\n\t\t//每次刷新取5个。\n\t\tlet newnotes = new QueryPager<NoteItem>(this.uqs.notes.GetNotes, 5, 5, false);\n\t\tawait newnotes.first({folderId: this.folderId, withX: 1});\n\t\tlet newitems = newnotes.items;\n\t\tif (newitems) {\n\t\t\tlet len = newitems.length;\n\t\t\tlet items = this.notesPager.items;\n\t\t\tfor (let i = len - 1; i >= 0; --i) {\n\t\t\t\tlet item = newitems[i];\n\t\t\t\tlet {note, x} = item;\n\t\t\t\tlet index = items.findIndex(v => v.noteItem.note===note);\n\t\t\t\tif (index >= 0) {\n\t\t\t\t\titems.splice(index, 1);\n\t\t\t\t}\n\t\t\t\tif (x === 0) {\n\t\t\t\t\tlet cNoteItem = this.owner.noteItemConverter(item, undefined);\n\t\t\t\t\titems.unshift(cNoteItem);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\t// private async getNote(id: number): Promise<NoteModel> {\n\t// \tlet folderId = this.owner.currentFold?.folderId;\n\t// \tlet ret = await this.uqs.notes.GetNote.query({folder: folderId, note: id});\n\t// \tlet noteModel:NoteModel = ret.ret[0];\n\t// \tnoteModel.to = ret.to;\n\t// \tnoteModel.flow = ret.flow;\n\t// \tnoteModel.spawn = ret.spawn;\n\t// \tnoteModel.contain = ret.contain;\n\t// \tnoteModel.comments = ret.comments;\n\t// \tfor (var sItem of noteModel.spawn) {\n\t// \t\tinitNoteItemObj(sItem);\n\t// \t}\n\t// \treturn noteModel;\n\t// }\n\n\tshowNoteItem = async (item: CNoteBase) => {\n\t\tlet noteItem = this.currentNoteItem = item.noteItem;\n\t\t//let noteModel = await this.getNote(noteItem.note);\n\t\tnoteItem.unread = 0;\n\t\tnoteItem.commentUnread = 0;\n\t\t//item.noteModel = noteModel;\n\t\tawait item.lodeModel();\n\t\treturn item.showViewPage();\n\t}\n\n\titemChanged(noteItem: NoteItem):NoteItem {\n\t\tlet {items} = this.notesPager;\n\t\tlet index = items.findIndex(v => v.noteItem === noteItem);\n\t\tif (index > 0) {\n\t\t\tlet fItem = items.splice(index, 1);\n\t\t\titems.unshift(...fItem);\n\t\t}\n\t\t//return index >= 0;\n\t\treturn this.noteItem;\n\t}\n\n\tabstract async showFolder(): Promise<void>;\n\t/* {\n\t\tthis.load();\n\t\tthis.openVPage(VFolder);\n\t}*/\n\n\trenderListView() {\n\t\treturn (new VFolder(this)).renderListView();\n\t}\n\n\tshowViewPage(): void {\n\t\tthis.owner.openFolder(this);\n\t}\n\n\tasync showFolderView() {\n\t\tlet noteItem = this.noteItem;\n\t\tif (!noteItem)\n\t\t\treturn;\n\t\t//let noteModel = await this.getNote(noteItem.note);\n\t\tnoteItem.unread = 0;\n\t\tnoteItem.commentUnread = 0;\n\t\t//this.noteModel = noteModel;\n\t\tawait this.lodeModel();\n\t\tthis.showFolderViewPage();\n\t}\n\n\tshowFolderViewPage() {\n\t\tthis.openVPage(VFolderView as any);\n\t}\n\n\tasync addNote(folder:number, caption:string, content:string, obj:any, type:EnumNoteType) {\n\t\tlet sub = 0;\n\t\tlet param = {\n\t\t\tgroupFolder:this.groupFolder,\n\t\t\tfolder:folder,\n\t\t\tcaption,\n\t\t\tcontent,\n\t\t\ttype,\n\t\t\tsub}\n\t\tlet ret = await this.uqs.notes.AddNote.submit(param);\n\t\tlet {note} = ret;\n\t\tlet date = new Date();\n\t\tlet noteItem:NoteItem = {\n\t\t\tseconds: undefined,\n\t\t\towner: this.user.id,\n\t\t\tnote: note as number,\n\t\t\ttype,\n\t\t\tcaption,\n\t\t\tcontent,\n\t\t\tx: 0,\n\t\t\tassigned: undefined,\n\t\t\tfrom: undefined,\n\t\t\tfromAssigned: undefined,\n\t\t\tstate: undefined,\n\t\t\tunread: 0,\n\t\t\tobj,\n\t\t\t$create: date,\n\t\t\t$update: date,\n\t\t}\n\t\tif (type === EnumNoteType.folder) {\n\t\t\tnoteItem.groupFolder = this.groupFolder;\n\t\t}\n\t\tlet cNoteItem = this.owner.createCNoteBase(noteItem);\n\t\tcNoteItem.init(noteItem);\n\t\tif (folder === this.folderId) {\n\t\t\tthis.notesPager.items.unshift(cNoteItem);\n\t\t}\n\t\treturn cNoteItem;\n\t}\n\n\tasync editNote(waiting:boolean, noteItem:NoteItem, caption:string, content:string, obj:any) {\n\t\tlet {SetNote} = this.uqs.notes;\n\t\tlet {note, type} = noteItem;\n\t\tawait SetNote.submit({note, caption, content, type}, waiting);\n\t\t// Note.resetCache(note); 现在不调用NoteTuid的cache，所以不需要了\n\t\t// noteItem.unread = 1; 自己修改自己的小单，只是移到最前面，并不显示unread\n\t\tif (note === this.noteItem?.note) {\n\t\t\tthis.noteItem.caption = caption;\n\t\t\tthis.noteItem.content = content;\n\t\t\tthis.noteItem.obj = obj;\n\t\t}\n\t\telse {\n\t\t\tlet {items} = this.notesPager;\n\t\t\tlet index = items.findIndex(v => v.noteItem.note===note);\n\t\t\tif (index >= 0) {\n\t\t\t\tlet theItems = items.splice(index, 1);\n\t\t\t\tlet theItem = theItems[0];\n\t\t\t\ttheItem.noteItem.caption = caption;\n\t\t\t\ttheItem.noteItem.content = content;\n\t\t\t\ttheItem.noteItem.obj = obj;\n\t\t\t\titems.unshift(theItem);\n\t\t\t}\n\t\t}\n\t}\n\n\tasync hideNote(note:number, x:number) {\n\t\tawait this.uqs.notes.HideNote.submit({note, x});\n\t\tlet index = this.notesPager.items.findIndex(v => v.noteItem.note === note);\n\t\tif (index >= 0) this.notesPager.items.splice(index, 1);\n\t}\n\n\trenderDirItem(index: number): JSX.Element {\n\t\tlet vNoteItem = new VFolderDir(this);\n\t\treturn vNoteItem.render();\n\t}\n\n\tasync addGroup(caption:string, content:string, members:{member:number}[]) {\n\t\tlet ret = await this.uqs.notes.AddGroup.submit({caption, content, members});\n\t\tlet {group, folder} = ret;\n\t\tlet date = new Date();\n\t\tlet type = EnumNoteType.groupFolder;\n\t\tlet noteItem:NoteItem = {\n\t\t\tseconds: undefined,\n\t\t\towner: this.user.id,\n\t\t\tnote: folder as number,\n\t\t\ttype,\n\t\t\tcaption,\n\t\t\tcontent,\n\t\t\tx: 0,\n\t\t\tassigned: undefined,\n\t\t\tfrom: undefined,\n\t\t\tfromAssigned: undefined,\n\t\t\tstate: undefined,\n\t\t\tgroupFolder:group,\n\t\t\tunread: 0,\n\t\t\tobj: undefined,\n\t\t\t$create: date,\n\t\t\t$update: date,\n\t\t}\n\t\tlet cNoteItem = this.owner.createCNoteBase(noteItem);\n\t\tcNoteItem.init(noteItem);\n\t\tthis.notesPager.items.unshift(cNoteItem);\n\t\treturn cNoteItem;\n\t}\n\n\ttaskUpdateState(noteItem:NoteItem) {\n\t\tlet {items} = this.notesPager;\n\t\tlet {note} = noteItem;\n\t\tlet index = items.findIndex(v => v.noteItem.note===note);\n\t\tif (index >= 0) {\n\t\t\titems.splice(index, 1);\n\t\t\tlet c = this.getItemConverter();\n\t\t\tlet newItem = c(noteItem, undefined);\n\t\t\titems.unshift(newItem);\n\t\t}\n\t}\n}\n","import React from 'react';\nimport { FA } from '../../../tonva';\nimport { CSpace } from './CSpace';\nimport { observer } from 'mobx-react';\nimport { VNoteBase, renderIcon } from '../../../notes/noteBase';\n\nexport class VSpaceDir extends VNoteBase<CSpace> {\n\trender() {\n\t\treturn React.createElement(observer(() => {\n\t\t\tlet {noteItem} = this.controller;\n\t\t\tlet {toCount, unread} = noteItem;\n\t\t\tlet divToCount:any;\n\t\t\tif (toCount > 0) {\n\t\t\t\tdivToCount = <small className=\"ml-4 text-muted\">\n\t\t\t\t\t<FA name=\"share\" className=\"mr-1\" />\n\t\t\t\t\t{toCount}\n\t\t\t\t</small>;\n\t\t\t}\n\t\t\treturn <div className=\"d-block bg-white\">\n\t\t\t\t<div className=\"d-flex pl-2 pr-3 py-2 align-items-center\">\n\t\t\t\t\t<div className=\"unread-dot mr-3\">\n\t\t\t\t\t\t{renderIcon('users', 'text-warning')}\n\t\t\t\t\t\t{unread>0 && <u />}\n\t\t\t\t\t</div>\n\t\t\t\t\t<b className=\"text-primary\">{noteItem.caption}</b>\n\t\t\t\t\t{divToCount}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t}));\n\t}\n\t// <FA name=\"users\" className=\"text-warning\" size=\"lg\" fixWidth={true} />\n}\n","import { VBasePage } from '../../../notes/views/VBasePage';\nimport React from 'react';\nimport { FA, List } from '../../../tonva';\nimport { CSpace } from './CSpace';\n\nexport class VSpaceMembers extends VBasePage<CSpace> {\n\theader() {return '空间成员'}\n\tright() {\n\t\treturn <div className=\"cursor-pointer btn btn-lg text-white p-1 mr-1\" onClick={this.controller.showAddMember}>\n\t\t\t<FA name=\"plus\" />\n\t\t</div>;\n\t}\n\tcontent() {\n\t\treturn <div>\n\t\t\t<div className=\"text-success px-3 py-2 bg-white border-bottom\">[自己]</div>\n\t\t\t<List items={this.controller.members} item={{render: this.renderContactItem}} />\n\t\t</div>\n\t}\n}","import React from 'react';\nimport { DropdownAction, FA } from '../../../tonva';\nimport { VFolder } from \"../views/VFolder\";\nimport { CSpace } from './CSpace';\nimport { VNotesDropDown } from '../../views';\nimport { CNotes } from '../../../notes/CNotes';\nimport { observer } from 'mobx-react';\n\nexport class VSpaceView extends VFolder<CSpace> {\n\theader() {\n\t\treturn React.createElement(observer(() => {\n\t\t\tlet {noteItem} = this.controller;\n\t\t\tlet caption = noteItem ? noteItem.caption : this.t('noteSpace');\n\t\t\treturn <div>{caption}</div>\n\t\t}));\n\t}\n\n\tright() {\n\t\tif (this.isMe(this.controller.groupOwner)) {\n\t\t\tlet dd = new VSpaceDropdown(this.controller.owner, this.controller);\n\t\t\treturn dd.render();\n\t\t}\n\t\telse {\n\t\t\treturn this.controller.owner.renderSpaceDropDown();\n\t\t}\n\t}\n\n\tprotected top():JSX.Element {\n\t\tlet {noteItem} = this.controller;\n\t\tif (!noteItem) return;\n\n\t\tlet paragraphs: string = '群';\n\t\tlet {content: contentString} = noteItem;\n\t\tif (contentString) {\n\t\t\tlet json = JSON.parse(contentString);\n\t\t\tif (json) {\n\t\t\t\tlet {content} = json;\n\t\t\t\tparagraphs = (content as string)?.trimEnd();\n\t\t\t\tparagraphs = paragraphs.replace(/(\\r|\\n)/g, ' ');\n\t\t\t}\n\t\t}\n\t\treturn <div className=\"px-3 py-3 d-flex cursor-pointer align-items-center\"\n\t\t\tonClick={this.controller.showSpaceContent}>\n\t\t\t<FA className=\"mr-3 mt-1 text-warning\" name=\"users\" size=\"2x\" />\n\t\t\t<div className=\"text-muted mr-3\" style={{whiteSpace: 'nowrap', overflow: 'hidden', textOverflow: 'ellipsis'}}>\n\t\t\t\t{paragraphs}\n\t\t\t</div>\n\t\t</div>;\n\t}\n}\n\nclass  VSpaceDropdown extends VNotesDropDown {\n\tprivate cSpace: CSpace;\n\t\n\tconstructor(cNotes:CNotes, cSpace: CSpace) {\n\t\tsuper(cNotes);\n\t\tthis.cSpace = cSpace;\n\t}\n\tprotected get dropdownActions(): DropdownAction[] {\n\t\tlet addMember = {\n\t\t\ticon:'user-o', \n\t\t\tcaption:this.t('成员增减'), \n\t\t\taction: this.cSpace.showAddMember,\n\t\t\ticonClass: 'text-success'\n\t\t};\n\t\treturn [this.text, this.list, this.checkable, this.task, this.folder, undefined, addMember];\n\t}\n}\n","import { CContainer } from '../CContainer';\nimport { VNoteBaseEdit } from '../../../notes/noteBase';\n\nexport abstract class VContainerForm<T extends CContainer> extends VNoteBaseEdit<T> {\n\theader() {\n\t\treturn this.t('noteFolder');\n\t}\n\n\tprotected renderContent():JSX.Element {\n\t\treturn this.controller.cContent.renderInput()\n\t}\n\n}\n\n/*\nexport abstract class VContainerForm<T extends CContainer> extends VNoteBaseView<T> {\n\t@observable private changed: boolean = false;\n\tprivate inputAdd: HTMLInputElement;\n\n\theader() {return this.t('notes')}\n\n\tprotected onTitleChange = (evt: React.ChangeEvent<HTMLInputElement>) => {\n\t\tthis.controller.title = evt.target.value.trim();\n\t}\n\n\tprotected onContentChange = (evt:React.ChangeEvent<HTMLTextAreaElement>) => {\n\t\tthis.controller.changedNoteContent = evt.target.value;\n\t}\n\n\t@computed protected get btnSaveDisabled():boolean {\n\t\tif (this.changed === true) return false;\n\t\treturn this.getSaveDisabled();\n\t}\n\n\tprotected abstract getSaveDisabled():boolean;\n\n\tprotected abstract onButtonSave(): Promise<void>;\n\n\tprotected async onDelete(): Promise<void> {\n\t\tlet options: ConfirmOptions = {\n\t\t\tcaption: '请确认',\n\t\t\tmessage: '真的要删除这个小单吗？',\n\t\t\tyes: '确认删除',\n\t\t\tno: '不删除'\n\t\t};\n\t\tif (await this.controller.confirm(options) === 'yes') {\n\t\t\tawait this.controller.owner.hideNote(this.controller.noteItem.note, 1);\n\t\t\tthis.closePage(2);\n\t\t}\n\t}\n\n\tprotected renderDeleteButton() {\n\t\treturn <button className=\"btn btn-outline-secondary mr-3\" onClick={() => this.onDelete()}>\n\t\t\t删除\n\t\t</button>;\n\t}\n\n\tprotected abstract renderExButtons():JSX.Element;\n\n\tprotected renderEdit() {\n\t\treturn <div className=\"m-2\">\n\t\t\t<div className=\"border rounded\">\n\t\t\t\t<div className=\"bg-white\">\n\t\t\t\t\t<div className=\"py-1 px-1 border-bottom\">\n\t\t\t\t\t\t<input type=\"text\" className=\"w-100 border-0 form-control font-weight-bold\" placeholder=\"标题\" maxLength={80}\n\t\t\t\t\t\t\tonChange={this.onTitleChange}\n\t\t\t\t\t\t\tdefaultValue={this.controller.title} />\n\t\t\t\t\t</div>\n\t\t\t\t\t<div className=\"py-1 px-1\">\n\t\t\t\t\t\t{React.createElement(observer(() => this.renderContentTextArea()))}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div className=\"py-2 pl-3 bg-light border-top d-flex\">\n\t\t\t\t\t<div className=\"mr-auto\" />\n\t\t\t\t\t{React.createElement(observer(() => <>\n\t\t\t\t\t\t<button onClick={() => this.onButtonSave()}\n\t\t\t\t\t\t\tclassName=\"btn btn-primary mr-3\" disabled={this.btnSaveDisabled}>\n\t\t\t\t\t\t\t保存\n\t\t\t\t\t\t</button>\n\t\t\t\t\t</>))}\n\t\t\t\t\t{this.renderExButtons()}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>;\n\t}\n\n\tprivate renderContentTextArea() {\n\t\treturn <textarea rows={10} \n\t\t\tclassName=\"w-100 border-0 form-control\" \n\t\t\tplaceholder={this.t('notes')} maxLength={20000}\n\t\t\tdefaultValue={this.controller.noteContent}\n\t\t\tonChange={this.onContentChange} />;\n\t}\n}\n*/","import React from 'react';\nimport { observer } from 'mobx-react';\nimport { VContainerForm } from '../views/VContainerForm';\nimport { CSpace } from './CSpace';\n\nexport class VSpaceEdit extends VContainerForm<CSpace> {\n\tprotected get back(): 'close' | 'back' | 'none' {return 'close'}\n\theader() {\n\t\treturn '编辑空间';\n\t}\n\n\tprotected renderEditBottom():JSX.Element {\n\t\treturn <div className=\"py-2 pl-3 bg-light border-top d-flex\">\n\t\t\t<div className=\"mr-auto\" />\n\t\t\t{React.createElement(observer(() => <>\n\t\t\t\t<button onClick={() => this.onButtonSave()}\n\t\t\t\t\tclassName=\"btn btn-primary mr-3\" disabled={!this.controller.isNoteChanged}>\n\t\t\t\t\t保存\n\t\t\t\t</button>\n\t\t\t</>))}\n\t\t</div>;\n\t}\n\n\tprotected async onButtonSave(): Promise<void> {\n\t\tawait this.controller.SetGroup();\n\t\tthis.closePage();\n\t}\n}\n","import { observer } from 'mobx-react';\nimport { renderParagraphs } from '../../components';\nimport React from 'react';\nimport { FA, List } from '../../../tonva';\nimport { VNoteBase } from \"../../noteBase\";\nimport { CSpace } from \"./CSpace\";\n\nexport class VContentView extends VNoteBase<CSpace> {\n\theader() {return '详情'}\n\tright() {\n\t\tlet vEditButton:any;\n\t\tif (this.isMe(this.controller.groupOwner)) {\n\t\t\tvEditButton = <span className=\"mr-2\">{this.renderEditButton()}</span>;\n\t\t}\n\t\treturn vEditButton;\n\t}\n\n\tcontent() {\n\t\treturn React.createElement(observer(() => {\n\t\t\tlet {noteItem} = this.controller;\n\t\t\tif (!noteItem) return;\n\n\t\t\tlet paragraphs: string = '空间';\n\t\t\tlet {caption, content: contentString} = noteItem;\n\t\t\tif (contentString) {\n\t\t\t\tlet json = JSON.parse(contentString);\n\t\t\t\tif (json) {\n\t\t\t\t\tlet {content} = json;\n\t\t\t\t\tparagraphs = (content as string)?.trimEnd();\n\t\t\t\t}\n\t\t\t}\n\t\t\tlet left: any;\n\t\t\tleft = <div className=\"\">\n\t\t\t\t<div className=\"d-flex py-3 px-3\">\n\t\t\t\t\t<FA className=\"mr-3 text-warning\" name=\"users\" size=\"2x\" />\n\t\t\t\t\t<div>{caption}</div>\n\t\t\t\t</div>\n\t\t\t\t<div className=\"bg-white px-3 py-2\">\n\t\t\t\t\t{renderParagraphs(paragraphs)}\n\t\t\t\t</div>\n\t\t\t</div>;\n\t\t\tlet {memberCount} = this.controller;\n\t\t\tlet members = this.controller.members.filter((value, index)=>value.already===1);\n\t\t\treturn <div>\n\t\t\t\t{left}\n\t\t\t\t<div className=\"d-flex mt-2 align-items-end\">\n\t\t\t\t\t<div className=\"ml-3 mb-2 small text-muted\">{memberCount}成员</div>\n\t\t\t\t\t{ this.isMe(this.controller.groupOwner) ?\n\t\t\t\t\t\t<div className=\"ml-auto cursor-pointer text-success border border-success rounded bg-white px-1 mr-2 mb-1\"\n\t\t\t\t\t\t\tonClick={this.controller.showAddMember}>\n\t\t\t\t\t\t\t<FA name=\"plus\" />\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t:\n\t\t\t\t\t\tundefined\n\t\t\t\t\t}\n\t\t\t\t</div>\n\t\t\t\t<div>\n\t\t\t\t\t<div className=\"text-success px-3 py-2 bg-white border-bottom\">[自己]</div>\n\t\t\t\t\t{members.length>0 && <List items={members} item={{render: this.renderContactItem}} />}\n\t\t\t\t</div>\n\t\t\t</div>;\n\t\t}));\n\t}\n}\n","import { Contact } from 'model';\nimport { VBasePage } from '../../../notes/views/VBasePage';\nimport React from 'react';\nimport { List } from '../../../tonva';\nimport { CSpace } from './CSpace';\n\nexport class VContacts extends VBasePage<CSpace> {\n\theader() {return '选择成员'}\n\tcontent() {\n\t\treturn <div>\n\t\t\t<List items={this.controller.contacts} \n\t\t\t\titem={{render: this.renderContactItem, onSelect:this.onContactSelect}} \n\t\t\t\tisItemSelected={v=> v.already > 0}/>\n\t\t</div>\n\t}\n\n\tprivate onContactSelect = (item:Contact, isSelected:boolean, anySelected:boolean):void => {\n\t\tthis.controller.selectMember(item, isSelected);\n\t}\n\n}","import { VSpaceEdit } from \"./VSpaceEdit\";\n\nexport class VSapceAdd extends VSpaceEdit {\n\theader() {return '新建群'}\n\n\tprotected async onButtonSave(): Promise<void> {\n\t\tawait this.controller.addGroup();\n\t\tthis.closePage();\n\t\treturn;\n\t}\n}","import { CContainer } from \"../CContainer\";\nimport { VSpaceDir } from \"./VSpaceDir\";\nimport { renderIcon } from \"../../noteBase\";\nimport { compareID, EnumNoteType, NoteItem } from \"../../../notes/model\";\nimport { observable } from \"mobx\";\nimport { Contact } from \"model\";\nimport { VSpaceMembers } from \"./VSpaceMembers\";\nimport { VSpaceView } from \"./VSpaceView\";\nimport { VSpaceEdit } from \"./VSpaceEdit\";\nimport { VContentView } from \"./VContentView\";\nimport { VContacts } from \"./VContacts\";\nimport { VSapceAdd } from \"./VSpaceAdd\";\n\nexport class CSpace extends CContainer {\n\tgroupId: number;\n\tgroupOwner: number;\n\t@observable memberCount: number;\n\t@observable members:Contact[];\n\t@observable contacts:Contact[];\n\n\tget type():EnumNoteType { return EnumNoteType.groupFolder }\n\tasync showFolder() {\n\t\tthis.load();\n\t\tawait this.loadSpace();\t\t \n\t\tthis.openVPage(VSpaceView);\n\t}\n\n\tasync loadSpace() {\n\t\tlet resulte = await this.uqs.notes.GetGroupFolderMemberCount.query({folder: this.folderId});\n\t\tlet {group, count, owner} = resulte.ret[0];\n\t\tthis.groupId = group;\n\t\tthis.groupOwner = owner;\n\t\tthis.memberCount = count;\n\t}\n\n\tasync loadMembers() {\n\t\tlet result = await this.uqs.notes.GetGroupMembers.query({group: this.groupId});\n\t\tlet ret:any[] = result.ret;\n\t\tlet index = ret.findIndex(v => this.isMe(v.contact));\n\t\tif (index >= 0) ret.splice(index, 1);\n\t\tthis.members = ret;\n\t}\n\n\tasync loadContacts() {\n\t\tlet result = await this.uqs.notes.GetGroupContacts.query({group: this.groupId});\n\t\tlet ret:any[] = result.ret;\n\t\tlet index = ret.findIndex(v => this.isMe(v.contact));\n\t\tif (index >= 0) ret.splice(index, 1);\n\t\tthis.contacts = ret;\n\t}\n\n\trenderIcon(): JSX.Element {\n\t\treturn renderIcon('users', 'text-warning');\n\t}\n\trenderDirItem():JSX.Element {\n\t\tlet item = new VSpaceDir(this);\n\t\treturn item.render();\n\t}\n\n\tshowAddPage() {\n\t\tthis.openVPage(VSapceAdd);\n\t}\n\n\tshowEditPage() {\n\t\tthis.openVPage(VSpaceEdit);\n\t}\n\n\tshowMembers = async () => {\n\t\tawait this.loadMembers();\n\t\tthis.openVPage(VSpaceMembers);\n\t}\n\n\tshowSpaceContent = async() => {\n\t\tawait this.loadMembers();\n\t\tthis.openVPage(VContentView);\n\t}\n\n\tshowAddMember = async () => {\n\t\tawait this.loadContacts();\n\t\tawait this.loadMembers();\n\t\tthis.openVPage(VContacts);\n\t}\n\n\tasync selectMember(item:Contact, isSelected:boolean) {\n\t\tlet i = this.contacts.findIndex(v=>compareID(v.contact, item.contact));\n\t\tif (i < 0)\n\t\t\treturn;\n\t\tlet c = this.contacts[i];\n\t\tif (isSelected) {\n\t\t\tawait this.uqs.notes.AddGroupMember.submit({group:this.groupId, member:c.contact});\n\t\t\tc.already = 1;\n\t\t}\n\t\telse {\n\t\t\tawait this.uqs.notes.RemoveGroupMember.submit({group:this.groupId, member:c.contact})\n\t\t\tc.already = 0;\n\t\t}\n\t\tlet mi = this.members.findIndex(v=>compareID(v.contact, item.contact));\n\t\tif (mi >= 0) {\n\t\t\tlet m = this.members[mi];\n\t\t\tm.already = c.already;\n\t\t}\n\t\telse if (isSelected) {\n\t\t\tthis.members.push({...c});\n\t\t}\n\t}\n\n\tprotected endContentInput():any {\n\t\tlet obj = this.noteItem ? { ...this.noteItem.obj } : {};\n\t\tthis.cContent.endInput(obj);\n\t\treturn obj;\n\t}\n\n\tasync addGroup() {\n\t\tlet obj = this.endContentInput();\n\t\tlet noteContent = JSON.stringify(obj);\n\t\treturn await this.owner.rootFold.addGroup(this.caption, noteContent, []);\n\t}\n\n\tasync SetGroup(showWaiting: boolean = true) {\n\t\tlet obj = this.endContentInput();\n\t\tlet noteContent = JSON.stringify(obj);\n\t\tawait this.editGroup(showWaiting,\n\t\t\tthis.noteItem,\n\t\t\tthis.caption,\n\t\t\tnoteContent,\n\t\t\tobj);\n\t\tthis.updateChange();\n\t}\n\n\tasync editGroup(waiting:boolean, noteItem:NoteItem, caption:string, content:string, obj:any) {\n\t\tlet {SetGroup} = this.uqs.notes;\n\t\tlet {note} = noteItem;\n\t\tawait SetGroup.submit({group:this.groupId, caption, content}, waiting);\n\t\tif (note === this.noteItem?.note) {\n\t\t\tthis.noteItem.caption = caption;\n\t\t\tthis.noteItem.content = content;\n\t\t\tthis.noteItem.obj = obj;\n\t\t}\n\t}\n\n}\n","import { CContainer } from \"./CContainer\";\nimport { NoteItem, EnumNoteType } from \"../model\";\nimport { CNoteBase } from \"../noteBase\";\n\nexport abstract class CFolder extends CContainer {\n\tget type():EnumNoteType { return EnumNoteType.folder }\n}\n\nexport abstract class CFolderDisableItemFrom extends CFolder {\n\tprotected getItemConverter() {\n\t\treturn (item:NoteItem, queryResults:{[name:string]:any[]}):CNoteBase => {\n\t\t\tlet ret = this.owner.noteItemConverter(item, queryResults);\n\t\t\tret.disableFrom = true;\n\t\t\treturn ret;\n\t\t}\n\t}\n}\n","import React from 'react';\nimport { observer } from 'mobx-react';\nimport { VContainerForm } from '../views/VContainerForm';\nimport { CFolderMy } from './CFolderMy';\n\nexport class VFolderMyEdit extends VContainerForm<CFolderMy> {\n\tprotected get back(): 'close' | 'back' | 'none' {return 'close'}\n\theader() {\n\t\treturn '编辑目录';\n\t}\n\n\tprotected renderEditBottom():JSX.Element {\n\t\treturn <div className=\"py-2 pl-3 bg-light border-top d-flex\">\n\t\t\t<div className=\"mr-auto\" />\n\t\t\t{React.createElement(observer(() => <>\n\t\t\t\t<button onClick={() => this.onButtonSave()}\n\t\t\t\t\tclassName=\"btn btn-primary mr-3\" disabled={!this.controller.isNoteChanged}>\n\t\t\t\t\t保存\n\t\t\t\t</button>\n\t\t\t</>))}\n\t\t</div>;\n\t}\n}\n","import { VFolderMyEdit } from \"./VFolderMyEdit\";\n\nexport class VFolderMyAdd extends VFolderMyEdit {\n\theader() {return '新建小单夹'}\n\n\tprotected async onButtonSave(): Promise<void> {\n\t\tawait this.controller.AddNote();\n\t\tthis.closePage();\n\t\treturn;\n\t}\n}","import React from 'react';\nimport { VFolderView } from '../views';\nimport { CFolderMy } from './CFolderMy';\n\nexport class VFolderMyView extends VFolderView<CFolderMy> {\n\tprotected renderViewBottom():JSX.Element {\n\t\treturn <div className=\"py-2 pl-3 bg-light border-top d-flex align-items-end\">\n\t\t\t{this.renderShareButton()}\n\t\t</div>;\n\t}\n}\n","import { VFolder } from '../views/VFolder'\nimport { CFolderMy } from './CFolderMy';\n\nexport class VFolderMy extends VFolder<CFolderMy> {\n\n}","import { CFolderDisableItemFrom } from \"../CFolder\";\nimport { renderIcon } from \"../../noteBase\";\nimport { VFolderMyEdit } from \"./VFolderMyEdit\";\nimport { VFolderMyAdd } from \"./VFolderMyAdd\";\nimport { VFolderMyView } from \"./VFolderMyView\";\nimport { VFolderMy } from \"./VFolderMy\";\n\n// 小单夹\nexport class CFolderMy extends CFolderDisableItemFrom {\n\trenderIcon(): JSX.Element {\n\t\treturn renderIcon(this.noteItem.toCount>0? 'files-o': 'file-o', 'text-info');\n\t}\n\tshowAddPage() {\n\t\tthis.openVPage(VFolderMyAdd);\n\t}\n\tshowEditPage() {\n\t\tthis.openVPage(VFolderMyEdit);\n\t}\n\n\tshowFolderViewPage() {\n\t\tthis.openVPage(VFolderMyView);\n\t}\n\n\tasync showFolder() {\n\t\tthis.load();\n\t\tthis.openVPage(VFolderMy);\n\t}\n\n\tprotected endContentInput():any {\n\t\tlet obj = this.noteItem ? { ...this.noteItem.obj } : {};\n\t\tthis.cContent.endInput(obj);\n\t\treturn obj;\n\t}\n}\n","import { VFolder } from '../views/VFolder'\nimport { CFolderShare } from './CFolderShare';\n\nexport class VFolderShare extends VFolder<CFolderShare> {\n\n}","import { CFolderDisableItemFrom } from \"../CFolder\";\nimport { renderIcon } from \"../../noteBase\";\nimport { VFolderShare } from \"./VFolderShare\";\n\nexport class CFolderShare extends CFolderDisableItemFrom {\n\trenderIcon(): JSX.Element {\n\t\treturn renderIcon('folder', 'text-warning');\n\t}\n\tshowAddPage() {}\n\tshowEditPage() {}\n\n\tasync showFolder() {\n\t\tthis.load();\n\t\tthis.openVPage(VFolderShare);\n\t}\n}\n","import { CFolder } from \"../CFolder\";\n\nexport class CFolderRoot extends CFolder {\n\trenderIcon(): JSX.Element {return;}\n\tshowAddPage() {}\n\tshowEditPage() {}\n\n\tasync showFolder() {\n\t\tthis.load();\n\t\t//this.openVPage(VFolder);\n\t}\n}\n","import React from 'react';\nimport { VBasePage } from \"../../../../notes/views/VBasePage\";\nimport { CRootAdmin } from \"./CUnitAdmin\";\nimport { FA, Form, ItemSchema, List, Page, \n\tButtonSchema, UiButton, \n\tStringSchema, IntSchema, UiTextItem, UiNumberItem, UiSchema, Context } from '../../../../tonva';\nimport { BookProject } from '../model';\n\nexport class VRootProjects extends VBasePage<CRootAdmin> {\n\tprivate projectFileds: ItemSchema[] = [\n\t\t{name: 'name', type: 'string', maxLength: 100, required: true} as StringSchema,\n\t\t{name: 'caption', type: 'string', maxLength: 100} as StringSchema,\n\t\t{name: 'memo', type: 'string', maxLength: 100} as StringSchema,\n\t\t{name: 'ratioX', type: 'integer', min: 1} as IntSchema,\n\t\t{name: 'ratioY', type: 'integer', min: 1} as IntSchema,\n\t\t{name: 'readUnit', type: 'string', maxLength: 20} as StringSchema,\n\t\t{name: 'submit', type: 'submit'} as ButtonSchema,\n\t];\n\tprivate projectUISchema: UiSchema= {\n\t\titems: {\n\t\t\tname: {\n\t\t\t\tlabel: '名称', placeholder: '科目名称'\n\t\t\t} as UiTextItem,\n\t\t\tcaption: {\n\t\t\t\tlabel: '标题', placeholder: '科目显示标题'\n\t\t\t} as UiTextItem,\n\t\t\tmemo: {\n\t\t\t\tlabel: '说明', placeholder: '科目说明'\n\t\t\t} as UiTextItem,\n\t\t\tratioX: {\n\t\t\t\tlabel: '分子', defaultValue: 1, discription: '基本单位换算分子，默认1'\n\t\t\t} as UiNumberItem,\n\t\t\tratioY: {\n\t\t\t\tlabel: '分母', defaultValue: 1, discription: '基本单位换算分母，默认1'\n\t\t\t} as UiNumberItem,\n\t\t\treadUnit: {\n\t\t\t\tlabel: '计量单位', placeholder: '显示出来的计量单位'\n\t\t\t} as UiTextItem,\n\t\t\tsubmit: {\n\t\t\t\twidget: 'button',\n\t\t\t\tlabel: '提交',\n\t\t\t\tclassName: 'btn btn-primary'\n\t\t\t} as UiButton\n\t\t}\n\t};\n\theader() {return '机构科目'}\n\tright() {\n\t\treturn <button className=\"btn btn-sm btn-success mr-2\" onClick={this.onClickAdd}>\n\t\t\t<FA name=\"plus\" />\n\t\t</button>\n\t}\n\n\tprivate onClickAdd = () => {\n\t\tthis.controller.project = undefined;\n\t\tthis.openPageElement(<Page header=\"新增科目\">\n\t\t\t<Form className=\"m-3\"\n\t\t\t\tschema={this.projectFileds} \n\t\t\t\tuiSchema={this.projectUISchema} \n\t\t\t\tfieldLabelSize={2} onButtonClick={this.onSubmitNewProject} />\n\t\t</Page>);\n\t}\n\n\tprivate onSubmitNewProject = async (name:string, context: Context) => {\n\t\tawait this.controller.saveBookProject(context.data);\n\t\tthis.closePage();\n\t}\n\n\tcontent() {\n\t\treturn <div className=\"my-3\">\n\t\t\t<List items={this.controller.bookProjects} \n\t\t\t\titem={{render: this.renderProject, onClick: this.onClickProject}} />\n\t\t</div>;\n\t}\n\n\tprivate renderProject = (project: BookProject, index: number) => {\n\t\tlet {name, caption, memo, ratioX, ratioY, readUnit} = project;\n\t\treturn <div className=\"px-3 py-2 align-items-center\">\n\t\t\t<b>{caption ?? name}</b> <small className=\"ml-3 text-muted\">{memo}</small>\n\t\t\t<span className=\"ml-auto\">{name} = {ratioX} / {ratioY} {readUnit}</span>\n\t\t</div>;\n\t}\n\n\tprivate onClickProject = (project: BookProject) => {\n\t\tthis.controller.project = project;\n\t\tthis.openPageElement(<Page header=\"编辑科目\">\n\t\t\t<Form className=\"m-3\"\n\t\t\t\tformData={this.controller.project}\n\t\t\t\tschema={this.projectFileds} \n\t\t\t\tuiSchema={this.projectUISchema} \n\t\t\t\tfieldLabelSize={2} onButtonClick={this.onSubmitNewProject} />\n\t\t</Page>);\n\t}\n}\n","import React from 'react';\nimport { VBasePage } from \"../../../../notes/views/VBasePage\";\nimport { CAdminBase } from \"./CUnitAdmin\";\nimport { FA, List, Page } from '../../../../tonva';\nimport { BookProject } from '../model';\n\nexport class VUnitProjects <C extends CAdminBase> extends VBasePage<C> {\n\theader() {return '显示科目'}\n\tright() {return <button className=\"btn btn-sm btn-success mr-2\" onClick={this.onAddSub}>增减</button>}\n\tcontent() {\n\t\treturn <div className=\"my-3\">\n\t\t\t<List items={this.controller.unitedProjects} \n\t\t\t\titem={{render: this.renderProject, onClick: this.onClickProject}} />\n\t\t</div>;\n\t}\n\n\tprivate renderProject = (project: BookProject, index: number) => {\n\t\tlet {name, caption, memo, ratioX, ratioY, readUnit} = project;\n\t\treturn <div className=\"px-3 py-2 align-items-center\">\n\t\t\t<b>{caption ?? name}</b> <small className=\"ml-3 text-muted\">{memo}</small>\n\t\t\t<span className=\"ml-auto\">{name} = {ratioX} / {ratioY} {readUnit}</span>\n\t\t</div>;\n\t}\n\n\tprivate onClickProject = (project: BookProject) => {\n\t}\n\n\tprivate onAddSub = () => {\n\t\tthis.openPageElement(<Page header=\"调整科目\">\n\t\t\t<div className=\"mt-3 mb-1 small mx-3\">已显示科目</div>\n\t\t\t<List items={this.controller.unitedProjects} \n\t\t\t\titem={{render: this.renderUnitedProject}} />\n\t\t\t\n\t\t\t<div className=\"mt-3 mb-1 small mx-3\">可显示科目</div>\n\t\t\t<List items={this.controller.unitableProjects} \n\t\t\t\titem={{render: this.renderUnitableProject}} />\n\t\t</Page>);\n\t}\n\n\tprivate renderUnitedProject = (project: BookProject, index: number) => {\n\t\tlet {name, caption, memo, ratioX, ratioY, readUnit} = project;\n\t\tlet downVisible = index>=this.controller.unitedProjects.length-1? 'invisible' : '';\n\t\tlet upVisible = index<=0? 'invisible' : '';\n\t\treturn <div className=\"px-3 py-2 align-items-center\">\n\t\t\t<b>{caption ?? name}</b> <small className=\"ml-3 text-muted\">{memo}</small>\n\t\t\t<span className=\"ml-auto\">{name} = {ratioX} / {ratioY} {readUnit}</span>\n\t\t\t<button className=\"btn btn-sm btn-outline-dark ml-3\" \n\t\t\t\tonClick={()=>this.controller.setProjectDisplay(project, false)}>\n\t\t\t\t\t<FA name=\"minus\" />\n\t\t\t</button>\n\t\t\t<button className={'btn btn-sm btn-outline-info ml-3 ' + downVisible}\n\t\t\t\tonClick={()=>this.controller.setProjectDown(index)}>\n\t\t\t\t\t<FA name=\"arrow-down\" />\n\t\t\t</button>\n\t\t\t<button className={'btn btn-sm btn-outline-info ml-3 ' + upVisible}\n\t\t\t\tonClick={()=>this.controller.setProjectUp(index)}>\n\t\t\t\t\t<FA name=\"arrow-up\" />\n\t\t\t</button>\n\t\t</div>;\n\t}\n\n\tprivate renderUnitableProject = (project: BookProject, index: number) => {\n\t\tlet {name, caption, memo, ratioX, ratioY, readUnit} = project;\n\t\treturn <div className=\"px-3 py-2 align-items-center\">\n\t\t\t<b>{caption ?? name}</b> <small className=\"ml-3 text-muted\">{memo}</small>\n\t\t\t<span className=\"ml-auto\">{name} = {ratioX} / {ratioY} {readUnit}</span>\n\t\t\t<button className=\"btn btn-sm btn-success ml-3\"\n\t\t\t\tonClick={()=>this.controller.setProjectDisplay(project, true)}>\n\t\t\t\t\t<FA name=\"plus\" />\n\t\t\t\t</button>\n\t\t</div>;\n\t}\n}\n","import React from 'react';\nimport { VBasePage } from \"../../../../notes/views/VBasePage\";\nimport { CRootAdmin } from \"./CUnitAdmin\";\nimport { FA, Form, ItemSchema, List, Page, \n\tButtonSchema, UiButton, \n\tStringSchema, CStringEdit, UiTextItem, UiSchema, Context } from '../../../../tonva';\nimport { BookReport } from '../model';\n\nexport class VReportsAdmin extends VBasePage<CRootAdmin> {\n\tprivate projectFileds: ItemSchema[] = [\n\t\t{name: 'caption', type: 'string', maxLength: 100, required: true} as StringSchema,\n\t\t{name: 'submit', type: 'submit'} as ButtonSchema,\n\t];\n\tprivate projectUISchema: UiSchema= {\n\t\titems: {\n\t\t\tcaption: {\n\t\t\t\tlabel: '名称', placeholder: '报表名称'\n\t\t\t} as UiTextItem,\n\t\t\tsubmit: {\n\t\t\t\twidget: 'button',\n\t\t\t\tlabel: '提交',\n\t\t\t\tclassName: 'btn btn-primary'\n\t\t\t} as UiButton\n\t\t}\n\t};\n\theader() {return '报表设计'}\n\tright() {\n\t\treturn <button className=\"btn btn-sm btn-success mr-2\" onClick={this.onClickAdd}>\n\t\t\t<FA name=\"plus\" />\n\t\t</button>\n\t}\n\n\tprivate onClickAdd = () => {\n\t\tthis.controller.report = undefined;\n\t\tthis.openPageElement(<Page header=\"新增报表\">\n\t\t\t<Form className=\"m-3\"\n\t\t\t\tschema={this.projectFileds} \n\t\t\t\tuiSchema={this.projectUISchema} \n\t\t\t\tfieldLabelSize={2} onButtonClick={this.onSubmitNewReport} />\n\t\t</Page>);\n\t}\n\n\tprivate onSubmitNewReport = async (name:string, context: Context) => {\n\t\tawait this.controller.saveBookReport(context.data);\n\t\tthis.closePage();\n\t}\n\n\tcontent() {\n\t\treturn <div className=\"my-3\">\n\t\t\t<List items={this.controller.bookReports} \n\t\t\t\titem={{render: this.renderProject, onClick: this.onClickReport}} />\n\t\t</div>;\n\t}\n\n\tprivate renderProject = (report: BookReport, index: number) => {\n\t\tlet {caption} = report;\n\t\treturn <div className=\"px-3 py-2 align-items-center\">\n\t\t\t<b>{caption}</b>\n\t\t</div>;\n\t}\n\n\tprivate onClickReport = (report: BookReport) => {\n\t\tthis.controller.report = report;\n\t\tlet cNameEdit: CStringEdit = new CStringEdit(this.res);\n\t\tlet props = {\n\t\t\tlabel: '报表名称', \n\t\t\tonValueChange: this.controller.changeReportName,\n\t\t};\n\t\tthis.openPageElement(<Page header=\"编辑报表\">\n\t\t\t<div className=\"px-3 py-2 align-items-center\">\n\t\t\t\t<small className=\"text-muted\">报表名称:</small> &nbsp;\n\t\t\t\t{cNameEdit.render(report.caption, props)}\n\t\t\t</div>\n\t\t</Page>);\n\t}\n/*\n\t<Form className=\"m-3\"\n\tformData={this.controller.report}\n\tschema={this.projectFileds} \n\tuiSchema={this.projectUISchema} \n\tfieldLabelSize={2} onButtonClick={this.onSubmitNewReport} />\n*/\n}\n","import React from 'react';\nimport { observable } from 'mobx';\nimport { observer } from 'mobx-react';\nimport { Edit, FA, Form, List, Schema, StringSchema, BoolSchema, UiSchema, UiTextItem, UiCheckItem, VPage, ItemSchema, Page } from '../../../../tonva';\nimport { CAdminBase, CUnitAdmin, CRootAdmin } from './CUnitAdmin';\nimport { VBasePage } from '../../../../notes/views/VBasePage';\nimport { VAddContact } from '../../../../tool';\nimport { EnumUnitRole, MemberItem, UnitItem } from '../model';\n\nexport abstract class VAdminBase<C extends CAdminBase> extends VBasePage<C> {\n\tcontent() {\n\t\tlet {unit} = this.controller;\n\t\tlet {content} = unit;\n\t\treturn <div>\n\t\t\t{this.renderParent()}\n\t\t\t<div className=\"m-3\">\n\t\t\t\t<div>\n\t\t\t\t\t{React.createElement(observer(()=><b>{unit.caption}</b>))}\n\t\t\t\t\t{this.renderEditUnitName()}\n\t\t\t\t\t{this.renderUnitID()}\n\t\t\t\t</div>\n\t\t\t\t{content && <div>content</div>}\n\t\t\t</div>\n\n\t\t\t<div className=\"my-5\">\n\t\t\t\t{this.renderProjects()}\n\t\t\t\t{/*this.renderReportDesign()*/}\n\t\t\t\t{this.renderUnitProjects()}\n\t\t\t</div>\n\n\t\t\t{this.renderMembersAndUnits()}\n\t\t</div>\n\t}\n\n\tprotected renderParent():JSX.Element {return;}\n\tprotected renderEditUnitName():JSX.Element {return}\n\tprotected renderUnitID():JSX.Element {return}\n\tprotected renderProjects():JSX.Element {return;}\n\tprotected renderReportDesign():JSX.Element {return;}\n\n\tprotected renderUnitProjects():JSX.Element {\n\t\treturn <div className=\"mt-3 px-3 py-2 d-flex bg-white cursor-pointer align-items-center\"\n\t\t\tonClick={this.controller.showUnitProjects}>\n\t\t\t<span>科目显示</span>\n\t\t\t<FA className=\"ml-auto\" name=\"angle-right\" />\n\t\t</div>;\n\t}\n\n\tprotected renderMembersAndUnits() {\n\t\treturn <>\n\t\t\t{this.renderMembers()}\n\t\t\t<div className=\"mt-5\" />\n\t\t\t{this.renderUnits()}\n\t\t</>\n\t}\n\n\tprotected renderMembers() {\n\t\treturn <>\n\t\t\t\t<div className=\"d-flex align-items-end px-3 my-2\">\n\t\t\t\t<div className=\"small text-muted\">成员</div>\n\t\t\t\t<button className=\"ml-auto btn btn-sm btn-primary\" onClick={this.onNewMember}>\n\t\t\t\t\t<FA name=\"plus\" /> 成员\n\t\t\t\t</button>\n\t\t\t</div>\n\t\t\t<List items={this.controller.members} item={{render:this.renderMemberRow, onClick:this.onClickMember}} />\n\t\t</>;\n\t}\n\n\tprotected renderUnits() {\n\t\treturn <>\n\t\t\t\t<div className=\"d-flex align-items-end px-3 my-2\">\n\t\t\t\t<div className=\"small text-muted\">下级单位</div>\n\t\t\t\t<button className=\"ml-auto btn btn-sm btn-primary\" onClick={this.onNewUnit}>\n\t\t\t\t\t<FA name=\"plus\" /> 单位\n\t\t\t\t</button>\n\t\t\t</div>\n\t\t\t<List items={this.controller.units} item={{render: this.renderUnitRow, onClick: this.onUnitRow}} />\n\t\t</>\n\t}\n\n\tprivate onNewUnit = () => {\n\t\tthis.openVPage(VNewUnit);\n\t}\n\n\tprivate renderUnitRow = (unitItem: UnitItem, index: number) => {\n\t\treturn React.createElement(observer(() => {\n\t\t\tlet {caption, memberCount} = unitItem;\n\t\t\treturn <div className=\"px-3 py-2 align-items-center d-flex\">\n\t\t\t\t<div>\n\t\t\t\t\t<FA className=\"text-warning mr-3\" name=\"sitemap\" />\n\t\t\t\t\t<span>{caption}</span>\n\t\t\t\t</div>\n\n\t\t\t\t{<span className=\"ml-auto small\"><FA name=\"user-o\" className=\"small text-info mr-2\" /> {memberCount}</span>}\n\t\t\t</div>;\n\t\t}));\n\t}\n\n\tprivate onUnitRow = (unitItem: UnitItem) => {\n\t\tthis.controller.showUnitAdmin(unitItem);\n\t}\n\n\tprivate onNewMember = () => {\n\t\tthis.openVPage(VNewMember);\n\t}\n\n\tprivate renderMemberRow = (item: MemberItem, index: number) => {\n\t\tlet {member, assigned, role, discription} = item;\n\t\tlet right: any[] = [];\n\t\tif ((role & EnumUnitRole.owner) === EnumUnitRole.owner) {\n\t\t\tright.push(<FA key=\"owner\" className=\"text-danger ml-2\" name=\"flag\" />);\n\t\t}\n\t\tif ((role&EnumUnitRole.admin) === EnumUnitRole.admin) {\n\t\t\tright.push(<span key=\"admin\" className=\"ml-2\">管理员</span>)\n\t\t}\n\t\treturn <div className=\"px-3 py-2 cursor-pointer align-items-center\">\n\t\t\t<div className=\"mr-3\">{this.renderContact(member, assigned)}</div>\n\t\t\t<div className=\"small text-muted\">{discription}</div>\n\t\t\t<span className=\"ml-auto small\">\n\t\t\t\t{right}\n\t\t\t</span>\n\t\t</div>;\n\t}\n\n\tprivate onClickMember = (item: MemberItem) => {\n\t\tthis.openVPage(VEditMember, item);\n\t}\t\n}\n\nexport class VRootAdmin extends VAdminBase<CRootAdmin> {\n\theader() {return React.createElement(observer(()=><>机构 {this.controller.unit.caption}</>))};\n\tprotected renderUnitID() {\n\t\treturn <small className=\"text-muted ml-3\">ID={this.controller.unit.id}</small>\n\t}\n\n\tprotected renderReportDesign():JSX.Element {\n\t\treturn <div className=\"px-3 py-2 d-flex bg-white cursor-pointer\"\n\t\t\tonClick={this.controller.showDesignReports}>\n\t\t\t<span>报表设计</span>\n\t\t\t<FA className=\"ml-auto\" name=\"angle-right\" />\n\t\t</div>;\n\t}\n\n\tprotected renderProjects():JSX.Element {\n\t\treturn <div className=\"px-3 py-2 d-flex bg-white cursor-pointer border-bottom\"\n\t\t\tonClick={this.controller.showRootProjects}>\n\t\t\t<span>机构科目</span>\n\t\t\t<FA className=\"ml-auto\" name=\"angle-right\" />\n\t\t</div>;\n\t}\n\n\tprotected renderMembersAndUnits() {\n\t\treturn <>\n\t\t\t{this.renderUnits()}\n\t\t\t<div className=\"mt-5\" />\n\t\t\t{this.renderMembers()}\n\t\t</>;\n\t}\n}\n\nexport class VUnitAdmin extends VAdminBase<CUnitAdmin> {\n\theader() {return React.createElement(observer(()=><>{this.controller.unit.caption}</>))};\n\n\tprotected renderParent() {\n\t\tlet {parent} = this.controller;\n\t\treturn <div className=\"m-3 small\">\n\t\t\t<span className=\"text-muted\">上级：</span>\n\t\t\t<b className=\"text-primary\">{parent.caption}</b>\n\t\t</div>;\n\t}\n\n\tprotected renderUnitID() {\n\t\treturn <small className=\"text-muted\">ID={this.controller.unit.id}</small>\n\t}\n\n\tprotected renderEditUnitName() {\n\t\treturn <span className=\"cursor-pointer align-self-stretch\" onClick={this.onEditUnitName}>\n\t\t\t<FA className=\"text-info mx-3\" name=\"pencil-square-o\" />\n\t\t</span>;\n\t}\n\tprivate onEditUnitName = () => {\n\t\tlet right = <button className=\"btn btn-sm btn-success mr-1\" onClick={this.onUnitNameSubmit}>提交</button>;\n\t\tthis.openPageElement(<Page header=\"名称\" right={right}>\n\t\t\t<div className=\"m-3\">\n\t\t\t\t<input type=\"text\" className=\"form-control\" \n\t\t\t\t\tdefaultValue={this.controller.unit.caption}\n\t\t\t\t\tonChange={this.onUnitNameChange} maxLength={100}\n\t\t\t\t\tonKeyDown={this.onUnitNameKeyDown} />\n\t\t\t</div>\n\t\t</Page>)\n\t}\n\n\tprivate unitName:string;\n\tprivate onUnitNameChange = (evt:React.ChangeEvent<HTMLInputElement>) => {\n\t\tthis.unitName = evt.target.value;\n\t}\n\tprivate onUnitNameKeyDown = (evt:React.KeyboardEvent<HTMLInputElement>) => {\n\t\tif (evt.keyCode === 13) this.onUnitNameSubmit();\n\t}\n\n\tprivate onUnitNameSubmit = async () => {\n\t\tawait this.controller.setUnitName(this.unitName);\n\t\tthis.controller.unit.caption = this.unitName;\n\t\tthis.closePage();\n\t}\n}\n\nclass VNewUnit<C extends CAdminBase> extends VPage<C> {\n\t@observable private input: string;\n\t@observable private error: string;\n\n\theader() {return '新增单位'}\n\tcontent() {\n\t\treturn React.createElement(observer(() => {\n\t\t\tlet vError:any;\n\t\t\tif (this.error)\n\t\t\tvError = <div className=\"my-3 text-danger\">{this.error}</div>;\n\t\t\treturn <div className=\"m-3\">\n\t\t\t\t<div className=\"\">\n\t\t\t\t\t<input type=\"text\" className=\"form-control\" maxLength={100}\n\t\t\t\t\t\tplaceholder=\"单位名称\" onChange={this.onChange} onKeyDown={this.onKeyDown}/>\n\t\t\t\t</div>\n\t\t\t\t{vError}\n\t\t\t\t<div className=\"my-2\">\n\t\t\t\t\t<button className=\"btn btn-primary\" disabled={this.input?.trim().length===0}\n\t\t\t\t\t\tonClick={this.onCreate}>新建单位</button>\n\t\t\t\t</div>\n\t\t\t</div>;\n\t\t}));\n\t}\n\n\tprivate onChange = (evt: React.ChangeEvent<HTMLInputElement>) => {\n\t\tthis.input = evt.currentTarget.value;\n\t}\n\n\tprivate onKeyDown = async (evt: React.KeyboardEvent<HTMLInputElement>) => {\n\t\tif (evt.keyCode === 13) {\n\t\t\tawait this.onCreate();\n\t\t}\n\t}\n\n\tprivate onCreate = async () => {\n\t\tlet unitId = await this.controller.createUnit(this.input.trim());\n\t\tif (unitId > 0) {\n\t\t\tthis.closePage();\n\t\t\treturn;\n\t\t}\n\t\tswitch (unitId) {\n\t\t\tdefault: this.error = '错误编号：' + unitId; break;\n\t\t\tcase -1: this.error = '无建单位权限'; break;\n\t\t\tcase -2: this.error = '单位重名'; break;\n\t\t}\n\t}\n}\n\nconst adminSchema = {name: 'isAdmin', type: 'boolean', required: false} as BoolSchema;\nconst isAdminUI = {widget: 'checkbox',label: '管理员'} as UiCheckItem;\n\nconst schema: Schema = [\n\t{name: 'assigned', type: 'string', required: false, maxLength: 100} as StringSchema,\n\t{name: 'discription', type: 'string', required: false, maxLength: 100} as StringSchema,\n];\nconst uiSchema: UiSchema = {\n\titems: {\n\t\tassigned: {\n\t\t\twidget: 'text',\n\t\t\tlabel: '赋予名字',\n\t\t\tplaceholder: '成员的真实姓名'\n\t\t} as UiTextItem,\n\t\tdiscription: {\n\t\t\twidget: 'text',\n\t\t\tlabel: '说明',\n\t\t\tplaceholder: '职称，职务或者岗位信息'\n\t\t} as UiTextItem,\n\t\tisAdmin: isAdminUI,\n\t}\n};\nclass VNewMember<C extends CAdminBase> extends VAddContact<C> {\n\tprivate form: Form;\n\n\tprotected renderFields() {\n\t\treturn <Form ref={f => this.form=f} className=\"m-3\" schema={schema} uiSchema={uiSchema} fieldLabelSize={2} />\t\n\t}\n\t\n\tprotected async addContact():Promise<void> {\n\t\tlet {assigned, discription} = this.form.data;\n\t\tawait this.controller.addMember(this.user.id, assigned, discription);\n\t}\n}\n\nclass VEditMember<C extends CAdminBase> extends VBasePage<C> {\n\t@observable private item: MemberItem;\n\tinit(item: MemberItem) {\n\t\tthis.item = item;\n\t\tisAdminUI.readOnly = (this.item.role & EnumUnitRole.owner) === EnumUnitRole.owner;\n\t}\n\theader() {return '详情'}\n\tcontent () {\n\t\treturn React.createElement(observer(() => {\n\t\t\tlet {assigned, discription} = this.item;\n\t\t\tlet data = {\n\t\t\t\tisAdmin: (this.item.role & (EnumUnitRole.admin | EnumUnitRole.unitAdmin)) !== 0,\n\t\t\t\tassigned, discription,\n\t\t\t};\n\t\t\treturn <div>\n\t\t\t\t<Edit className=\"m-3\" \n\t\t\t\t\tdata={data}\n\t\t\t\t\tschema={[adminSchema, ...schema]} \n\t\t\t\t\tuiSchema={uiSchema}\n\t\t\t\t\tonItemChanged={this.onItemChanged} />\n\t\t\t</div>;\n\t\t}));\n\t}\n\n\tprivate onItemChanged = async (itemSchema: ItemSchema, newValue:any, preValue:any) => {\n\t\tlet {name} = itemSchema;\n\t\tif (name === 'isAdmin') {\n\t\t\tawait this.controller.setUnitMemberAdmin(this.item, newValue);\n\t\t}\n\t\telse {\n\t\t\tawait this.controller.setUnitMemberProp(this.item, name, newValue);\n\t\t}\n\t}\n}\n","import { observable } from \"mobx\";\nimport _ from 'lodash';\nimport { EnumNoteType } from \"../../../../notes/model\";\nimport { renderIcon } from \"../../../../notes/noteBase\";\nimport { CUqBase } from \"../../../../tapp\";\nimport { VRootProjects } from \"./VRootProjects\";\nimport { VUnitProjects } from \"./VUnitProjects\";\nimport { VReportsAdmin } from \"./VReportsAdmin\";\nimport { VAdminBase, VUnitAdmin, VRootAdmin } from \"./VUnitAdmin\";\nimport { BookProject, BookReport, EnumUnitRole, MemberItem, UnitItem } from \"../model\";\n\nexport class CAdminBase  extends CUqBase {\n\tisChanged: boolean = false;\n\troot: UnitItem;\n\tparent: UnitItem;\n\t@observable unit: UnitItem;\n\t@observable units:UnitItem[];\n\t@observable members:MemberItem[];\n\n\tprotected async internalStart() {}\n\tinit(root:UnitItem, parent:UnitItem, unit:UnitItem) {\n\t\tthis.root = root;\n\t\tthis.parent = parent;\n\t\tthis.unit = unit;\n\t}\n\n\tget type():EnumNoteType { return EnumNoteType.unitNote }\n\trenderIcon(): JSX.Element {return renderIcon('sitemap', 'text-primary');}\n\trenderDirItem(index: number): JSX.Element {return;}\n\tshowAddPage() {}\n\tshowEditPage() {}\n\n\tprotected getVUnitAdmin(): new (controller: any) => VAdminBase<any> { return VUnitAdmin; }\n\n\tasync showViewPage(afterBack: (isChanged:boolean) => void) {\n\t\tlet unitNote = -this.unit.id;\n\t\tlet result = await this.uqs.notes.GetUnit.query({unitNote});\n\t\tthis.unit = result.ret[0];\n\t\tif (this.unit === undefined) {\n\t\t\tdebugger;\n\t\t\tthrow new Error('not unit for note=' + unitNote);\n\t\t}\n\t\tthis.units = result.units;\n\t\tthis.members = this.moveOwnerMemberToTop(result.members);\n\t\tthis.openVPage(this.getVUnitAdmin(), undefined, afterBack);\n\t}\n\n\tprivate moveOwnerMemberToTop(members: MemberItem[]):MemberItem[] {\n\t\tlet ret:MemberItem[] = [];\n\t\tlet pOwner = 0, pAdmin = 0;\n\t\tfor (let member of members) {\n\t\t\tlet {role} = member;\n\t\t\tif ((role & EnumUnitRole.owner) === EnumUnitRole.owner) {\n\t\t\t\tret.splice(pOwner, 0, member);\n\t\t\t\tpOwner++;\n\t\t\t\tpAdmin++;\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tif ((role & EnumUnitRole.admin) === EnumUnitRole.admin) {\n\t\t\t\tret.splice(pAdmin, 0, member);\n\t\t\t\tpAdmin++;\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tret.push(member);\n\t\t}\n\t\treturn ret;\n\t}\n\n\tasync showUnitAdmin(unitItem: UnitItem) {\n\t\tlet cUnitAdmin = new CUnitAdmin(this.cApp);\n\t\tcUnitAdmin.init(this.root, this.unit, unitItem);\n\t\tawait cUnitAdmin.showViewPage(() => {\n\t\t\tlet {isChanged} = cUnitAdmin;\n\t\t\tif (isChanged) this.isChanged = isChanged;\n\t\t});\n\t}\n\n\tasync createUnit(unitName: string):Promise<number> {\n\t\tlet result = await this.uqs.notes.CreateUnit.submit({\n\t\t\tparent: this.parent.id, //.unitNoteId, \n\t\t\tname: unitName,\n\t\t\tcontent: undefined,\n\t\t});\n\t\tlet {id} = result;\n\t\tif (id > 0) {\n\t\t\tthis.units.push({\n\t\t\t\tid,\n\t\t\t\tcaption: unitName,\n\t\t\t\tcontent: undefined,\n\t\t\t\trole: 7,\n\t\t\t\tmemberCount: 0,\n\t\t\t})\n\t\t}\n\t\tthis.isChanged = true;\n\t\treturn id;\n\t}\n\n\tasync setUnitName(unitName:string) {\n\t\tawait this.uqs.notes.SetUnitName.submit({unit: this.unit.id, name: unitName});\n\t\tthis.parent.caption = unitName;\n\t\tthis.isChanged = true;\n\t}\n\n\tasync addMember(userId:number, assigned:string, discription:string) {\n\t\tawait this.uqs.notes.AddUnitMember.submit({\n\t\t\tunit: this.unit.id,\n\t\t\tmember: userId,\n\t\t\tassigned,\n\t\t\tdiscription\n\t\t});\n\t\tthis.members.push({\n\t\t\tmember: userId,\n\t\t\tassigned,\n\t\t\tdiscription,\n\t\t\trole: 0,\n\t\t});\n\t\tthis.isChanged = true;\n\t}\n\n\tasync setUnitMemberAdmin(member:MemberItem, isAdmin: boolean) {\n\t\tlet roleMask = EnumUnitRole.admin | EnumUnitRole.unitAdmin;\n\t\tlet role = isAdmin ? roleMask : 0;\n\t\tawait this.uqs.notes.SetUnitMemberRole.submit({\n\t\t\tunit:this.unit.id, member:member.member, roleMask, role\n\t\t});\n\t\tmember.role &= ~roleMask;\n\t\tmember.role |= role;\n\t\tthis.isChanged = true;\n\t}\n\n\tasync setUnitMemberProp(member:MemberItem, prop:string, value:string) {\n\t\tawait this.uqs.notes.SetUnitMemberProp.submit({\n\t\t\tunit:this.unit.id, member:member.member, prop, value\n\t\t});\n\t\t(member as any)[prop] = value;\n\t\tthis.isChanged = true;\n\t}\n\n\trootProjects: BookProject[];\n\t@observable unitedProjects: BookProject[];\n\t@observable unitableProjects: BookProject[];\n\tprivate async loadUnitProjects() {\n\t\tlet results = await this.uqs.notes.GetUnitProjects.query({\n\t\t\trootUnit: this.root.id, \n\t\t\tunit:this.unit.id\n\t\t});\n\t\tlet projects:BookProject[] = results.ret;\n\t\tthis.rootProjects = projects;\n\t\tlet unitedProjects:BookProject[] = [];\n\t\tlet unitableProjects:BookProject[] = [];\n\t\tfor (let project of projects) {\n\t\t\tlet {orderNo} = project;\n\t\t\tif (orderNo > 0) {\n\t\t\t\tunitedProjects.push(project);\n\t\t\t}\n\t\t\telse {\n\t\t\t\tunitableProjects.push(project);\n\t\t\t}\n\t\t}\n\t\tif (unitedProjects.length === 0) {\n\t\t\tfor (let i=0; i<projects.length; i++) {unitableProjects[i].orderNo = i+1};\n\t\t\tunitedProjects = unitableProjects;\n\t\t\tunitableProjects = [];\n\t\t}\n\t\tthis.unitedProjects = unitedProjects;\n\t\tthis.unitableProjects = unitableProjects;\n\t}\n\tshowUnitProjects = async () => {\n\t\tawait this.loadUnitProjects();\n\t\tthis.openVPage<CAdminBase>(VUnitProjects);\n\t}\n\n\tsetProjectDisplay = async (project: BookProject, display: boolean) => {\n\t\tlet from: BookProject[], to: BookProject[];\n\t\tif (display === true) {\n\t\t\tfrom = this.unitableProjects;\n\t\t\tto = this.unitedProjects;\n\t\t\tproject.orderNo = this.unitedProjects.length + 1;\n\t\t}\n\t\telse {\n\t\t\tfrom = this.unitedProjects;\n\t\t\tto = this.unitableProjects;\n\t\t\tproject.orderNo = undefined;\n\t\t}\n\t\tlet index = from.findIndex(v => v === project);\n\t\tif (index >= 0) {\n\t\t\tfrom.splice(index, 1);\n\t\t\tto.push(project);\n\t\t}\n\t\tawait this.setUnitProjects();\n\t}\n\tsetProjectDown = async (index: number) => {\n\t\tlet arr = this.unitedProjects.splice(index, 1);\n\t\tthis.unitedProjects.splice(index+1, 0, ...arr);\n\t\tawait this.setUnitProjects();\n\t}\n\tsetProjectUp = async (index: number) => {\n\t\tlet arr = this.unitedProjects.splice(index, 1);\n\t\tthis.unitedProjects.splice(index-1, 0, ...arr);\n\t\tawait this.setUnitProjects();\n\t}\n\n\tprivate async setUnitProjects() {\n\t\tlet param = {\n\t\t\tunit: this.unit.id, \n\t\t\tprojects: this.unitedProjects.map(v => ({project: v.id, orderNo: v.orderNo}))\n\t\t}\n\t\tawait this.uqs.notes.SetUnitProjects.submit(param);\n\t}\n}\n\nexport class CUnitAdmin extends CAdminBase {\n}\n\nexport class CRootAdmin extends CAdminBase {\n\tproject: BookProject;\n\t@observable bookProjects: BookProject[];\n\treport: BookReport;\n\t@observable bookReports: BookReport[];\n\n\tprotected getVUnitAdmin(): new (controller: any) => VAdminBase<any> { return VRootAdmin; }\n\n\tprivate async loadBookProjects() {\n\t\tlet results = await this.uqs.notes.GetRootUnitProjects.query({rootUnit: this.unit.id});\n\t\tthis.bookProjects = results.ret;\n\t}\n\tshowRootProjects = async () => {\n\t\tawait this.loadBookProjects();\n\t\tthis.openVPage(VRootProjects);\n\t}\n\tasync saveBookProject(data: any) {\n\t\tlet id = this.project?.id;\n\t\tdata.rootUnit = this.unit.id;\n\t\tlet ret = await this.uqs.notes.BookProject.save(id, data);\n\t\tdata.id = ret.id;\n\t\tif (this.project) {\n\t\t\t_.merge(this.project, data);\n\t\t}\n\t\telse {\n\t\t\tthis.bookProjects.push(data);\n\t\t}\n\t}\n\n\tprivate async loadBookReports() {\n\t\tlet results = await this.uqs.notes.GetRootUnitReports.query({rootUnit: this.unit.id});\n\t\tthis.bookReports = results.ret;\n\t}\n\tshowDesignReports = async () => {\n\t\tawait this.loadBookReports();\n\t\tthis.openVPage(VReportsAdmin);\n\t}\n\tasync saveBookReport(data: any) {\n\t\tlet id = this.report?.id;\n\t\tdata.rootUnit = this.unit.id;\n\t\tlet ret = await this.uqs.notes.BookReport.save(id, data);\n\t\tdata.id = ret.id;\n\t\tif (this.report) {\n\t\t\t_.merge(this.report, data);\n\t\t}\n\t\telse {\n\t\t\tthis.bookReports.push(data);\n\t\t}\n\t}\n\n\tchangeReportName = async (caption: string) => {\n\t\tthis.report.caption = caption;\n\t}\n}\n","import React from 'react';\nimport { observer } from 'mobx-react';\nimport { FA } from '../../../tonva';\nimport { CContainer } from '../CContainer';\nimport { VNoteBase } from '../../noteBase';\n\nexport class VUnitNoteDir extends VNoteBase<CContainer> {\n\trender() {\n\t\treturn React.createElement(observer(() => {\n\t\t\tlet {noteItem} = this.controller;\n\t\t\tlet {toCount, unread} = noteItem;\n\t\t\tlet divToCount:any;\n\t\t\tif (toCount > 0) {\n\t\t\t\tdivToCount = <small className=\"ml-4 text-muted\">\n\t\t\t\t\t<FA name=\"share\" className=\"mr-1\" />\n\t\t\t\t\t{toCount}\n\t\t\t\t</small>;\n\t\t\t}\n\n\t\t\tlet dot:any;\n\t\t\tif (unread>0) {\n\t\t\t\tdot = <u/>;\n\t\t\t}\n\t\n\t\t\tlet vIcon = <div className=\"unread-dot mr-3\">\n\t\t\t\t{this.controller.renderIcon()}\n\t\t\t\t{dot}\n\t\t\t</div>;\n\n\t\t\treturn <div className=\"d-block bg-white\">\n\t\t\t\t<div className=\"d-flex pl-2 pr-3 py-2 align-items-center\">\n\t\t\t\t\t{vIcon}\n\t\t\t\t\t<b className=\"text-primary\">{noteItem.caption}</b>\n\t\t\t\t\t{divToCount}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t}));\n\t}\n}\n","import React from 'react';\nimport { observer } from 'mobx-react';\nimport { FA, List } from '../../../tonva';\nimport { VNoteBase } from '../../noteBase';\nimport { CUnitNote } from './CUnitNote';\nimport { EnumUnitRole, MemberProjectsSum, ProjectSum, UnitProjectsSum } from './model';\n\nexport class VUnitNoteView extends VNoteBase<CUnitNote> {\n\theader() {return this.controller.noteItem.caption};\n\tright() {\n\t\tlet {role} = this.controller.unit;\n\t\tif ((role & EnumUnitRole.admin) === EnumUnitRole.admin) {\n\t\t\treturn <button className=\"btn btn-success btn-sm mr-2\" onClick={this.onAdmin}>管理</button>;\n\t\t}\n\t}\n\tprivate onAdmin = () => {\n\t\tthis.controller.showRootAdmin();\n\t}\n\t\n\tcontent() {\n\t\treturn React.createElement(observer(() => {\n\t\t\tlet {unit, myProjectsSum} = this.controller;\n\t\t\tlet {id, caption, content} = unit;\n\t\t\treturn <div className=\"pb-3\">\n\t\t\t\t<div className=\"m-3\">\n\t\t\t\t\tnote: {id} <br/>\n\t\t\t\t\tcaption: {caption} <br/>\n\t\t\t\t\tcontent: {content} <br/>\n\t\t\t\t</div>\n\t\t\t\t<div className=\"mb-1\" />\n\t\t\t\t<div className=\"bg-white mb-4\">\n\t\t\t\t\t{this.renderMemberRow(myProjectsSum, 0)}\n\t\t\t\t</div>\n\t\t\t\t{this.renderUnits()}\n\t\t\t\t<div className=\"mb-4\" />\n\t\t\t\t{this.renderMembers()}\n\t\t\t</div>;\n\t\t}));\n\t}\n\n\tprivate renderProjectSums(projectSums:ProjectSum[]) {\n\t\treturn <div className=\"d-flex flex-wrap\">\n\t\t\t{projectSums.map(v => {\n\t\t\t\tlet {project, debit} = v;\n\t\t\t\tlet {name, caption} =project;\n\t\t\t\treturn <div className=\"border p-2 mx-3 mb-3 text-center w-8c rounded border-info\">\n\t\t\t\t\t<div className=\"mb-2 text-truncate text-dark small\">{caption || name}</div>\n\t\t\t\t\t<div className=\"text-primary\">{debit}</div>\n\t\t\t\t</div>;\n\t\t\t})}\n\t\t</div>;\n\t}\n\n\tprotected renderUnits() {\n\t\treturn <>\n\t\t\t<div className=\"d-flex align-items-end px-3 my-2\">\n\t\t\t\t<div className=\"small text-muted\">单位</div>\n\t\t\t</div>\n\t\t\t<List items={this.controller.unitProjectsSums} item={{render: this.renderUnitRow, onClick: this.onUnitRow}} />\n\t\t</>\n\t}\n\n\tprivate renderUnitRow = (unitProjectsSum: UnitProjectsSum, index: number) => {\n\t\tlet {unit, projectSums} = unitProjectsSum;\n\t\treturn React.createElement(observer(() => {\n\t\t\tlet {caption} = unit;\n\t\t\treturn <div className=\"d-block\">\n\t\t\t\t<div className=\"d-flex px-3 py-2 align-items-center\">\n\t\t\t\t\t<FA className=\"text-warning mr-3\" name=\"sitemap\" />\n\t\t\t\t\t<span>{caption}</span>\n\t\t\t\t</div>\n\t\t\t\t{this.renderProjectSums(projectSums)}\n\t\t\t</div>;\n\t\t}));\n\t}\n\n\tprivate onUnitRow = () => {\n\t\talert('unit')\n\t}\n\n\tprotected renderMembers() {\n\t\treturn <>\n\t\t\t\t<div className=\"d-flex align-items-end px-3 my-2\">\n\t\t\t\t<div className=\"small text-muted\">成员</div>\n\t\t\t</div>\n\t\t\t<List items={this.controller.memberProjectsSums} item={{render:this.renderMemberRow, onClick:this.onMemberRow}} />\n\t\t</>;\n\t}\n\n\tprivate renderMemberRow = (memberProjectsSum: MemberProjectsSum, index: number) => {\n\t\tlet {member:memberItem, projectSums} = memberProjectsSum;\n\t\tlet {member, assigned, discription} = memberItem;\n\t\tlet right: any[] = [];\n\t\t/*\n\t\tif ((role & EnumUnitRole.owner) === EnumUnitRole.owner) {\n\t\t\tright.push(<FA key=\"owner\" className=\"text-danger ml-2\" name=\"flag\" />);\n\t\t}\n\t\tif ((role&EnumUnitRole.admin) === EnumUnitRole.admin) {\n\t\t\tright.push(<span key=\"admin\" className=\"ml-2\">管理员</span>)\n\t\t}\n\t\t*/\n\t\treturn <div className=\"d-block\">\n\t\t\t<div className=\"d-flex px-3 py-2 cursor-pointer align-items-center\">\n\t\t\t\t<div className=\"mr-3\">{this.renderContact(member, assigned)}</div>\n\t\t\t\t<div className=\"small text-muted\">{discription}</div>\n\t\t\t\t<span className=\"ml-auto small\">\n\t\t\t\t\t{right}\n\t\t\t\t</span>\n\t\t\t</div>\n\t\t\t{this.renderProjectSums(projectSums)}\n\t\t</div>;\n\t}\n\n\tprivate onMemberRow = () => {\n\t\talert('member')\n\t}\n}\n","import { observable } from \"mobx\";\nimport { EnumNoteType } from \"../../../notes/model\";\nimport { renderIcon } from \"../../../notes/noteBase\";\nimport { Tuid } from \"../../../tonva\";\nimport { CContainer } from \"../CContainer\";\nimport { CRootAdmin, CUnitAdmin } from \"./admin\";\nimport { EnumPeriod, MemberItem, MemberProjectsSum, ProjectSum, UnitItem, UnitProjectsSum } from \"./model\";\nimport { VUnitNoteDir } from \"./VUnitNoteDir\";\nimport { VUnitNoteView } from \"./VUnitNoteView\";\n\nexport class CUnitNote extends CContainer {\n\tunit: UnitItem;\n\t@observable units:UnitItem[];\n\t@observable members:MemberItem[];\n\tcUnitAdmins: CUnitAdmin[] = [];\n\tcurUnitAdmin: CUnitAdmin;\n\tisChanged: boolean = false;\n\t@observable unitProjectsSums: UnitProjectsSum[];\n\t@observable memberProjectsSums: MemberProjectsSum[];\n\t@observable myProjectsSum: MemberProjectsSum;\n\n\tget type():EnumNoteType { return EnumNoteType.unitNote }\n\trenderIcon(): JSX.Element {\n\t\treturn renderIcon('sitemap', 'text-primary');\n\t}\n\n\trenderDirItem(index: number): JSX.Element {\n\t\tlet vNoteItem = new VUnitNoteDir(this);\n\t\treturn vNoteItem.render();\n\t}\n\n\tshowAddPage() {\n\t\t//this.openVPage(VFolderMyAdd);\n\t}\n\tshowEditPage() {\n\t\t//this.openVPage(VFolderMyEdit);\n\t}\n\n\tprivate async loadUnits() {\n\t\tlet unitNote = this.noteItem.note;\n\t\tlet result = await this.uqs.notes.GetUnit.query({unitNote});\n\t\tthis.unit = result.ret[0];\n\t\tif (this.unit === undefined) {\n\t\t\tdebugger;\n\t\t\tthrow new Error('not unit for note=' + unitNote);\n\t\t}\n\t\tthis.units = result.units;\n\t\tthis.members = result.members;\n\t}\n\n\tasync loadMySum(period: EnumPeriod) {\n\t\tlet results = await this.uqs.notes.GetMySum.query({\n\t\t\tunit:this.unit.id,\n\t\t\tat: undefined,\n\t\t\tperiod, \t\t\t// 1=day, 2=week, 3=month, 4=year\t\t\t\t\t\t\t\n\t\t});\n\t\tlet {projects, sum} = results;\n\t\tthis.myProjectsSum = this.buildMyProjectsSum(sum, projects);\n\t}\n\n\tprivate async loadProjectsSum(period: EnumPeriod) {\n\t\tlet results = await this.uqs.notes.GetUnitSum.query({\n\t\t\tunit:this.unit.id,\n\t\t\tat: undefined,\n\t\t\tperiod, \t\t\t// 1=day, 2=week, 3=month, 4=year\t\t\t\t\t\t\t\n\t\t});\n\t\tlet {projects, subSum, memberSum} = results;\n\t\tthis.unitProjectsSums = this.buildUnitProjectsSums(subSum, projects);\n\t\tthis.memberProjectsSums = this.buildMemberProjectsSums(memberSum, projects);\n\t}\n\n\tprivate buildUnitProjectsSums(unitSums:any[], projects:any[]):UnitProjectsSum[] {\n\t\tlet unitProjectsSum:UnitProjectsSum = undefined;\n\t\tlet unitProjectsSums:UnitProjectsSum[] = [];\n\t\tfor (let subRow of unitSums) {\n\t\t\tlet {unit, project, debit, credit} = subRow;\n\t\t\tlet projectSums: ProjectSum[];\n\t\t\tif (unitProjectsSum === undefined || unitProjectsSum.unit.id !== unit) {\n\t\t\t\tlet unitItem = this.units.find(v => v.id === unit);\n\t\t\t\tif (unitItem === undefined) break;\n\t\t\t\tprojectSums  = projects.map((v:any) => ({project:v, debit:undefined, credit:undefined}));\n\t\t\t\tunitProjectsSum = {\n\t\t\t\t\tunit: unitItem,\n\t\t\t\t\tprojectSums\n\t\t\t\t}\n\t\t\t\tunitProjectsSums.push(unitProjectsSum);\n\t\t\t}\n\t\t\telse {\n\t\t\t\tprojectSums = unitProjectsSum.projectSums;\n\t\t\t}\n\t\t\tlet projectSum = projectSums.find(v => v.project.id === project);\n\t\t\tif (projectSum !== undefined) {\n\t\t\t\tprojectSum.debit = debit;\n\t\t\t\tprojectSum.credit = credit;\n\t\t\t}\n\t\t}\n\t\treturn unitProjectsSums;\n\t}\n\n\tprivate buildMemberProjectsSums(memberSums:any[], projects:any[]):MemberProjectsSum[] {\n\t\tlet memberProjectsSum:MemberProjectsSum = undefined;\n\t\tlet memberProjectsSums = [];\n\t\tfor (let memberSum of memberSums) {\n\t\t\tlet {member, project, debit, credit} = memberSum;\n\t\t\tlet projectSums: ProjectSum[];\n\t\t\tif (memberProjectsSum === undefined || Tuid.equ(memberProjectsSum.member.member, member) === false) {\n\t\t\t\tlet memberItem = this.members.find(v => Tuid.equ(v.member, member));\n\t\t\t\tif (memberItem === undefined) break;\n\t\t\t\tprojectSums  = projects.map((v:any) => ({project:v, debit:undefined, credit:undefined}));\n\t\t\t\tmemberProjectsSum = {\n\t\t\t\t\tmember: memberItem,\n\t\t\t\t\tprojectSums\n\t\t\t\t}\n\t\t\t\tmemberProjectsSums.push(memberProjectsSum);\n\t\t\t}\n\t\t\telse {\n\t\t\t\tprojectSums = memberProjectsSum.projectSums;\n\t\t\t}\n\t\t\tlet projectSum = projectSums.find(v => v.project.id === project);\n\t\t\tif (projectSum !== undefined) {\n\t\t\t\tprojectSum.debit = debit;\n\t\t\t\tprojectSum.credit = credit;\n\t\t\t}\n\t\t}\n\t\treturn memberProjectsSums;\n\t}\n\n\tprivate buildMyProjectsSum(mySums:any, projects:any[]):MemberProjectsSum {\n\t\tlet memberItem = this.members.find(v => Tuid.equ(v.member, this.user.id));\n\t\tlet projectSums: ProjectSum[] = projects.map((v:any) => ({project:v, debit:undefined, credit:undefined}));\n\t\tlet memberProjectsSum:MemberProjectsSum = {\n\t\t\tmember: memberItem,\n\t\t\tprojectSums\n\t\t}\n\t\tfor (let sum of mySums) {\n\t\t\tlet {project, debit, credit} = sum;\n\t\t\tlet projectSum = projectSums.find(v => v.project.id === project);\n\t\t\tif (projectSum !== undefined) {\n\t\t\t\tprojectSum.debit = debit;\n\t\t\t\tprojectSum.credit = credit;\n\t\t\t}\n\t\t}\n\t\treturn memberProjectsSum;\n\t}\n\n\tasync showFolder() {\n\t\tawait this.loadUnits();\n\t\tawait this.loadMySum(EnumPeriod.day);\n\t\tawait this.loadProjectsSum(EnumPeriod.day);\n\t\tthis.openVPage(VUnitNoteView);\n\t}\n\n\tasync showRootAdmin() {\n\t\tthis.curUnitAdmin = new CRootAdmin(this.cApp);\n\t\tthis.curUnitAdmin.init(this.unit, undefined, {\n\t\t\tid: -this.noteItem.note,\n\t\t} as any);\n\t\tawait this.curUnitAdmin.showViewPage(() => {\n\t\t\tlet {isChanged} = this.curUnitAdmin;\n\t\t\tif (isChanged) {\n\t\t\t\tthis.units = undefined;\n\t\t\t\tthis.loadUnits();\n\t\t\t}\n\t\t});\n\t}\n}\n","import React from 'react';\nimport { View, Page, UserView, EasyTime, User } from \"../../../../tonva\";\nimport { CComments } from \"./CComments\";\nimport { CommentItem } from '../../../../notes/model';\n\nexport class VCommentsList extends View<CComments> {\n\trender() {\n\t\treturn this.renderComments();\n\t}\n\t\n\tprotected renderComments = () => {\n\t\tlet {comments} = this.controller.cNote.noteModel;\n\t\tlet {length} = comments;\n\t\tif (length === 0) return;\n\t\treturn <div className=\"py-3\">\n\t\t\t{comments.map(v => this.renderComment(v))}\n\t\t\t{\n\t\t\t\tlength >= 10 && <div className=\"px-3 pt-3 cursor-pointer text-primary text-right small\"\n\t\t\t\tonClick={this.showMoreComments}>更多评论...</div>\n\t\t\t}\n\t\t</div>;\n\t}\n\n\tprivate showMoreComments = () => {\n\t\tthis.openPageElement(<Page header=\"评论\">\n\t\t\t<div className=\"text-muted p-3\">更多评论正在开发中 ...</div>\n\t\t</Page>);\n\t}\n\n\tprotected renderComment(comment:CommentItem) {\n\t\tlet {id, owner, assigned, content, $update} = comment;\n\t\tlet renderUser = (user:User) => {\n\t\t\tlet {id, name, nick} = user;\n\t\t\tlet isMe = this.isMe(id);\n\t\t\tlet userName:string, cn:string;\n\t\t\tif (isMe === true) {\n\t\t\t\tcn = 'text-success';\n\t\t\t\tuserName = '[我]';\n\t\t\t}\n\t\t\telse {\n\t\t\t\tcn = 'text-primary-dark';\n\t\t\t\tuserName = assigned || nick || name;\n\t\t\t}\n\t\t\tlet divUserName = <span className={cn + ' mr-2'}>{userName}:</span>;\n\t\t\t// <Image className=\"w-1-5c h-1-5c mx-3\" src={icon || '.user-o'} />\n\t\t\t// <div className=\"small mb-3\">{divUserName}</div>\n\t\t\treturn <div className=\"mt-1 d-flex bg-white pt-2\">\n\t\t\t\t<div className=\"mx-3\">\n\t\t\t\t\t<div className=\"small text-muted\"><EasyTime date={$update} /></div>\n\t\t\t\t\t<div className=\"\">{this.renderCommentContent(divUserName, content)}</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t}\n\t\treturn <UserView key={id} user={owner} render={renderUser} />;\n\t}\n\t\n\tprotected renderCommentContent(vUser:any, content:string):JSX.Element {\n\t\tif (!content) return;\n\t\treturn <>{content.trimRight().split('\\n').map((v, index) => {\n\t\t\tlet c:any;\n\t\t\tif (!v) {\n\t\t\t\tc = '\\u00A0'; //<>&nbsp;</>;\n\t\t\t}\n\t\t\telse {\n\t\t\t\tc = '';\n\t\t\t\tlet len = v.length, i=0;\n\t\t\t\tfor (; i<len; i++) {\n\t\t\t\t\tswitch(v.charCodeAt(i)) {\n\t\t\t\t\t\tcase 0x20: c +='\\u2000'; continue;\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tc += v.substr(i);\n\t\t\t}\n\t\t\tif (index === 0) c = <>{vUser}{c}</>;\n\t\t\treturn <div key={index} className=\"pb-1\">{c}</div>;\n\t\t})}</>;\n\t}\n}\n","import { EnumNoteType, NoteItem } from \"../../model\";\n\nexport enum EnumTaskState { Start = 0, Done = 1, Pass = 2, Fail = 3, Rated = 4, Canceled = 5 };\n\nexport interface TaskStateResult {\n\tcontent: string;\n\tisEnd: boolean;\n}\nconst stateContents: {[key in EnumTaskState]: TaskStateResult} = {\n\t[EnumTaskState.Start]: {content: '待办', isEnd: false},\n\t[EnumTaskState.Done]: {content: '已办', isEnd: true},\n\t[EnumTaskState.Pass]: {content: '签收', isEnd: true},\n\t[EnumTaskState.Fail]: {content: '拒签', isEnd: true},\n\t[EnumTaskState.Rated]: {content: '已评价', isEnd: true},\n\t[EnumTaskState.Canceled]: {content: '已取消', isEnd: true}\n}\n\nexport function GetTaskStateContent(type:number, state:number) {\n\tif (type !== EnumNoteType.task)\n\t\treturn;\n\treturn stateContents[state as EnumTaskState];\n}\n\nexport function getTaskItemState(noteItem: NoteItem): TaskStateResult {\n\tlet {type, state} = noteItem;\n\tif (type !== EnumNoteType.task)\n\t\treturn;\n\tswitch (state) {\n\t\tcase EnumTaskState.Done:\n\t\t\tif (noteItem.obj.checker) {\n\t\t\t\treturn {content: '待验收', isEnd: false};\n\t\t\t}\n\t\t\telse if (noteItem.obj.rater) {\n\t\t\t\treturn {content: '待评分', isEnd: false};\n\t\t\t}\n\t\t\tbreak;\n\t\tcase EnumTaskState.Pass:\n\t\t\tif (noteItem.obj.rater) {\n\t\t\t\treturn {content: '待评分', isEnd: false};\n\t\t\t}\n\t\t\tbreak;\n\t}\n\treturn GetTaskStateContent(type, state);\n}\n","import React from 'react';\nimport { VPage } from \"../../../../tonva\";\nimport { CComments } from \"./CComments\";\n\nexport class VAddComment extends VPage<CComments> {\n\theader() {return \"评论\"}\n\t\n\tcontent() {\n\t\treturn <textarea rows={10} \n\t\t\tclassName=\"w-100 border-0 form-control\"\n\t\t\tplaceholder=\"请输入\" maxLength={20000}\n\t\t\tonChange={this.onCommentChange} />\n\t}\n\n\tright() {\n\t\treturn <button className=\"btn btn-sm btn-success mr-1\" onClick={this.onCommentSubmit}>提交</button>;\n\t}\n\n\tprivate comment:string;\n\tprivate onCommentChange = (evt:React.ChangeEvent<HTMLTextAreaElement>) => {\n\t\tthis.comment = evt.target.value;\n\t}\n\n\tprivate onCommentSubmit = async () => {\n\t\tawait this.controller.onAddComment(this.comment);\n\t\t//this.controller.relativeKey = 'comment';\n\t\tthis.closePage();\n\t}\n}\n","import React from 'react';\nimport { View, Page, FA } from \"../../../../tonva\";\nimport { CComments } from \"./CComments\";\n\nexport class VWriteComment extends View<CComments> {\n\trender():JSX.Element {\n\t\treturn <div\n\t\t\tclassName=\"flex-fill rounded-pill mr-3 border bg-white px-3 py-1 small cursor-pointer\"\n\t\t\tonClick={this.onComment}>\n\t\t\t写评论...\n\t\t</div>;\n\t}\n\n\trenderButton():JSX.Element {\n\t\treturn <span className=\"cursor-pointer text-primary mr-5\" onClick={this.onComment}>\n\t\t\t<FA name=\"comment-o\" />\n\t\t</span>;\n\t}\n\n\tprotected onComment = () => {\n\t\tlet right = <button className=\"btn btn-sm btn-success mr-1\" onClick={this.onCommentSubmit}>提交</button>;\n\t\tthis.openPageElement(<Page header=\"评论\" right={right}>\n\t\t\t<textarea rows={10} \n\t\t\t\tclassName=\"w-100 border-0 form-control\"\n\t\t\t\tplaceholder=\"请输入\" maxLength={20000}\n\t\t\t\tonChange={this.onCommentChange} />\n\t\t</Page>);\n\t}\n\tprivate comment:string;\n\tprivate onCommentChange = (evt:React.ChangeEvent<HTMLTextAreaElement>) => {\n\t\tthis.comment = evt.target.value;\n\t}\n\n\tprivate onCommentSubmit = async () => {\n\t\tawait this.controller.onAddComment(this.comment);\n\t\t//this.controller.relativeKey = 'comment';\n\t\tthis.closePage();\n\t}\n}\n","import { Controller } from \"../../../../tonva\";\nimport { VCommentsList } from \"./VCommentsList\";\nimport { VAddComment } from \"./VAddComment\";\nimport { CNote } from \"../../../../notes/note/CNote\";\nimport { VWriteComment } from \"./VWriteComment\";\n\nexport class CComments extends Controller {\n\tcNote: CNote;\n\n\tprotected async internalStart() {}\n\n\tinit(cNote: CNote) {\n\t\tthis.cNote = cNote;\n\t}\n\n\trenderCommentsList():JSX.Element { return this.renderView(VCommentsList); }\n\t\n\tshowAddCommentPage() {\n\t\tthis.openVPage(VAddComment);\n\t}\n\n\tasync onAddComment(comment:string) {\n\t\tawait this.cNote.addComment(comment);\n\t}\n\n\trenderWriteComment():JSX.Element {\n\t\treturn this.renderView(VWriteComment);\n\t}\n\n\trenderCommentButton():JSX.Element {\n\t\tlet vWriteComment = new VWriteComment(this);\n\t\treturn vWriteComment.renderButton();\n\t}\n}\n","import { CNoteBase } from \"../noteBase\";\nimport { NoteItem } from \"../model\";\nimport { CComments } from \"./components\";\n\nexport abstract class CNote extends CNoteBase {\n\tcComments: CComments;\n\n\tinit(param: NoteItem):void {\n\t\tsuper.init(param);\n\t\tthis.cComments = new CComments(this.res);\n\t\tthis.cComments.init(this);\n\t\tif (param) {\n\t\t\tif (!this.caption) this.caption = param.caption;\n\t\t}\n\t}\n\t\n\taddComment = async (content: string) => {\n\t\tlet ret = await this.uqs.notes.AddComment.submit({ note: this.noteModel.id, content });\n\t\tlet commentId = ret.comment;\n\t\t// 加入note界面，显示comment\n\t\tif (commentId) {\n\t\t\tthis.noteItem.commentCount++;\n\t\t\tthis.noteModel.comments.unshift({\n\t\t\t\tid: commentId,\n\t\t\t\tcontent: content,\n\t\t\t\towner: this.user.id,\n\t\t\t\tassigned: undefined,\n\t\t\t\t$create: new Date(),\n\t\t\t\t$update: new Date(),\n\t\t\t});\n\t\t\tthis.activeRelativeTab = 'comment';\n\t\t\tthis.updateChange();\n\t\t}\n\t}\n}\n","import React from 'react';\nimport { FA } from \"../../../tonva\";\nimport { CNote } from \"../CNote\";\nimport { VRelativesBase, TabRelative } from '../../noteBase';\n\nexport class VRelativesNoteBase<T extends CNote> extends VRelativesBase<T> {\n\tprotected tabComment:TabRelative = {\n\t\tname: 'comment',\n\t\tvisible: () => this.controller.noteItem.commentCount>0,\n\t\tcaption: (isAction:boolean) => {\n\t\t\tlet {commentCount} = this.controller.noteItem;\n\t\t\tlet vCount:any;\n\t\t\tif (commentCount > 0) vCount = <small>{commentCount}</small>;\n\t\t\treturn <>\n\t\t\t\t<FA className=\"mr-2\" name=\"comment-o\" /> \n\t\t\t\t{vCount}\n\t\t\t</>\n\t\t},\n\t\trender: () => this.controller.cComments.renderCommentsList(),\n\t}\n\n\tprotected tabFlow:TabRelative = {\n\t\tname: 'flow',\n\t\tvisible: () => this.controller.noteModel?.flow.length>0,\n\t\tcaption: (isAction:boolean) => {\n\t\t\treturn <>流程</>;\n\t\t},\n\t\trender: () => {\n\t\t\tlet {flow} = this.controller.noteModel;\n\t\t\tif (!flow || flow.length === 0) return;\n\t\t\treturn <div>flow: {flow.length}</div>\n\t\t}\n\t}\n\t\n\tprotected get tabs():TabRelative[] { return [this.tabComment, this.tabShare, this.tabFlow] };\n}\n\nexport class VNoteRelatives extends VRelativesNoteBase<CNote> {\n}","//import React from 'react';\nimport { VRelativesNoteBase } from '../views';\nimport { CNoteAssign } from './CNoteAssign';\nimport { TabRelative } from '../../noteBase';\n\nexport class VAssignRelatives extends VRelativesNoteBase<CNoteAssign> {\n\tprotected get tabs():TabRelative[] { return [this.tabComment, this.tabShare] };\n}\n","import { NoteItem } from '../../../notes/model';\nimport React from 'react';\nimport { DropdownAction, DropdownActions, List } from '../../../tonva';\nimport { VNoteBaseView } from '../../noteBase';\nimport { getTaskItemState } from '../task/TaskState';\nimport { CNoteAssign } from './CNoteAssign';\nimport { VAssignRelatives } from './VAssignRelatives';\n\nexport class VAssignView extends VNoteBaseView<CNoteAssign> {\n\theader() {\n\t\treturn this.t('noteTask')\n\t}\n\n\tprotected renderRelatives() {\n\t\treturn this.renderVm(VAssignRelatives);\n\t}\n\n\tright() {\n\t\tlet dropdownActions: DropdownAction[] = [\n\t\t\t{\n\t\t\t\ticon:'hand-pointer-o', \n\t\t\t\tcaption:'复制任务', \n\t\t\t\taction: this.controller.duplicateAssign,\n\t\t\t\ticonClass: 'text-primary'\n\t\t\t}\n\t\t];\n\t\treturn <DropdownActions actions={dropdownActions}\n\t\t\ticon=\"plus\"\n\t\t\titemIconClass=\"text-info\"\n\t\t\tclassName=\"cursor-pointer btn btn-lg text-white p-1 mr-1\"/>\n\t}\n\n\tfooter() {\n\t\treturn this.renderFooter();\n\t}\n\n\tprotected renderFooter() {\n\t\treturn <div className=\"py-2 pl-3 bg-light border-top d-flex align-items-center\">\n\t\t\t{this.controller.cComments.renderWriteComment()}\n\t\t</div>;\n\t}\n\n\tprotected renderContent() {\n\t\treturn this.controller.cContent.renderDirContent();\n\t}\n\n\tprotected renderViewBottom():JSX.Element {\n\t\tlet {noteItem, noteModel} = this.controller;\n\t\tif (this.isMe(noteItem.owner) === false) return;\n\n\t\tlet {spawn} = noteModel;\n\t\tlet div:any;\n\t\tif (spawn.length === 0) {\n\t\t\tdiv = <div className=\"px-3 py-2\">\n\t\t\t\t<button className=\"btn btn-primary\" onClick={this.controller.showAssignTo}>分派</button>\n\t\t\t</div>;\n\t\t}\n\t\telse {\n\t\t\tdiv = <div className=\"my-3\">\n\t\t\t\t<div className=\"d-flex px-3 py-2 align-items-end\">\n\t\t\t\t\t<div className=\"small text-muted pt-2 pb-1\">已分派</div>\n\t\t\t\t</div>\n\t\t\t\t<List items={spawn} item={{render: this.renderSpawn, className:'notes'}} />\n\t\t\t</div>;\n\t\t}\n\t\treturn <div className=\"bg-light\">{div}</div>;\n\t}\n\n\tprivate renderSpawn = (noteItem: NoteItem, index: number) => {\n\t\tlet {owner, assigned} = noteItem;\n\t\tlet state = getTaskItemState(noteItem);\n\t\tlet {content, isEnd} = state;\n\t\treturn <div className=\"px-3 py-2 bg-light border-top\" onClick={e=>this.controller.showSpawn(noteItem)}>\n\t\t\t{this.renderContact(owner as number, assigned)}\n\t\t\t<div className=\"ml-2\"></div>\n\t\t\t{this.renderStateSpan(content, isEnd)}\n\t\t</div>\n\t}\n\n\tprotected renderEditButton() : JSX.Element {\n\t\treturn;\n\t}\n\n}\n","import { observer } from \"mobx-react\";\nimport React from \"react\";\nimport { VAssignEdit } from './VAssignEdit';\n\nexport class VAssignAdd extends VAssignEdit {\n\tprotected async onButtonSend(): Promise<void> {\n\t\tawait this.controller.saveAndAssingTo();\n\t}\n\n\tprotected renderExButtons():JSX.Element {\n\t\treturn;\n\t}\n\n\tprotected renderEditBottom():JSX.Element {\n\t\treturn <div className=\"py-2 pl-3 bg-light border-top d-flex\">\n\t\t\t<div className=\"mr-auto\" />\n\t\t\t{React.createElement(observer(() => <>\n\t\t\t\t<button onClick={() => this.onButtonSend()}\n\t\t\t\t\tclassName=\"btn btn-primary mr-3\" disabled={this.controller.isNoteEmpty}>\n\t\t\t\t\t分派\n\t\t\t\t</button>\n\t\t\t</>))}\n\t\t\t{this.renderExButtons()}\n\t\t</div>;\n\t}\n\t\n}\n","import React from 'react';\nimport { FA } from \"../../../tonva\";\nimport { CNoteAssign } from \"./CNoteAssign\";\nimport { VNoteBaseEdit } from '../../../notes/noteBase';\nimport { none } from '../../../tool';\nimport { taskTimeToString } from '../../../notes/model';\nimport { CInputHours } from '../../../notes/components';\n\ninterface TaskParam {\n\tlabel: string;\n\tvalues?: any;\n\tonClick?: () => void;\n}\n\nexport class VAssignEdit extends VNoteBaseEdit<CNoteAssign> { // VNoteForm<CNoteAssign> {\n\theader() {\n\t\treturn this.t('noteTask');\n\t}\n\n\tprotected renderTopCaptionContent():JSX.Element {\n\t\treturn <div className=\"\">\n\t\t\t{this.renderCaptionInput()}\n\t\t\t<div className=\"mx-1 py-1 bg-white\">\n\t\t\t\t{this.renderContent()}\n\t\t\t</div>\n\t\t\t{this.renderTaskAdditions()}\n\t\t</div>;\n\t}\n\n\tprotected renderContent():JSX.Element {\n\t\treturn this.controller.cContent.renderInput()\n\t}\n\n\tprotected renderParam(param: TaskParam) {\n\t\tlet {label, values, onClick} = param;\n\t\treturn <div key={label} className=\"px-3 py-2 bg-white d-flex align-items-center border-bottom\" onClick={onClick}>\n\t\t\t<div className=\"text-muted mr-3 w-5c\">{label}</div>\n\t\t\t<div className=\"flex-fill mr-3 \">{values || none}</div>\n\t\t\t{\n\t\t\t\tonClick ?\n\t\t\t\t<FA className=\"ml-auto\" name=\"angle-right\" />\n\t\t\t\t:\n\t\t\t\tundefined\n\t\t\t}\n\t\t</div>\n\t}\n\n\tprotected renderTaskAdditions() {\n\t\tlet additionRows: TaskParam[] = [\n\t\t\t{label: '分派工时', values: this.renderAssignHours(), onClick: this.onClickHours}, \n\t\t];\n\t\treturn <div>\n\t\t\t{additionRows.map(v => this.renderParam(v))}\n\t\t</div>;\n\t}\n\n\tprotected renderAssignHours() {\n\t\treturn <div className=\"flex-fill mr-3 \">\n\t\t\t{taskTimeToString(this.controller.assignhours)}\n\t\t\t</div>\n\t}\n\n\tprivate onClickHours = async () => {\n\t\tlet chours = new CInputHours(this.controller.owner);\n\t\tlet h = await chours.inputHours(this.controller.assignhours);\n\t\tthis.closePage();\n\t\tif (h !== undefined) {\n\t\t\tthis.controller.assignhours = h;\n\t\t}\n\t}\n\n\t// protected onHoursChange = (evt:React.ChangeEvent<HTMLInputElement>) => {\n\t// \tlet m = checkHourMinutes(evt.target.value);\n\t// \tif (m < 0) {\n\t// \t\tm = 0;\n\t// \t}\n\t// \tthis.controller.assignhours = m;\n\t// \tthis.controller.changed = true;\n\t// }\n\n\t// protected onHoursBlur = (evt: React.FocusEvent<HTMLInputElement>) => {\n\t// \tif (checkHourMinutes(evt.target.value) < 0) {\n\t// \t\tevt.target.value = '';\n\t// \t\tthis.controller.assignhours = 0;\n\t// \t\tthis.controller.changed = true;\n\t// \t}\n\t// }\n\n\tprotected renderExButtons():JSX.Element {\n\t\treturn <>{this.renderDeleteButton()}</>;\n\t}\n}\n","import { VNoteBaseDir } from '../../noteBase';\nimport { CNoteAssign } from './CNoteAssign';\n\nexport class VAssignDir extends VNoteBaseDir<CNoteAssign> {\n\tprotected renderContent():JSX.Element {\n\t\treturn this.controller.cContent.renderDirContent();\n\t}\n}\n","import React from 'react';\nimport { observer } from 'mobx-react';\nimport { VPage, FA, UserView, Image, User } from \"../../../tonva\";\nimport { none } from '../../../tool';\nimport { Contact } from '../../../model';\nimport { SelectContactOptions } from '../../views';\nimport { CNoteAssign } from \"./CNoteAssign\";\nimport { CAssignTo } from './CAssignTo';\nimport { CNotes } from '../../../notes/CNotes';\nimport { CSelectContact } from '../../../notes/components/selectContact';\nimport { taskTimeToString } from '../../../notes/model';\nimport { CInputHours } from '../../../notes/components';\n\nexport interface Row {\n\tlabel: string;\n\tvalues?: any;\n\tonClick?: () => void;\n}\n\n//const none = <small className=\"text-muted\">[无]</small>;\n\nexport class VAssignParams extends VPage<CAssignTo> {\n\tprivate cNoteAssign: CNoteAssign;\n\n\tinit() {\n\t\tthis.cNoteAssign = this.controller.cNoteAssign;\n\t}\n\n\theader() {return '分派任务'}\n\tget back(): 'close'|'back'|'none' {return 'close';}\n\n\tprivate renderParam(param: Row) {\n\t\tlet {label, values, onClick} = param;\n\t\treturn <div key={label} className=\"px-3 py-2 bg-white d-flex cursor-pointer align-items-center border-bottom\" onClick={onClick}>\n\t\t\t<div className=\"text-muted mr-3 w-5c\">{label}</div>\n\t\t\t<div className=\"flex-fill mr-3 \">{values || none}</div>\n\t\t\t{\n\t\t\t\tonClick ?\n\t\t\t\t<FA className=\"ml-auto\" name=\"angle-right\" />\n\t\t\t\t:\n\t\t\t\tundefined\n\t\t\t}\n\t\t</div>\n\t}\n\n\tcontent() {\n\t\tlet rows: Row[] = [\n\t\t\t//{label: '执行人', values: this.renderContacts(), onClick: this.onClickContacts}, \n\t\t\t//{label: '分值', values: this.renderPoint()}, \n\t\t\t{label: '工时', values: this.renderHours(), onClick: this.onClickHours}, \n\t\t\t{label: '检查人', values: this.renderChecker(), onClick: this.onClickChecker}, \n\t\t\t{label: '评价人', values: this.renderRater(), onClick: this.onClickRater}, \n\t\t];\n\t\t//let {owner} = this.controller;\n\t\treturn <div className=\"py-2\">\n\t\t\t{this.cNoteAssign.renderDirItem(0)}\n\t\t\t{rows.map(v => this.renderParam(v))}\n\t\t\t<div className=\"px-3 py-2\"><button className=\"btn btn-primary\" onClick={this.controller.onSendOut}>发送</button></div>\n\t\t</div>;\n\t}\n\n\tprivate renderContact = (item:Contact, index?:number) => {\n\t\tif (!item) return none;\n\t\tlet {contact, assigned} = item;\n\t\tlet renderUser = (user:User) => {\n\t\t\tlet {name, nick, icon} = user;\n\t\t\treturn <>\n\t\t\t\t<Image className=\"w-1c h-1c mr-1\" src={icon || '.user-o'} />\n\t\t\t\t<span className=\"mr-3\">{assigned || nick || name}</span>\n\t\t\t</>;\n\t\t}\n\t\treturn <UserView user={contact} render={renderUser} />;\n\t}\n\n\tprivate renderPoint() {\n\t\treturn <input className=\"flex-fill form-control border-0\"\n\t\t\t\ttype=\"number\" step=\"1\" min=\"1\" defaultValue={this.cNoteAssign.point}\n\t\t\t\tonChange={this.onItemChange}\n\t\t\t\tonKeyDown={this.onItemKeyDown}/>;\n\t}\n\n\tprivate renderHours() {\n\t\tlet time = taskTimeToString(this.cNoteAssign.assignhours);\n\t\treturn <div className=\"flex-fill form-control border-0\">{time}</div>\n\t\t// return <input className=\"flex-fill form-control border-0\"\n\t\t// \t\ttype=\"text\"\n\t\t// \t\tplaceholder=\"2.5或者2:30表示两个半小时\"\n\t\t// \t\tdefaultValue={time}\n\t\t// \t\tonChange={this.onHoursChange}\n\t\t// \t\tonBlur={this.onHoursBlur}\n\t\t// \t\tonKeyDown={this.onHoursKeyDown}/>;\n\t}\n\n\tprivate onClickHours = async () => {\n\t\tlet chours = new CInputHours(this.cNoteAssign.owner);\n\t\tlet h = await chours.inputHours(this.cNoteAssign.assignhours);\n\t\tthis.closePage();\n\t\tif (h !== undefined) {\n\t\t\tthis.cNoteAssign.assignhours = h;\n\t\t}\n\t}\n\n\n\tprivate onItemChange = (evt:React.ChangeEvent<HTMLInputElement>) => {\n\t\tthis.cNoteAssign.point = Number(evt.currentTarget.value);\n\t}\n\n\tprivate onItemKeyDown = (evt:React.KeyboardEvent<HTMLInputElement>) => {\n\t}\n\n\t// private onHoursChange = (evt:React.ChangeEvent<HTMLInputElement>) => {\n\t// \tlet m = checkHourMinutes(evt.target.value);\n\t// \tif (m < 0) {\n\t// \t\tm = 0;\n\t// \t}\n\t// \tthis.cNoteAssign.assignhours = m;\n\t// }\n\n\t// private onHoursKeyDown = (evt:React.KeyboardEvent<HTMLInputElement>) => {\n\t// }\n\n\t// protected onHoursBlur = (evt: React.FocusEvent<HTMLInputElement>) => {\n\t// \tif (checkHourMinutes(evt.target.value) < 0) {\n\t// \t\tevt.target.value = '';\n\t// \t\tthis.cNoteAssign.assignhours = 0;\n\t// \t}\n\t// }\n\n\tprivate renderChecker() {\n\t\treturn React.createElement(observer(() => this.renderContact(this.cNoteAssign.checker)));\n\t}\n\n\tprivate onClickChecker = async () => {\n\t\tlet cSelectContact = new CNotesSelectContact(this.cNoteAssign.owner, '检查人')\n\t\tcSelectContact.SetContacts(this.controller.GetAssignToContacts());\n\n\t\tlet options: SelectContactOptions = {title: '检查人', single: true};\n\t\tlet contacts = await cSelectContact.callSelectContact(options);\n\t\tthis.closePage();\n\t\tthis.cNoteAssign.checker = contacts[0];\n\t}\n\n\tprivate renderRater() {\n\t\treturn React.createElement(observer(() => this.renderContact(this.cNoteAssign.rater)));\n\t}\n\n\tprivate onClickRater = async () => {\n\t\tlet cSelectContact = new CNotesSelectContact(this.cNoteAssign.owner, '评价人')\n\t\tcSelectContact.SetContacts(this.controller.GetAssignToContacts());\n\n\t\tlet options: SelectContactOptions = {title: '评价人', single: true};\n\t\tlet contacts = await cSelectContact.callSelectContact(options);\n\t\tthis.closePage();\n\t\tthis.cNoteAssign.rater = contacts[0];\n\t}\n}\n\nclass CNotesSelectContact extends CSelectContact {\n\tprotected cNotes: CNotes;\n\ttitle: string;\n\tconstructor(cNotes:CNotes, title: string) {\n\t\tsuper(cNotes.cApp);\n\t\tthis.cNotes = cNotes;\n\t\tthis.title = title;\n\t}\n\n\tSetContacts(contacts:Contact[]) {\n\t\tthis.contacts = [];\n\t\tfor (var ci of contacts) {\n\t\t\tlet n = {...ci};\n\t\t\tn.already = 0;\n\t\t\tthis.contacts.push(n);\n\t\t}\n\t}\n\n\tprotected async loadContacts() {\n\t}\n}\n","import { CTo } from \"../../../notes/components\";\nimport { VTo } from \"../../../notes/components/to/VTo\"\nimport { VAssignParams } from \"./VAssignParams\";\nimport { CNoteAssign } from \"./CNoteAssign\";\nimport { Query } from \"../../../tonva\";\nimport { Contact } from \"../../../model\";\n\nexport class CAssignTo extends CTo {\n\tcNoteAssign: CNoteAssign;\n\n\tconstructor(cApp:any, cNoteAssign: CNoteAssign, replaceTop:boolean=false) {\n\t\tlet {currentFold} = cNoteAssign.owner;\n\t\tlet {groupFolder, currentNoteItem} = currentFold;\n\t\tsuper(cApp, groupFolder, currentNoteItem);\n\t\tthis.cNoteAssign = cNoteAssign;\n\t\tthis.replaceTop = replaceTop;\n\t}\n\n\tprotected replaceTop:boolean;\n\n\tprotected get GetContacts(): Query {return this.uqs.notes.GetAssignToContacts}\n\n\tprotected async internalStart():Promise<void> {\n\t\tlet ret = await this.GetContacts.page(\n\t\t\t{\n\t\t\t\tgroupFolder: this.currentGroupFolder,\n\t\t\t\tnote: undefined,\n\t\t\t}, 0, 50, true);\n\t\tthis.groupContacts = ret.$page;\n\t\tthis.groupContacts.push({contact:this.user.id, assigned:'[自己]', already:0});\n\t\tif (this.replaceTop) {\n\t\t\tthis.replaceVPage(VTo);//replacePage((new VTo(this)).render());\n\t\t}\n\t\telse {\n\t\t\tthis.startAction();\n\t\t\tthis.openVPage(VTo);\n\t\t}\n\t}\n\n\tGetAssignToContacts() : Contact[] {\n\t\treturn this.groupContacts;\n\t}\n\n\tprotected async sendOut(toList:number[]): Promise<void> {\n\t\tawait this.cNoteAssign.assignTask(toList);\n\t}\n\n\tprotected async afterContactsSelected(): Promise<void> {\n\t\tthis.openVPage(VAssignParams);\n\t}\n}\n","import React from 'react';\nimport { observer } from 'mobx-react';\nimport { View } from \"../../../../tonva\";\nimport { CTaskContent } from './CTaskContent';\nimport { TaskCheckItem } from '../model';\n\nexport abstract class VBase extends View<CTaskContent> {\n\trender() {\n\t\treturn React.createElement(observer(() => {\n\t\t\tlet {uncheckedItems, checkedItems} = this.controller.getItems();\n\t\t\treturn <div className=\"mb-2\">\n\t\t\t\t{uncheckedItems.map((v, index) => this.renderCheckItem(v))}\n\t\t\t\t{this.renderCheckedItems(checkedItems)}\n\t\t\t</div>;\n\t\t}));\n\t}\n\n\tprotected abstract renderCheckItem(v:TaskCheckItem):JSX.Element;\n\tprotected abstract renderCheckedItems(checkedItems:TaskCheckItem[]):JSX.Element;\n}\n","import React from 'react';\nimport { TaskCheckItem } from '../model';\nimport { VBase } from './VBase';\n\nexport class VView extends VBase {\n\tprotected renderCheckItem(v:TaskCheckItem) {\n\t\tlet {key, text, checked} = v;\n\t\tlet cn = 'ml-3 ';\n\t\tlet content: any;\n\t\tif (checked === true) {\n\t\t\tcn += 'text-muted ';\n\t\t\tcontent = <del>{text}</del>;\n\t\t}\n\t\telse {\n\t\t\tcontent = text;\n\t\t}\n\t\treturn <div key={key} className=\"d-flex mx-3 align-items-center form-check\">\n\t\t\t<input className=\"form-check-input mr-3 mt-0\" type=\"checkbox\"\n\t\t\t\tdefaultChecked={checked}\n\t\t\t\tdisabled={!this.controller.allowCheck}\n\t\t\t\tonChange={e => this.controller.onCheckChange(key, e.currentTarget.checked)}\n\t\t\t\tdata-key={key} />\n\t\t\t<div className={'form-control-plaintext ' + cn}>{content}</div>\n\t\t</div>;\n\t}\n\n\tprotected renderCheckedItems(checkedItems:TaskCheckItem[]):JSX.Element {\n\t\tlet checkedCount = checkedItems.length;\n\t\tif (checkedCount > 0) {\n\t\t\treturn <div className=\"border-top py-2\">\n\t\t\t\t<div className=\"px-3 pt-2 small text-muted\">{checkedCount}项完成</div>\n\t\t\t\t{checkedItems.map((v, index) => this.renderCheckItem(v))}\n\t\t\t</div>;\n\t\t}\n\t}\n}\n","import React from 'react';\nimport { FA } from '../../../../tonva';\nimport { TaskCheckItem } from '../model';\nimport { VBase } from \"./VBase\";\n\nexport class VItem extends VBase {\n\tprotected renderCheckItem(v:TaskCheckItem) {\n\t\tlet {key, text, checked} = v;\n\t\tlet cn = 'ml-3 ';\n\t\tlet content: any;\n\t\tlet icon: string;\n\t\tif (checked === true) {\n\t\t\tcn += 'text-muted ';\n\t\t\tcontent = <del>{text}</del>;\n\t\t\ticon = 'check-square';\n\t\t}\n\t\telse {\n\t\t\tcontent = text;\n\t\t\ticon = 'square-o';\n\t\t}\n\t\treturn <div key={key} className=\"d-flex mx-3 align-items-center\">\n\t\t\t<FA name={icon} />\n\t\t\t<div className={'py-1 ' + cn}>{content}</div>\n\t\t</div>;\n\t}\n\n\tprotected renderCheckedItems(checkedItems:TaskCheckItem[]):JSX.Element {\n\t\tlet checkedCount = checkedItems.length;\n\t\tif (checkedCount > 0) {\n\t\t\treturn <div className=\"\">\n\t\t\t\t{checkedItems.map((v, index) => this.renderCheckItem(v))}\n\t\t\t</div>;\n\t\t}\n\t}\n}\n","import { observable } from \"mobx\";\nimport { CContent } from \"../../../components\";\nimport { VView } from \"./VView\";\nimport { VItem } from \"./VItem\";\nimport { TaskCheckItem } from \"../model\";\n\nexport class CTaskContent extends CContent {\n\tallowCheck: boolean;\n\tprivate inputingText: string;\n\t@observable items: TaskCheckItem[] = [];\n\titemKey: number = 1;\n\n\tinit(obj:any) {\n\t\tif (obj) {\n\t\t\tif (obj.itemKey !== undefined && obj.items !== undefined) {\n\t\t\t\tthis.itemKey = obj.itemKey;\n\t\t\t\tthis.items = obj.items;\n\t\t\t}\n\t\t}\n\t}\n\n\trenderInput():JSX.Element {\n\t\treturn;\n\t}\n\n\trenderViewContent():JSX.Element {return this.renderView(VView)}\n\trenderDirContent():JSX.Element {return this.renderView(VItem)}\n\n\tendInput(obj:any): void {\n\t\tthis.addNewItem();\n\t\tthis.buildObj(obj);\n\t}\n\n\tprotected buildObj(obj:any): void {\n\t\tobj.itemKey = this.itemKey;\n\t\tobj.items = this.items;\n\t}\n\n\ttoString():string { \n\t\treturn this.items?.map(v => v.text).join('\\n')\n\t}\n\n\tfromString(value: string) {\n\t\tif (value) {\n\t\t\tthis.items = [];\n\t\t\tthis.itemKey = 1;\n\t\t\tthis.items.push(...value.split('\\n').filter((v, index) => {\n\t\t\t\treturn v.trim().length > 0;\n\t\t\t}).map((v, index) => {\n\t\t\t\treturn {\n\t\t\t\t\tkey: this.itemKey++,\n\t\t\t\t\ttext: v,\n\t\t\t\t\tchecked: false\n\t\t\t\t}\n\t\t\t}));\n\t\t}\n\t}\n\n\tasync onCheckChange(key: number, checked: boolean) {\n\t\tlet item = this.items.find(v => v.key === key);\n\t\tif (item) item.checked = checked;\n\t\t//await this.onContentChanged?.();\n\t\t//await this.SetNote(false);\n\t}\n\t/*\n\tonItemChanged = (key: number, value: string) => {\n\t\tlet item = key && this.items.find(v => v.key === key);\n\t\tif (item) {\n\t\t\titem.text = value;\n\t\t}\n\t\telse {\n\t\t\tthis.inputingText = value;\n\t\t}\n\t\tthis.changed = true;\n\t}\n\t*/\n\n\taddNewItem(): void {\n\t\tif (this.inputingText === undefined) return;\n\t\tlet text = this.inputingText.trim();\n\t\tif (text.length === 0) return;\n\t\tthis.items.push({\n\t\t\tkey: this.itemKey++,\n\t\t\ttext,\n\t\t\tchecked: false,\n\t\t});\n\t\tthis.changed = true;\n\t\tthis.inputingText = undefined;\n\t}\n\n\tgetItems():{uncheckedItems:TaskCheckItem[], checkedItems: TaskCheckItem[]} {\n\t\tlet uncheckedItems:TaskCheckItem[] = [];\n\t\tlet checkedItems:TaskCheckItem[] = [];\n\t\tfor (let ci of this.items) {\n\t\t\tlet {checked} = ci;\n\t\t\tif (checked === true) checkedItems.push(ci);\n\t\t\telse uncheckedItems.push(ci);\n\t\t}\n\t\treturn {uncheckedItems, checkedItems};\n\t}\n}\n","import { observable } from \"mobx\";\nimport { NoteItem, EnumNoteType } from '../../model';\nimport { renderIcon } from '../../noteBase';\nimport { TaskStateResult } from \"./TaskState\"\nimport { CNote } from \"../CNote\";\nimport { CTaskContent } from \"./content\";\n\nexport abstract class CNoteTask extends CNote {\n\tget type():EnumNoteType { return EnumNoteType.task }\n\n\tcContent: CTaskContent;\n\tget allowCheck() { return false; }\n\n\t@observable checkInfo: string;\n\t@observable rateInfo: string;\n\n\tprotected checker: number;\n\tprotected rater: number;\n\tprotected checkInfoInput: string;\n\tprotected rateInfoInput: string;\n\tprotected rateValue: number;\n\tprotected rateValueInput: number;\n\tassignhours: number;\n\t@observable hours: number;\n\tpoint: number;\n\n\tinit(param: NoteItem):void {\n\t\tsuper.init(param);\n\t\tthis.cContent = new CTaskContent(this.res);\n\t\tif (param) {\n\t\t\tlet {obj} = param;\n\t\t\tthis.initobj(obj);\n\t\t}\n\t\tthis.cContent.allowCheck = this.allowCheck;\n\t}\n\n\tprotected initobj(obj:any) {\n\t\tif (obj) {\n\t\t\tthis.cContent.init(obj);\n\t\t\tthis.checkInfo = obj.checkInfo;\n\t\t\tthis.checkInfoInput = this.checkInfo;\n\t\t\tthis.rateInfo = obj.rateInfo;\n\t\t\tthis.rateInfoInput = this.rateInfo;\n\t\t\tthis.rateValue = obj.rateValue;\n\t\t\tthis.rateValueInput = this.rateValue;\n\t\t\tthis.checker = obj.checker;\n\t\t\tthis.rater = obj.rater;\n\t\t\tthis.assignhours = obj.assignhours;\n\t\t\tthis.hours = obj.hours;\n\t\t\tthis.point = obj.point;\n\t\t}\n}\n\n\tprotected endContentInput():any {\n\t\tlet obj = super.endContentInput();\n\t\tif (this.checkInfo) {\n\t\t\tobj.checkInfo = this.checkInfo;\n\t\t}\n\t\telse {\n\t\t\tdelete obj.checkInfo;\n\t\t}\n\t\tif (this.rateInfo) {\n\t\t\tobj.rateInfo = this.rateInfo;\n\t\t}\n\t\telse {\n\t\t\tdelete obj.rateInfo;\n\t\t}\n\t\tif (this.rateValue !== undefined) {\n\t\t\tobj.rateValue = this.rateValue;\n\t\t}\n\t\telse {\n\t\t\tdelete obj.rateValue;\n\t\t}\n\t\tif (this.checker !== undefined) {\n\t\t\tobj.checker = this.checker;\n\t\t}\n\t\tif (this.rater !== undefined) {\n\t\t\tobj.rater = this.rater;\n\t\t}\n\t\tobj.assignhours = this.assignhours;\n\t\tobj.hours = this.hours;\n\t\tobj.point = this.point;\n\t\tthis.cContent.endInput(obj);\n\t\treturn obj;\n\t}\n\n\tupdateCheckInfo(v:string) {\n\t\tthis.checkInfoInput = v;\n\t}\n\n\tupdateRateInfo(v:string) {\n\t\tthis.rateInfoInput = v;\n\t}\n\tabstract get taskStateResult(): TaskStateResult;\n\n\tshowAddPage() {/*CNoteTask no need to Add*/}\n\tshowEditPage() {/*CNoteTask no need to Edit*/}\n\n\trenderIcon(): JSX.Element {\n\t\treturn renderIcon('tasks', 'text-success');\n\t}\n\n\tasync checkSaveInfo() {\n\t\tlet change = false;\n\t\tif (this.rateInfo !== this.rateInfoInput) {\n\t\t\tthis.rateInfo = this.rateInfoInput;\n\t\t\tchange = true;\n\t\t}\n\t\tif (this.checkInfo !== this.checkInfoInput) {\n\t\t\tthis.checkInfo = this.checkInfoInput;\n\t\t\tchange = true;\n\t\t}\n\t\tif (this.rateValue !== this.rateValueInput) {\n\t\t\tthis.rateValue = this.rateValueInput;\n\t\t\tchange = true;\n\t\t}\n\n\t\tif (change) {\n\t\t\tawait this.saveX();\n\t\t}\n\t}\n\n\tprotected async saveX() {\n\t\tlet { note: noteId } = this.noteItem;\n\t\tlet obj = this.endContentInput();\n\t\tlet flowContent = JSON.stringify(obj);\n\t\tlet param = { note: noteId, content: flowContent };\n\t\tawait this.uqs.notes.SetNoteX.submit(param, false);\n\t}\n}\n","import { TabRelative } from '../../noteBase';\nimport { CNoteTask } from \"./CNoteTask\";\nimport { VRelativesNoteBase } from '../views';\n\nexport class VTaskRelatives extends VRelativesNoteBase<CNoteTask> {\n\tprotected get tabs():TabRelative[] { return [this.tabComment] };\n}\n","import React from 'react';\nimport { observer } from 'mobx-react';\nimport { FA } from \"../../../tonva\";\nimport { TaskCheckItemBase } from './model';\nimport { VNoteBaseView } from '../../noteBase';\nimport { CNoteTask } from \"./CNoteTask\";\nimport { VTaskRelatives } from './VTaskRelatives';\nimport { none } from '../../../tool';\nimport { taskTimeToString } from '../../../notes/model';\n\nexport interface TaskParam {\n\tlabel: string;\n\tvalues?: any;\n\tonClick?: () => void;\n}\n\nexport abstract class VTaskView<T extends CNoteTask> extends VNoteBaseView<T> {\n\tprotected get back(): 'close' | 'back' | 'none' { return 'close' }\n\theader() { return this.t('task') }\n\tcontent() {\n\t\treturn React.createElement(observer(() => {\n\t\t\treturn <div className=\"\">\n\t\t\t\t{this.renderTopCaptionContent()}\n\t\t\t\t{this.renderTaskAdditions()}\n\t\t\t\t{this.renderViewBottom()}\n\t\t\t\t{this.renderRelatives()}\n\t\t\t</div>;\n\t\t}));\n\t}\n\n\tprotected renderContent() {\n\t\treturn this.controller.cContent.renderViewContent();\n\t}\n\n\tfooter() {\n\t\treturn this.renderFooter();\n\t}\n\n\tprotected renderFooter() {\n\t\treturn <div className=\"py-2 pl-3 bg-light border-top d-flex align-items-center\">\n\t\t\t{this.controller.cComments?.renderWriteComment()}\n\t\t</div>;\n\t}\n\n\trenderDirView() {\n\t\treturn React.createElement(observer(() => {\n\t\t\treturn <div className=\"d-block bg-white\">\n\t\t\t\t<div className=\"bg-white\">\n\t\t\t\t\t{this.renderTaskDirTop()}\n\t\t\t\t\t<div className=\"py-2\">\n\t\t\t\t\t\t{this.controller.cContent.renderDirContent()}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t{this.renderDirBottom()}\n\t\t\t</div>;\n\t\t}));\n\t}\n\n\tprotected renderTop():JSX.Element {\n\t\treturn <div className={'d-flex px-3 py-3 border-top border-bottom bg-light'}>\n\t\t\t{this.renderIcon()}\n\t\t\t<div>\n\t\t\t\t{this.renderCaption()}\n\t\t\t\t<div>\n\t\t\t\t\t{this.renderFrom()} \n\t\t\t\t\t<span className=\"mr-3\">{this.renderEditTime()}</span>\n\t\t\t\t</div>\n\t\t\t</div>\t\t\t\n\t\t</div>;\n\t}\n\n\tprivate renderTaskDirTop():JSX.Element {\n\t\treturn <div className={'d-flex pr-3 pl-2 py-2'}>\n\t\t\t{this.renderIcon()}\n\t\t\t<div>\n\t\t\t\t{this.renderCaption()}\n\t\t\t\t{this.renderFrom()}\n\t\t\t</div>\n\t\t\t<span className=\"ml-auto\">{this.renderEditTime()}</span>\n\t\t</div>;\n\t}\n\n\t/*\n\tprotected renderDirTop():JSX.Element {\n\t\treturn <div className=\"d-flex px-3 py-2 border-top\">\n\t\t\t{this.renderIcon()}\n\t\t\t<div>\n\t\t\t\t{this.renderCaption()}\n\t\t\t\t{this.renderFrom()}\n\t\t\t</div>\n\t\t\t<div className=\"ml-auto\">{this.renderEditTime()}</div>\n\t\t</div>;\n\t}*/\n\n\tprotected renderDirBottom():JSX.Element {\n\t\tlet divToCount = this.renderToCount();\n\t\tlet divSpawnCount = this.renderSpawnCount();\n\t\tlet divComment = this.renderCommentFlag();\n\t\tif (divToCount || divSpawnCount || divComment) {\n\t\t\treturn <div className=\"d-flex align-items-center px-3 mb-1\">\n\t\t\t\t{divToCount}\n\t\t\t\t{divSpawnCount}\n\t\t\t\t{divComment}\n\t\t\t\t<div className=\"mr-auto\" />\n\t\t\t</div>;\n\t\t}\n\t}\n\n\tprotected renderCaption() {\n\t\tlet { caption: title } = this.controller;\n\t\tlet divCaption = title ? <b className=\"text-primary\">{title}</b> : <span className=\"text-info\">任务</span>;\n\t\treturn <div className=\"pr-3\">\n\t\t\t<span className=\"mr-2\">{divCaption}</span> {this.renderState()}\n\t\t</div>;\n\t}\n\n\tprotected renderParam(param: TaskParam) {\n\t\tlet {label, values, onClick} = param;\n\t\treturn <div key={label} className=\"px-3 py-2 bg-white d-flex align-items-center border-bottom\" onClick={onClick}>\n\t\t\t<div className=\"text-muted mr-3 w-5c\">{label}</div>\n\t\t\t<div className=\"flex-fill mr-3 \">{values || none}</div>\n\t\t\t{\n\t\t\t\tonClick ?\n\t\t\t\t<FA className=\"ml-auto\" name=\"angle-right\" />\n\t\t\t\t:\n\t\t\t\tundefined\n\t\t\t}\n\t\t</div>\n\t}\n\n\tprotected get additionRows(): TaskParam[]  {\n\t\treturn \t[\n\t\t\t//{label: '分值', values: this.renderPoint()}, \n\t\t\t{label: '分派工时', values: this.renderAssignHours()}, \n\t\t\t{label: '实际工时', values: this.renderHours()}, \n\t\t];\n\t}\n\n\tprotected renderTaskAdditions() {\n\t\treturn <div>\n\t\t\t{this.additionRows.map(v => this.renderParam(v))}\n\t\t</div>;\n\t}\n\n\tprotected renderPoint() {\n\t\treturn <div className=\"flex-fill form-control border-0\">\n\t\t\t{this.controller.point}\n\t\t</div>;\n\t}\n\n\tprotected renderAssignHours() {\n\t\treturn <div className=\"flex-fill form-control border-0\">\n\t\t\t{taskTimeToString(this.controller.assignhours)}\n\t\t</div>;\n\t}\n\n\tprotected renderHours() {\n\t\treturn <div className=\"flex-fill form-control border-0\">\n\t\t\t{taskTimeToString(this.controller.hours)}\n\t\t</div>;\n\t}\n\n\tprotected renderViewBottom():JSX.Element {\n\t\treturn;\n\t\t/*\n\t\tlet { owner, state } = this.controller.noteItem;\n\t\tlet right: any;\n\t\tlet isMe = this.isMe(owner);\t\t\n\t\tif (isMe === true && state === EnumTaskState.Start) {\n\t\t\tright = <>{this.renderEditButton()}</>;\n\t\t}\n\t\treturn <div className=\"py-2 bg-light border-top d-flex align-items-end\">\n\t\t\t{this.controller.cComments.renderCommentButton()}\n\t\t\t<div className=\"mr-auto\" />\n\t\t\t{right}\n\t\t</div>;\n\t\t*/\n\t}\n\n\trenderRelatives() {\n\t\treturn this.renderVm(VTaskRelatives as any);\n\t}\n\n\tprotected renderState(): JSX.Element {\n\t\treturn <>state</>;\n\t}\n\t/*\n\tprotected onEdit() {\n\t\tthis.openVPage(VEdit as any);\n\t}\n\t*/\n\n\tprotected renderCheckItem(v:TaskCheckItemBase, checkable:boolean) {\n\t\tlet {key, text, checked} = v;\n\t\tlet cn = 'form-control-plaintext ml-3 ';\n\t\tlet content: any;\n\t\tif (checked === true) {\n\t\t\tcn += 'text-muted';\n\t\t\tcontent = <del>{text}</del>;\n\t\t}\n\t\telse {\n\t\t\tcontent = text;\n\t\t}\n\t\treturn <label key={key} className=\"d-flex mx-3 my-0 align-items-center form-check\">\n\t\t\t<input className=\"form-check-input mr-3 mt-0\" type=\"checkbox\"\n\t\t\t\tdefaultChecked={checked}\n\t\t\t\tonChange={this.onCheckChange}\n\t\t\t\tdata-key={key}\n\t\t\t\tdisabled={!checkable} />\n\t\t\t<div className={cn}>{content}</div>\n\t\t</label>;\n\t}\n\n\tprivate onCheckChange = async (evt:React.ChangeEvent<HTMLInputElement>) => {\n\t\t//let t = evt.currentTarget;\n\t\t//let key = Number(t.getAttribute('data-key'));\n\t\t//await this.controller.onCheckChange(key, t.checked);\n\t}\n}\n","import React from 'react';\nimport { VTaskView } from './VTaskView';\nimport { CTaskObserver } from './CTaskObserver';\n\nexport class VTaskObserver extends VTaskView<CTaskObserver> {\n\tprotected renderState() {\n\t\tlet state = this.controller.taskStateResult;\n\t\treturn this.renderStateSpan(state.content, state.isEnd);\n\t}\n\n\tprotected renderTaskAdditions() {\n\t\tlet rows = [\n\t\t\t//{label: '分值', values: this.renderPoint()}, \n\t\t\t{label: '分派工时', values: this.renderAssignHours()}, \n\t\t\t{label: '实际工时', values: this.renderHours()}, \n\t\t];\n\t\tlet {checker, rater} = this.controller.noteItem.obj;\n\t\treturn <div>\n\t\t\t{rows.map(v => this.renderParam(v))}\n\t\t\t{ checker ? this.renderChecker() : undefined }\n\t\t\t{ rater ? this.renderRater() : undefined }\n\t\t</div>;\n\t}\n\n\tprivate renderChecker() {\n\t\treturn <div>检查人</div>;\n\t}\n\n\tprivate renderRater() {\n\t\treturn <div>评分人</div>;\n\t}\n\n}\n\nexport class VTaskObserverDir extends VTaskObserver {\n\trender() {\n\t\treturn this.renderDirView();\n\t}\n}","import { initNoteItemObj } from \"../../../notes/model\";\nimport { CNoteTask } from \"./CNoteTask\";\nimport { TaskStateResult, getTaskItemState } from \"./TaskState\";\nimport { VTaskObserver, VTaskObserverDir } from \"./VTaskObserver\";\n\nexport class CTaskObserver extends CNoteTask {\t\n\tget allowCheck() { return false; }\n\n\tshowViewPage():void {this.openVPage(VTaskObserver);};\n\trenderDirItem(index: number): JSX.Element {\n\t\treturn this.renderView(VTaskObserverDir);\n\t}\n\tget taskStateResult(): TaskStateResult {\n\t\treturn getTaskItemState(this.noteItem);\n\t}\n\n\tinitModelData() {\n\t\tif (this.noteModel === undefined || this.noteModel.flowContent === undefined)\n\t\t\treturn;\n\t\tthis.noteItem.flowContent = this.noteModel.flowContent;\n\t\tinitNoteItemObj(this.noteItem);\n\n\t\tlet {obj} = this.noteItem;\n\t\tthis.initobj(obj);\n\t}\n}\n","//import React from 'react';\nimport { computed, observable } from 'mobx';\n//import { FA } from 'tonva';\nimport { Contact } from '../../../model';\nimport { EnumNoteType, NoteItem, numberFromId } from '../../model';\nimport { renderIcon } from '../../noteBase';\nimport { CContent, CCheckable } from '../../components';\nimport { CNote } from '../CNote';\nimport { VAssignView } from './VAssignView';\nimport { VAssignAdd } from './VAssignAdd';\n//import { VAssignEdit } from './VAssignEdit'\nimport { VAssignDir } from './VAssignDir';\nimport { CAssignTo } from './CAssignTo';\nimport { CTaskObserver } from '../task/CTaskObserver';\n\nexport class CNoteAssign extends CNote {\n\tcContent: CContent;\n\t@observable checker: Contact;\n\t@observable rater: Contact;\n\n\tpoint:number = 100;\n\t@observable assignhours:number = 0;\n\t@observable changed:boolean = false;\n\n\tinit(param: NoteItem): void {\n\t\tsuper.init(param);\n\t\tthis.cContent = new CCheckable(this.res);\n\t\tlet obj:any;\n\t\tif (param) {\n\t\t\tthis.caption = param.caption;\n\t\t\tobj = param.obj;\n\t\t\tthis.assignhours = obj.assignhours;\n\t\t}\n\t\tthis.cContent.init(obj);\n\t}\n\n\t@computed get isContentChanged():boolean {return this.changed || this.cContent.changed}\n\tget type():EnumNoteType { return EnumNoteType.assign }\n\t@computed get isNoteEmpty(): boolean {\n\t\treturn (this.caption === undefined || this.caption.trim().length === 0) || this.cContent.isEmpty;\n\t}\n\n\trenderIcon(): JSX.Element {\n\t\treturn renderIcon('list', 'text-primary');\n\t}\n\n\tprotected endContentInput():any {\n\t\tlet obj = this.noteItem ? { ...this.noteItem.obj } : {};\n\t\tthis.cContent.endInput(obj);\n\t\tobj.assignhours = this.assignhours;\n\t\treturn obj;\n\t}\n\n\trenderDirItem(index: number): JSX.Element {\n\t\treturn this.renderView(VAssignDir);\n\t}\n\n\tshowViewPage() {\n\t\tthis.openVPage(VAssignView);\n\t}\n\n\tshowEditPage() {\n\t\t//this.cContent.startInput();\n\t\t//this.openVPage(VAssignEdit);\n\t}\n\n\tduplicateAssign = () => {\n\t\t//this.owner\n\t\tlet noteItem = {...this.noteItem};\n\t\tnoteItem.obj = JSON.parse(noteItem.content);\n\t\tnoteItem.commentCount = 0;\n\t\tnoteItem.commentUnread = 0;\n\t\tnoteItem.note = undefined;\n\t\tthis.closePage();\n\t\tthis.owner.duplicateAssign(noteItem);\n\t}\n\n\tshowAddPage() {\n\t\tthis.cContent.startInput();\n\t\tthis.startAction();\n\t\tthis.openVPage(VAssignAdd);\n\t}\n\n\tsaveAndAssingTo = async () => {\n\t\tlet ret = await this.AddNote() as CNoteAssign;\n\t\tlet cAssignTo = new CAssignTo(this.cApp, ret, true);\n\t\tcAssignTo.SetTopKey(this.TopKey);\n\t\tawait cAssignTo.start();\n\t}\n\n\tshowAssignTo = async () => {\n\t\tlet cAssignTo = new CAssignTo(this.cApp, this);\n\t\tawait cAssignTo.start();\n\t}\n\n\tassignTask = async (toList: number[]) => {\n\t\tlet { note } = this.noteItem;\n\t\tlet { caption, content } = this.noteItem;\n\t\tlet cObj = JSON.parse(content);\n\t\tif (this.checker) {\n\t\t\tcObj.checker = numberFromId(this.checker.contact);\n\t\t}\n\t\telse {\n\t\t\tdelete cObj.checker;\n\t\t}\n\t\tif (this.rater) {\n\t\t\tcObj.rater = numberFromId(this.rater.contact);\n\t\t}\n\t\telse {\n\t\t\tdelete cObj.rater;\n\t\t}\n\t\tcObj.assignhours = this.assignhours;\n\t\t//cObj.hours = this.assignhours;\n\t\tcObj.point = this.point;\n\t\tlet data = {\n\t\t\tgroupFolder: this.owner.currentFold.groupFolder,\n\t\t\tfolder: this.owner.currentFold.folderId,\n\t\t\tnote,\n\t\t\tcaption,\n\t\t\tcontent: JSON.stringify(cObj),\n\t\t\ttos: toList.map(v => ({to:v})),\n\t\t\tchecker: this.checker?.contact,\n\t\t\trater: this.rater?.contact,\n\t\t\tpoint: this.point,\n\t\t}\n\t\tawait this.uqs.notes.AssignTask.submit(data);\n\t\tawait this.lodeModel();\n\t\tthis.noteItem.spawnCount = this.noteModel.spawn.length;\n\t}\n\n\tshowSpawn = async (noteItem: NoteItem) => {\n\t\tlet s = new CTaskObserver(this.owner);\n\t\ts.init(noteItem);\n\t\tawait s.lodeModel();\n\t\ts.initModelData();\n\t\ts.showViewPage();\n\t}\n}\n","//import React from 'react';\nimport { TabRelative } from '../../noteBase';\nimport { VRelativesNoteBase } from '../views';\nimport { CNoteText } from './CNoteText';\n\nexport class VTextRelatives extends VRelativesNoteBase<CNoteText> {\n\tprotected get tabs():TabRelative[] { return [this.tabComment, this.tabShare] };\n}\n","import React from 'react';\nimport { View } from \"../../../tonva\";\nimport { CNoteText } from \"./CNoteText\";\nimport { observer } from 'mobx-react';\n\nexport class VTextHeader extends View<CNoteText> {\n\trender() {\n\t\treturn React.createElement(observer(() => <>{this.controller.header}</>));\n\t}\n}\n","import React from 'react';\nimport { VNoteBaseView } from '../../noteBase';\nimport { CNoteText } from './CNoteText';\nimport { VTextRelatives } from './VTextRelatives';\nimport { VTextHeader } from './VTextHeader';\n\nexport class VTextView extends VNoteBaseView<CNoteText> {\n\theader() {\n\t\treturn this.renderVm(VTextHeader);\n\t}\n\n\tprotected renderRelatives() {\n\t\treturn this.renderVm(VTextRelatives);\n\t}\n\n\tfooter() {\n\t\treturn this.renderFooter();\n\t}\n\n\tprotected renderFooter() {\n\t\treturn <div className=\"py-2 pl-3 bg-light border-top d-flex align-items-center\">\n\t\t\t{this.renderShareButton()}\n\t\t\t{this.controller.cComments.renderWriteComment()}\n\t\t</div>;\n\t}\n\n\tprotected renderContent() {\n\t\treturn this.controller.cContent.renderViewContent();\n\t}\n}\n","import React from 'react';\nimport { observer } from 'mobx-react';\nimport { DropdownActions, DropdownAction } from '../../../tonva';\nimport { VNoteBaseEdit } from '../../noteBase';\nimport { CNoteText } from \"./CNoteText\";\nimport { VTextHeader } from './VTextHeader';\n\nexport class VTextEdit extends VNoteBaseEdit<CNoteText> {\n\theader() {\n\t\treturn this.renderVm(VTextHeader);\n\t}\n\n\tprotected renderContent():JSX.Element {\n\t\t//return this.controller.cContent.renderInput();\n\t\treturn React.createElement(observer(() =>{\n\t\t\tlet {cType, cContent} = this.controller;\n\t\t\treturn <>\n\t\t\t\t<span className=\"d-none\">{cType}</span>\n\t\t\t\t{cContent.renderInput()}\n\t\t\t</>;\n\t\t}));\n\t}\n\n\tprotected renderEditBottom():JSX.Element {\n\t\treturn <div className=\"py-2 pl-3 bg-light border-top d-flex\">\n\t\t\t{this.renderButtonLeft()}\n\t\t\t<div className=\"mr-auto\" />\n\t\t\t{React.createElement(observer(() => <>\n\t\t\t\t<button onClick={() => this.onButtonSave()}\n\t\t\t\t\tclassName=\"btn btn-primary mr-3\" disabled={!this.controller.isNoteChanged}>\n\t\t\t\t\t保存\n\t\t\t\t</button>\n\t\t\t</>))}\n\t\t\t{this.renderExButtons()}\n\t\t</div>;\n\t}\n\n\tprotected renderExButtons():JSX.Element {\n\t\treturn this.renderDeleteButton();\n\t}\n\n\tprivate dropdownActions: {[type: string]: DropdownAction} = {\n\t\ttext: {\n\t\t\ticon:'file-o', \n\t\t\tcaption:this.t('noteText'), \n\t\t\taction: this.controller.changeToText,\n\t\t},\n\t\tlist: {\n\t\t\ticon:'list', \n\t\t\tcaption:this.t('noteList'), \n\t\t\taction: this.controller.changeToList,\n\t\t},\n\t\tcheckable: {\n\t\t\ticon:'check-square-o', \n\t\t\tcaption:this.t('noteCheckable'), \n\t\t\taction: this.controller.changeToCheckable,\n\t\t},\n\t};\n\n\tprotected renderButtonLeft():JSX.Element { \n\t\treturn <DropdownActions\n\t\t\tactions={this.controller.dropdowns.map(v => this.dropdownActions[v])} \n\t\t\ticon=\"th-list\" \n\t\t\titemIconClass=\"text-info\" \n\t\t\tisRight={false}\n\t\t\tclassName=\"cursor-pointer btn btn-lg p-1 mr-1\"/>;\n\t}\n}\n","import React from \"react\";\nimport { VTextEdit } from \"./VTextEdit\";\nimport { observer } from \"mobx-react\";\n\nexport class VTextAdd extends VTextEdit {\n\theader() {return <>新建</>}\n\n\tprotected async onButtonSave(): Promise<void> {\n\t\tawait this.controller.AddNote();\n\t\tthis.closePage();\n\t\treturn;\n\t}\n\n\tprotected renderExButtons():JSX.Element {\n\t\treturn React.createElement(observer(() => {\n\t\t\treturn this.renderShareButton();\n\t\t}));\n\t}\n\n\tprotected renderShareButton() {\n\t\treturn <button onClick={this.onSaveAndSendNote}\n\t\t\tclassName=\"btn btn-outline-primary mr-3\">\n\t\t\t发给\n\t\t</button>;\n\t}\n\n\tprotected onSaveAndSendNote = async () => {\n\t\tlet cnewNote = await this.controller.AddNote();\n\t\tthis.closePage();\n\t\tawait cnewNote.cApp.loadRelation();\n\t\tcnewNote.showShareTo();\n\t}\n\n}\n","import { CNoteText } from \"./CNoteText\";\nimport { VNoteBaseDir } from \"../../noteBase\";\n\nexport class VTextDir extends VNoteBaseDir<CNoteText> {\n\tprotected renderContent():JSX.Element {\n\t\treturn this.controller.cContent.renderDirContent();\n\t}\n}\n","import { computed, observable } from 'mobx';\nimport { EnumNoteType, NoteItem } from '../../model';\nimport { VTextView } from './VTextView';\nimport { VTextAdd } from './VTextAdd';\nimport { renderIcon } from '../../noteBase';\nimport { VTextDir } from './VTextDir';\nimport { VTextEdit } from './VTextEdit';\nimport { CContent, CText, CCheckable, CList } from '../../components';\nimport { CNote } from '../CNote';\n\nexport class CNoteText extends CNote {\n\t@observable header: string;\n\t@observable cType: EnumNoteType;\n\t@observable dropdowns: string[];\n\t@observable cContent: CContent;\n\n\tcreateTextContent(): void {\n\t\tthis.header = this.t('noteText');\n\t\tthis.cContent = new CText(this.res);\n\t\tthis.cType = EnumNoteType.text;\n\t\tthis.dropdowns = ['list', 'checkable'];\n\t}\n\t\n\tcreateListContent(): void {\n\t\tthis.header = this.t('noteList');\n\t\tthis.cContent = new CList(this.res);\n\t\tthis.cType = EnumNoteType.textList;\n\t\tthis.dropdowns = ['text', 'checkable'];\n\t}\n\n\tcreateCheckableContent(): void {\n\t\tthis.header = this.t('noteCheckable');\n\t\tthis.cContent = new CCheckable(this.res);\n\t\tthis.cType = EnumNoteType.textCheckable;\n\t\tthis.dropdowns = ['text', 'list'];\n\t}\n\t\n\tinit(param: NoteItem): void {\n\t\tsuper.init(param);\n\t\tif (param) {\n\t\t\tif (this.cContent === undefined) {\n\t\t\t\tdebugger;\n\t\t\t\tthrow new Error('this.cContent should have created');\n\t\t\t}\n\t\t\tthis.cContent.init(param.obj);\n\t\t}\n\t}\n\n\t@computed get isContentChanged():boolean { return this.cContent.changed }\n\tget type():EnumNoteType { return this.cType; }\n\n\trenderIcon(): JSX.Element {\n\t\t//return renderIcon(this.noteItem.toCount>0? 'files-o': 'file-o', 'text-info');\n\t\treturn renderIcon('file-o', 'text-info');\n\t}\n\n\tprotected endContentInput():any {\n\t\tlet obj = this.noteItem ? { ...this.noteItem.obj } : {};\n\t\tthis.cContent.endInput(obj);\n\t\treturn obj;\n\t}\n\n\trenderDirItem(index: number): JSX.Element {\n\t\treturn this.renderView(VTextDir);\n\t}\n\n\tshowViewPage() {\n\t\tthis.openVPage(VTextView);\n\t}\n\n\tshowEditPage() {\n\t\tthis.cContent.startInput();\n\t\tthis.openVPage(VTextEdit);\n\t}\n\n\tshowAddPage() {\n\t\tthis.cContent.startInput();\n\t\tthis.openVPage(VTextAdd);\n\t}\n\n\tchangeToText = () => {\n\t\tif (this.cType === EnumNoteType.text)\n\t\t\treturn;\n\t\tlet content = this.cContent.toString();\n\t\tthis.createTextContent();\n\t\tthis.cContent.reset(content);\n\t\tif (this.noteItem) {\n\t\t\tthis.noteItem.type = EnumNoteType.text;\n\t\t}\n\t}\n\n\tchangeToList = () => {\n\t\tif (this.cType === EnumNoteType.textList)\n\t\t\treturn;\n\t\tlet content = this.cContent.toString();\n\t\tthis.createListContent();\n\t\tthis.cContent.reset(content);\n\t\tif (this.noteItem) {\n\t\t\tthis.noteItem.type = EnumNoteType.textList;\n\t\t}\n\t}\n\n\tchangeToCheckable = () => {\n\t\tif (this.cType === EnumNoteType.textCheckable)\n\t\t\treturn;\n\t\tlet content = this.cContent.toString();\n\t\tthis.createCheckableContent();\n\t\tthis.cContent.reset(content);\n\t\tif (this.noteItem) {\n\t\t\tthis.noteItem.type = EnumNoteType.textCheckable;\n\t\t}\n\t}\n}\n","import { CInputHours } from '../../../../notes/components';\nimport { taskTimeToString } from '../../../../notes/model';\nimport React from 'react';\nimport { FA, Image, User, UserView } from '../../../../tonva';\nimport { none } from '../../../../tool';\nimport { VTaskView, TaskParam } from '../VTaskView';\nimport { CTaskStart } from './CTaskStart';\n\nexport class VTaskStart extends VTaskView<CTaskStart> {\n\tprotected renderState(): JSX.Element {\n\t\treturn this.renderStateSpan('待办');\n\t}\n\n\tprotected renderViewBottom() {\n\t\tlet { owner } = this.controller.noteItem;\n\t\tlet left: any, right: any;\n\t\tlet isMe = this.isMe(owner);\n\t\tif (isMe === true) {\n\t\t\tleft = <button onClick={this.onDone} className=\"btn btn-primary mx-3\">\n\t\t\t\t完成\n\t\t\t</button>;\n\t\t}\n\n\t\treturn <div className=\"py-2 bg-light border-top d-flex\">\n\t\t\t\t{left}\n\t\t\t\t<div className=\"mr-auto\" />\n\t\t\t\t{right}\n\t\t</div>;\n\t}\n\n\tprotected get additionRows(): TaskParam[]  {\n\t\treturn \t[\n\t\t\t//{label: '分值', values: this.renderPoint()}, \n\t\t\t{label: '分派工时', values: this.renderAssignHours()}, \n\t\t\t{label: '实际工时', values: this.renderHours(), onClick: this.onClickHours}, \n\t\t];\n\t}\n\n\tprotected renderHours() {\n\t\treturn <div className=\"flex-fill form-control border-0\">\n\t\t\t{taskTimeToString(this.controller.hours)}\n\t\t</div>;\n\t}\n\n\tprivate onClickHours = async () => {\n\t\tlet chours = new CInputHours(this.controller.owner);\n\t\tlet h = await chours.inputHours(this.controller.hours);\n\t\tthis.closePage();\n\t\tif (h !== undefined) {\n\t\t\tthis.controller.hours = h;\n\t\t}\n\t}\n\n\t// protected onHoursChange = (evt:React.ChangeEvent<HTMLInputElement>) => {\n\t// \tlet m = checkHourMinutes(evt.target.value);\n\t// \tif (m < 0) {\n\t// \t\tm = 0;\n\t// \t}\n\t// \tthis.controller.hours = m;\n\t// }\n\n\t// protected onHoursBlur = (evt: React.FocusEvent<HTMLInputElement>) => {\n\t// \tif (checkHourMinutes(evt.target.value) < 0) {\n\t// \t\tevt.target.value = '';\n\t// \t\tthis.controller.hours = 0;\n\t// \t}\n\t// }\n\n\tprivate onDone = async () => {\n\t\tawait this.controller.DoneTask();\n\t\tthis.closePage();\n\n\t\t// 这个地方应该要显示，下一步是由谁来做什么。比如谁来验收，或者谁来评价\n\t\t// 如果没有后续操作，显示成红色，加一个终止标志 #\n\t\t// 如果由后续操作，显示成绿色，并且显示下一步什么操作，由谁来操作\n\t\tlet { obj } = this.controller.noteItem;\n\t\tlet { checker, rater } = obj;\n\t\tlet content;\n\t\tif (checker === undefined && rater === undefined) {\n\t\t\tcontent = <div className=\"text-danger\"><FA className=\"mr-1\" name=\"stop\" />任务完成</div>\n\t\t}\n\t\telse {\n\t\t\tlet contentChecker = checker ? <div className=\"px-3 py-2 bg-white d-flex border-bottom\">\n\t\t\t\t<div className=\"text-muted mr-3 w-5c\">检查人</div>\n\t\t\t\t<div className=\"mr-3 \">{this.renderContact(checker)}</div>\n\t\t\t\t</div>\n\t\t\t\t: undefined;\n\t\t\tlet contentRater = rater ? <div className=\"px-3 py-2 bg-white d-flex border-bottom\">\n\t\t\t\t<div className=\"text-muted mr-3 w-5c\">评分人</div>\n\t\t\t\t<div className=\"mr-3 \">{this.renderContact(rater)}</div>\n\t\t\t\t</div>\n\t\t\t\t: undefined;\n\n\t\t\tcontent = <div>\n\t\t\t\t<div className=\"text-success\">任务完成</div>\n\t\t\t\t{contentChecker}\n\t\t\t\t{contentRater}\n\t\t\t</div>\n\t\t}\n\t\tthis.showActionEndPage({ content });\n\t}\n\n\tprotected renderContact = (item:number) => {\n\t\tif (!item) return none;\n\t\tlet renderUser = (user:User) => {\n\t\t\tlet {name, nick, icon} = user;\n\t\t\treturn <>\n\t\t\t\t<Image className=\"w-1c h-1c mr-1\" src={icon || '.user-o'} />\n\t\t\t\t<span className=\"mr-3\">{nick || name}</span>\n\t\t\t</>;\n\t\t}\n\t\treturn <UserView user={item} render={renderUser} />;\n\t}\n}\n\nexport class VTaskStartDir extends VTaskStart {\n\trender() {\n\t\treturn this.renderDirView();\n\t}\n}","import { numberFromId } from \"../../../model\";\nimport { CNoteTask } from \"../CNoteTask\";\nimport { VTaskStart, VTaskStartDir } from \"./VTaskStart\";\nimport { TaskStateResult, EnumTaskState } from \"../TaskState\";\n\nexport class CTaskStart extends CNoteTask {\t\n\tget allowCheck() { return this.isMe(this.noteItem.owner); }\n\n\tshowViewPage():void {this.openVPage(VTaskStart);};\n\trenderDirItem(index: number): JSX.Element {\n\t\treturn this.renderView(VTaskStartDir);\n\t}\n\tget taskStateResult(): TaskStateResult {\n\t\treturn {content: '待办', isEnd: false}\n\t}\n\n\tasync DoneTask() {\n\t\tlet { note: noteId, caption } = this.noteItem;\n\t\tlet obj = this.endContentInput();\n\t\tlet content = JSON.stringify(obj);\n\t\tlet data = {\n\t\t\tgroupFolder: this.owner.currentFold.groupFolder,\n\t\t\tfolder: this.owner.currentFold.folderId,\n\t\t\tnote: numberFromId(noteId),\n\t\t\tcontent: content,\n\t\t\tcaption: caption,\n\t\t\thours: this.hours\n\t\t}\n\n\t\tawait this.uqs.notes.DoneTask.submit(data);\n\t\tthis.noteItem.state = EnumTaskState.Done;\n\t\tthis.noteItem.flowContent = content;\n\t\tthis.noteItem.$update = new Date();\n\t\tthis.owner.currentFold.taskUpdateState(this.noteItem);\n\t}\n}\n","//import React from 'react';\nimport { VTaskView } from '../VTaskView';\nimport { CTaskDone } from './CTaskDone';\n\nexport class VTaskDone extends VTaskView<CTaskDone> {\n\tprotected renderState() {\n\t\tlet { noteItem } = this.controller;\n\t\tlet obj = noteItem.obj;\n\t\tif (obj) {\n\t\t\tlet { checker } = obj;\n\t\t\tif (checker) {\n\t\t\t\treturn this.renderStateSpan('待验收');\n\t\t\t}\n\t\t\tlet { rater } = obj;\n\t\t\tif (rater) {\n\t\t\t\treturn this.renderStateSpan('待评分');\n\t\t\t}\n\t\t}\n\t\treturn this.renderStateSpan('已办', true);\n\t}\n}\n\nexport class VTaskDoneDir extends VTaskDone {\n\trender() {\n\t\treturn this.renderDirView();\n\t}\n}","import { CNoteTask } from \"../CNoteTask\";\nimport { VTaskDone, VTaskDoneDir } from \"./VTaskDone\";\nimport { TaskStateResult } from \"../TaskState\";\n\nexport class CTaskDone extends CNoteTask {\t\n\t//protected getTaskView() {return VTaskDone };\n\trenderDirItem(index: number): JSX.Element {\n\t\treturn this.renderView(VTaskDoneDir);\n\t}\n\tshowViewPage():void {this.openVPage(VTaskDone);}\n\n\tget taskStateResult(): TaskStateResult {\n\t\treturn {content: '已办', isEnd: true}\n\t}\n}\n","//import React from 'react';\nimport { VTaskView } from '../VTaskView';\nimport { CTaskCanceled } from './CTaskCanceled';\n\nexport class VTaskCanceled extends VTaskView<CTaskCanceled> {\n\tprotected renderState() {\n\t\treturn this.renderStateSpan('已取消', true);\n\t}\n}\n\nexport class VTaskCanceledDir extends VTaskCanceled {\n\trender() {\n\t\treturn this.renderDirView();\n\t}\n}","import { CNoteTask } from \"../CNoteTask\";\nimport { VTaskCanceled, VTaskCanceledDir } from \"./VTaskCanceled\";\nimport { TaskStateResult } from \"../TaskState\";\n\nexport class CTaskCanceled extends CNoteTask {\t\n\t//protected getTaskView() {return VTaskCanceled };\n\trenderDirItem(index: number): JSX.Element {\n\t\treturn this.renderView(VTaskCanceledDir);\n\t}\n\tshowViewPage():void {this.openVPage(VTaskCanceled);}\n\n\tget taskStateResult(): TaskStateResult {\n\t\treturn {content: '已取消', isEnd: false}\n\t}\n}\n","//import React from 'react';\nimport { VTaskView } from '../VTaskView';\nimport { CTaskPass } from './CTaskPass';\n\nexport class VTaskPass extends VTaskView<CTaskPass> {\n\tprotected renderState() {\n\t\tlet { noteItem } = this.controller;\n\t\tlet obj = noteItem.obj;\n\t\tif (obj) {\n\t\t\tlet { rater } = obj;\n\t\t\tif (rater) {\n\t\t\t\treturn this.renderStateSpan('待评价');\n\t\t\t}\n\t\t}\n\t\treturn this.renderStateSpan('签收', true);\n\t}\n}\n\nexport class VTaskPassDir extends VTaskPass {\n\trender() {\n\t\treturn this.renderDirView();\n\t}\n}","import { CNoteTask } from \"../CNoteTask\";\nimport { VTaskPass, VTaskPassDir } from \"./VTaskPass\";\nimport { TaskStateResult } from \"../TaskState\";\n\nexport class CTaskPass extends CNoteTask {\t\n\tshowViewPage():void {this.openVPage(VTaskPass) };\n\trenderDirItem(index: number): JSX.Element {\n\t\treturn this.renderView(VTaskPassDir);\n\t}\n\n\tget taskStateResult(): TaskStateResult {\n\t\treturn {content: '签收', isEnd: true}\n\t}\n}\n","//import React from 'react';\nimport { VTaskView } from '../VTaskView';\nimport { CTaskFail } from './CTaskFail';\n\nexport class VTaskFail extends VTaskView<CTaskFail> {\n\tprotected renderState() {\n\t\treturn this.renderStateSpan('拒签', true);\n\t}\n}\n\nexport class VTaskFailDir extends VTaskFail {\n\trender() {\n\t\treturn this.renderDirView();\n\t}\n}","import { CNoteTask } from \"../CNoteTask\";\nimport { VTaskFail, VTaskFailDir } from \"./VTaskFail\";\nimport { TaskStateResult } from \"../TaskState\";\n\nexport class CTaskFail extends CNoteTask {\t\n\tshowViewPage():void {this.openVPage(VTaskFail) };\n\trenderDirItem(index: number): JSX.Element {\n\t\treturn this.renderView(VTaskFailDir);\n\t}\n\n\tget taskStateResult(): TaskStateResult {\n\t\treturn {content: '拒签', isEnd: true}\n\t}\n}\n","//import React from 'react';\nimport { VTaskView } from '../VTaskView';\nimport { CTaskRated } from './CTaskRated';\n\nexport class VTaskRated extends VTaskView<CTaskRated> {\n\tprotected renderState() {\n\t\treturn this.renderStateSpan('已评价', true);\n\t}\n}\n\nexport class VTaskRatedDir extends VTaskRated {\n\trender() {\n\t\treturn this.renderDirView();\n\t}\n}","import { CNoteTask } from \"../CNoteTask\";\nimport { VTaskRated, VTaskRatedDir } from \"./VTaskRated\";\nimport { TaskStateResult } from \"../TaskState\";\n\nexport class CTaskRated extends CNoteTask {\t\n\tshowViewPage():void {this.openVPage(VTaskRated) };\n\trenderDirItem(index: number): JSX.Element {\n\t\treturn this.renderView(VTaskRatedDir);\n\t}\n\n\tget taskStateResult(): TaskStateResult {\n\t\treturn {content: '已评价', isEnd: true}\n\t}\n}\n","import React from \"react\";\nimport { Controller, View, Page } from \"../../../tonva\";\nimport { observable } from \"mobx\";\nimport { observer } from \"mobx-react\";\n\nexport interface EditTextItemProps {\n\tonUpdate: (inputContent: string) => Promise<void>;\n\tcontent: string;\n\theader: string;\n}\n\nexport class VEditTextItemInput<T extends Controller> extends View<T> {\n\t@observable private disabled: boolean;\n\tprivate inputText: string;\n\tprivate props: EditTextItemProps;\n\n\tconstructor(controller: T, props: EditTextItemProps) {\n\t\tsuper(controller);\n\t\tthis.props = props;\n\t\tthis.inputText = this.props.content;\n\t}\n\n\tonUpdate = () => {\n\t\tthis.disabled = true;\n\t\tthis.openPageElement(React.createElement(observer(() => {\n\t\t\tlet onClickSave = async () => {\n\t\t\t\tif (this.disabled === true) return;\n\t\t\t\tlet inputText = this.inputText.trim();\n\t\t\t\tawait this.props.onUpdate(inputText);\n\t\t\t\tthis.closePage();\n\t\t\t}\n\t\t\tlet onKeyDown = (evt: React.KeyboardEvent<HTMLInputElement>) => {\n\t\t\t\tif (evt.keyCode === 13) onClickSave();\n\t\t\t}\n\t\t\tlet onInputChange = (evt: React.ChangeEvent<HTMLInputElement>) => {\n\t\t\t\tthis.inputText = evt.target.value;\n\t\t\t\tthis.disabled = this.props.content === this.inputText;\n\t\t\t}\n\t\t\tlet right = <button className=\"btn btn-sm btn-success mr-2\"\n\t\t\t\tdisabled={this.disabled}\n\t\t\t\tonClick={onClickSave}>保存</button>;\n\t\t\treturn <Page header={this.props.header} back=\"close\" right={right}>\n\t\t\t\t<div className=\"p-3\">\n\t\t\t\t\t<input className=\"form-control\" type=\"text\"\n\t\t\t\t\t\tonChange={onInputChange} onKeyDown={onKeyDown}\n\t\t\t\t\t\tdefaultValue={this.props.content} />\n\t\t\t\t</div>\n\t\t\t</Page>;\n\t\t})));\n\t}\n\n\trender(props: EditTextItemProps): JSX.Element {\n\t\tthis.props = props;\n\t\tthis.inputText = this.props.content;\n\n\t\treturn <></>\n\t}\n}\n","import React from 'react';\nimport { VTaskView } from '../VTaskView';\nimport { Page, FA } from '../../../../tonva';\nimport { VEditTextItemInput, EditTextItemProps } from '../VEditTextItem';\nimport { CTaskCheck } from './CTaskCheck';\nimport { TaskCheckItem } from '../model';\n\nexport class VTaskCheck extends VTaskView<CTaskCheck> {\n\tprotected renderState(): JSX.Element {\n\t\treturn this.renderStateSpan('待验收');\n\t}\n\n\tprotected renderCheckItem(item: TaskCheckItem) {\n\t\tlet { key, text, checked, checkInfo } = item;\n\t\tlet cn = 'form-control-plaintext ml-3 ';\n\t\tlet content: any;\n\t\tif (checked === true) {\n\t\t\tcn += 'text-muted';\n\t\t\tcontent = <del>{text}</del>;\n\t\t}\n\t\telse {\n\t\t\tcontent = text;\n\t\t}\n\t\tlet onUpdate = async (v: string) => {\n\t\t\tawait this.controller.setCheckInfo(item, v);\n\t\t}\n\t\tlet eprops: EditTextItemProps = { onUpdate: onUpdate, content: checkInfo, header: '验收事项说明' }\n\t\tlet vEdit = new VEditTextItemInput(this.controller, eprops);\n\t\treturn <div key={key} className={'d-flex'}>\n\t\t\t<label className=\"flex-grow-1 d-flex mx-3 my-0 align-items-center form-check\">\n\t\t\t\t<input className=\"form-check-input mr-3 mt-0\" type=\"checkbox\"\n\t\t\t\t\tdefaultChecked={checked}\n\t\t\t\t\tdata-key={key}\n\t\t\t\t\tdisabled={!this.controller.allowCheck} />\n\t\t\t\t<div className=\"flex-grow-1\">\n\t\t\t\t\t<div className={cn}>{content}</div>\n\t\t\t\t\t{checkInfo && <div className=\"mt-1 ml-3 small\">\n\t\t\t\t\t\t<FA name=\"comment-o\" className=\"mr-2 text-primary\" />\n\t\t\t\t\t\t<span className=\"text-info cursor-ponter\" onClick={vEdit.onUpdate}>{checkInfo}</span>\n\t\t\t\t\t</div>}\n\t\t\t\t</div>\n\t\t\t</label>\n\t\t\t<div className=\"p-2 cursor-pointer\" onClick={vEdit.onUpdate}>\n\t\t\t\t<FA name=\"pencil-square-o text-info\" />\n\t\t\t</div>\n\t\t</div>;\n\t}\n\n\tprotected renderOrtherContent() {\n\t\tlet { checkInfo } = this.controller;\n\t\treturn <div className=\"px-3 py-2 d-flex align-items-center border-bottom\" >\n\t\t\t<div className=\"text-muted mr-1 w-5c\">验收意见</div>\n\t\t\t<div className=\"flex-fill mr-3 \">\n\t\t\t\t<input className=\"flex-fill form-control border-0\"\n\t\t\t\t\ttype=\"text\" step=\"1\" min=\"1\"\n\t\t\t\t\tdefaultValue={checkInfo}\n\t\t\t\t\tonChange={this.onDiscribeChange}\n\t\t\t\t\tonKeyDown={this.onDiscribeKeyDown} /></div>\n\t\t</div>\n\t}\n\n\tprivate onDiscribeChange = (evt: React.ChangeEvent<HTMLInputElement>) => {\n\t\tlet v = evt.target.value;\n\t\tif (v.length <= 0)\n\t\t\tv = undefined;\n\t\tthis.controller.updateCheckInfo(v);\n\t}\n\n\tprivate onDiscribeKeyDown = (evt: React.KeyboardEvent<HTMLInputElement>) => {\n\t\tif (evt.keyCode === 13) {\n\t\t\tthis.controller.checkSaveInfo();\n\t\t}\n\t}\n\n\tprotected renderViewBottom() {\n\t\tlet left = <div>\n\t\t\t<button onClick={()=>this.onCheck(true)} className=\"btn btn-success mx-3\">\n\t\t\t\t<FA name=\"check\" /> 通过\n\t\t\t</button>\n\t\t\t<button onClick={() => this.onCheck(false)} className=\"btn btn-outline-secondary mx-3\">\n\t\t\t\t<FA name=\"times\" /> 不通过\n\t\t\t</button>\n\t\t</div>;\n\t\treturn <>\n\t\t\t{this.renderOrtherContent()}\n\t\t\t<div className=\"py-2 bg-light border-top d-flex\">\n\t\t\t\t{left}\n\t\t\t\t<div className=\"mr-auto\" />\n\t\t\t</div>\n\t\t</>;\n\t}\n\n\tprotected onCheck = async (pass: boolean) => {\n\t\tawait this.controller.checkTask(pass);\n\t\tthis.closePage();\n\t\tlet content = pass ?\n\t\t\t<span className=\"text-success\"><FA name=\"check\" /> 验收通过</span>\n\t\t\t:\n\t\t\t<span className=\"text-secondary\"><FA name=\"check\" /> 验收不通过</span>\n\t\tthis.showActionEndPage({ content });\n\t\t//this.openPage(this.resultPage, {pass})\n\t}\n\n\tprotected resultPage = ({ pass }: { pass: boolean }) => {\n\t\tlet { caption: title } = this.controller;\n\t\tlet content = pass ?\n\t\t\t<span className=\"text-success\"><FA name=\"check\" /> 验收通过</span>\n\t\t\t:\n\t\t\t<span className=\"text-secondary\"><FA name=\"check\" /> 验收不通过</span>\n\t\treturn <Page header={title} back=\"close\">\n\t\t\t<div className=\"border bg-white rounded m-5\">\n\t\t\t\t<div className=\"py-5 text-center\">\n\t\t\t\t\t{content}\n\t\t\t\t</div>\n\t\t\t\t<div className=\"border-top text-center py-3\">\n\t\t\t\t\t<button className=\"btn btn-outline-info\" onClick={() => this.closePage()}>返回</button>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</Page>;\n\t}\n}\n\nexport class VTaskCheckDir extends VTaskCheck {\n\trender() {\n\t\treturn this.renderDirView();\n\t}\n}","import { numberFromId } from \"../../../model\";\nimport { CNoteTask } from \"../CNoteTask\";\nimport { VTaskCheck, VTaskCheckDir } from \"./VTaskCheck\";\nimport { TaskStateResult, EnumTaskState } from \"../TaskState\";\nimport { TaskCheckItem } from \"../model\";\n\nexport class CTaskCheck extends CNoteTask {\t\n\tshowViewPage():void {this.openVPage(VTaskCheck) };\n\trenderDirItem(index: number): JSX.Element {\n\t\treturn this.renderView(VTaskCheckDir);\n\t}\n\t\n\tget taskStateResult(): TaskStateResult {\n\t\treturn {content: 'check', isEnd: false}\n\t}\n\n\tasync checkTask(pass: boolean) {\n\t\tawait this.checkSaveInfo();\n\n\t\tlet { note: noteId } = this.noteItem;\n\t\tlet obj = this.endContentInput();\n\t\tlet content = JSON.stringify(obj);\n\t\tlet data = {\n\t\t\tgroupFolder: this.owner.currentFold.groupFolder,\n\t\t\tfolder: this.owner.currentFold.folderId,\n\t\t\tnote: numberFromId(noteId),\n\t\t\taction: pass ? 1 : 2,\n\t\t\tcontent: content\n\t\t}\n\n\t\tawait this.uqs.notes.CheckTask.submit(data);\n\t\tthis.noteItem.state = pass ? EnumTaskState.Pass : EnumTaskState.Fail;\n\t\tthis.noteItem.flowContent = content;\n\t\tthis.noteItem.$update = new Date();\n\t\tthis.owner.currentFold.taskUpdateState(this.noteItem);\n\t}\n\n\tasync setCheckInfo(item: TaskCheckItem, v:string) {\n\t\tif (v === undefined || v.length === 0) {\n\t\t\tdelete item.checkInfo;\n\t\t}\n\t\telse {\n\t\t\titem.checkInfo = v;\n\t\t}\n\t\tawait this.saveX();\n\t}\n}\n","import React from 'react';\nimport { FA } from '../../../../tonva';\nimport { VTaskView } from '../VTaskView';\nimport { CTaskRate } from './CTaskRate';\nimport { TaskCheckItem } from '../model';\n\nexport class VTaskRate extends VTaskView<CTaskRate> {\n\tprotected rateValue: number = 0;\n\n\tprotected renderState(): JSX.Element {\n\t\treturn this.renderStateSpan('待评价');\n\t}\n\n\tprotected renderCheckItem(item: TaskCheckItem) {\n\t\tlet { key, text, checked, checkInfo } = item;\n\t\tlet cn = 'form-control-plaintext ml-3 ';\n\t\tlet content: any;\n\t\tif (checked === true) {\n\t\t\tcn += 'text-muted';\n\t\t\tcontent = <del>{text}</del>;\n\t\t}\n\t\telse {\n\t\t\tcontent = text;\n\t\t}\n\t\treturn <label key={key} className=\"flex-grow-1 d-flex mx-3 my-0 align-items-center form-check\">\n\t\t\t<input className=\"form-check-input mr-3 mt-0\" type=\"checkbox\"\n\t\t\t\tdefaultChecked={checked}\n\t\t\t\tdata-key={key}\n\t\t\t\tdisabled={!this.controller.allowCheck} />\n\t\t\t<div className=\"flex-grow-1\">\n\t\t\t\t<div className={cn}>{content}</div>\n\t\t\t\t{checkInfo && <div className=\"mt-1 ml-3 small\">\n\t\t\t\t\t<FA name=\"comment-o\" className=\"mr-2 text-primary\" />\n\t\t\t\t\t<span className=\"text-info cursor-ponter\" >{checkInfo}</span>\n\t\t\t\t</div>}\n\t\t\t</div>\n\t\t</label>;\n\t}\n\n\tprotected renderOrtherContent() {\n\t\tlet { rateInfo, checkInfo } = this.controller;\n\t\treturn <div>\n\t\t\t{\n\t\t\t\tcheckInfo && <div className=\"px-3 py-2 d-flex align-items-center border-bottom\" >\n\t\t\t\t\t<div className=\"text-muted mr-1 w-5c\">验收意见</div>\n\t\t\t\t\t<div className=\"flex-fill mr-3 \">\n\t\t\t\t\t<input className=\"flex-fill form-control border-0\"\n\t\t\t\t\t\ttype=\"text\" step=\"1\" min=\"1\"\n\t\t\t\t\t\tdefaultValue={checkInfo}\n\t\t\t\t\t\tdisabled={true}\n\t\t\t\t\t\t /></div>\n\t\t\t\t</div>\n\t\t\t}\n\t\t\t<div className=\"px-3 py-2 d-flex align-items-center border-bottom\" >\n\t\t\t\t<div className=\"text-muted mr-1 w-5c\">评分意见</div>\n\t\t\t\t<div className=\"flex-fill mr-3 \">\n\t\t\t\t\t<input className=\"flex-fill form-control border-0\"\n\t\t\t\t\t\ttype=\"text\" step=\"1\" min=\"1\"\n\t\t\t\t\t\tdefaultValue={rateInfo}\n\t\t\t\t\t\tonChange={this.onDiscribeChange}\n\t\t\t\t\t\tonKeyDown={this.onDiscribeKeyDown} /></div>\n\t\t\t</div>\n\t\t</div>;\n\t}\n\n\tprivate onDiscribeChange = (evt: React.ChangeEvent<HTMLInputElement>) => {\n\t\tlet v = evt.target.value;\n\t\tif (v.length <= 0)\n\t\t\tv = undefined;\n\t\tthis.controller.updateRateInfo(v);\n\t}\n\n\tprivate onDiscribeKeyDown = (evt: React.KeyboardEvent<HTMLInputElement>) => {\n\t\tif (evt.keyCode === 13) {\n\t\t\tthis.controller.checkSaveInfo();\n\t\t}\n\t}\n\n\tprotected renderViewBottom() {\n\t\tlet left = <div>\n\t\t\t<button onClick={() => this.onRate()} className=\"btn btn-success mx-3\">\n\t\t\t\t评价\n\t\t\t</button>\n\t\t</div>;\n\n\t\treturn <div>\n\t\t\t{this.renderOrtherContent()}\n\t\t\t{this.renderValueRadio()}\n\t\t\t<div className=\"py-2 bg-light border-top d-flex\">\n\t\t\t\t{left}\n\t\t\t\t<div className=\"mr-auto\" />\n\t\t\t</div>\n\t\t</div>\n\t}\n\n\tprivate onChange = (evt: React.ChangeEvent<HTMLInputElement>) => {\n\t\tthis.rateValue = Number(evt.target.value);\n\t};\n\n\tprotected renderValueRadio(): JSX.Element {\n\t\tlet radios = [\n\t\t\t{ val: 2, text: '卓越' },\n\t\t\t{ val: 1, text: '谢谢' },\n\t\t];\n\n\t\treturn <div className=\"my-3\">\n\t\t\t{radios.map((v, index) => {\n\t\t\t\tlet { val, text } = v;\n\t\t\t\treturn <label key={index} className=\"mb-0 mx-3\">\n\t\t\t\t\t<input className=\"mr-1\" type=\"radio\" value={val}\n\t\t\t\t\t\tdefaultChecked={this.rateValue === val} name={'ratevalue'} onChange={this.onChange} />\n\t\t\t\t\t{text}\n\t\t\t\t</label>\n\t\t\t})}\n\t\t</div>;\n\t}\n\n\tprivate onRate = async () => {\n\t\tawait this.controller.rateTask(this.rateValue);\n\t\tthis.closePage();\n\t\tlet content = <>评价完成</>;\n\t\tthis.showActionEndPage({ content });\n\t}\n}\n\nexport class VTaskRateDir extends VTaskRate {\n\trender() {\n\t\treturn this.renderDirView();\n\t}\n}","import { numberFromId } from \"../../../model\";\nimport { CNoteTask } from \"../CNoteTask\";\nimport { VTaskRate, VTaskRateDir } from \"./VRateTask\";\nimport { TaskStateResult, EnumTaskState } from \"../TaskState\";\nimport { TaskCheckItem } from \"../model\";\n\nexport class CTaskRate extends CNoteTask {\t\n\tshowViewPage():void {this.openVPage(VTaskRate) };\n\trenderDirItem(index: number): JSX.Element {\n\t\treturn this.renderView(VTaskRateDir);\n\t}\n\n\tget taskStateResult(): TaskStateResult {\n\t\treturn {content: 'rate', isEnd: true}\n\t}\n\n\tasync rateTask(value: number) {\n\t\tthis.rateValueInput = value;\n\t\tawait this.checkSaveInfo();\n\n\t\tlet { note: noteId } = this.noteItem;\n\t\tlet obj = this.endContentInput();\n\t\tlet content = JSON.stringify(obj);\n\t\tlet data = {\n\t\t\tgroupFolder: this.owner.currentFold.groupFolder,\n\t\t\tfolder: this.owner.currentFold.folderId,\n\t\t\tnote: numberFromId(noteId),\n\t\t\tvalue: value,\n\t\t\tcontent: content\n\t\t}\n\n\t\tawait this.uqs.notes.RateTask.submit(data);\n\t\tthis.noteItem.state = EnumTaskState.Rated;\n\t\tthis.noteItem.flowContent = content;\n\t\tthis.noteItem.$update = new Date();\n\t\tthis.owner.currentFold.taskUpdateState(this.noteItem);\n\t}\n\n\tasync setRateInfo(item: TaskCheckItem, v:string) {\n\t\tif (v === undefined || v.length === 0) {\n\t\t\tdelete item.rateInfo;\n\t\t}\n\t\telse {\n\t\t\titem.rateInfo = v;\n\t\t}\n\t\tawait this.saveX();\n\t}\n}\n","import React from 'react';\nimport { VBasePage } from './VBasePage';\nimport { CShareTo } from 'notes/CShareTo';\n\nexport class VActions extends VBasePage<CShareTo> {\n\theader() {return '操作'}\n\tcontent() {\n\t\tlet cn = 'px-3 py-2 cursor-pointer bg-white mt-1';\n\t\treturn <div className=\"\">\n\t\t\t<div className=\"text-muted small px-3 py-1 mt-2\">收件人</div>\n\t\t\t<div className=\"border rounded p-3 mb-3\">\n\t\t\t\t{this.renderSelectedContact(this.controller.contacts)}\n\t\t\t</div>\n\t\t\t<div className={cn} onClick={this.controller.onSendOut}>\n\t\t\t\t分享内容\n\t\t\t</div>\n\t\t</div>;\n\t}\n}\n","import { CTo } from \"./components\";\nimport { VActions } from \"./views/VActions\";\nimport { CNotes } from \"./CNotes\";\nimport { Query } from \"tonva\";\n\nexport class CShareTo extends CTo {\n\tprivate cNotes:CNotes;\n\tconstructor(cApp:any, cNotes:CNotes) {\n\t\tlet {currentFold} = cNotes;\n\t\tlet {groupFolder, currentNoteItem} = currentFold;\n\t\tif (currentNoteItem === undefined) {\n\t\t\tcurrentNoteItem = currentFold.noteItem;\n\t\t}\n\t\tsuper(cApp, groupFolder, currentNoteItem);\n\t\tthis.cNotes = cNotes;\n\t}\n\t\n\tprotected get GetContacts(): Query {return this.uqs.notes.GetShareContacts}\n\n\tprotected async sendOut(toList:number[]):Promise<void> {\n\t\tawait this.cNotes.sendNoteTo(toList);\n\t}\n\n\tprotected async afterContactsSelected(): Promise<void> {\n\t\tthis.openVPage(VActions); //, {contacts, noteId: this.currentNoteId});\n\t}\n}\n","import { CUqBase } from \"../tapp\";\nimport { VSelectContact, SelectContactOptions } from \"./views\";\nimport { EnumNoteType, initNoteItemObj, NoteItem } from \"./model\";\nimport { CNoteBase } from \"./noteBase\";\nimport { CContainer, CFolderRoot, createCSpace, createCFolder, createCUnitNote } from \"./container\";\nimport { Contact } from \"../model\";\nimport { createCNoteTask } from \"./note\";\nimport { VFolderDropdown, VHomeDropdown, VSpaceDropdown } from \"./views/VNotesDropDown\";\nimport { CNoteText } from \"./note/text\";\nimport { CNoteAssign } from \"./note/assign\";\nimport { CFolderMy } from \"./container/folderMy\";\nimport { CShareTo } from \"./CShareTo\";\nimport { CSpace } from \"./container/space\";\n\nexport class CNotes extends CUqBase {\n\tprotected foldStack: CContainer[];\n\trootFold: CContainer;\n\tcurrentFold: CContainer;\n\tnoteItem: NoteItem;\n\n    protected async internalStart() {\n\t}\n\n\tinit() {\n\t\tthis.rootFold =this.currentFold = this.newSub(CFolderRoot);\n\t\tthis.foldStack = [];\n\t}\n\n\tnoteItemConverter = (item:NoteItem, queryResults:{[name:string]:any[]}):CNoteBase => {\n\t\tinitNoteItemObj(item);\n\t\tlet cNoteBase = this.createCNoteBase(item);\n\t\tcNoteBase.init(item);\n\t\treturn cNoteBase;\n\t}\n\n\titemChanged(noteItem: NoteItem) {\n\t\tlet folderNoteItem = this.currentFold.itemChanged(noteItem);\n\t\tif (this.foldStack.length > 0) {\n\t\t\tfor (let folder of this.foldStack) {\n\t\t\t\tfolderNoteItem = folder.itemChanged(folderNoteItem)\n\t\t\t}\n\t\t}\n\t}\n\n\topenFolder(foldItem:CContainer) {\n\t\tthis.foldStack.push(this.currentFold);\n\t\tthis.currentFold = foldItem;\n\t\tthis.currentFold.showFolder();\n\t}\n\n\tpopFolder() {\n\t\tthis.currentFold = this.foldStack.pop();\n\t}\n\n\tcreateCNoteBase(noteItem: NoteItem): CNoteBase {\n\t\tswitch (noteItem.type) {\n\t\t\tdefault: throw Error(\"unknown type\");\n\t\t\tcase EnumNoteType.text: return this.createCNoteText();\n\t\t\tcase EnumNoteType.textList: return this.createCNoteList(); \n\t\t\tcase EnumNoteType.textCheckable: return this.createCNoteCheckable(); \n\t\t\tcase EnumNoteType.folder: return createCFolder(this, noteItem);\n\t\t\tcase EnumNoteType.task: return createCNoteTask(this, noteItem); \n\t\t\tcase EnumNoteType.group: debugger; throw Error(\"type group undefined\");\n\t\t\tcase EnumNoteType.groupFolder: return createCSpace(this); \n\t\t\tcase EnumNoteType.unit:  debugger; throw Error(\"type unit undefined\");\n\t\t\tcase EnumNoteType.assign: return new CNoteAssign(this);\n\t\t\tcase EnumNoteType.unitNote: return createCUnitNote(this);\n\t\t}\n\t}\n\n\tprivate createCNoteText(): CNoteText {\n\t\tlet ret = new CNoteText(this);\n\t\tret.createTextContent();\n\t\treturn ret;\n\t}\n\n\tprivate createCNoteList(): CNoteText {\n\t\tlet ret = new CNoteText(this);\n\t\tret.createListContent();\n\t\treturn ret;\n\t}\n\n\tprivate createCNoteCheckable(): CNoteText {\n\t\tlet ret = new CNoteText(this);\n\t\tret.createCheckableContent();\n\t\treturn ret;\n\t}\n\n\tasync load() {\n\t\tawait this.currentFold.load();\n\t}\n\n\tasync refresh() {\n\t\tawait this.currentFold.refresh();\n\t}\n\t/*\n\tasync getNote(id: number): Promise<NoteModel> {\n\t\treturn await this.currentFold.getNote(id);\n\t}\n\t*/\n\n\tasync addNote(folder:number, caption:string, content:string, obj:any, type: EnumNoteType) {\n\t\treturn await this.currentFold.addNote(folder, caption, content, obj, type);\n\t}\n\n\tasync editNote(waiting:boolean, noteItem:NoteItem, caption:string, content:string, obj:any) {\n\t\treturn await this.currentFold.editNote(waiting, noteItem, caption, content, obj);\n\t}\n\n\tasync sendNoteTo(toList:number[]) {\n\t\tlet {groupFolder, currentNoteItem} = this.currentFold;\n\t\tif (currentNoteItem === undefined) {\n\t\t\tcurrentNoteItem = this.currentFold.noteItem;\n\t\t}\n\t\tlet {note} = currentNoteItem;\n\t\tlet tos = toList.join('|');\n\t\tawait this.uqs.notes.SendNoteTo.submit({groupFolder, note, tos});\n\t}\n\n\tasync hideNote(note:number, x:number) {\n\t\tawait this.currentFold.hideNote(note, x);\n\t}\n\n\trenderNotesView() {\n\t\treturn this.currentFold.renderListView();\n\t}\n\n\trenderHomeDropDown() {\n\t\tlet vHomeDropdown = new VHomeDropdown(this);\n\t\treturn vHomeDropdown.render();\n\t};\n\n\trenderFolderDropDown() {\n\t\tlet vHomeDropdown = new VFolderDropdown(this);\n\t\treturn vHomeDropdown.render();\n\t};\n\n\trenderSpaceDropDown() {\n\t\tlet vSpaceDropdown = new VSpaceDropdown(this);\n\t\treturn vSpaceDropdown.render();\n\t};\n\n\tshowAddNoteTextPage = () => {\n\t\tlet cNoteText = this.createCNoteText();\n\t\tcNoteText.showAddPage();\n\t}\n\n\tshowAddNoteListPage = () => {\n\t\tlet cNoteText = this.createCNoteList();\n\t\tcNoteText.showAddPage();\n\t}\n\t\n\tshowAddNoteCheckablePage = () => {\n\t\tlet cNoteText = this.createCNoteCheckable();\n\t\tcNoteText.showAddPage();\n\t}\n\n\tshowAddMyFolderPage = () => {\n\t\tlet cFolder = new CFolderMy(this);\n\t\tcFolder.init(undefined);\n\t\tcFolder.showAddPage();\n\t}\n\n\tshowAddGroupPage = () => {\n\t\t//let cGroup = this.newSub(CGroup);\n\t\t//cGroup.showAddPage()\n\t\tlet cGroup = new CSpace(this);\n\t\tcGroup.init(undefined);\n\t\tcGroup.showAddPage();\n\t}\n\n\tshowAddAssignPage = () => {\n\t\tlet cNoteAssign = new CNoteAssign(this);\n\t\tcNoteAssign.init(undefined);\n\t\tcNoteAssign.showAddPage();\n\t}\n\n\tduplicateAssign = (param: NoteItem) => {\n\t\tlet cNoteAssign = new CNoteAssign(this);\n\t\tcNoteAssign.init(param);\n\t\tcNoteAssign.showAddPage();\n\t}\n\t\n\tasync showShareTo() {\n\t\t//this.noteItem = noteItem;\n\t\t/*\n\t\tlet ret = await this.uqs.notes.GetMyContacts.page(\n\t\t\t{\n\t\t\t\tgroupFolder: this.currentFold.groupFolder\n\t\t\t}, 0, 50, true);\n\t\tthis.groupMembers = ret.$page;\n\t\tthis.openVPage(VTo, backPageCount);\n\t\t*/\n\t\t//let {groupFolder} = this.currentFold;\n\t\t//let {note} = noteItem;\n\t\t/*\n\t\tlet props: CToProps = {\n\t\t\tcurrentGroupFolder: groupFolder,\n\t\t\tonAfterContactsSelected: async () => {\n\t\t\t\tthis.openVPage(VActions); //, {contacts, noteId: this.currentNoteId});\n\t\t\t},\n\t\t\tsendOut: async (toList: number[]) => {\n\t\t\t\tlet tos = toList.join('|');\n\t\t\t\tawait this.uqs.notes.SendNoteTo.submit({groupFolder, note, tos});\n\t\t\t},\n\t\t};\n\t\tlet cTo = new CTo(this.cApp, props);\n\t\tawait cTo.start();\n\t\t*/\n\t\tlet cShareTo = new CShareTo(this.cApp, this);\n\t\tawait cShareTo.start();\n\t}\n\n\t/*\n\tshowSentPage() {\n\t\tthis.openVPage(VSent);\n\t}\n\t*/\n\n\tasync callSelectContact(options: SelectContactOptions): Promise<Contact[]> {\n\t\treturn await this.vCall(VSelectContact, options);\n\t}\n\n\t/*\n\tshowAssignTaskPage() {\n\t\tlet cNoteTask = createCNoteTask(this, this.noteItem); // this.newSub(CNoteTask);\n\t\tcNoteTask.init(this.noteItem);\n\t\tcNoteTask.showAssignTaskPage();\n\t}\n\t*/\n}\n","import { CNotes } from '../CNotes';\nimport { CSpace } from './space';\nimport { CFolder } from './CFolder';\nimport { NoteItem } from '../model';\nimport { CFolderMy } from './folderMy';\nimport { CFolderShare } from './folderShare';\n\nexport { CContainer } from './CContainer';\nexport { CFolderRoot } from './folderRoot';\n\nexport * from './unitNote';\n\nexport function createCSpace(cNotes: CNotes): CSpace { \n\treturn new CSpace(cNotes);\n}\n\nexport function createCFolder(cNotes: CNotes, noteItem: NoteItem): CFolder {\n\tif (cNotes.isMe(noteItem.owner) === true) {\n\t\treturn new CFolderMy(cNotes);\n\t}\n\telse {\n\t\treturn new CFolderShare(cNotes);\n\t}\n}\n","import { CNotes } from '../../CNotes';\nimport { NoteItem } from '../../model';\nimport { CNoteTask } from './CNoteTask';\nimport { EnumTaskState } from './TaskState';\nimport { CTaskStart } from './start';\nimport { CTaskDone } from './done';\nimport { CTaskCanceled } from './canceled';\nimport { CTaskPass } from './pass';\nimport { CTaskFail } from './fail';\nimport { CTaskRated } from './rated';\nimport { CTaskCheck } from './check';\nimport { CTaskRate } from './rate';\n\nexport function createCNoteTask(cNotes: CNotes, noteItem: NoteItem): CNoteTask {\n\tswitch (noteItem.state) {\n\t\tdefault:\n\t\tcase EnumTaskState.Start:\n\t\t\treturn new CTaskStart(cNotes);\n\t\tcase EnumTaskState.Done:\n\t\t\tif (noteItem && cNotes.isMe(noteItem.obj.checker)) {\n\t\t\t\treturn new CTaskCheck(cNotes);\n\t\t\t}\n\t\t\treturn new CTaskDone(cNotes);\n\t\tcase EnumTaskState.Pass:\n\t\t\tif (noteItem && cNotes.isMe(noteItem.obj.rater)) {\n\t\t\t\treturn new CTaskRate(cNotes);\n\t\t\t}\n\t\t\treturn new CTaskPass(cNotes);\n\t\tcase EnumTaskState.Fail:\n\t\t\treturn new CTaskFail(cNotes);\n\t\tcase EnumTaskState.Rated:\n\t\t\treturn new CTaskRated(cNotes);\n\t\tcase EnumTaskState.Canceled:\n\t\t\treturn new CTaskCanceled(cNotes);\n\t}\n}\n","import { CNotes } from \"notes/CNotes\";\nimport { CUnitNote } from \"./CUnitNote\";\n\nexport function createCUnitNote(cNotes: CNotes): CUnitNote { \n\treturn new CUnitNote(cNotes);\n}\n","import React from 'react';\nimport { VPage, Page } from '../tonva';\nimport { CHome } from './CHome';\n\nexport class VHome extends VPage<CHome> {\n\trender() {\n\t\tlet {cNotes: cNodes} = this.controller;\n\t\tlet right = this.controller.cNotes.renderHomeDropDown();\n\t\treturn <Page header={this.t('home')} right={right}>\n\t\t\t{cNodes.renderNotesView()}\n\t\t</Page>;\n\t}\n}\n","import { CUqBase } from \"../tapp\";\nimport { CNotes } from \"../notes\";\nimport { VHome } from \"./VHome\";\n\nexport class CHome extends CUqBase {\n\tcNotes: CNotes;\n\n  \tprotected async internalStart() {\n\t}\n\n\tasync refresh() {\n\t\tawait this.cNotes.refresh();\n\t}\n\n\tinit() {\n\t\tthis.cNotes = this.newC(CNotes);\n\t}\n\n\ttab = () => this.renderView(VHome);\n\n\tasync load() {\n\t\tawait this.cNotes.load();\n\t}\n}\n","import { CRelation } from \"./CRelation\";\nimport { VAddContact } from \"../tool\";\n\nexport class VAdd extends VAddContact<CRelation> {\n\tprotected async addContact():Promise<void> {\n\t\tawait this.controller.AddContact(this.user.id);\n\t}\n}\n","import React from 'react';\nimport { CRelation } from './CRelation';\nimport { VPage, FA, List, UserView, User, Image } from '../tonva';\nimport { VAdd } from './VAdd';\nimport { Contact } from '../model';\n\nexport class VRelation extends VPage<CRelation> {\n\theader() {return this.t('relation')}\n\n\tright() {\n\t\treturn <button className=\"btn btn-sm btn-primary mr-1\" onClick={()=>this.openVPage(VAdd)}>\n\t\t\t<FA name=\"user-plus\" />\n\t\t</button>;\n\t}\n\n\tcontent() {\n\t\treturn <div className=\"\">\n\t\t\t<List items={this.controller.contacts} item={{render: this.renderContact}} />\n\t\t</div>\n\t}\n\n\tprivate renderContact = (item:Contact, index:number) => {\n\t\tlet {contact, assigned} = item;\n\t\tlet renderUser = (user:User) => {\n\t\t\tlet {name, nick, icon} = user;\n\t\t\treturn <div className=\"px-3 py-2 cursor-pointer\" onClick={()=>this.controller.onShowContact(item)}>\n\t\t\t\t<Image className=\"w-2c h-2c mr-3\" src={icon || '.user-o'} />\n\t\t\t\t{assigned || nick || name}\n\t\t\t</div>\n\t\t}\n\t\treturn <UserView user={contact} render={renderUser} />;\n\t}\n}\n","import React from \"react\";\nimport { CContact } from \"./CContact\";\nimport { VPage, UserView, Image, FA, Muted, User } from \"../../tonva\";\nimport { observer } from \"mobx-react\";\n\nexport class VContact extends VPage<CContact> {\n\n\tinit(param:any) {\n\t}\n\n\theader() {\n\t\treturn ' ';\n\t}\n\n\tprivate onEditAlias = () => {\n\t\tthis.controller.onEditAssigned();\n\t}\n\n\tcontent() {\n\t\tlet renderUser = (user:User) => {\n\t\t\tlet {id, name, nick, icon} = user;\n\t\t\tlet { assigned } = this.controller.contact;\n\t\t\treturn <div className=\"p-3 d-flex\">\n\t\t\t\t<Image className=\"w-3c h-3c mr-4\" src={icon || '.user-o'} />\n\t\t\t\t<div>\n\t\t\t\t\t<div className=\"h6\"><b>{assigned || nick || name}</b></div>\n\t\t\t\t\t<div><Muted>id: </Muted>{id}</div>\n\t\t\t\t\t<div><Muted>用户名: </Muted>{name}</div>\n\t\t\t\t\t{nick && <div><Muted>别名: </Muted>{nick}</div>}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t}\n\t\tlet { contact } = this.controller.contact;\n\t\tlet cn = 'px-3 py-2 bg-white d-flex align-items-center border-bottom cursor-pointer';\n\t\treturn <div>\n\t\t\t<UserView user={contact as number} render={renderUser} />\n\t\t\t{\n\t\t\t\tReact.createElement(observer(() =>\n\t\t\t\t<div className={cn}  onClick={this.onEditAlias}>\n\t\t\t\t\t<div className=\"text-muted mr-3 w-4c\">备注名</div>\n\t\t\t\t\t<div className=\"flex-fill w-100 border-0 form-control mr-auto\">{this.controller.contact.assigned || <Muted>[无]</Muted>}</div>\n\t\t\t\t\t<FA name=\"angle-right\" />\n\t\t\t\t</div>))\n\t\t\t}\n\t\t</div>;\n\t}\n}","import React from \"react\";\nimport { CContact } from \"./CContact\";\nimport { VPage } from \"../../tonva\";\nimport { observable, computed } from \"mobx\";\nimport { observer } from \"mobx-react\";\n\nexport class VEditAssigned extends VPage<CContact> {\n\t@observable private assigned:string;\n\n\tinit(param?:any) {\n\t\tthis.assigned = this.controller.contact?.assigned;\n\t}\n\n\t@computed protected get btnSaveDisabled():boolean {\n\t\treturn this.assigned === this.controller.contact.assigned;\n\t}\n\n\theader() {\n\t\treturn '编辑';\n\t}\n\n\tright():JSX.Element {\n\t\treturn React.createElement(observer(() => <>\n\t\t\t<button onClick={() => this.onButtonSave()}\n\t\t\t\tclassName=\"btn btn-sm btn-success mr-1\" disabled={this.btnSaveDisabled}>\n\t\t\t\t保存\n\t\t\t</button>\n\t\t</>));\n\t}\n\n\tprotected onChange = (evt: React.ChangeEvent<HTMLInputElement>) => {\n\t\tthis.assigned = evt.target.value.trim();\n\t}\n\n\tprivate onKeyDown = (evt: React.KeyboardEvent<HTMLInputElement>) => {\n\t\tif (evt.keyCode === 13) {\n\t\t\tif (!this.btnSaveDisabled) {\n\t\t\t\tthis.onButtonSave();\n\t\t\t}\n\t\t}\n\t}\n\n\tprotected async onButtonSave(): Promise<void> {\n\t\tthis.controller.SaveContactAssign(this.assigned);\n\t\tthis.closePage();\n\t}\n\n\tcontent() {\n\t\treturn <div className=\"border rounded\">\n\t\t\t<div className=\"bg-white\">\n\t\t\t\t<div className=\"px-3 py-2 bg-white d-flex align-items-center border-bottom\">\n\t\t\t\t\t<div className=\"text-muted mr-3 w-4c\">备注名</div>\n\t\t\t\t\t<input type=\"text\" className=\"flex-fill w-100 border-0 form-control\" maxLength={80}\n\t\t\t\t\t\tautoFocus={true}\n\t\t\t\t\t\tonChange={this.onChange}\n\t\t\t\t\t\tonKeyDown={this.onKeyDown}\n\t\t\t\t\t\tdefaultValue={this.assigned} />\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t}\n}","import { CUqSub } from \"../../tapp\"\nimport { observable } from \"mobx\";\nimport { Contact } from \"model\";\nimport { CRelation } from \"../CRelation\";\nimport { VContact } from \"./VContact\";\nimport { VEditAssigned } from \"./VEditAssigned\";\n\nexport class CContact extends CUqSub<CRelation> {\n\tprotected async internalStart() {}\n\t@observable contact: Contact;\n\n\tinit(param:Contact):void {\n\t\tthis.contact = {...param};\n\t}\n\n\tasync SaveContactAssign(value:string) {\n\t\tawait this.owner.SaveContactAssign(this.contact, value);\n\t\tthis.contact.assigned = value;\n\t}\n\n\tasync showContact() {\n\t\tthis.openVPage(VContact);\n\t}\n\n\tasync onEditAssigned() {\n\t\tthis.openVPage(VEditAssigned);\n\t}\n}","import { CUqBase } from \"../tapp\";\nimport { VRelation } from \"./VRelation\";\nimport { observable } from \"mobx\";\nimport { Contact } from \"model\";\nimport { CContact } from \"./contact\";\n\nexport class CRelation extends CUqBase {\n\tprivate loaded: boolean = false;\n\t@observable contacts: Contact[] = [];\n\n    protected async internalStart() {\n\t}\n\n\ttab = () => this.renderView(VRelation);\n\n\tload = async () => {\n\t\tif (this.loaded === true) return;\n\t\tlet ret = await this.uqs.notes.GetMyContacts.page({}, 0, 500, true);\n\t\tthis.contacts.push(...ret['$page']);\n\t\tthis.loaded = true;\n\t}\n\n\tasync AddContact(contact: number) {\n\t\tawait this.uqs.notes.AddContact.submit({contact});\n\t\tthis.contacts.unshift({contact, assigned:undefined});\n\t}\n\n\tasync onShowContact(item:Contact) {\n\t\tlet cc = this.newSub(CContact, item);\n\t\tcc.showContact();\n\t}\n\n\tasync SaveContactAssign(item:Contact, value:string) {\n\t\tlet param = {contact:item.contact, assigned:value};\n\t\tawait this.uqs.notes.SetContactAssinged.submit(param);\n\t\tlet c = this.contacts.find(v=>v.contact === item.contact);\n\t\tif (c !== undefined) {\n\t\t\tc.assigned = value;\n\t\t}\n\t}\n}\n","import { observable } from 'mobx';\nimport { observer } from 'mobx-react';\nimport React from 'react';\nimport { VPage, userApi, User, Image, Page, List, UserView, \n\tEdit, ItemSchema, StringSchema, IntSchema, UiSchema, UiTextItem, UiNumberItem, BoolSchema, UiCheckItem } from \"../tonva\";\nimport { CMe, RootUnitItem } from \"./CMe\";\n\nexport class VAdmin extends VPage<CMe> {\n\theader() {return '管理员'}\n\tcontent() {\n\t\treturn <div>\n\t\t\t<div className=\"px-3 py-3 bg-white border-bottom\">\n\t\t\t\t<div><b className=\"text-info\">为用户创建机构</b></div>\n\t\t\t\t<div>\n\t\t\t\t\t给指定用户创建机构。机构下面的部门和成员，由机构所有者创建。\n\t\t\t\t</div>\n\t\t\t\t<div className=\"my-2\">\n\t\t\t\t\t<button className=\"btn btn-primary\" onClick={()=>this.openVPage(VUser)}>创建</button>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<List items={this.controller.rootUnits} item={{render: this.renderRootUnit, onClick: this.onClickRootUnit}} />\n\t\t</div>;\n\t}\n\n\tprivate renderRootUnit = (item: RootUnitItem, index: number) => {\n\t\tlet {id, owner, name, tonvaUnit, x} = item;\n\t\tlet renderUser = (user:User) => {\n\t\t\tlet {name, nick, icon} = user;\n\t\t\treturn <>\n\t\t\t\t<Image className=\"w-1-5c h-1-5c mr-2\" src={icon || '.user-o'} />\n\t\t\t\t{nick || name}\n\t\t\t</>\n\t\t}\n\t\tlet vId = <small className=\"text-muted\">ID={id}</small>;\n\t\tlet vName = (x !== 0)? \n\t\t\t<del>{name} {vId}</del>\n\t\t\t:\n\t\t\t<><b>{name}</b> {vId}</>;\n\t\treturn <div className={'px-3 py-2 align-items-center '}>\n\t\t\t<div className=\"mr-3\">{vName}</div>\n\t\t\t<div className=\"small text-muted d-flex align-items-center\"><UserView user={owner as number} render={renderUser} /></div>\n\t\t\t{tonvaUnit && <div className=\"ml-auto small text-muted\">tonva={tonvaUnit}</div>}\n\t\t</div>;\n\t}\n\n\tprivate onClickRootUnit = (item: RootUnitItem) => {\n\t\tlet {name} = item;\n\t\tlet schema: ItemSchema[] = [\n\t\t\t{ name: 'name', type: 'string' } as StringSchema,\n\t\t\t{ name: 'tonvaUnit', type: 'integer' } as IntSchema,\n\t\t\t{ name: 'x', type: 'boolean' } as BoolSchema,\n\t\t];\n\t\tlet uiSchema: UiSchema = {\n\t\t\titems: {\n\t\t\t\tname: { widget: 'text', label: '机构名称' } as UiTextItem,\n\t\t\t\ttonvaUnit: { widget: 'number', label: 'Tonva Unit' } as UiNumberItem,\n\t\t\t\tx: {widget: 'checkbox', label: '停用', trueValue: 1, falseValue: 0} as UiCheckItem,\n\t\t\t}\n\t\t}\n\t\tthis.openPageElement(<Page header={name}>\n            <Edit schema={schema} uiSchema={uiSchema}\n                data={item}\n                onItemChanged={async (itemSchema: ItemSchema, newValue: any, preValue: any) => {\n\t\t\t\t\tawait this.onItemChanged(item, itemSchema, newValue, preValue);\n\t\t\t\t}} />\n\t\t</Page>);\n\t}\n\n\tprivate onItemChanged = async (item: RootUnitItem, itemSchema: ItemSchema, newValue: any, preValue: any) => {\n\t\tswitch (itemSchema.name) {\n\t\t\tcase 'name':\n\t\t\t\tlet name = newValue.trim();\n\t\t\t\tif (name === preValue.trim()) break;\n\t\t\t\tawait this.controller.changeRootUnitName(item, name);\n\t\t\t\tbreak;\n\t\t\tcase 'tonvaUnit':\n\t\t\t\tawait this.controller.changeRootUnitTonva(item, newValue);\n\t\t\t\tbreak;\n\t\t\tcase 'x':\n\t\t\t\tawait this.controller.changeRootUnitX(item, newValue);\n\t\t\t\tbreak;\n\t\t}\n\t}\n}\n\nclass VUser extends VPage<CMe> {\n\t@observable private hasError = false;\n\t@observable private user:{id:number, name:string, nick:string, icon:string};\n\t@observable private inputName: string;\n\n\theader() {return '机构所有者'}\n\tcontent() {\n\t\treturn React.createElement(observer(() => {\n\t\t\tlet vError:any;\n\t\t\tif (this.hasError===true)\n\t\t\t\tvError = <div className=\"my-3 text-danger\">用户不存在！</div>;\n\t\t\treturn <div className=\"m-3\">\n\t\t\t\t<div>\n\t\t\t\t\t<input type=\"text\" className=\"form-control\"  maxLength={100}\n\t\t\t\t\t\tplaceholder=\"用户\"\n\t\t\t\t\t\tonFocus={()=>this.hasError = false}\n\t\t\t\t\t\tonKeyDown={this.onKeyDown}\n\t\t\t\t\t\tonChange={this.onChange}/>\n\t\t\t\t</div>\n\t\t\t\t{vError}\n\t\t\t\t<div className=\"my-2\">\n\t\t\t\t\t<button className=\"btn btn-primary\" disabled={this.inputName?.trim().length===0}\n\t\t\t\t\t\tonClick={this.onNext}>下一步</button>\n\t\t\t\t</div>\n\t\t\t</div>;\n\t\t}));\n\t}\n\n\tprivate onKeyDown = async (evt: React.KeyboardEvent<HTMLInputElement>) => {\n\t\tthis.hasError = false;\n\t\tif (evt.keyCode === 13) {\n\t\t\tawait this.onNext();\n\t\t}\n\t}\n\n\tprivate onChange = (evt: React.ChangeEvent<HTMLInputElement>) => {\n\t\tthis.inputName = evt.currentTarget.value;\n\t}\n\n\tprivate onNext = async () => {\n\t\tawait this.search(this.inputName.trim());\n\t\tif (this.hasError === false) {\n\t\t\tthis.controller.unitOwner = this.user as User;\n\t\t\tthis.openVPage(VUnit);\n\t\t}\n\t}\n\n\tprivate search = async (key:string) => {\n\t\tlet ret = await userApi.fromKey(key);\n\t\tif (!ret) {\n\t\t\tthis.hasError = true;\n\t\t\treturn;\n\t\t}\n\t\t// if (this.controller.isMe(ret.id)) {\n\t\t//\treturn;\n\t\t//}\n\t\tthis.user = ret;\n\t}\n}\n\nclass VUnit extends VPage<CMe> {\n\t@observable private input: string;\n\n\theader() {return '新建机构'}\n\tcontent() {\n\t\treturn React.createElement(observer(() => {\n\t\t\tlet {unitOwner} = this.controller;\n\t\t\tlet {icon, name, nick} = unitOwner;\n\t\t\treturn <div className=\"m-3\">\n\t\t\t\t<div className=\"my-2\">所有者: <Image className=\"w-2c h-2c\" src={icon} /> {nick ?? name} </div>\n\t\t\t\t<div>\n\t\t\t\t\t<input type=\"text\" className=\"form-control\" maxLength={100}\n\t\t\t\t\t\tplaceholder=\"机构名称\" onChange={this.onChange} onKeyDown={this.onKeyDown}/>\n\t\t\t\t</div>\n\t\t\t\t<div className=\"my-2\">\n\t\t\t\t\t<button className=\"btn btn-primary\" disabled={this.input?.trim().length===0}\n\t\t\t\t\t\tonClick={this.onCreate}>创建机构</button>\n\t\t\t\t</div>\n\t\t\t</div>;\n\t\t}));\n\t}\n\n\tprivate onChange = (evt: React.ChangeEvent<HTMLInputElement>) => {\n\t\tthis.input = evt.currentTarget.value;\n\t}\n\n\tprivate onKeyDown = async (evt: React.KeyboardEvent<HTMLInputElement>) => {\n\t\tif (evt.keyCode === 13) {\n\t\t\tawait this.onCreate();\n\t\t}\n\t}\n\n\tprivate onCreate = async () => {\n\t\tlet unitId = await this.controller.createRootUnit({\n\t\t\tname: this.input.trim(),  \n\t\t\tcontent: undefined,\n\t\t\towner: this.controller.user.id\n\t\t});\n\t\tlet header:string = '错误', cn:string = 'text-danger', content:string;\n\t\tswitch (unitId) {\n\t\t\tdefault:\n\t\t\t\theader = '成功';\n\t\t\t\tcn = 'text-success';\n\t\t\t\tcontent = '机构创建成功！';\n\t\t\t\tbreak;\n\t\t\tcase -1:\n\t\t\t\tcontent = '无权创建机构';\n\t\t\t\tbreak;\n\t\t\tcase -2:\n\t\t\t\tcontent = '机构名称已经被使用了';\n\t\t\t\tbreak;\n\t\t}\n\t\tthis.openPageElement(<Page header={header} afterBack={()=>this.closePage(3)} back=\"close\">\n\t\t\t<div className={'m-3 ' +  cn}>{content}</div>\n\t\t</Page>)\n\t}\n}\n","import * as React from 'react';\nimport { observable } from 'mobx';\nimport {\n    userApi, ItemSchema, StringSchema, ImageSchema, UiTextItem, UiImageItem, nav, Page,\n    Edit, UiSchema, VPage\n} from '../tonva';\nimport { CMe } from './CMe';\n\nexport class VEditMe extends VPage<CMe>{\n\n    async open(param: any) {\n        this.openPage(this.page);\n    }\n\n    private schema: ItemSchema[] = [\n        { name: 'nick', type: 'string' } as StringSchema,\n        { name: 'icon', type: 'image' } as ImageSchema,\n    ];\n    private uiSchema: UiSchema = {\n        items: {\n            nick: { widget: 'text', label: '别名', placeholder: '好的别名更方便记忆' } as UiTextItem,\n            icon: { widget: 'image', label: '头像' } as UiImageItem,\n        }\n    }\n    @observable private data: any;\n\n    constructor(props: any) {\n        super(props);\n        let { nick, icon } = nav.user;\n        this.data = {\n            nick: nick,\n            icon: icon,\n        };\n    }\n\n    private onItemChanged = async (itemSchema: ItemSchema, newValue: any, preValue: any) => {\n        let { name } = itemSchema;\n        await userApi.userSetProp(name, newValue);\n        this.data[name] = newValue;\n        nav.user.name = newValue;\n        nav.saveLocalUser();\n    }\n\n    private page = () => {\n\t\tlet { schema, uiSchema, data, onItemChanged } = this;\n\t\tlet vAdmin: any;\n\t\t\n\t\tlet { role } = this.controller;\n\t\tif ((role & 2) === 2) {\n\t\t\tvAdmin = <div className=\"px-3 py-2 cursor-pointer bg-white border-bottom\" onClick={this.controller.showAdmin}>管理员</div>;\n\t\t}\n\n        return <Page header=\"个人信息\">\n            <Edit schema={schema} uiSchema={uiSchema}\n                data={data}\n                onItemChanged={onItemChanged} />\n\t\t\t{vAdmin}\n        </Page>;\n    }\n}\n\nexport const webUserSchema: ItemSchema[] = [\n    { name: 'firstName', type: 'string', required: true } as StringSchema,\n    { name: 'gender', type: 'string' } as StringSchema,\n    { name: 'salutation', type: 'string' } as StringSchema,\n    { name: 'organizationName', type: 'string', required: true } as StringSchema,\n    { name: 'departmentName', type: 'string' } as StringSchema,\n];\n\n","import React from 'react';\nimport { CMe } from './CMe';\nimport { Image, VPage, nav, IconText, PropGrid, LMR, FA, Prop } from '../tonva';\nimport { observer } from 'mobx-react';\nimport { appConfig } from '../tapp';\n\nexport class VMe extends VPage<CMe> {\n\theader() {return this.t('me')}\n\n\tcontent() {\n        const { user } = nav;\n        let aboutRows: Prop[] = [\n            '',\n            {\n                type: 'component',\n                component: <div className=\"w-100 d-flex justify-content-between\">\n                    <IconText iconClass=\"text-info mr-2\" icon=\"smile-o\" text={this.t('aboutTheApp')} />\n                    <div className=\"py-2 small\">V{appConfig.version}</div>\n                </div>,\n            }\n        ];\n\n        let rows: Prop[];\n        if (user === undefined) {\n            rows = aboutRows;\n            rows.push(\n                {\n                    type: 'component',\n                    component: <button className=\"btn btn-success w-100 my-2\" onClick={() => nav.logout()}>\n                        <FA name=\"sign-out\" size=\"lg\" /> {this.t('pleaseLogin')}\n                    </button>\n                },\n            );\n        }\n        else {\n            let logOutRows: Prop[] = [\n                '',\n                {\n                    type: 'component',\n                    bk: '',\n                    component: <button className=\"btn btn-danger w-100\" onClick={this.onExit}>\n                        <FA name=\"sign-out\" size=\"lg\" /> {this.t('logout')}\n                </button>\n                },\n            ];\n\n            rows = [\n                '',\n                {\n                    type: 'component',\n                    component: <this.meInfo />\n                },\n                '',\n                {\n                    type: 'component',\n                    component: <IconText iconClass=\"text-info mr-2\" icon=\"key\" text={this.t('changePassword')} />,\n                    onClick: this.changePassword\n                },\n            ]\n            rows.push(...aboutRows, ...logOutRows);\n        }\n        return <PropGrid rows={[...rows]} values={{}} />;\n\t}\n\n\tprivate onExit = () => {\n        nav.showLogout();\n    }\n\n    private changePassword = async () => {\n        await nav.changePassword();\n    }\n\n    private meInfo = observer(() => {\n        let { user } = nav;\n        if (user === undefined) return null;\n        let { id, name, nick, icon } = user;\n        return <LMR className=\"py-2 cursor-pointer w-100\"\n            left={<Image className=\"w-3c h-3c mr-3\" src={icon || '.user-o'} />}\n            right={<FA className=\"align-self-end\" name=\"angle-right\" />}\n            onClick={this.controller.showEditMe}>\n            <div>\n                <div>{userSpan(name, nick)}</div>\n                <div className=\"small\"><span className=\"text-muted\">ID:</span> {id > 10000 ? id : String(id + 10000).substr(1)}</div>\n            </div>\n        </LMR>;\n    });\n}\n\nfunction userSpan(name: string, nick: string): JSX.Element {\n    return nick ?\n        <><b>{nick} &nbsp; <small className=\"muted\">{name}</small></b></>\n        : <b>{name}</b>\n}\n","import { CUqBase } from \"../tapp\";\nimport { QueryPager, User } from \"../tonva\";\nimport { VAdmin } from \"./VAdmin\";\nimport { VEditMe } from \"./VEditMe\";\nimport { VMe } from \"./VMe\";\n\nexport interface RootUnitItem {\n\tid: number;\t\t\t\t\t// root unit id\n\towner: any;\n\tname: string;\t\t\t\t// 唯一\n\tcontent: string;\n\ttonvaUnit: number;\t\t\t// 跟tonva机构对应的值\n\tx: number;\n}\n\nexport class CMe extends CUqBase {\n\trole: number;\n\tunitOwner: User;\n\trootUnits: QueryPager<any>;\n\n    protected async internalStart() {\n\t}\n\n\ttab = () => this.renderView(VMe);\n\n\tshowEditMe = async () => {\n\t\tlet result = await this.uqs.notes.GetSystemRole.query({});\n\t\tthis.role = result.ret[0]?.role;\n\t\tthis.openVPage(VEditMe);\n\t}\n\n\tshowAdmin = async () => {\n\t\tthis.rootUnits = new QueryPager<any>(this.uqs.notes.GetRootUnits, undefined, undefined, true);\n\t\tthis.rootUnits.first({});\n\t\tthis.openVPage(VAdmin);\n\t}\n\n\tasync createRootUnit(param: {name:string; content:string; owner:number}): Promise<number> {\n\t\tlet result = await this.uqs.notes.CreateRootUnit.submit(param);\n\t\treturn result.id;\n\t}\n\n\tasync changeRootUnitName(item:RootUnitItem, name:string) {\n\t\tawait this.uqs.notes.ChangeRootUnitProp.submit({unit:item.id, prop:'name', value: name})\n\t\titem.name = name;\n\t}\n\n\tasync changeRootUnitTonva(item:RootUnitItem, tonvaUnit:any) {\n\t\tawait this.uqs.notes.ChangeRootUnitProp.submit({unit:item.id, prop:'tonvaUnit', value: tonvaUnit})\n\t\titem.tonvaUnit = tonvaUnit;\n\t}\n\n\tasync changeRootUnitX(item:RootUnitItem, x:number) {\n\t\tawait this.uqs.notes.ChangeRootUnitProp.submit({unit:item.id, prop:'x', value: x})\n\t\titem.x = x;\n\t}\n}\n","import { Tuid, Query, Action/*, Map, Sheet, Tag*/ } from \"../tonva\";\n\nexport enum EnumSpecFolder {notes=1};\n\nexport interface Notes {\n\tNote: Tuid;\n\n\tAddNote: Action;\n\tSetNote: Action;\n\tSetNoteX: Action;\n\tSendNoteTo: Action;\n\tHideNote: Action;\n\tAddContact: Action;\n\tSetContactAssinged: Action;\n\tAssignTask: Action;\n\n\tDoneTask: Action;\n\tCheckTask: Action;\n\tRateTask: Action;\n\n\tAddComment: Action;\n\n\tAddGroup: Action;\n\tSetGroup: Action;\n\n\t$Poked: Query;\n\tGetNotes: Query;\n\tGetMyContacts: Query;\n\tGetNote: Query;\n\tGetNoteItemFromId: Query;\n\tGetShareContacts: Query;\n\tGetSpawnContacts: Query;\n\tGetAssignToContacts: Query;\n\n\tAddGroupMember: Action;\n\tRemoveGroupMember: Action;\n\tGetGroupFolderMemberCount: Query;\n\tGetGroupMembers: Query;\n\tGetGroupContacts: Query;\n\n\tGetBookProjects: Query;\n\tGetProjectFlow: Query;\n\tGetProjectYearSum: Query;\n\tGetProjectMonthSum: Query;\n\tGetProjectDaySum: Query;\n\n\tInitMySetting: Action;\n\tGetSystemRole: Query;\n\n\tCreateRootUnit: Action;\n\tCreateUnit: Action;\n\tGetUnit: Query;\n\tSetUnitName: Action;\n\tAddUnitMember: Action;\n\tSetUnitMemberRole: Action;\n\tSetUnitMemberProp: Action;\n\tGetRootUnits: Query;\n\tChangeRootUnitProp: Action;\n\n\tBookProject: Tuid;\n\tBookReport: Tuid;\n\tGetRootUnitProjects: Query;\n\tGetRootUnitReports: Query;\n\tGetUnitProjects: Query;\n\tSetUnitProjects: Action;\n\tGetUnitSum: Query;\n\tGetMySum: Query;\n\n\tTestBusBootProject: Action;\n};\n\nexport interface UQs {\n    notes: Notes\n}\n","import React from 'react';\nimport { CDiscover } from './CDiscover';\nimport { VPage, LMR, FA } from '../tonva';\n\ninterface Item {\n\ticon: string;\n\tcaption: string;\n\tonClick: () => void;\n}\n\nexport class VDiscover extends VPage<CDiscover> {\n\tprivate onTaskReport = () => {\n\t\talert('实现中');\n\t}\n\n\tprivate onOtherReport = () => {\n\t\talert('实现中');\n\t}\n\n\tprivate items:(Item|string)[] = [\n\t\t{icon: undefined, caption: '任务报表', onClick: this.onTaskReport}, \n\t\t{icon: undefined, caption: '其它报表', onClick: this.onOtherReport}, \n\t\t'-',\n\t\t{icon: undefined, caption: '任务报表', onClick: this.onTaskReport}, \n\t\t{icon: undefined, caption: '其它报表', onClick: this.onOtherReport}, \n\t];\n\n\theader() {return this.t('discover')}\n\tcontent() {\n\t\tlet cn = 'px-3 py-2 cursor-pointer bg-white mb-1';\n\t\tlet right = <FA name=\"angle-right\" />;\n\t\treturn <div className=\"py-3\">\n\t\t\t<div>\n\t\t\t\t<button className=\"btn btn-primary\" onClick={this.testBus}>测试Bus</button>\n\t\t\t</div>\n\n\t\t\t{this.controller.cBook.renderBook()}\n\n\t\t\t{this.items.map((v, index) => {\n\t\t\t\tif (typeof v === 'string') {\n\t\t\t\t\treturn <div key={index} className=\"pt-2\" />;\n\t\t\t\t}\n\t\t\t\tlet {icon, caption, onClick} = v;\n\t\t\t\tlet left = <FA name={icon} />;\n\t\t\t\treturn <LMR key={index} className={cn} onClick={onClick} left={left} right={right}>\n\t\t\t\t\t{caption}\n\t\t\t\t</LMR>\n\t\t\t})}\n\t\t</div>;\n\t}\n\n\tprivate testBus = async () => {\n\t\tawait this.controller.testBus();\n\t}\n}\n","import React from 'react';\nimport { View, FA } from \"../tonva\";\nimport { CBook, ProjectSum } from './CBook';\n\nexport class VBook extends View<CBook> {\n\trender() {\n\t\tlet {projectSums} = this.controller;\n\t\tif (projectSums.length === 0) return;\n\t\treturn <div className=\"px-3 mb-3 border-top\">\n\t\t\t{projectSums.map(v => { \n\t\t\t\t//let {id, name, debitYear, creditYear, debitMonth, creditMonth, debitWeek, creditWeek, debitDay, creditDay} = v;\n\t\t\t\tlet {id, name, debitMonth, debitWeek, debitDay} = v;\n\t\t\t\treturn <div key={id} className=\"row py-3 align-items-end border-bottom bg-white cursor-pointer\"\n\t\t\t\t\tonClick={() => this.onProject(v)}>\n\t\t\t\t\t<div className=\"col text-center\">{name}</div>\n\t\t\t\t\t{this.renderNumber('今天', debitDay)}\n\t\t\t\t\t{this.renderNumber('本周', debitWeek)}\n\t\t\t\t\t{this.renderNumber('本月', debitMonth)}\n\t\t\t\t\t<div className=\"mx-3\">\n\t\t\t\t\t\t<FA name=\"angle-right\" />\n\t\t\t\t\t</div>\n\t\t\t\t</div>;\n\t\t\t})}\n\t\t</div>;\n\t}\n\n\tprivate renderNumber(caption:string, num:number) {\n\t\treturn <div className=\"text-center col\">\n\t\t\t<small className=\"text-muted\">{caption}</small><br/>\n\t\t\t<span>{num ?? 0}</span>\n\t\t</div>\n\t}\n\n\tprivate onProject = async (projectSum:ProjectSum) => {\n\t\tawait this.controller.showProjectFlow(projectSum);\n\t}\n}\n","import React from 'react';\nimport { CBook, ProjectFlowItem, ProjectSum } from './CBook';\nimport { VPage, List, EasyTime, FA } from '../tonva';\n\nexport class VFlow extends VPage<CBook> {\n\tprivate projectSum: ProjectSum;\n\tinit(param: ProjectSum) {\n\t\tthis.projectSum = param;\n\t}\n\n\theader() {return '明细 - ' + this.projectSum.name}\n\n\tcontent() {\n\t\treturn <div>\n\t\t\t<div className=\"px-3 py-2 d-flex\">\n\t\t\t\t<div className=\"w-8c\">日期</div>\n\t\t\t\t<div className=\"w-5c text-right\"><FA name=\"plus\"/></div>\n\t\t\t\t<div className=\"w-5c text-right\"><FA name=\"minus\"/></div>\n\t\t\t</div>\n\t\t\t<List\n\t\t\t\titems={this.controller.projectDetailPager}\n\t\t\t\titem={{render: this.renderFlowItem}}/>\n\t\t</div>;\n\t}\n\n\tprivate renderFlowItem = (flowItem:ProjectFlowItem) => {\n\t\tlet {stamp, memo, debit, credit} = flowItem;\n\t\treturn <div className=\"px-3 py-2 d-flex cursor-pointer\" onClick={()=>this.controller.showFlowItem(flowItem)}>\n\t\t\t<div className=\"w-8c\"><EasyTime date={stamp} /></div>\n\t\t\t<div className=\"w-5c text-right\">{debit}</div>\n\t\t\t<div className=\"w-5c text-right\">{credit}</div>\n\t\t\t<div className=\"ml-5\">{memo}</div>\n\t\t</div>;\n\t}\n}\n","import { CUqBase } from \"../tapp\";\nimport { initNoteItemObj, NoteItem } from \"../notes/model\";\nimport { VBook } from \"./VBook\";\nimport { QueryPager } from \"../tonva\";\nimport { VFlow } from \"./VFlow\";\n\nexport interface ProjectSum {\n\tid: number;\n\tname: string;\n\tdebitYear: number;\n\tcreditYear: number;\n\tdebitMonth: number;\n\tcreditMonth: number;\n\tdebitWeek: number;\n\tcreditWeek: number;\n\tdebitDay: number;\n\tcreditDay: number;\n\th8: number;\n}\n\nexport interface ProjectFlowItem {\n\tproject: number;\n\tstamp: Date;\n\tdebit: number;\n\tcredit: number;\n\tmemo: string;\n\tnote: number; \t\t// 关联的Note\n}\n\nexport class CBook extends CUqBase {\n\tprojectSums: ProjectSum[];\n\tprojectDetailPager: QueryPager<ProjectFlowItem>;\n\n    protected async internalStart() {\n\t}\n\n\tasync loadBookProjects() {\n\t\t//let ret = await this.uqs.notes.GetBookProjects.query({user: this.user.id, at: undefined}, true);\n\t\tthis.projectSums = []; //ret.ret;\n\t}\n\n\trenderBook() {\n\t\treturn this.renderView(VBook);\n\t}\n\n\tasync showProjectFlow(projectSum: ProjectSum) {\n\t\tthis.projectDetailPager = new QueryPager(this.uqs.notes.GetProjectFlow);\n\t\tthis.projectDetailPager.first({project: projectSum.id});\n\t\tthis.openVPage(VFlow, projectSum);\n\t}\n\n\tasync showFlowItem(projectFlowItem: ProjectFlowItem) {\n\t\tlet {note} = projectFlowItem;\n\t\tlet ret = await this.uqs.notes.GetNoteItemFromId.query({note});\n\t\tlet noteItem:NoteItem = ret.ret[0];\n\t\tinitNoteItemObj(noteItem);\n\t\tlet cNote = this.cApp.cHome.cNotes.createCNoteBase(noteItem);\n\t\tcNote.init(noteItem);\n\t\tcNote.showViewPage();\n\t}\n}\n","import { CUqBase } from \"../tapp\";\nimport { VDiscover } from \"./VDiscover\";\nimport { CBook } from \"../book\";\n\nexport class CDiscover extends CUqBase {\n\tcBook: CBook;\n\n    protected async internalStart() {\n\t}\n\n\tinit() {\n\t\tthis.cBook = this.newC(CBook);\n\t\treturn;\n\t}\n\n\tloadBookProjects = async () => {\n\t\tawait this.cBook.loadBookProjects();\n\t}\n\n\ttab = () => this.renderView(VDiscover);\n\n\tasync testBus() {\n\t\tawait this.uqs.notes.TestBusBootProject.submit({});\n\t\talert('test bus');\n\t}\n}\n","import React from 'react';\nimport { CApp } from \"./CApp\";\nimport { VPage } from \"../tonva\";\n\nexport class VTestMe extends VPage<CApp> {\n\theader() {return 'VTestMe'}\n\tcontent() {\n\t\treturn <div>VTestMe</div>;\n\t}\n}\n","import React from 'react';\nimport { CApp } from \"./CApp\";\nimport { VPage } from \"../tonva\";\nimport { VTestMe } from './VTestMe';\n\nexport class VTestAB extends VPage<CApp> {\n\theader() {return 'VTestAB'}\n\tcontent() {\n\t\treturn <div>\n\t\t\tVTestAB\n\t\t\t<button onClick={()=>this.go(()=>this.openVPage(VTestMe), '/bbbb/cccc')}>To Me</button>\n\t\t</div>;\n\t}\n}\n","import { zh } from \"./zh\";\nimport { en } from \"./en\";\n\nexport const res = {\n\t$zh: zh,\n\t$en: en,\n}\n","export const zh = {\n\thome: '首页',\n\trelation: '关系',\n\tdiscover: '发现',\n\tme: '我',\n\n\tchangePassword: '修改密码',\n\taboutTheApp: '关于本APP',\n\tlogout: '退出登录',\n\tpleaseLogin: '登录',\n\n\tnotes: '小单',\n\ttask: '任务',\n\tassign: '作业单',\n\n\tnoteSpace: '群',\n\n\tnoteText: '文字单',\n\tnoteList: '列表单',\n\tnoteCheckable: '勾选单',\n\tnoteTask: '布置任务',\n\tnoteFolder: '小单夹',\n\tnoteCreateSpace: '新建群',\n\n\tcontent: '内容',\n}\n","export const en = {\n\thome: 'Home',\n\trelation: 'Relation',\n\tdiscover: 'Discover',\n\tme: 'Me',\n\n\tchangePassword: 'Change password',\n\taboutTheApp: 'About the APP',\n\tlogout: 'Logout',\n\tpleaseLogin: 'Login',\n\n\tnotes: 'Notes',\n\ttask: 'Task',\n\tassign: 'Assign',\n\n\tnoteSpace: 'Group',\n\n\tnoteText: 'Text',\n\tnoteList: 'List',\n\tnoteCheckable: 'Checkable',\n\tnoteTask: 'Task',\n\tnoteFolder: 'Folder',\n\tnoteCreateSpace: 'Create Group',\n\n\tcontent: 'Content',\n}\n","import { CUqApp } from \"./CBase\";\r\nimport { VMain } from \"./main\";\r\nimport { CHome } from \"../home\";\r\nimport { CRelation } from \"../relation\";\r\nimport { CMe } from \"../me\";\r\nimport { CDiscover } from \"../discover\";\r\nimport { computed } from \"mobx\";\r\nimport { Contact } from \"model\";\r\nimport { VTestMe } from \"./VTestMe\";\r\nimport { VTestAB } from \"./VTestAB\";\r\nimport { res } from \"./res\";\r\n\r\nconst gaps = [10, 3,3,3,3,3,5,5,5,5,5,5,5,5,10,10,10,10,15,15,15,30,30,60];\r\n\r\nexport class CApp extends CUqApp {\r\n\tprivate timer:any;\r\n\tcHome: CHome;\r\n\tcRelation: CRelation;\r\n\tcDiscover: CDiscover;\r\n\tcMe: CMe;\r\n\r\n\tprotected async internalStart(isUserLogin: boolean) {\r\n\t\tthis.setRes(res);\r\n\t\tif (isUserLogin === true) await this.initMySetting();\r\n\t\t//if (this.isRouting === false) \r\n\t\tawait this.startHome();\r\n\t}\r\n\r\n\tprotected async startHome() {\r\n\t\tthis.cHome = this.newC(CHome);\r\n\t\tthis.cRelation = this.newC(CRelation);\r\n\t\tthis.cDiscover = this.newC(CDiscover);\r\n\t\tthis.cMe = this.newC(CMe);\r\n\t\tthis.cHome.load();\r\n\t\tthis.showMain();\r\n\r\n\t\tthis.timer = setInterval(this.callTick, 1000);\r\n\t}\r\n\r\n\tprivate async initMySetting() {\r\n\t\tlet timezone:number = - (new Date()).getTimezoneOffset() / 60;\r\n\t\tawait this.uqs.notes.InitMySetting.submit({timezone}, true);\r\n\t}\r\n\r\n\tprotected onDispose() {\r\n\t\tclearInterval(this.timer);\r\n\t\tthis.timer = undefined;\r\n\t}\r\n\r\n\tprotected async startMe() {\r\n\t\tthis.openVPage(VTestMe);\r\n\t}\r\n\r\n\tprotected async startAB() {\r\n\t\tthis.openVPage(VTestAB);\r\n\t}\r\n\r\n\tprotected onRoute() {\r\n\t\tthis.on({\r\n\t\t\t'/a/b': () => {\r\n\t\t\t\t// renderDom(<div>/a/b <button onClick={()=>nav.navigate('/c/d')}>test</button></div>)\r\n\t\t\t\tthis.startAB();\r\n\t\t\t},\r\n\t\t\t'/c/d': () => {\r\n\t\t\t\t/*\r\n\t\t\t\trenderDom(<div>\r\n\t\t\t\t\t/c/d\r\n\t\t\t\t\t<button onClick={()=>nav.navigate('/eeee/a/1?c=1 & d=3')}>test</button>\r\n\t\t\t\t</div>)\r\n\t\t\t\t*/\r\n\t\t\t},\r\n\t\t\t'/eeee/:action/:id': (params:any, queryStr:any) => {\r\n\t\t\t\t/*\r\n\t\t\t\tlet span:any;\r\n\t\t\t\tif (queryStr) {\r\n\t\t\t\t\tspan = <span>{queryStr}</span>\r\n\t\t\t\t}\r\n\t\t\t\trenderDom(<div>/e query:{span}  params:{JSON.stringify(params)}</div>)\r\n\t\t\t\t*/\r\n\t\t\t},\r\n\t\t\t'/bbbb/cccc': () => {\r\n\t\t\t\t//renderCApp(new CAppBBBBCCCC());\r\n\t\t\t\tthis.startMe();\r\n\t\t\t},\r\n\t\t});\r\n\t\tthis.on(() => {\r\n\t\t\t//renderCApp(new CApp());\r\n\t\t\tthis.startHome();\r\n\t\t});\r\n\t}\r\n\r\n\r\n\t@computed get contacts(): Contact[] {return this.cRelation.contacts;};\r\n\r\n\tasync loadRelation() {\r\n\t\tawait this.cRelation.load();\r\n\t}\r\n\r\n    private showMain(initTabName?: string) {\r\n        this.openVPage(VMain, initTabName, this.dispose);\r\n\t}\r\n\r\n\tprivate tick = 0;\r\n\tprivate gapIndex = 0;\r\n\tprivate callTick = async () => {\r\n\t\ttry {\r\n\t\t\tif (!this.user) return;\r\n\t\t\t++this.tick;\r\n\t\t\tif (this.tick<gaps[this.gapIndex]) return;\r\n\t\t\t//console.error('tick ', new Date());\r\n\t\t\tthis.tick = 0;\r\n\t\t\tif (this.gapIndex < gaps.length - 1) ++this.gapIndex;\r\n\t\t\tlet ret = await this.uqs.notes.$Poked.query(undefined, false);\r\n\t\t\tlet v = ret.ret[0];\r\n\t\t\tif (v === undefined) return;\r\n\t\t\tif (!v.poke) return;\r\n\t\t\tthis.gapIndex = 1;\r\n\r\n\t\t\t// uq 里面加入这一句，会让相应的$Poked查询返回poke=1：\r\n\t\t\t// TUID [$User] ID (member) SET poke=1;\r\n\t\t\t// 这个地方重新调入的数据\r\n\t\t\tthis.cHome.refresh();\r\n\t\t}\r\n\t\tcatch {\r\n\t\t}\r\n\t}\r\n}\r\n","import React from 'react';\r\nimport ReactDOM from 'react-dom';\r\n//import 'bootstrap/dist/css/bootstrap.css'\r\nimport './bootstrap.css';\r\nimport './index.css';\r\nimport * as serviceWorker from './serviceWorker';\r\nimport { NavView, start, nav } from './tonva';\r\nimport './App.css';\r\nimport { CApp, appConfig } from './tapp';\r\n\r\nasync function startApp() {\r\n\tnav.setSettings(appConfig);\r\n\t//如果要支持route，必须调用下面这一句\r\n\t//await startRoute(appConfig);\r\n\tconst App: React.FC = () => {\r\n\t\tconst onLogined = async (isUserLogin?: boolean) => {\r\n\t\t\tawait start(CApp, appConfig, isUserLogin);\r\n\t\t}\r\n\t\treturn <NavView onLogined={onLogined} />;\r\n\t}\r\n\r\n\tReactDOM.render(\r\n\t\t<React.StrictMode>\r\n\t\t\t<App />\r\n\t\t</React.StrictMode>,\r\n\t\tdocument.getElementById('root')\r\n\t);\r\n\r\n\t// If you want your app to work offline and load faster, you can change\r\n\t// unregister() to register() below. Note this comes with some pitfalls.\r\n\t// Learn more about service workers: https://bit.ly/CRA-PWA\r\n\tserviceWorker.unregister();\r\n}\r\n\r\nexport default function createApp() {\r\n\tnav.setSettings(appConfig);\r\n\tconst container = document.createElement('div')\r\n\tcontainer.id = 'app'\r\n\tdocument.body.appendChild(container)\r\n\tconst App: React.FC = () => {\r\n\t\tconst onLogined = async (isUserLogin?: boolean) => {\r\n\t\t\tawait start(CApp, appConfig, isUserLogin);\r\n\t\t}\r\n\t\treturn <NavView onLogined={onLogined} />;\r\n\t}\r\n\r\n\tReactDOM.render(\r\n\t\t<React.StrictMode>\r\n\t\t\t<App />\r\n\t\t</React.StrictMode>,\r\n\t\tcontainer\r\n\t);\r\n}\r\n\r\n\"undefined\" != typeof wx && wx.getSystemInfoSync || startApp()\r\n"],"sourceRoot":""}